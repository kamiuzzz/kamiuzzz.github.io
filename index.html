<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-å­—èŠ‚å®ä¹ " class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/26/%E5%AD%97%E8%8A%82%E5%AE%9E%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2021-04-26T09:29:28.000Z" itemprop="datePublished">2021-04-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/26/%E5%AD%97%E8%8A%82%E5%AE%9E%E4%B9%A0/">å­—èŠ‚å®ä¹ </a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="å­—èŠ‚å®ä¹ "><a href="#å­—èŠ‚å®ä¹ " class="headerlink" title="å­—èŠ‚å®ä¹ "></a>å­—èŠ‚å®ä¹ </h1><p>1.ArrayListå’ŒLinkedListä¼˜ç¼ºç‚¹</p>
<p>2.é”çš„ç§ç±»</p>
<p>3.jvmå†…å­˜ç»“æ„ï¼Œæ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨</p>
<p>4.é”çš„å‡çº§ï¼Œé”èƒ½ä¸èƒ½é™çº§</p>
<p>5.JUC</p>
<p>6.è½»é‡çº§é”çš„è·ç¦»</p>
<p>7.äº‹åŠ¡çš„å‡ ç§å±æ€§ï¼Œä»¥åŠäº‹åŠ¡éš”ç¦»</p>
<p>8.redisä¸€è‡´æ€§</p>
<p>9.ä»‹ç»ä¸€ä¸‹ç´¢å¼•</p>
<p>10.3æ¬¡æ¡æ‰‹ï¼Œèƒ½ä¸èƒ½æ”¹æˆä¸¤æ¬¡</p>
<p>11.é“¾è¡¨ç›¸åŠ </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/26/%E5%AD%97%E8%8A%82%E5%AE%9E%E4%B9%A0/" data-id="cknyemfcb00016oub976hhij4" data-title="å­—èŠ‚å®ä¹ " class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-jvmå­¦ä¹ " class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/18/jvm%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2021-04-18T08:11:29.879Z" itemprop="datePublished">2021-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="JVMå­¦ä¹ "><a href="#JVMå­¦ä¹ " class="headerlink" title="JVMå­¦ä¹ "></a>JVMå­¦ä¹ </h1><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1yE411Z7AP"><strong>è§£å¯†JVMã€é»‘é©¬ç¨‹åºå‘˜å‡ºå“ã€‘</strong></a>æ•™å­¦è§†é¢‘çš„ç¬”è®°ï¼ˆè½¬è½½<a target="_blank" rel="noopener" href="https://nyimac.gitee.io/2020/07/03/JVM%E5%AD%A6%E4%B9%A0/#2%E3%80%81%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95">nyimac</a>ï¼Œåšä¸€æ¡æ‡’ğŸ•ï¼Œè¿™ä¸ªäººåšçš„ä¸é”™ï¼‰</p>
<h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯JVM"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯JVM" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯JVM"></a>ä¸€ã€ä»€ä¹ˆæ˜¯JVM</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>Java Virtual Machineï¼ŒJAVAç¨‹åºçš„<strong>è¿è¡Œç¯å¢ƒ</strong>ï¼ˆJAVAäºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼‰</p>
<h3 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h3><ul>
<li>ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ</li>
<li>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶</li>
<li>æ•°ç»„ä¸‹æ ‡è¶Šç•Œæ£€æŸ¥</li>
</ul>
<h3 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h3><p>JVM JRE JDKçš„åŒºåˆ«</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png" alt="img"></a></p>
<h2 id="äºŒã€å†…å­˜ç»“æ„"><a href="#äºŒã€å†…å­˜ç»“æ„" class="headerlink" title="äºŒã€å†…å­˜ç»“æ„"></a>äºŒã€å†…å­˜ç»“æ„</h2><h3 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a><strong>æ•´ä½“æ¶æ„</strong></h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png" alt="img"></a></p>
<h3 id="1ã€ç¨‹åºè®¡æ•°å™¨"><a href="#1ã€ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="1ã€ç¨‹åºè®¡æ•°å™¨"></a>1ã€ç¨‹åºè®¡æ•°å™¨</h3><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>ç”¨äºä¿å­˜JVMä¸­ä¸‹ä¸€æ¡æ‰€è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€</p>
<h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul>
<li>çº¿ç¨‹ç§æœ‰<ul>
<li>CPUä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡ï¼Œå½“å½“å‰çº¿ç¨‹çš„æ—¶é—´ç‰‡ä½¿ç”¨å®Œä»¥åï¼ŒCPUå°±ä¼šå»æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­çš„ä»£ç </li>
<li>ç¨‹åºè®¡æ•°å™¨æ˜¯<strong>æ¯ä¸ªçº¿ç¨‹</strong>æ‰€<strong>ç§æœ‰</strong>çš„ï¼Œå½“å¦ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œï¼Œåˆè¿”å›æ¥æ‰§è¡Œå½“å‰çº¿ç¨‹çš„ä»£ç æ—¶ï¼Œé€šè¿‡ç¨‹åºè®¡æ•°å™¨å¯ä»¥çŸ¥é“åº”è¯¥æ‰§è¡Œå“ªä¸€å¥æŒ‡ä»¤</li>
</ul>
</li>
<li>ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º</li>
</ul>
<h3 id="2ã€è™šæ‹Ÿæœºæ ˆ"><a href="#2ã€è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="2ã€è™šæ‹Ÿæœºæ ˆ"></a>2ã€è™šæ‹Ÿæœºæ ˆ</h3><h4 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><ul>
<li>æ¯ä¸ª<strong>çº¿ç¨‹</strong>è¿è¡Œéœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œç§°ä¸º<strong>è™šæ‹Ÿæœºæ ˆ</strong></li>
<li>æ¯ä¸ªæ ˆç”±å¤šä¸ª<strong>æ ˆå¸§</strong>ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶æ‰€å ç”¨çš„å†…å­˜</li>
<li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰<strong>ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§</strong>ï¼Œå¯¹åº”ç€<strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•</strong></li>
</ul>
<h4 id="æ¼”ç¤º"><a href="#æ¼”ç¤º" class="headerlink" title="æ¼”ç¤º"></a>æ¼”ç¤º</h4><p>ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		method1();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static void method1() &#123;</span><br><span class="line">		method2(1, 2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static int method2(int a, int b) &#123;</span><br><span class="line">		int c &#x3D; a + b;</span><br><span class="line">		return c;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png" alt="img"></a></p>
<p>åœ¨æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸»ç±»ä¸­çš„æ–¹æ³•åœ¨è¿›å…¥è™šæ‹Ÿæœºæ ˆçš„æ—¶å€™ï¼Œç¬¦åˆæ ˆçš„ç‰¹ç‚¹</p>
<h4 id="é—®é¢˜è¾¨æ"><a href="#é—®é¢˜è¾¨æ" class="headerlink" title="é—®é¢˜è¾¨æ"></a>é—®é¢˜è¾¨æ</h4><ul>
<li>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ<ul>
<li><strong>ä¸éœ€è¦</strong>ã€‚å› ä¸ºè™šæ‹Ÿæœºæ ˆä¸­æ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆçš„ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå¯¹åº”çš„æ ˆå¸§å°±ä¼šè¢«å¼¹å‡ºæ ˆã€‚æ‰€ä»¥æ— éœ€é€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶å»å›æ”¶å†…å­˜ã€‚</li>
</ul>
</li>
<li>æ ˆå†…å­˜çš„åˆ†é…è¶Šå¤§è¶Šå¥½å—ï¼Ÿ<ul>
<li>ä¸æ˜¯ã€‚å› ä¸º<strong>ç‰©ç†å†…å­˜æ˜¯ä¸€å®šçš„</strong>ï¼Œæ ˆå†…å­˜è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒæ›´å¤šçš„é€’å½’è°ƒç”¨ï¼Œä½†æ˜¯å¯æ‰§è¡Œçš„çº¿ç¨‹æ•°å°±ä¼šè¶Šå°‘ã€‚</li>
</ul>
</li>
<li>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ<ul>
<li>å¦‚æœæ–¹æ³•å†…<strong>å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„</li>
<li>å¦‚æœå¦‚æœ<strong>å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡</strong>ï¼Œå¹¶<strong>é€ƒç¦»äº†æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
</ul>
</li>
</ul>
<h4 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><p><strong>Java.lang.stackOverflowError</strong> æ ˆå†…å­˜æº¢å‡º</p>
<p><strong>å‘ç”ŸåŸå› </strong></p>
<ul>
<li>è™šæ‹Ÿæœºæ ˆä¸­ï¼Œ<strong>æ ˆå¸§è¿‡å¤š</strong>ï¼ˆæ— é™é€’å½’ï¼‰</li>
<li>æ¯ä¸ªæ ˆå¸§<strong>æ‰€å ç”¨è¿‡å¤§</strong></li>
</ul>
<h4 id="çº¿ç¨‹è¿è¡Œè¯Šæ–­"><a href="#çº¿ç¨‹è¿è¡Œè¯Šæ–­" class="headerlink" title="çº¿ç¨‹è¿è¡Œè¯Šæ–­"></a>çº¿ç¨‹è¿è¡Œè¯Šæ–­</h4><p>CPUå ç”¨è¿‡é«˜</p>
<ul>
<li>Linuxç¯å¢ƒä¸‹è¿è¡ŒæŸäº›ç¨‹åºçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´CPUçš„å ç”¨è¿‡é«˜ï¼Œè¿™æ—¶éœ€è¦å®šä½å ç”¨CPUè¿‡é«˜çš„çº¿ç¨‹<ul>
<li><strong>top</strong>å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å“ªä¸ª<strong>è¿›ç¨‹</strong>å ç”¨CPUè¿‡é«˜</li>
<li><strong>ps H -eo pid, tidï¼ˆçº¿ç¨‹idï¼‰, %cpu | grep åˆšæ‰é€šè¿‡topæŸ¥åˆ°çš„è¿›ç¨‹å·</strong> é€šè¿‡pså‘½ä»¤è¿›ä¸€æ­¥æŸ¥çœ‹æ˜¯å“ªä¸ªçº¿ç¨‹å ç”¨CPUè¿‡é«˜</li>
<li><strong>jstack è¿›ç¨‹id</strong> é€šè¿‡æŸ¥çœ‹è¿›ç¨‹ä¸­çš„çº¿ç¨‹çš„nidï¼Œåˆšæ‰é€šè¿‡pså‘½ä»¤çœ‹åˆ°çš„tidæ¥<strong>å¯¹æ¯”å®šä½</strong>ï¼Œæ³¨æ„jstackæŸ¥æ‰¾å‡ºçš„çº¿ç¨‹idæ˜¯<strong>16è¿›åˆ¶çš„</strong>ï¼Œ<strong>éœ€è¦è½¬æ¢</strong></li>
</ul>
</li>
</ul>
<h3 id="3ã€æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3ã€æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3ã€æœ¬åœ°æ–¹æ³•æ ˆ"></a>3ã€æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>ä¸€äº›å¸¦æœ‰<strong>nativeå…³é”®å­—</strong>çš„æ–¹æ³•å°±æ˜¯éœ€è¦JAVAå»è°ƒç”¨æœ¬åœ°çš„Cæˆ–è€…C++æ–¹æ³•ï¼Œå› ä¸ºJAVAæœ‰æ—¶å€™æ²¡æ³•ç›´æ¥å’Œæ“ä½œç³»ç»Ÿåº•å±‚äº¤äº’ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°æœ¬åœ°æ–¹æ³•</p>
<h3 id="4ã€å †"><a href="#4ã€å †" class="headerlink" title="4ã€å †"></a>4ã€å †</h3><h4 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>é€šè¿‡newå…³é”®å­—<strong>åˆ›å»ºçš„å¯¹è±¡</strong>éƒ½ä¼šè¢«æ”¾åœ¨å †å†…å­˜</p>
<h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul>
<li><strong>æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>ï¼Œå †å†…å­˜ä¸­çš„å¯¹è±¡éƒ½éœ€è¦<strong>è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</strong></li>
<li>æœ‰åƒåœ¾å›æ”¶æœºåˆ¶</li>
</ul>
<h4 id="å †å†…å­˜æº¢å‡º"><a href="#å †å†…å­˜æº¢å‡º" class="headerlink" title="å †å†…å­˜æº¢å‡º"></a>å †å†…å­˜æº¢å‡º</h4><p><strong>java.lang.OutofMemoryError</strong> ï¼šjava heap space. å †å†…å­˜æº¢å‡º</p>
<h4 id="å †å†…å­˜è¯Šæ–­"><a href="#å †å†…å­˜è¯Šæ–­" class="headerlink" title="å †å†…å­˜è¯Šæ–­"></a>å †å†…å­˜è¯Šæ–­</h4><p><strong>jps</strong></p>
<p><strong>jmap</strong></p>
<p><strong>jconsole</strong></p>
<p><strong>jvirsalvm</strong></p>
<h3 id="5ã€æ–¹æ³•åŒº"><a href="#5ã€æ–¹æ³•åŒº" class="headerlink" title="5ã€æ–¹æ³•åŒº"></a>5ã€æ–¹æ³•åŒº</h3><h4 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png" alt="img"></a></p>
<h4 id="å†…å­˜æº¢å‡º-1"><a href="#å†…å­˜æº¢å‡º-1" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><ul>
<li>1.8ä»¥å‰ä¼šå¯¼è‡´<strong>æ°¸ä¹…ä»£</strong>å†…å­˜æº¢å‡º</li>
<li>1.8ä»¥åä¼šå¯¼è‡´<strong>å…ƒç©ºé—´</strong>å†…å­˜æº¢å‡º</li>
</ul>
<h4 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>äºŒè¿›åˆ¶å­—èŠ‚ç çš„ç»„æˆï¼šç±»çš„åŸºæœ¬ä¿¡æ¯ã€å¸¸é‡æ± ã€ç±»çš„æ–¹æ³•å®šä¹‰ï¼ˆåŒ…å«äº†è™šæ‹ŸæœºæŒ‡ä»¤ï¼‰</p>
<p><strong>é€šè¿‡åç¼–è¯‘æ¥æŸ¥çœ‹ç±»çš„ä¿¡æ¯</strong></p>
<ul>
<li><p>è·å¾—å¯¹åº”ç±»çš„.classæ–‡ä»¶</p>
<ul>
<li><p>åœ¨JDKå¯¹åº”çš„binç›®å½•ä¸‹è¿è¡Œcmdï¼Œ<strong>ä¹Ÿå¯ä»¥åœ¨IDEAæ§åˆ¶å°è¾“å…¥</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150602.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150602.png" alt="img"></a></p>
</li>
<li><p>è¾“å…¥ <strong>javac å¯¹åº”ç±»çš„ç»å¯¹è·¯å¾„</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">F:\JAVA\JDK8.0\bin&gt;javac F:\Thread_study\src\com\nyima\JVM\day01\Main.java</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥å®Œæˆåï¼Œå¯¹åº”çš„ç›®å½•ä¸‹å°±ä¼šå‡ºç°ç±»çš„.classæ–‡ä»¶</p>
</li>
</ul>
</li>
<li><p>åœ¨æ§åˆ¶å°è¾“å…¥ javap -v ç±»çš„ç»å¯¹è·¯å¾„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javap -v F:\Thread_study\src\com\nyima\JVM\day01\Main.class</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>ç„¶åèƒ½åœ¨æ§åˆ¶å°çœ‹åˆ°åç¼–è¯‘ä»¥åç±»çš„ä¿¡æ¯äº†</p>
<ul>
<li><p>ç±»çš„åŸºæœ¬ä¿¡æ¯</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png" alt="img"></a></p>
</li>
<li><p>å¸¸é‡æ± </p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png" alt="img"></a></p>
</li>
<li><p>è™šæ‹Ÿæœºä¸­æ‰§è¡Œç¼–è¯‘çš„æ–¹æ³•ï¼ˆæ¡†å†…çš„æ˜¯çœŸæ­£ç¼–è¯‘æ‰§è¡Œçš„å†…å®¹ï¼Œ**#å·çš„å†…å®¹éœ€è¦åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾**ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png" alt="img"></a></p>
</li>
</ul>
</li>
</ul>
<h4 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h4><ul>
<li>å¸¸é‡æ± <ul>
<li>å°±æ˜¯ä¸€å¼ è¡¨ï¼ˆå¦‚ä¸Šå›¾ä¸­çš„constant poolï¼‰ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ä¿¡æ¯</li>
</ul>
</li>
<li>è¿è¡Œæ—¶å¸¸é‡æ± <ul>
<li>å¸¸é‡æ± æ˜¯*.classæ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥<strong>ç±»è¢«åŠ è½½ä»¥å</strong>ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼š<strong>æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œå¹¶æŠŠé‡Œé¢çš„<strong>ç¬¦å·åœ°å€å˜ä¸ºçœŸå®åœ°å€</strong></li>
</ul>
</li>
</ul>
<h4 id="å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"><a href="#å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»" class="headerlink" title="å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"></a>å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»</h4><h5 id="ä¸²æ± StringTable"><a href="#ä¸²æ± StringTable" class="headerlink" title="ä¸²æ± StringTable"></a><strong>ä¸²æ± </strong>StringTable</h5><p><strong>ç‰¹å¾</strong></p>
<ul>
<li>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œåªæœ‰<strong>åœ¨è¢«ç”¨åˆ°æ—¶æ‰ä¼šè½¬åŒ–ä¸ºå¯¹è±¡</strong></li>
<li>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡</li>
<li>å­—ç¬¦ä¸²<strong>å˜é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯<strong>StringBuilder</strong></li>
<li>å­—ç¬¦ä¸²<strong>å¸¸é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯<strong>ç¼–è¯‘å™¨ä¼˜åŒ–</strong></li>
<li>å¯ä»¥ä½¿ç”¨<strong>internæ–¹æ³•</strong>ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± ä¸­</li>
<li><strong>æ³¨æ„</strong>ï¼šæ— è®ºæ˜¯ä¸²æ± è¿˜æ˜¯å †é‡Œé¢çš„å­—ç¬¦ä¸²ï¼Œéƒ½æ˜¯å¯¹è±¡</li>
</ul>
<p>ç”¨æ¥æ”¾å­—ç¬¦ä¸²å¯¹è±¡ä¸”é‡Œé¢çš„<strong>å…ƒç´ ä¸é‡å¤</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class StringTableStudy &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		String a &#x3D; &quot;a&quot;; </span><br><span class="line">		String b &#x3D; &quot;b&quot;;</span><br><span class="line">		String ab &#x3D; &quot;ab&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ï¼Œéƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä½†è¿™æ˜¯a b ab ä»…æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·ï¼Œ<strong>è¿˜æ²¡æœ‰æˆä¸ºjavaå­—ç¬¦ä¸²</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0: ldc           #2                  &#x2F;&#x2F; String a</span><br><span class="line">2: astore_1</span><br><span class="line">3: ldc           #3                  &#x2F;&#x2F; String b</span><br><span class="line">5: astore_2</span><br><span class="line">6: ldc           #4                  &#x2F;&#x2F; String ab</span><br><span class="line">8: astore_3</span><br><span class="line">9: return</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å½“æ‰§è¡Œåˆ° ldc #2 æ—¶ï¼Œä¼šæŠŠç¬¦å· a å˜ä¸º â€œaâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œ<strong>å¹¶æ”¾å…¥ä¸²æ± ä¸­</strong>ï¼ˆhashtableç»“æ„ ä¸å¯æ‰©å®¹ï¼‰</p>
<p>å½“æ‰§è¡Œåˆ° ldc #3 æ—¶ï¼Œä¼šæŠŠç¬¦å· b å˜ä¸º â€œbâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p>
<p>å½“æ‰§è¡Œåˆ° ldc #4 æ—¶ï¼Œä¼šæŠŠç¬¦å· ab å˜ä¸º â€œabâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p>
<p>æœ€ç»ˆ<strong>StringTable [â€œaâ€, â€œbâ€, â€œabâ€]</strong></p>
<p><strong>æ³¨æ„</strong>ï¼šå­—ç¬¦ä¸²å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯<strong>æ‡’æƒ°çš„</strong>ï¼Œåªæœ‰å½“è¿è¡Œåˆ°é‚£ä¸€è¡Œå­—ç¬¦ä¸²ä¸”åœ¨ä¸²æ± ä¸­ä¸å­˜åœ¨çš„æ—¶å€™ï¼ˆå¦‚ ldc #2ï¼‰æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²æ‰ä¼šè¢«åˆ›å»ºå¹¶æ”¾å…¥ä¸²æ± ä¸­ã€‚</p>
<p>ä½¿ç”¨æ‹¼æ¥<strong>å­—ç¬¦ä¸²å˜é‡å¯¹è±¡</strong>åˆ›å»ºå­—ç¬¦ä¸²çš„è¿‡ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class StringTableStudy &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		String a &#x3D; &quot;a&quot;;</span><br><span class="line">		String b &#x3D; &quot;b&quot;;</span><br><span class="line">		String ab &#x3D; &quot;ab&quot;;</span><br><span class="line">		&#x2F;&#x2F;æ‹¼æ¥å­—ç¬¦ä¸²å¯¹è±¡æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²</span><br><span class="line">		String ab2 &#x3D; a+b; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>åç¼–è¯‘åçš„ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">	 Code:</span><br><span class="line">      stack&#x3D;2, locals&#x3D;5, args_size&#x3D;1</span><br><span class="line">         0: ldc           #2                  &#x2F;&#x2F; String a</span><br><span class="line">         2: astore_1</span><br><span class="line">         3: ldc           #3                  &#x2F;&#x2F; String b</span><br><span class="line">         5: astore_2</span><br><span class="line">         6: ldc           #4                  &#x2F;&#x2F; String ab</span><br><span class="line">         8: astore_3</span><br><span class="line">         9: new           #5                  &#x2F;&#x2F; class java&#x2F;lang&#x2F;StringBuilder</span><br><span class="line">        12: dup</span><br><span class="line">        13: invokespecial #6                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;StringBuilder.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">        16: aload_1</span><br><span class="line">        17: invokevirtual #7                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;StringBuilder.append:(Ljava&#x2F;lang&#x2F;String</span><br><span class="line">;)Ljava&#x2F;lang&#x2F;StringBuilder;</span><br><span class="line">        20: aload_2</span><br><span class="line">        21: invokevirtual #7                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;StringBuilder.append:(Ljava&#x2F;lang&#x2F;String</span><br><span class="line">;)Ljava&#x2F;lang&#x2F;StringBuilder;</span><br><span class="line">        24: invokevirtual #8                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;StringBuilder.toString:()Ljava&#x2F;lang&#x2F;Str</span><br><span class="line">ing;</span><br><span class="line">        27: astore        4</span><br><span class="line">        29: return</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ‹¼æ¥çš„æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²çš„<strong>è¿‡ç¨‹</strong>æ˜¯ï¼šStringBuilder().append(â€œaâ€).append(â€œbâ€).toString()</p>
<p>æœ€åçš„toStringæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª<strong>æ–°çš„å­—ç¬¦ä¸²</strong>ï¼Œä½†å­—ç¬¦ä¸²çš„<strong>å€¼</strong>å’Œæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸€è‡´ï¼Œä½†æ˜¯ä¸¤ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ï¼Œ<strong>ä¸€ä¸ªå­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œä¸€ä¸ªå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String ab &#x3D; &quot;ab&quot;;</span><br><span class="line">String ab2 &#x3D; a+b;</span><br><span class="line">&#x2F;&#x2F;ç»“æœä¸ºfalse,å› ä¸ºabæ˜¯å­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œab2æ˜¯ç”±StringBufferçš„toStringæ–¹æ³•æ‰€è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br><span class="line">System.out.println(ab &#x3D;&#x3D; ab2);</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡å¯¹è±¡</strong>çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class StringTableStudy &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		String a &#x3D; &quot;a&quot;;</span><br><span class="line">		String b &#x3D; &quot;b&quot;;</span><br><span class="line">		String ab &#x3D; &quot;ab&quot;;</span><br><span class="line">		String ab2 &#x3D; a+b;</span><br><span class="line">		&#x2F;&#x2F;ä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</span><br><span class="line">		String ab3 &#x3D; &quot;a&quot; + &quot;b&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>åç¼–è¯‘åçš„ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> 	  Code:</span><br><span class="line">      stack&#x3D;2, locals&#x3D;6, args_size&#x3D;1</span><br><span class="line">         0: ldc           #2                  &#x2F;&#x2F; String a</span><br><span class="line">         2: astore_1</span><br><span class="line">         3: ldc           #3                  &#x2F;&#x2F; String b</span><br><span class="line">         5: astore_2</span><br><span class="line">         6: ldc           #4                  &#x2F;&#x2F; String ab</span><br><span class="line">         8: astore_3</span><br><span class="line">         9: new           #5                  &#x2F;&#x2F; class java&#x2F;lang&#x2F;StringBuilder</span><br><span class="line">        12: dup</span><br><span class="line">        13: invokespecial #6                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;StringBuilder.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">        16: aload_1</span><br><span class="line">        17: invokevirtual #7                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;StringBuilder.append:(Ljava&#x2F;lang&#x2F;String</span><br><span class="line">;)Ljava&#x2F;lang&#x2F;StringBuilder;</span><br><span class="line">        20: aload_2</span><br><span class="line">        21: invokevirtual #7                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;StringBuilder.append:(Ljava&#x2F;lang&#x2F;String</span><br><span class="line">;)Ljava&#x2F;lang&#x2F;StringBuilder;</span><br><span class="line">        24: invokevirtual #8                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;StringBuilder.toString:()Ljava&#x2F;lang&#x2F;Str</span><br><span class="line">ing;</span><br><span class="line">        27: astore        4</span><br><span class="line">        &#x2F;&#x2F;ab3åˆå§‹åŒ–æ—¶ç›´æ¥ä»ä¸²æ± ä¸­è·å–å­—ç¬¦ä¸²</span><br><span class="line">        29: ldc           #4                  &#x2F;&#x2F; String ab</span><br><span class="line">        31: astore        5</span><br><span class="line">        33: return</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸º<strong>å†…å®¹æ˜¯å¸¸é‡ï¼Œjavacåœ¨ç¼–è¯‘æœŸä¼šè¿›è¡Œä¼˜åŒ–ï¼Œç»“æœå·²åœ¨ç¼–è¯‘æœŸç¡®å®šä¸ºab</strong>ï¼Œè€Œåˆ›å»ºabçš„æ—¶å€™å·²ç»åœ¨ä¸²æ± ä¸­æ”¾å…¥äº†â€œabâ€ï¼Œæ‰€ä»¥ab3ç›´æ¥ä»ä¸²æ± ä¸­è·å–å€¼ï¼Œæ‰€ä»¥è¿›è¡Œçš„æ“ä½œå’Œ ab = â€œabâ€ ä¸€è‡´ã€‚</li>
<li>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å˜é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸ºå†…å®¹æ˜¯å˜é‡ï¼Œåªèƒ½<strong>åœ¨è¿è¡ŒæœŸç¡®å®šå®ƒçš„å€¼ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨StringBuilderæ¥åˆ›å»º</strong></li>
</ul>
<h5 id="internæ–¹æ³•-1-8"><a href="#internæ–¹æ³•-1-8" class="headerlink" title="internæ–¹æ³• 1.8"></a>internæ–¹æ³• 1.8</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p>
<ul>
<li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥æˆåŠŸ</li>
<li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li>
</ul>
<p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p>
<p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶å¦‚æœè°ƒç”¨internæ–¹æ³•æˆåŠŸï¼Œå †å†…å­˜ä¸ä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</p>
<p><strong>ä¾‹1</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		&#x2F;&#x2F;&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­ï¼Œstråˆ™å­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br><span class="line">		String str &#x3D; new String(&quot;a&quot;) + new String(&quot;b&quot;);</span><br><span class="line">		&#x2F;&#x2F;è°ƒç”¨strçš„internæ–¹æ³•ï¼Œè¿™æ—¶ä¸²æ± ä¸­æ²¡æœ‰&quot;ab&quot;ï¼Œåˆ™ä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥åˆ°ä¸²æ± ä¸­ï¼Œæ­¤æ—¶å †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span><br><span class="line">		String st2 &#x3D; str.intern();</span><br><span class="line">		&#x2F;&#x2F;ç»™str3èµ‹å€¼ï¼Œå› ä¸ºæ­¤æ—¶ä¸²æ± ä¸­å·²æœ‰&quot;ab&quot;ï¼Œåˆ™ç›´æ¥å°†ä¸²æ± ä¸­çš„å†…å®¹è¿”å›</span><br><span class="line">		String str3 &#x3D; &quot;ab&quot;;</span><br><span class="line">		&#x2F;&#x2F;å› ä¸ºå †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä»¥ä¸‹ä¸¤æ¡è¯­å¥æ‰“å°çš„éƒ½ä¸ºtrue</span><br><span class="line">		System.out.println(str &#x3D;&#x3D; st2);</span><br><span class="line">		System.out.println(str &#x3D;&#x3D; str3);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>ä¾‹2</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">        &#x2F;&#x2F;æ­¤å¤„åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡&quot;ab&quot;ï¼Œå› ä¸ºä¸²æ± ä¸­è¿˜æ²¡æœ‰&quot;ab&quot;ï¼Œæ‰€ä»¥å°†å…¶æ”¾å…¥ä¸²æ± ä¸­</span><br><span class="line">		String str3 &#x3D; &quot;ab&quot;;</span><br><span class="line">        &#x2F;&#x2F;&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­ï¼Œstråˆ™å­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br><span class="line">		String str &#x3D; new String(&quot;a&quot;) + new String(&quot;b&quot;);</span><br><span class="line">        &#x2F;&#x2F;æ­¤æ—¶å› ä¸ºåœ¨åˆ›å»ºstr3æ—¶ï¼Œ&quot;ab&quot;å·²å­˜åœ¨ä¸ä¸²æ± ä¸­ï¼Œæ‰€ä»¥æ”¾å…¥å¤±è´¥ï¼Œä½†æ˜¯ä¼šè¿”å›ä¸²æ± ä¸­çš„&quot;ab&quot;</span><br><span class="line">		String str2 &#x3D; str.intern();</span><br><span class="line">        &#x2F;&#x2F;false</span><br><span class="line">		System.out.println(str &#x3D;&#x3D; str2);</span><br><span class="line">        &#x2F;&#x2F;false</span><br><span class="line">		System.out.println(str &#x3D;&#x3D; str3);</span><br><span class="line">        &#x2F;&#x2F;true</span><br><span class="line">		System.out.println(str2 &#x3D;&#x3D; str3);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h5 id="internæ–¹æ³•-1-6"><a href="#internæ–¹æ³•-1-6" class="headerlink" title="internæ–¹æ³• 1.6"></a>internæ–¹æ³• 1.6</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p>
<ul>
<li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œå†æ”¾å…¥åˆ°ä¸²æ± ä¸­</li>
<li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li>
</ul>
<p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p>
<p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶æ— è®ºè°ƒç”¨internæ–¹æ³•æˆåŠŸä¸å¦ï¼Œä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡å’Œå †å†…å­˜ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡<strong>éƒ½ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</strong></p>
<h4 id="StringTable-åƒåœ¾å›æ”¶"><a href="#StringTable-åƒåœ¾å›æ”¶" class="headerlink" title="StringTable åƒåœ¾å›æ”¶"></a>StringTable åƒåœ¾å›æ”¶</h4><p>StringTableåœ¨å†…å­˜ç´§å¼ æ—¶ï¼Œä¼šå‘ç”Ÿåƒåœ¾å›æ”¶</p>
<h4 id="StringTableè°ƒä¼˜"><a href="#StringTableè°ƒä¼˜" class="headerlink" title="StringTableè°ƒä¼˜"></a>StringTableè°ƒä¼˜</h4><ul>
<li><p>å› ä¸ºStringTableæ˜¯ç”±HashTableå®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥<strong>é€‚å½“å¢åŠ HashTableæ¡¶çš„ä¸ªæ•°</strong>ï¼Œæ¥å‡å°‘å­—ç¬¦ä¸²æ”¾å…¥ä¸²æ± æ‰€éœ€è¦çš„æ—¶é—´</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:StringTableSize&#x3D;xxxx</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>è€ƒè™‘æ˜¯å¦éœ€è¦å°†å­—ç¬¦ä¸²å¯¹è±¡å…¥æ± </p>
<p>å¯ä»¥é€šè¿‡<strong>internæ–¹æ³•å‡å°‘é‡å¤å…¥æ± </strong></p>
</li>
</ul>
<h3 id="6ã€ç›´æ¥å†…å­˜"><a href="#6ã€ç›´æ¥å†…å­˜" class="headerlink" title="6ã€ç›´æ¥å†…å­˜"></a>6ã€ç›´æ¥å†…å­˜</h3><ul>
<li>å±äºæ“ä½œç³»ç»Ÿï¼Œå¸¸è§äºNIOæ“ä½œæ—¶ï¼Œ<strong>ç”¨äºæ•°æ®ç¼“å†²åŒº</strong></li>
<li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜</li>
<li>ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç†</li>
</ul>
<h4 id="æ–‡ä»¶è¯»å†™æµç¨‹"><a href="#æ–‡ä»¶è¯»å†™æµç¨‹" class="headerlink" title="æ–‡ä»¶è¯»å†™æµç¨‹"></a>æ–‡ä»¶è¯»å†™æµç¨‹</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png" alt="img"></a></p>
<p><strong>ä½¿ç”¨äº†DirectBuffer</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png" alt="img"></a></p>
<p>ç›´æ¥å†…å­˜æ˜¯æ“ä½œç³»ç»Ÿå’ŒJavaä»£ç <strong>éƒ½å¯ä»¥è®¿é—®çš„ä¸€å—åŒºåŸŸ</strong>ï¼Œæ— éœ€å°†ä»£ç ä»ç³»ç»Ÿå†…å­˜å¤åˆ¶åˆ°Javaå †å†…å­˜ï¼Œä»è€Œæé«˜äº†æ•ˆç‡</p>
<h4 id="é‡Šæ”¾åŸç†"><a href="#é‡Šæ”¾åŸç†" class="headerlink" title="é‡Šæ”¾åŸç†"></a>é‡Šæ”¾åŸç†</h4><p>ç›´æ¥å†…å­˜çš„å›æ”¶ä¸æ˜¯é€šè¿‡JVMçš„åƒåœ¾å›æ”¶æ¥é‡Šæ”¾çš„ï¼Œè€Œæ˜¯é€šè¿‡<strong>unsafe.freeMemory</strong>æ¥æ‰‹åŠ¨é‡Šæ”¾</p>
<p>é€šè¿‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;é€šè¿‡ByteBufferç”³è¯·1Mçš„ç›´æ¥å†…å­˜</span><br><span class="line">ByteBuffer byteBuffer &#x3D; ByteBuffer.allocateDirect(_1M);</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ç”³è¯·ç›´æ¥å†…å­˜ï¼Œä½†JVMå¹¶ä¸èƒ½å›æ”¶ç›´æ¥å†…å­˜ä¸­çš„å†…å®¹ï¼Œå®ƒæ˜¯å¦‚ä½•å®ç°å›æ”¶çš„å‘¢ï¼Ÿ</p>
<p><strong>allocateDirectçš„å®ç°</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static ByteBuffer allocateDirect(int capacity) &#123;</span><br><span class="line">    return new DirectByteBuffer(capacity);</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>DirectByteBufferç±»</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">DirectByteBuffer(int cap) &#123;   &#x2F;&#x2F; package-private</span><br><span class="line">   </span><br><span class="line">    super(-1, 0, cap, cap);</span><br><span class="line">    boolean pa &#x3D; VM.isDirectMemoryPageAligned();</span><br><span class="line">    int ps &#x3D; Bits.pageSize();</span><br><span class="line">    long size &#x3D; Math.max(1L, (long)cap + (pa ? ps : 0));</span><br><span class="line">    Bits.reserveMemory(size, cap);</span><br><span class="line"></span><br><span class="line">    long base &#x3D; 0;</span><br><span class="line">    try &#123;</span><br><span class="line">        base &#x3D; unsafe.allocateMemory(size); &#x2F;&#x2F;ç”³è¯·å†…å­˜</span><br><span class="line">    &#125; catch (OutOfMemoryError x) &#123;</span><br><span class="line">        Bits.unreserveMemory(size, cap);</span><br><span class="line">        throw x;</span><br><span class="line">    &#125;</span><br><span class="line">    unsafe.setMemory(base, size, (byte) 0);</span><br><span class="line">    if (pa &amp;&amp; (base % ps !&#x3D; 0)) &#123;</span><br><span class="line">        &#x2F;&#x2F; Round up to page boundary</span><br><span class="line">        address &#x3D; base + ps - (base &amp; (ps - 1));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        address &#x3D; base;</span><br><span class="line">    &#125;</span><br><span class="line">    cleaner &#x3D; Cleaner.create(this, new Deallocator(base, size, cap)); &#x2F;&#x2F;é€šè¿‡è™šå¼•ç”¨ï¼Œæ¥å®ç°ç›´æ¥å†…å­˜çš„é‡Šæ”¾ï¼Œthisä¸ºè™šå¼•ç”¨çš„å®é™…å¯¹è±¡</span><br><span class="line">    att &#x3D; null;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªCleanerçš„createæ–¹æ³•ï¼Œä¸”åå°çº¿ç¨‹è¿˜ä¼šå¯¹è™šå¼•ç”¨çš„å¯¹è±¡ç›‘æµ‹ï¼Œå¦‚æœè™šå¼•ç”¨çš„å®é™…å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯DirectByteBufferï¼‰è¢«å›æ”¶ä»¥åï¼Œå°±ä¼šè°ƒç”¨Cleanerçš„cleanæ–¹æ³•ï¼Œæ¥æ¸…é™¤ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void clean() &#123;</span><br><span class="line">       if (remove(this)) &#123;</span><br><span class="line">           try &#123;</span><br><span class="line">               this.thunk.run(); &#x2F;&#x2F;è°ƒç”¨runæ–¹æ³•</span><br><span class="line">           &#125; catch (final Throwable var2) &#123;</span><br><span class="line">               AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">                   public Void run() &#123;</span><br><span class="line">                       if (System.err !&#x3D; null) &#123;</span><br><span class="line">                           (new Error(&quot;Cleaner terminated abnormally&quot;, var2)).printStackTrace();</span><br><span class="line">                       &#125;</span><br><span class="line"></span><br><span class="line">                       System.exit(1);</span><br><span class="line">                       return null;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;);</span><br><span class="line">           &#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”å¯¹è±¡çš„runæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void run() &#123;</span><br><span class="line">    if (address &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        &#x2F;&#x2F; Paranoia</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    unsafe.freeMemory(address); &#x2F;&#x2F;é‡Šæ”¾ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</span><br><span class="line">    address &#x3D; 0;</span><br><span class="line">    Bits.unreserveMemory(size, capacity);</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h5 id="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"><a href="#ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“" class="headerlink" title="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"></a>ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“</h5><ul>
<li>ä½¿ç”¨äº†Unsafeç±»æ¥å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶ï¼Œå›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨freeMemoryæ–¹æ³•</li>
<li>ByteBufferçš„å®ç°å†…éƒ¨ä½¿ç”¨äº†Cleanerï¼ˆè™šå¼•ç”¨ï¼‰æ¥æ£€æµ‹ByteBufferã€‚ä¸€æ—¦ByteBufferè¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆä¼šç”±ReferenceHandleræ¥è°ƒç”¨Cleanerçš„cleanæ–¹æ³•è°ƒç”¨freeMemoryæ¥é‡Šæ”¾å†…å­˜</li>
</ul>
<h2 id="ä¸‰ã€åƒåœ¾å›æ”¶"><a href="#ä¸‰ã€åƒåœ¾å›æ”¶" class="headerlink" title="ä¸‰ã€åƒåœ¾å›æ”¶"></a>ä¸‰ã€åƒåœ¾å›æ”¶</h2><h3 id="1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"><a href="#1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶" class="headerlink" title="1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"></a>1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶</h3><h4 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h4><p>å¼Šç«¯ï¼šå¾ªç¯å¼•ç”¨æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„è®¡æ•°éƒ½ä¸º1ï¼Œå¯¼è‡´ä¸¤ä¸ªå¯¹è±¡éƒ½æ— æ³•è¢«é‡Šæ”¾</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150750.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150750.png" alt="img"></a></p>
<h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h4><ul>
<li>JVMä¸­çš„åƒåœ¾å›æ”¶å™¨é€šè¿‡<strong>å¯è¾¾æ€§åˆ†æ</strong>æ¥æ¢ç´¢æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡</li>
<li>æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹èƒ½å¦æ²¿ç€GC Rootå¯¹è±¡ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¦‚æœ<strong>æ‰¾ä¸åˆ°ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å›æ”¶</strong></li>
<li>å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡<ul>
<li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚ã€€</li>
<li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
</li>
</ul>
<h4 id="äº”ç§å¼•ç”¨"><a href="#äº”ç§å¼•ç”¨" class="headerlink" title="äº”ç§å¼•ç”¨"></a>äº”ç§å¼•ç”¨</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150800.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150800.png" alt="img"></a></p>
<h5 id="å¼ºå¼•ç”¨"><a href="#å¼ºå¼•ç”¨" class="headerlink" title="å¼ºå¼•ç”¨"></a>å¼ºå¼•ç”¨</h5><p>åªæœ‰GC Root<strong>éƒ½ä¸å¼•ç”¨</strong>è¯¥å¯¹è±¡æ—¶ï¼Œæ‰ä¼šå›æ”¶<strong>å¼ºå¼•ç”¨</strong>å¯¹è±¡</p>
<ul>
<li>å¦‚ä¸Šå›¾Bã€Cå¯¹è±¡éƒ½ä¸å¼•ç”¨A1å¯¹è±¡æ—¶ï¼ŒA1å¯¹è±¡æ‰ä¼šè¢«å›æ”¶</li>
</ul>
<h5 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h5><p>å½“GC RootæŒ‡å‘è½¯å¼•ç”¨å¯¹è±¡æ—¶ï¼Œåœ¨<strong>å†…å­˜ä¸è¶³æ—¶</strong>ï¼Œä¼š<strong>å›æ”¶è½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A2å¯¹è±¡ä¸”å†…å­˜ä¸è¶³æ—¶ï¼Œè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„A2å¯¹è±¡å°±ä¼šè¢«å›æ”¶</li>
</ul>
<h6 id="è½¯å¼•ç”¨çš„ä½¿ç”¨"><a href="#è½¯å¼•ç”¨çš„ä½¿ç”¨" class="headerlink" title="è½¯å¼•ç”¨çš„ä½¿ç”¨"></a>è½¯å¼•ç”¨çš„ä½¿ç”¨</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Demo1 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		final int _4M &#x3D; 4*1024*1024;</span><br><span class="line">		&#x2F;&#x2F;ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span><br><span class="line">		List&lt;SoftReference&lt;byte[]&gt;&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">		SoftReference&lt;byte[]&gt; ref&#x3D; new SoftReference&lt;&gt;(new byte[_4M]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨åƒåœ¾å›æ”¶æ—¶å‘ç°å†…å­˜ä¸è¶³ï¼Œåœ¨å›æ”¶è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡æ—¶ï¼Œ<strong>è½¯å¼•ç”¨æœ¬èº«ä¸ä¼šè¢«æ¸…ç†</strong></p>
<p>å¦‚æœæƒ³è¦<strong>æ¸…ç†è½¯å¼•ç”¨</strong>ï¼Œéœ€è¦ä½¿<strong>ç”¨å¼•ç”¨é˜Ÿåˆ—</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Demo1 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		final int _4M &#x3D; 4*1024*1024;</span><br><span class="line">		&#x2F;&#x2F;ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—ï¼Œç”¨äºç§»é™¤å¼•ç”¨ä¸ºç©ºçš„è½¯å¼•ç”¨å¯¹è±¡</span><br><span class="line">		ReferenceQueue&lt;byte[]&gt; queue &#x3D; new ReferenceQueue&lt;&gt;();</span><br><span class="line">		&#x2F;&#x2F;ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span><br><span class="line">		List&lt;SoftReference&lt;byte[]&gt;&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">		SoftReference&lt;byte[]&gt; ref&#x3D; new SoftReference&lt;&gt;(new byte[_4M]);</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F;éå†å¼•ç”¨é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å…ƒç´ ï¼Œåˆ™ç§»é™¤</span><br><span class="line">		Reference&lt;? extends byte[]&gt; poll &#x3D; queue.poll();</span><br><span class="line">		while(poll !&#x3D; null) &#123;</span><br><span class="line">			&#x2F;&#x2F;å¼•ç”¨é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™ä»é›†åˆä¸­ç§»é™¤è¯¥å…ƒç´ </span><br><span class="line">			list.remove(poll);</span><br><span class="line">			&#x2F;&#x2F;ç§»åŠ¨åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span><br><span class="line">			poll &#x3D; queue.poll();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>å¤§æ¦‚æ€è·¯ä¸ºï¼š</strong>æŸ¥çœ‹å¼•ç”¨é˜Ÿåˆ—ä¸­æœ‰æ— è½¯å¼•ç”¨ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å°†è¯¥è½¯å¼•ç”¨ä»å­˜æ”¾å®ƒçš„é›†åˆä¸­ç§»é™¤ï¼ˆè¿™é‡Œä¸ºä¸€ä¸ªlisté›†åˆï¼‰</p>
<h5 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h5><p>åªæœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œ<strong>æ— è®ºå†…å­˜æ˜¯å¦å……è¶³</strong>ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</p>
<ul>
<li>å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A3å¯¹è±¡ï¼Œåˆ™A3å¯¹è±¡ä¼šè¢«å›æ”¶</li>
</ul>
<p><strong>å¼±å¼•ç”¨çš„ä½¿ç”¨å’Œè½¯å¼•ç”¨ç±»ä¼¼</strong>ï¼Œåªæ˜¯å°† <strong>SoftReference æ¢ä¸ºäº† WeakReference</strong></p>
<h5 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a><strong>è™šå¼•ç”¨</strong></h5><p>å½“è™šå¼•ç”¨å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œè°ƒç”¨è™šå¼•ç”¨çš„æ–¹æ³•</p>
<ul>
<li>è™šå¼•ç”¨çš„ä¸€ä¸ªä½“ç°æ˜¯<strong>é‡Šæ”¾ç›´æ¥å†…å­˜æ‰€åˆ†é…çš„å†…å­˜</strong>ï¼Œå½“å¼•ç”¨çš„å¯¹è±¡ByteBufferè¢«åƒåœ¾å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡Cleanerå°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨Cleanerçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li>
<li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨ByteBufferå¯¹è±¡ï¼ŒByteBufferå°±ä¼šè¢«å›æ”¶ã€‚ä½†æ˜¯ç›´æ¥å†…å­˜ä¸­çš„å†…å­˜è¿˜æœªè¢«å›æ”¶ã€‚è¿™æ—¶éœ€è¦å°†è™šå¼•ç”¨å¯¹è±¡Cleaneræ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨å®ƒçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li>
</ul>
<h5 id="ç»ˆç»“å™¨å¼•ç”¨"><a href="#ç»ˆç»“å™¨å¼•ç”¨" class="headerlink" title="ç»ˆç»“å™¨å¼•ç”¨"></a>ç»ˆç»“å™¨å¼•ç”¨</h5><p>æ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿è‡ªObjectç±»ï¼ŒObjectç±»æœ‰ä¸€ä¸ªfinalizeæ–¹æ³•ã€‚å½“æŸä¸ªå¯¹è±¡ä¸å†è¢«å…¶ä»–çš„å¯¹è±¡æ‰€å¼•ç”¨æ—¶ï¼Œä¼šå…ˆå°†ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ”¾å…¥é¥®ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åæ ¹æ®ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</p>
<ul>
<li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨A4å¯¹è±¡ã€‚è¿™æ˜¯ç»ˆç»“å™¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œå¼•ç”¨é˜Ÿåˆ—ä¼šæ ¹æ®å®ƒï¼Œæ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åè°ƒç”¨è¢«å¼•ç”¨å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</li>
</ul>
<h5 id="å¼•ç”¨é˜Ÿåˆ—"><a href="#å¼•ç”¨é˜Ÿåˆ—" class="headerlink" title="å¼•ç”¨é˜Ÿåˆ—"></a>å¼•ç”¨é˜Ÿåˆ—</h5><ul>
<li><p>è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨</p>
<p>å¯ä»¥é…åˆ</p>
<p>å¼•ç”¨é˜Ÿåˆ—</p>
<ul>
<li>åœ¨<strong>å¼±å¼•ç”¨</strong>å’Œ<strong>è™šå¼•ç”¨</strong>æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œä¼šå°†è¿™äº›å¼•ç”¨æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œæ–¹ä¾¿ä¸€èµ·å›æ”¶è¿™äº›è½¯/å¼±å¼•ç”¨å¯¹è±¡</li>
</ul>
</li>
<li><p>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨</p>
<p>å¿…é¡»é…åˆ</p>
<p>å¼•ç”¨é˜Ÿåˆ—</p>
<ul>
<li>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨åœ¨ä½¿ç”¨æ—¶ä¼šå…³è”ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—</li>
</ul>
</li>
</ul>
<h3 id="2ã€åƒåœ¾å›æ”¶ç®—æ³•"><a href="#2ã€åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="2ã€åƒåœ¾å›æ”¶ç®—æ³•"></a>2ã€åƒåœ¾å›æ”¶ç®—æ³•</h3><h4 id="æ ‡è®°-æ¸…é™¤"><a href="#æ ‡è®°-æ¸…é™¤" class="headerlink" title="æ ‡è®°-æ¸…é™¤"></a>æ ‡è®°-æ¸…é™¤</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150813.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150813.png" alt="img"></a></p>
<p><strong>å®šä¹‰</strong>ï¼šæ ‡è®°æ¸…é™¤ç®—æ³•é¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‡åœ¨è™šæ‹Ÿæœºæ‰§è¡Œåƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆé‡‡ç”¨æ ‡è®°ç®—æ³•ç¡®å®šå¯å›æ”¶å¯¹è±¡ï¼Œç„¶ååƒåœ¾æ”¶é›†å™¨æ ¹æ®æ ‡è¯†æ¸…é™¤ç›¸åº”çš„å†…å®¹ï¼Œç»™å †å†…å­˜è…¾å‡ºç›¸åº”çš„ç©ºé—´</p>
<ul>
<li>è¿™é‡Œçš„è…¾å‡ºå†…å­˜ç©ºé—´å¹¶ä¸æ˜¯å°†å†…å­˜ç©ºé—´çš„å­—èŠ‚æ¸…0ï¼Œè€Œæ˜¯è®°å½•ä¸‹è¿™æ®µå†…å­˜çš„èµ·å§‹ç»“æŸåœ°å€ï¼Œä¸‹æ¬¡åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œä¼šç›´æ¥<strong>è¦†ç›–</strong>è¿™æ®µå†…å­˜</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š<strong>å®¹æ˜“äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡</strong>ï¼Œå¯èƒ½æ— æ³•æ»¡è¶³å¤§å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œä¸€æ—¦å¯¼è‡´æ— æ³•åˆ†é…å¯¹è±¡ï¼Œé‚£å°±ä¼šå¯¼è‡´jvmå¯åŠ¨gcï¼Œä¸€æ—¦å¯åŠ¨gcï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±ä¼šæš‚åœï¼Œè¿™å°±å¯¼è‡´åº”ç”¨çš„å“åº”é€Ÿåº¦å˜æ…¢</p>
<h4 id="æ ‡è®°-æ•´ç†"><a href="#æ ‡è®°-æ•´ç†" class="headerlink" title="æ ‡è®°-æ•´ç†"></a>æ ‡è®°-æ•´ç†</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150827.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150827.png" alt="img"></a></p>
<p>æ ‡è®°-æ•´ç† ä¼šå°†ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡å›æ”¶ï¼Œæ¸…æ¥šå…¶å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç„¶åæ•´ç†å‰©ä½™çš„å¯¹è±¡ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å› å†…å­˜ç¢ç‰‡è€Œå¯¼è‡´çš„é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ•´ä½“éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´ï¼Œæ‰€ä»¥æ•ˆç‡è¾ƒä½</p>
<h4 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150842.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150842.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150856.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150856.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150907.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150907.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150919.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150919.png" alt="img"></a></p>
<p>å°†å†…å­˜åˆ†ä¸ºç­‰å¤§å°çš„ä¸¤ä¸ªåŒºåŸŸï¼ŒFROMå’ŒTOï¼ˆTOä¸­ä¸ºç©ºï¼‰ã€‚å…ˆå°†è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ä»FROMæ”¾å…¥TOä¸­ï¼Œå†å›æ”¶ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åäº¤æ¢FROMå’ŒTOã€‚è¿™æ ·ä¹Ÿå¯ä»¥é¿å…å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šå ç”¨åŒå€çš„å†…å­˜ç©ºé—´ã€‚</p>
<h3 id="3ã€åˆ†ä»£å›æ”¶"><a href="#3ã€åˆ†ä»£å›æ”¶" class="headerlink" title="3ã€åˆ†ä»£å›æ”¶"></a>3ã€åˆ†ä»£å›æ”¶</h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150931.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150931.png" alt="img"></a></p>
<h4 id="å›æ”¶æµç¨‹"><a href="#å›æ”¶æµç¨‹" class="headerlink" title="å›æ”¶æµç¨‹"></a>å›æ”¶æµç¨‹</h4><p>æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½è¢«æ”¾åœ¨äº†<strong>æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­</strong>ä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150939.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150939.png" alt="img"></a></p>
<p>å½“ä¼Šç”¸å›­ä¸­çš„å†…å­˜ä¸è¶³æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œè¿™æ—¶çš„å›æ”¶å«åš <strong>Minor GC</strong></p>
<p>Minor GC ä¼šå°†<strong>ä¼Šç”¸å›­å’Œå¹¸å­˜åŒºFROM</strong>å­˜æ´»çš„å¯¹è±¡<strong>å…ˆ</strong>å¤åˆ¶åˆ° <strong>å¹¸å­˜åŒº TO</strong>ä¸­ï¼Œ å¹¶è®©å…¶<strong>å¯¿å‘½åŠ 1</strong>ï¼Œå†<strong>äº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒº</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150946.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150946.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150955.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150955.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151002.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151002.png" alt="img"></a></p>
<p>å†æ¬¡åˆ›å»ºå¯¹è±¡ï¼Œè‹¥æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­åˆæ»¡äº†ï¼Œåˆ™ä¼š<strong>å†æ¬¡è§¦å‘ Minor GC</strong>ï¼ˆä¼šè§¦å‘ <strong>stop the world</strong>ï¼Œ æš‚åœå…¶ä»–ç”¨æˆ·çº¿ç¨‹ï¼Œåªè®©åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œï¼‰ï¼Œè¿™æ—¶ä¸ä»…ä¼šå›æ”¶ä¼Šç”¸å›­ä¸­çš„åƒåœ¾ï¼Œ<strong>è¿˜ä¼šå›æ”¶å¹¸å­˜åŒºä¸­çš„åƒåœ¾</strong>ï¼Œå†å°†æ´»è·ƒå¯¹è±¡å¤åˆ¶åˆ°å¹¸å­˜åŒºTOä¸­ã€‚å›æ”¶ä»¥åä¼šäº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒºï¼Œå¹¶è®©å¹¸å­˜åŒºä¸­çš„å¯¹è±¡<strong>å¯¿å‘½åŠ 1</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151010.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151010.png" alt="img"></a></p>
<p>å¦‚æœå¹¸å­˜åŒºä¸­çš„å¯¹è±¡çš„<strong>å¯¿å‘½è¶…è¿‡æŸä¸ªé˜ˆå€¼</strong>ï¼ˆæœ€å¤§ä¸º15ï¼Œ4bitï¼‰ï¼Œå°±ä¼šè¢«<strong>æ”¾å…¥è€å¹´ä»£</strong>ä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151018.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151018.png" alt="img"></a></p>
<p>å¦‚æœæ–°ç”Ÿä»£è€å¹´ä»£ä¸­çš„å†…å­˜éƒ½æ»¡äº†ï¼Œå°±ä¼šå…ˆå‡ºæ³•Minor Gcï¼Œå†è§¦å‘<strong>Full GC</strong>ï¼Œæ‰«æ<strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸­</strong>æ‰€æœ‰ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¹¶å›æ”¶</p>
<h4 id="GC-åˆ†æ"><a href="#GC-åˆ†æ" class="headerlink" title="GC åˆ†æ"></a>GC åˆ†æ</h4><h5 id="å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"><a href="#å¤§å¯¹è±¡å¤„ç†ç­–ç•¥" class="headerlink" title="å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"></a>å¤§å¯¹è±¡å¤„ç†ç­–ç•¥</h5><p>å½“é‡åˆ°ä¸€ä¸ª<strong>è¾ƒå¤§çš„å¯¹è±¡</strong>æ—¶ï¼Œå°±ç®—æ–°ç”Ÿä»£çš„<strong>ä¼Šç”¸å›­</strong>ä¸ºç©ºï¼Œä¹Ÿ<strong>æ— æ³•å®¹çº³è¯¥å¯¹è±¡</strong>æ—¶ï¼Œä¼šå°†è¯¥å¯¹è±¡<strong>ç›´æ¥æ™‹å‡ä¸ºè€å¹´ä»£</strong></p>
<h5 id="çº¿ç¨‹å†…å­˜æº¢å‡º"><a href="#çº¿ç¨‹å†…å­˜æº¢å‡º" class="headerlink" title="çº¿ç¨‹å†…å­˜æº¢å‡º"></a>çº¿ç¨‹å†…å­˜æº¢å‡º</h5><p>æŸä¸ªçº¿ç¨‹çš„å†…å­˜æº¢å‡ºäº†è€ŒæŠ›å¼‚å¸¸ï¼ˆout of memoryï¼‰ï¼Œä¸ä¼šè®©å…¶ä»–çš„çº¿ç¨‹ç»“æŸè¿è¡Œ</p>
<p>è¿™æ˜¯å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹<strong>æŠ›å‡ºOOMå¼‚å¸¸å</strong>ï¼Œ<strong>å®ƒæ‰€å æ®çš„å†…å­˜èµ„æºä¼šå…¨éƒ¨è¢«é‡Šæ”¾æ‰</strong>ï¼Œä»è€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œï¼Œ<strong>è¿›ç¨‹ä¾ç„¶æ­£å¸¸</strong></p>
<h3 id="4ã€åƒåœ¾å›æ”¶å™¨"><a href="#4ã€åƒåœ¾å›æ”¶å™¨" class="headerlink" title="4ã€åƒåœ¾å›æ”¶å™¨"></a>4ã€åƒåœ¾å›æ”¶å™¨</h3><h4 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h4><p><strong>å¹¶è¡Œæ”¶é›†</strong>ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶<strong>ç”¨æˆ·çº¿ç¨‹ä»å¤„äºç­‰å¾…çŠ¶æ€</strong>ã€‚</p>
<p><strong>å¹¶å‘æ”¶é›†</strong>ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹<strong>åŒæ—¶å·¥ä½œ</strong>ï¼ˆä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„å¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ã€‚<strong>ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œ</strong>ï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºè¿è¡Œåœ¨å¦ä¸€ä¸ªCPUä¸Š</p>
<p><strong>ååé‡</strong>ï¼šå³CPUç”¨äº<strong>è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´</strong>ä¸CPU<strong>æ€»æ¶ˆè€—æ—¶é—´</strong>çš„æ¯”å€¼ï¼ˆååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / ( è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´ )ï¼‰ï¼Œä¹Ÿå°±æ˜¯ã€‚ä¾‹å¦‚ï¼šè™šæ‹Ÿæœºå…±è¿è¡Œ100åˆ†é’Ÿï¼Œåƒåœ¾æ”¶é›†å™¨èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ä¹ˆååé‡å°±æ˜¯99%</p>
<h4 id="ä¸²è¡Œ"><a href="#ä¸²è¡Œ" class="headerlink" title="ä¸²è¡Œ"></a>ä¸²è¡Œ</h4><ul>
<li>å•çº¿ç¨‹</li>
<li>å†…å­˜è¾ƒå°ï¼Œä¸ªäººç”µè„‘ï¼ˆCPUæ ¸æ•°è¾ƒå°‘ï¼‰</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151027.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151027.png" alt="img"></a></p>
<p><strong>å®‰å…¨ç‚¹</strong>ï¼šè®©å…¶ä»–çº¿ç¨‹éƒ½åœ¨è¿™ä¸ªç‚¹åœä¸‹æ¥ï¼Œä»¥å…åƒåœ¾å›æ”¶æ—¶ç§»åŠ¨å¯¹è±¡åœ°å€ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ‰¾ä¸åˆ°è¢«ç§»åŠ¨çš„å¯¹è±¡</p>
<p>å› ä¸ºæ˜¯ä¸²è¡Œçš„ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶çº¿ç¨‹ã€‚ä¸”åœ¨è¯¥çº¿ç¨‹æ‰§è¡Œå›æ”¶å·¥ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥<strong>é˜»å¡</strong>çŠ¶æ€</p>
<h5 id="Serial-æ”¶é›†å™¨"><a href="#Serial-æ”¶é›†å™¨" class="headerlink" title="Serial æ”¶é›†å™¨"></a>Serial æ”¶é›†å™¨</h5><p>Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬çš„ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong>å•çº¿ç¨‹ã€ç®€å•é«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼Œé‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€‚å¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ‰‹æœºæ•ˆç‡ã€‚æ”¶é›†å™¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒç»“æŸï¼ˆStop The Worldï¼‰</p>
<h5 id="ParNew-æ”¶é›†å™¨"><a href="#ParNew-æ”¶é›†å™¨" class="headerlink" title="ParNew æ”¶é›†å™¨"></a>ParNew æ”¶é›†å™¨</h5><p>ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ã€ParNewæ”¶é›†å™¨é»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œåœ¨CPUéå¸¸å¤šçš„ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨-XX:ParallelGCThreadså‚æ•°æ¥é™åˆ¶åƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ã€‚å’ŒSerialæ”¶é›†å™¨ä¸€æ ·å­˜åœ¨Stop The Worldé—®é¢˜</p>
<h5 id="Serial-Old-æ”¶é›†å™¨"><a href="#Serial-Old-æ”¶é›†å™¨" class="headerlink" title="Serial Old æ”¶é›†å™¨"></a>Serial Old æ”¶é›†å™¨</h5><p>Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šåŒæ ·æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong></p>
<h4 id="ååé‡ä¼˜å…ˆ"><a href="#ååé‡ä¼˜å…ˆ" class="headerlink" title="ååé‡ä¼˜å…ˆ"></a>ååé‡ä¼˜å…ˆ</h4><ul>
<li>å¤šçº¿ç¨‹</li>
<li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li>
<li>å•ä½æ—¶é—´å†…ï¼ŒSTWï¼ˆstop the worldï¼Œåœæ‰å…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼‰æ—¶é—´æœ€çŸ­</li>
<li><strong>JDK1.8é»˜è®¤ä½¿ç”¨</strong>çš„åƒåœ¾å›æ”¶å™¨</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151039.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151039.png" alt="img"></a></p>
<h5 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨"></a>Parallel Scavenge æ”¶é›†å™¨</h5><p>ä¸ååé‡å…³ç³»å¯†åˆ‡ï¼Œæ•…ä¹Ÿç§°ä¸ºååé‡ä¼˜å…ˆæ”¶é›†å™¨</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šå±äºæ–°ç”Ÿä»£æ”¶é›†å™¨ä¹Ÿæ˜¯é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>çš„æ”¶é›†å™¨ï¼ˆç”¨åˆ°äº†æ–°ç”Ÿä»£çš„å¹¸å­˜åŒºï¼‰ï¼Œåˆæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼ˆä¸ParNewæ”¶é›†å™¨ç±»ä¼¼ï¼‰</p>
<p>è¯¥æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ã€‚è¿˜æœ‰ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„ç‚¹æ˜¯ï¼š<strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼ˆä¸ParNewæ”¶é›†å™¨æœ€é‡è¦çš„ä¸€ä¸ªåŒºåˆ«ï¼‰</p>
<p><strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼šParallel Scavengeæ”¶é›†å™¨å¯è®¾ç½®-XX:+UseAdptiveSizePolicyå‚æ•°ã€‚å½“å¼€å…³æ‰“å¼€æ—¶<strong>ä¸éœ€è¦</strong>æ‰‹åŠ¨æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRationï¼‰ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è®¾ç½®è¿™äº›å‚æ•°ä»¥æä¾›æœ€ä¼˜çš„åœé¡¿æ—¶é—´å’Œæœ€é«˜çš„ååé‡ï¼Œè¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºGCçš„è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚</p>
<p>Parallel Scavengeæ”¶é›†å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ§åˆ¶ååé‡ï¼š</p>
<ul>
<li>XX:MaxGCPauseMillis æ§åˆ¶æœ€å¤§çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´</li>
<li>XX:GCRatio ç›´æ¥è®¾ç½®ååé‡çš„å¤§å°</li>
</ul>
<h5 id="Parallel-Old-æ”¶é›†å™¨"><a href="#Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="Parallel Old æ”¶é›†å™¨"></a><strong>Parallel Old æ”¶é›†å™¨</strong></h5><p>æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼ˆè€å¹´ä»£æ²¡æœ‰å¹¸å­˜åŒºï¼‰</p>
<h4 id="å“åº”æ—¶é—´ä¼˜å…ˆ"><a href="#å“åº”æ—¶é—´ä¼˜å…ˆ" class="headerlink" title="å“åº”æ—¶é—´ä¼˜å…ˆ"></a>å“åº”æ—¶é—´ä¼˜å…ˆ</h4><ul>
<li>å¤šçº¿ç¨‹</li>
<li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li>
<li>å°½å¯èƒ½è®©å•æ¬¡STWæ—¶é—´å˜çŸ­ï¼ˆå°½é‡ä¸å½±å“å…¶ä»–çº¿ç¨‹è¿è¡Œï¼‰</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151052.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151052.png" alt="img"></a></p>
<h5 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS æ”¶é›†å™¨"></a>CMS æ”¶é›†å™¨</h5><p>Concurrent Mark Sweepï¼Œä¸€ç§ä»¥è·å–<strong>æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´</strong>ä¸ºç›®æ ‡çš„<strong>è€å¹´ä»£</strong>æ”¶é›†å™¨</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šåŸºäº<strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>å®ç°ã€‚å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæ³¨é‡æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒç­‰åœºæ™¯ä¸‹ã€‚å¦‚webç¨‹åºã€b/sæœåŠ¡</p>
<p><strong>CMSæ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‹åˆ—4æ­¥ï¼š</strong></p>
<p><strong>åˆå§‹æ ‡è®°</strong>ï¼šæ ‡è®°GC Rootsèƒ½ç›´æ¥åˆ°çš„å¯¹è±¡ã€‚é€Ÿåº¦å¾ˆå¿«ä½†æ˜¯<strong>ä»å­˜åœ¨Stop The Worldé—®é¢˜</strong></p>
<p><strong>å¹¶å‘æ ‡è®°</strong>ï¼šè¿›è¡ŒGC Roots Tracing çš„è¿‡ç¨‹ï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ä¸”ç”¨æˆ·çº¿ç¨‹å¯å¹¶å‘æ‰§è¡Œ</p>
<p><strong>é‡æ–°æ ‡è®°</strong>ï¼šä¸ºäº†<strong>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´</strong>å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚ä»ç„¶å­˜åœ¨Stop The Worldé—®é¢˜</p>
<p><strong>å¹¶å‘æ¸…é™¤</strong>ï¼šå¯¹æ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤å›æ”¶</p>
<p>CMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·<strong>å¹¶å‘æ‰§è¡Œ</strong>çš„</p>
<h4 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h4><h5 id="å®šä¹‰ï¼š"><a href="#å®šä¹‰ï¼š" class="headerlink" title="å®šä¹‰ï¼š"></a><strong>å®šä¹‰</strong>ï¼š</h5><p>Garbage First</p>
<p>JDK 9ä»¥åé»˜è®¤ä½¿ç”¨ï¼Œè€Œä¸”æ›¿ä»£äº†CMS æ”¶é›†å™¨</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200909201212.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200909201212.png" alt="img"></a></p>
<h5 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><ul>
<li>åŒæ—¶æ³¨é‡ååé‡å’Œä½å»¶è¿Ÿï¼ˆå“åº”æ—¶é—´ï¼‰</li>
<li>è¶…å¤§å †å†…å­˜ï¼ˆå†…å­˜å¤§çš„ï¼‰ï¼Œä¼šå°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ª<strong>å¤§å°ç›¸ç­‰</strong>çš„åŒºåŸŸ</li>
<li>æ•´ä½“ä¸Šæ˜¯<strong>æ ‡è®°-æ•´ç†</strong>ç®—æ³•ï¼Œä¸¤ä¸ªåŒºåŸŸä¹‹é—´æ˜¯<strong>å¤åˆ¶</strong>ç®—æ³•</li>
</ul>
<p><strong>ç›¸å…³å‚æ•°</strong>ï¼šJDK8 å¹¶ä¸æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€éœ€è¦å‚æ•°å¼€å¯</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151100.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151100.png" alt="img"></a></p>
<h5 id="G1åƒåœ¾å›æ”¶é˜¶æ®µ"><a href="#G1åƒåœ¾å›æ”¶é˜¶æ®µ" class="headerlink" title="G1åƒåœ¾å›æ”¶é˜¶æ®µ"></a>G1åƒåœ¾å›æ”¶é˜¶æ®µ</h5><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151109.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151109.png" alt="img"></a></p>
<p>æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶â€”â€“&gt;å†…å­˜ä¸è¶³ï¼Œæ–°ç”Ÿä»£å›æ”¶+å¹¶å‘æ ‡è®°â€”â€“&gt;å›æ”¶æ–°ç”Ÿä»£ä¼Šç”¸å›­ã€å¹¸å­˜åŒºã€è€å¹´ä»£å†…å­˜â€”â€”&gt;æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶(é‡æ–°å¼€å§‹)</p>
<h5 id="Young-Collection"><a href="#Young-Collection" class="headerlink" title="Young Collection"></a>Young Collection</h5><p><strong>åˆ†åŒºç®—æ³•region</strong></p>
<p>åˆ†ä»£æ˜¯æŒ‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼Œåˆ†åŒºåˆ™æ˜¯å°†å †ç©ºé—´åˆ’åˆ†è¿ç»­å‡ ä¸ªä¸åŒå°åŒºé—´ï¼Œæ¯ä¸€ä¸ªå°åŒºé—´ç‹¬ç«‹å›æ”¶ï¼Œå¯ä»¥æ§åˆ¶ä¸€æ¬¡å›æ”¶å¤šå°‘ä¸ªå°åŒºé—´ï¼Œæ–¹ä¾¿æ§åˆ¶ GC äº§ç”Ÿçš„åœé¡¿æ—¶é—´</p>
<p>Eï¼šä¼Šç”¸å›­ Sï¼šå¹¸å­˜åŒº Oï¼šè€å¹´ä»£</p>
<ul>
<li>ä¼šSTW</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151119.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151129.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151129.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151140.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151140.png" alt="img"></a></p>
<h5 id="Young-Collection-CM"><a href="#Young-Collection-CM" class="headerlink" title="Young Collection + CM"></a>Young Collection + CM</h5><p>CMï¼šå¹¶å‘æ ‡è®°</p>
<ul>
<li>åœ¨ Young GC æ—¶ä¼š<strong>å¯¹ GC Root è¿›è¡Œåˆå§‹æ ‡è®°</strong></li>
<li>åœ¨è€å¹´ä»£<strong>å ç”¨å †å†…å­˜çš„æ¯”ä¾‹</strong>è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå¯¹è¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆä¸ä¼šSTWï¼‰ï¼Œé˜ˆå€¼å¯ä»¥æ ¹æ®ç”¨æˆ·æ¥è¿›è¡Œè®¾å®š</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151150.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151150.png" alt="img"></a></p>
<h5 id="Mixed-Collection"><a href="#Mixed-Collection" class="headerlink" title="Mixed Collection"></a>Mixed Collection</h5><p>ä¼šå¯¹E S O è¿›è¡Œ<strong>å…¨é¢çš„å›æ”¶</strong></p>
<ul>
<li>æœ€ç»ˆæ ‡è®°</li>
<li><strong>æ‹·è´</strong>å­˜æ´»</li>
</ul>
<p>-XX:MaxGCPauseMills:xxx ç”¨äºæŒ‡å®šæœ€é•¿çš„åœé¡¿æ—¶é—´</p>
<p><strong>é—®</strong>ï¼šä¸ºä»€ä¹ˆæœ‰çš„è€å¹´ä»£è¢«æ‹·è´äº†ï¼Œæœ‰çš„æ²¡æ‹·è´ï¼Ÿ</p>
<p>å› ä¸ºæŒ‡å®šäº†æœ€å¤§åœé¡¿æ—¶é—´ï¼Œå¦‚æœå¯¹æ‰€æœ‰è€å¹´ä»£éƒ½è¿›è¡Œå›æ”¶ï¼Œè€—æ—¶å¯èƒ½è¿‡é«˜ã€‚ä¸ºäº†ä¿è¯æ—¶é—´ä¸è¶…è¿‡è®¾å®šçš„åœé¡¿æ—¶é—´ï¼Œä¼š<strong>å›æ”¶æœ€æœ‰ä»·å€¼çš„è€å¹´ä»£</strong>ï¼ˆå›æ”¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ›´å¤šå†…å­˜ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151201.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151201.png" alt="img"></a></p>
<h5 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h5><p>G1åœ¨è€å¹´ä»£å†…å­˜ä¸è¶³æ—¶ï¼ˆè€å¹´ä»£æ‰€å å†…å­˜è¶…è¿‡é˜ˆå€¼ï¼‰</p>
<ul>
<li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦æ…¢äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¸ä¼šè§¦å‘Full GCï¼Œè¿˜æ˜¯å¹¶å‘åœ°è¿›è¡Œæ¸…ç†</li>
<li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦å¿«äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¾¿ä¼šè§¦å‘Full GC</li>
</ul>
<h5 id="Young-Collection-è·¨ä»£å¼•ç”¨"><a href="#Young-Collection-è·¨ä»£å¼•ç”¨" class="headerlink" title="Young Collection è·¨ä»£å¼•ç”¨"></a>Young Collection è·¨ä»£å¼•ç”¨</h5><ul>
<li>æ–°ç”Ÿä»£å›æ”¶çš„è·¨ä»£å¼•ç”¨ï¼ˆè€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£ï¼‰é—®é¢˜</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151211.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151211.png" alt="img"></a></p>
<ul>
<li>å¡è¡¨ä¸Remembered Set<ul>
<li>Remembered Set å­˜åœ¨äºEä¸­ï¼Œç”¨äºä¿å­˜æ–°ç”Ÿä»£å¯¹è±¡å¯¹åº”çš„è„å¡<ul>
<li>è„å¡ï¼šOè¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼ˆä¸€ä¸ªåŒºåŸŸ512Kï¼‰ï¼Œå¦‚æœè¯¥åŒºåŸŸå¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼Œåˆ™è¯¥åŒºåŸŸè¢«ç§°ä¸ºè„å¡</li>
</ul>
</li>
</ul>
</li>
<li>åœ¨å¼•ç”¨å˜æ›´æ—¶é€šè¿‡post-write barried + dirty card queue</li>
<li>concurrent refinement threads æ›´æ–° Remembered Set</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151222.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151222.png" alt="img"></a></p>
<h5 id="Remark"><a href="#Remark" class="headerlink" title="Remark"></a>Remark</h5><p>é‡æ–°æ ‡è®°é˜¶æ®µ</p>
<p>åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ”¶é›†å™¨å¤„ç†å¯¹è±¡çš„è¿‡ç¨‹ä¸­</p>
<p>é»‘è‰²ï¼šå·²è¢«å¤„ç†ï¼Œéœ€è¦ä¿ç•™çš„ ç°è‰²ï¼šæ­£åœ¨å¤„ç†ä¸­çš„ ç™½è‰²ï¼šè¿˜æœªå¤„ç†çš„</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151229.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151229.png" alt="img"></a></p>
<p>ä½†æ˜¯åœ¨<strong>å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­</strong>ï¼Œæœ‰å¯èƒ½Aè¢«å¤„ç†äº†ä»¥åæœªå¼•ç”¨Cï¼Œä½†è¯¥å¤„ç†è¿‡ç¨‹è¿˜æœªç»“æŸï¼Œåœ¨å¤„ç†è¿‡ç¨‹ç»“æŸä¹‹å‰Aå¼•ç”¨äº†Cï¼Œè¿™æ—¶å°±ä¼šç”¨åˆ°remark</p>
<p>è¿‡ç¨‹å¦‚ä¸‹</p>
<ul>
<li>ä¹‹å‰Cæœªè¢«å¼•ç”¨ï¼Œè¿™æ—¶Aå¼•ç”¨äº†Cï¼Œå°±ä¼šç»™CåŠ ä¸€ä¸ªå†™å±éšœï¼Œå†™å±éšœçš„æŒ‡ä»¤ä¼šè¢«æ‰§è¡Œï¼Œå°†Cæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­ï¼Œå¹¶å°†Cå˜ä¸º å¤„ç†ä¸­ çŠ¶æ€</li>
<li>åœ¨<strong>å¹¶å‘æ ‡è®°</strong>é˜¶æ®µç»“æŸä»¥åï¼Œé‡æ–°æ ‡è®°é˜¶æ®µä¼šSTWï¼Œç„¶åå°†æ”¾åœ¨è¯¥é˜Ÿåˆ—ä¸­çš„å¯¹è±¡é‡æ–°å¤„ç†ï¼Œå‘ç°æœ‰å¼ºå¼•ç”¨å¼•ç”¨å®ƒï¼Œå°±ä¼šå¤„ç†å®ƒ</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151239.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151239.png" alt="img"></a></p>
<h5 id="JDK-8u20-å­—ç¬¦ä¸²å»é‡"><a href="#JDK-8u20-å­—ç¬¦ä¸²å»é‡" class="headerlink" title="JDK 8u20 å­—ç¬¦ä¸²å»é‡"></a>JDK 8u20 å­—ç¬¦ä¸²å»é‡</h5><p>è¿‡ç¨‹</p>
<ul>
<li>å°†æ‰€æœ‰æ–°åˆ†é…çš„å­—ç¬¦ä¸²ï¼ˆåº•å±‚æ˜¯char[]ï¼‰æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—</li>
<li>å½“æ–°ç”Ÿä»£å›æ”¶æ—¶ï¼ŒG1å¹¶å‘æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„å­—ç¬¦ä¸²</li>
<li>å¦‚æœå­—ç¬¦ä¸²çš„å€¼ä¸€æ ·ï¼Œå°±è®©ä»–ä»¬<strong>å¼•ç”¨åŒä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</strong></li>
<li>æ³¨æ„ï¼Œå…¶ä¸String.internçš„åŒºåˆ«<ul>
<li>internå…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡</li>
<li>å­—ç¬¦ä¸²å»é‡å…³æ³¨çš„æ˜¯char[]</li>
<li>åœ¨JVMå†…éƒ¨ï¼Œä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦ä¸²æ ‡</li>
</ul>
</li>
</ul>
<p>ä¼˜ç‚¹ä¸ç¼ºç‚¹</p>
<ul>
<li>èŠ‚çœäº†å¤§é‡å†…å­˜</li>
<li>æ–°ç”Ÿä»£å›æ”¶æ—¶é—´ç•¥å¾®å¢åŠ ï¼Œå¯¼è‡´ç•¥å¾®å¤šå ç”¨CPU</li>
</ul>
<h5 id="JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½"><a href="#JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½" class="headerlink" title="JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½"></a>JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½</h5><p>åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸä»¥åï¼Œå°±èƒ½çŸ¥é“å“ªäº›ç±»ä¸å†è¢«ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨çš„æ‰€æœ‰ç±»éƒ½ä¸åœ¨ä½¿ç”¨ï¼Œåˆ™å¸è½½å®ƒæ‰€åŠ è½½çš„æ‰€æœ‰ç±»</p>
<h5 id="JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡"><a href="#JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡" class="headerlink" title="JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡"></a>JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡</h5><ul>
<li>ä¸€ä¸ªå¯¹è±¡å¤§äºregionçš„ä¸€åŠæ—¶ï¼Œå°±ç§°ä¸ºå·¨å‹å¯¹è±¡</li>
<li>G1ä¸ä¼šå¯¹å·¨å‹å¯¹è±¡è¿›è¡Œæ‹·è´</li>
<li>å›æ”¶æ—¶è¢«ä¼˜å…ˆè€ƒè™‘</li>
<li>G1ä¼šè·Ÿè¸ªè€å¹´ä»£æ‰€æœ‰incomingå¼•ç”¨ï¼Œå¦‚æœè€å¹´ä»£incomingå¼•ç”¨ä¸º0çš„å·¨å‹å¯¹è±¡å°±å¯ä»¥åœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶å¤„ç†æ‰</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151249.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151249.png" alt="img"></a></p>
<h3 id="5ã€GC-è°ƒä¼˜"><a href="#5ã€GC-è°ƒä¼˜" class="headerlink" title="5ã€GC è°ƒä¼˜"></a>5ã€GC è°ƒä¼˜</h3><p>æŸ¥çœ‹è™šæ‹Ÿæœºå‚æ•°å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;F:\JAVA\JDK8.0\bin\java&quot; -XX:+PrintFlagsFinal -version | findstr &quot;GC&quot;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æ ¹æ®å‚æ•°å»æŸ¥è¯¢å…·ä½“çš„ä¿¡æ¯</p>
<h4 id="è°ƒä¼˜é¢†åŸŸ"><a href="#è°ƒä¼˜é¢†åŸŸ" class="headerlink" title="è°ƒä¼˜é¢†åŸŸ"></a>è°ƒä¼˜é¢†åŸŸ</h4><ul>
<li>å†…å­˜</li>
<li>é”ç«äº‰</li>
<li>CPUå ç”¨</li>
<li>IO</li>
<li>GC</li>
</ul>
<h4 id="ç¡®å®šç›®æ ‡"><a href="#ç¡®å®šç›®æ ‡" class="headerlink" title="ç¡®å®šç›®æ ‡"></a>ç¡®å®šç›®æ ‡</h4><p>ä½å»¶è¿Ÿ/é«˜ååé‡ï¼Ÿ é€‰æ‹©åˆé€‚çš„GC</p>
<ul>
<li>CMS G1 ZGC</li>
<li>ParallelGC</li>
<li>Zing</li>
</ul>
<h4 id="æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"><a href="#æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC" class="headerlink" title="æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"></a>æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC</h4><p>é¦–å…ˆæ’é™¤å‡å°‘å› ä¸ºè‡ªèº«ç¼–å†™çš„ä»£ç è€Œå¼•å‘çš„å†…å­˜é—®é¢˜</p>
<ul>
<li>æŸ¥çœ‹Full GCå‰åçš„å†…å­˜å ç”¨ï¼Œè€ƒè™‘ä»¥ä¸‹å‡ ä¸ªé—®é¢˜<ul>
<li>æ•°æ®æ˜¯ä¸æ˜¯å¤ªå¤šï¼Ÿ</li>
<li>æ•°æ®è¡¨ç¤ºæ˜¯å¦å¤ªè‡ƒè‚¿<ul>
<li>å¯¹è±¡å›¾</li>
<li>å¯¹è±¡å¤§å°</li>
</ul>
</li>
<li>æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼</li>
</ul>
</li>
</ul>
<h4 id="æ–°ç”Ÿä»£è°ƒä¼˜"><a href="#æ–°ç”Ÿä»£è°ƒä¼˜" class="headerlink" title="æ–°ç”Ÿä»£è°ƒä¼˜"></a>æ–°ç”Ÿä»£è°ƒä¼˜</h4><ul>
<li>æ–°ç”Ÿä»£çš„ç‰¹ç‚¹<ul>
<li>æ‰€æœ‰çš„newæ“ä½œåˆ†é…å†…å­˜éƒ½æ˜¯éå¸¸å»‰ä»·çš„<ul>
<li>TLAB</li>
</ul>
</li>
<li>æ­»äº¡å¯¹è±¡å›æ”¶é›¶ä»£ä»·</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡ç”¨è¿‡å³æ­»ï¼ˆæœç”Ÿå¤•æ­»ï¼‰</li>
<li>MInor GC æ‰€ç”¨æ—¶é—´è¿œå°äºFull GC</li>
</ul>
</li>
<li>æ–°ç”Ÿä»£å†…å­˜è¶Šå¤§è¶Šå¥½ä¹ˆï¼Ÿ<ul>
<li>ä¸æ˜¯<ul>
<li>æ–°ç”Ÿä»£å†…å­˜å¤ªå°ï¼šé¢‘ç¹è§¦å‘Minor GCï¼Œä¼šSTWï¼Œä¼šä½¿å¾—ååé‡ä¸‹é™</li>
<li>æ–°ç”Ÿä»£å†…å­˜å¤ªå¤§ï¼šè€å¹´ä»£å†…å­˜å æ¯”æœ‰æ‰€é™ä½ï¼Œä¼šæ›´é¢‘ç¹åœ°è§¦å‘Full GCã€‚è€Œä¸”è§¦å‘Minor GCæ—¶ï¼Œæ¸…ç†æ–°ç”Ÿä»£æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ›´é•¿</li>
</ul>
</li>
<li>æ–°ç”Ÿä»£å†…å­˜è®¾ç½®ä¸ºå†…å®¹çº³[å¹¶å‘é‡*(è¯·æ±‚-å“åº”)]çš„æ•°æ®ä¸ºå®œ</li>
</ul>
</li>
</ul>
<h4 id="å¹¸å­˜åŒºè°ƒä¼˜"><a href="#å¹¸å­˜åŒºè°ƒä¼˜" class="headerlink" title="å¹¸å­˜åŒºè°ƒä¼˜"></a>å¹¸å­˜åŒºè°ƒä¼˜</h4><ul>
<li>å¹¸å­˜åŒºéœ€è¦èƒ½å¤Ÿä¿å­˜ <strong>å½“å‰æ´»è·ƒå¯¹è±¡</strong>+<strong>éœ€è¦æ™‹å‡çš„å¯¹è±¡</strong></li>
<li>æ™‹å‡é˜ˆå€¼é…ç½®å¾—å½“ï¼Œè®©é•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡å°½å¿«æ™‹å‡</li>
</ul>
<h4 id="è€å¹´ä»£è°ƒä¼˜"><a href="#è€å¹´ä»£è°ƒä¼˜" class="headerlink" title="è€å¹´ä»£è°ƒä¼˜"></a>è€å¹´ä»£è°ƒä¼˜</h4><h2 id="å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯"><a href="#å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯" class="headerlink" title="å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯"></a>å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯</h2><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151300.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151300.png" alt="img"></a></p>
<h3 id="1ã€ç±»æ–‡ä»¶ç»“æ„"><a href="#1ã€ç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="1ã€ç±»æ–‡ä»¶ç»“æ„"></a>1ã€ç±»æ–‡ä»¶ç»“æ„</h3><p>é¦–å…ˆè·å¾—.classå­—èŠ‚ç æ–‡ä»¶</p>
<p>æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨æ–‡æœ¬æ–‡æ¡£é‡Œå†™å…¥javaä»£ç ï¼ˆæ–‡ä»¶åä¸ç±»åä¸€è‡´ï¼‰ï¼Œå°†æ–‡ä»¶ç±»å‹æ”¹ä¸º.java</li>
<li>javaç»ˆç«¯ä¸­ï¼Œæ‰§è¡Œjavac X:â€¦\XXX.java</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200910155135.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200910155135.png" alt="img"></a></p>
<p>ä»¥ä¸‹æ˜¯å­—èŠ‚ç æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09 </span><br><span class="line">0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07 </span><br><span class="line">0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29 </span><br><span class="line">0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e </span><br><span class="line">0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63 </span><br><span class="line">0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01 </span><br><span class="line">0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63 </span><br><span class="line">0000160 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f </span><br><span class="line">0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16 </span><br><span class="line">0000220 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 </span><br><span class="line">0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13 </span><br><span class="line">0000260 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 </span><br><span class="line">0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61 </span><br><span class="line">0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46 </span><br><span class="line">0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64</span><br><span class="line">0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e </span><br><span class="line">0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 </span><br><span class="line">0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74 </span><br><span class="line">0000440 63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c </span><br><span class="line">0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61 </span><br><span class="line">0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61 </span><br><span class="line">0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f </span><br><span class="line">0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72 </span><br><span class="line">0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76 </span><br><span class="line">0000600 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d </span><br><span class="line">0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a </span><br><span class="line">0000640 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b </span><br><span class="line">0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 </span><br><span class="line">0000700 00 07 00 08 00 01 00 09 00 00 00 2f 00 01 00 01 </span><br><span class="line">0000720 00 00 00 05 2a b7 00 01 b1 00 00 00 02 00 0a 00 </span><br><span class="line">0000740 00 00 06 00 01 00 00 00 04 00 0b 00 00 00 0c 00 </span><br><span class="line">0000760 01 00 00 00 05 00 0c 00 0d 00 00 00 09 00 0e 00 </span><br><span class="line">0001000 0f 00 02 00 09 00 00 00 37 00 02 00 01 00 00 00 </span><br><span class="line">0001020 09 b2 00 02 12 03 b6 00 04 b1 00 00 00 02 00 0a </span><br><span class="line">0001040 00 00 00 0a 00 02 00 00 00 06 00 08 00 07 00 0b </span><br><span class="line">0001060 00 00 00 0c 00 01 00 00 00 09 00 10 00 11 00 00 </span><br><span class="line">0001100 00 12 00 00 00 05 01 00 10 00 00 00 01 00 13 00 </span><br><span class="line">0001120 00 00 02 00 14 </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ ¹æ® JVM è§„èŒƒï¼Œ<strong>ç±»æ–‡ä»¶ç»“æ„</strong>å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">u4 			 magic</span><br><span class="line">u2             minor_version;    </span><br><span class="line">u2             major_version;    </span><br><span class="line">u2             constant_pool_count;    </span><br><span class="line">cp_info        constant_pool[constant_pool_count-1];    </span><br><span class="line">u2             access_flags;    </span><br><span class="line">u2             this_class;    </span><br><span class="line">u2             super_class;   </span><br><span class="line">u2             interfaces_count;    </span><br><span class="line">u2             interfaces[interfaces_count];   </span><br><span class="line">u2             fields_count;    </span><br><span class="line">field_info     fields[fields_count];   </span><br><span class="line">u2             methods_count;    </span><br><span class="line">method_info    methods[methods_count];    </span><br><span class="line">u2             attributes_count;    </span><br><span class="line">attribute_info attributes[attributes_count];</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="é­”æ•°"><a href="#é­”æ•°" class="headerlink" title="é­”æ•°"></a>é­”æ•°</h4><p>u4 magic</p>
<p>å¯¹åº”å­—èŠ‚ç æ–‡ä»¶çš„0~3ä¸ªå­—èŠ‚</p>
<p>0000000 <strong>ca fe ba be</strong> 00 00 00 34 00 23 0a 00 06 00 15 09</p>
<h4 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h4><p>u2 minor_version;</p>
<p>u2 major_version;</p>
<p>0000000 ca fe ba be <strong>00 00 00 34</strong> 00 23 0a 00 06 00 15 09</p>
<p>34H = 52ï¼Œä»£è¡¨JDK8</p>
<h4 id="å¸¸é‡æ± -1"><a href="#å¸¸é‡æ± -1" class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>è§èµ„æ–™æ–‡ä»¶</p>
<p>â€¦ç•¥</p>
<h3 id="2ã€å­—èŠ‚ç æŒ‡ä»¤"><a href="#2ã€å­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="2ã€å­—èŠ‚ç æŒ‡ä»¤"></a>2ã€å­—èŠ‚ç æŒ‡ä»¤</h3><p>å¯å‚è€ƒ</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5</a></p>
<h4 id="javapå·¥å…·"><a href="#javapå·¥å…·" class="headerlink" title="javapå·¥å…·"></a>javapå·¥å…·</h4><p>Oracle æä¾›äº† <strong>javap</strong> å·¥å…·æ¥åç¼–è¯‘ class æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">javap -v F:\Thread_study\src\com\nyima\JVM\day01\Main.classCopy</span><br><span class="line">F:\Thread_study&gt;javap -v F:\Thread_study\src\com\nyima\JVM\day5\Demo1.class</span><br><span class="line">Classfile &#x2F;F:&#x2F;Thread_study&#x2F;src&#x2F;com&#x2F;nyima&#x2F;JVM&#x2F;day5&#x2F;Demo1.class</span><br><span class="line">  Last modified 2020-6-6; size 434 bytes</span><br><span class="line">  MD5 checksum df1dce65bf6fb0b4c1de318051f4a67e</span><br><span class="line">  Compiled from &quot;Demo1.java&quot;</span><br><span class="line">public class com.nyima.JVM.day5.Demo1</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 52</span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 &#x3D; Methodref          #6.#15         &#x2F;&#x2F; java&#x2F;lang&#x2F;Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">   #2 &#x3D; Fieldref           #16.#17        &#x2F;&#x2F; java&#x2F;lang&#x2F;System.out:Ljava&#x2F;io&#x2F;PrintStream;</span><br><span class="line">   #3 &#x3D; String             #18            &#x2F;&#x2F; hello world</span><br><span class="line">   #4 &#x3D; Methodref          #19.#20        &#x2F;&#x2F; java&#x2F;io&#x2F;PrintStream.println:(Ljava&#x2F;lang&#x2F;String;)V</span><br><span class="line">   #5 &#x3D; Class              #21            &#x2F;&#x2F; com&#x2F;nyima&#x2F;JVM&#x2F;day5&#x2F;Demo1</span><br><span class="line">   #6 &#x3D; Class              #22            &#x2F;&#x2F; java&#x2F;lang&#x2F;Object</span><br><span class="line">   #7 &#x3D; Utf8               &lt;init&gt;</span><br><span class="line">   #8 &#x3D; Utf8               ()V</span><br><span class="line">   #9 &#x3D; Utf8               Code</span><br><span class="line">  #10 &#x3D; Utf8               LineNumberTable</span><br><span class="line">  #11 &#x3D; Utf8               main</span><br><span class="line">  #12 &#x3D; Utf8               ([Ljava&#x2F;lang&#x2F;String;)V</span><br><span class="line">  #13 &#x3D; Utf8               SourceFile</span><br><span class="line">  #14 &#x3D; Utf8               Demo1.java</span><br><span class="line">  #15 &#x3D; NameAndType        #7:#8          &#x2F;&#x2F; &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">  #16 &#x3D; Class              #23            &#x2F;&#x2F; java&#x2F;lang&#x2F;System</span><br><span class="line">  #17 &#x3D; NameAndType        #24:#25        &#x2F;&#x2F; out:Ljava&#x2F;io&#x2F;PrintStream;</span><br><span class="line">  #18 &#x3D; Utf8               hello world</span><br><span class="line">  #19 &#x3D; Class              #26            &#x2F;&#x2F; java&#x2F;io&#x2F;PrintStream</span><br><span class="line">  #20 &#x3D; NameAndType        #27:#28        &#x2F;&#x2F; println:(Ljava&#x2F;lang&#x2F;String;)V</span><br><span class="line">  #21 &#x3D; Utf8               com&#x2F;nyima&#x2F;JVM&#x2F;day5&#x2F;Demo1</span><br><span class="line">  #22 &#x3D; Utf8               java&#x2F;lang&#x2F;Object</span><br><span class="line">  #23 &#x3D; Utf8               java&#x2F;lang&#x2F;System</span><br><span class="line">  #24 &#x3D; Utf8               out</span><br><span class="line">  #25 &#x3D; Utf8               Ljava&#x2F;io&#x2F;PrintStream;</span><br><span class="line">  #26 &#x3D; Utf8               java&#x2F;io&#x2F;PrintStream</span><br><span class="line">  #27 &#x3D; Utf8               println</span><br><span class="line">  #28 &#x3D; Utf8               (Ljava&#x2F;lang&#x2F;String;)V</span><br><span class="line">&#123;</span><br><span class="line">  public com.nyima.JVM.day5.Demo1();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack&#x3D;1, locals&#x3D;1, args_size&#x3D;1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 7: 0</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava&#x2F;lang&#x2F;String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack&#x3D;2, locals&#x3D;1, args_size&#x3D;1</span><br><span class="line">         0: getstatic     #2                  &#x2F;&#x2F; Field java&#x2F;lang&#x2F;System.out:Ljava&#x2F;io&#x2F;PrintStream;</span><br><span class="line">         3: ldc           #3                  &#x2F;&#x2F; String hello world</span><br><span class="line">         5: invokevirtual #4                  &#x2F;&#x2F; Method java&#x2F;io&#x2F;PrintStream.println:(Ljava&#x2F;lang&#x2F;String;)V</span><br><span class="line"></span><br><span class="line">         8: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 9: 0</span><br><span class="line">        line 10: 8</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"><a href="#å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹" class="headerlink" title="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"></a>å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹</h4><p>ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Demo3_1 &#123;    </span><br><span class="line">	public static void main(String[] args) &#123;        </span><br><span class="line">		int a &#x3D; 10;        </span><br><span class="line">		int b &#x3D; Short.MAX_VALUE + 1;        </span><br><span class="line">		int c &#x3D; a + b;        </span><br><span class="line">		System.out.println(c);   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± </strong></p>
<p>å¸¸é‡æ± ä¹Ÿå±äºæ–¹æ³•åŒºï¼Œåªä¸è¿‡è¿™é‡Œå•ç‹¬æå‡ºæ¥äº†</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151317.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151317.png" alt="img"></a></p>
<p><strong>æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº</strong></p>
<p>ï¼ˆstack=2ï¼Œlocals=4ï¼‰ å¯¹åº”æ“ä½œæ•°æ ˆæœ‰2ä¸ªç©ºé—´ï¼ˆæ¯ä¸ªç©ºé—´4ä¸ªå­—èŠ‚ï¼‰ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­æœ‰4ä¸ªæ§½ä½</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151325.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151325.png" alt="img"></a></p>
<p><strong>æ‰§è¡Œå¼•æ“å¼€å§‹æ‰§è¡Œå­—èŠ‚ç </strong></p>
<p><strong>bipush 10</strong></p>
<ul>
<li><p>å°†ä¸€ä¸ª byte å‹å…¥æ“ä½œæ•°æ ˆ</p>
<p>ï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰</p>
<ul>
<li>sipush å°†ä¸€ä¸ª short å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰</li>
<li>ldc å°†ä¸€ä¸ª int å‹å…¥æ“ä½œæ•°æ ˆ</li>
<li>ldc2_w å°†ä¸€ä¸ª long å‹å…¥æ“ä½œæ•°æ ˆï¼ˆ<strong>åˆ†ä¸¤æ¬¡å‹å…¥</strong>ï¼Œå› ä¸º long æ˜¯ 8 ä¸ªå­—èŠ‚ï¼‰</li>
<li>è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œ<strong>è¶…è¿‡ short èŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ± </strong></li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151336.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151336.png" alt="img"></a></p>
<p><strong>istore 1</strong></p>
<p>å°†æ“ä½œæ•°æ ˆæ ˆé¡¶å…ƒç´ å¼¹å‡ºï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„slot 1ä¸­</p>
<p>å¯¹åº”ä»£ç ä¸­çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a &#x3D; 10 </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151346.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151346.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151412.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151412.png" alt="img"></a></p>
<p><strong>ldc #3</strong></p>
<p>è¯»å–è¿è¡Œæ—¶å¸¸é‡æ± ä¸­#3ï¼Œå³32768(è¶…è¿‡shortæœ€å¤§å€¼èŒƒå›´çš„æ•°ä¼šè¢«æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­)ï¼Œå°†å…¶åŠ è½½åˆ°æ“ä½œæ•°æ ˆä¸­</p>
<p>æ³¨æ„ Short.MAX_VALUE æ˜¯ 32767ï¼Œæ‰€ä»¥ 32768 = Short.MAX_VALUE + 1 å®é™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—å¥½çš„</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151421.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151421.png" alt="img"></a></p>
<p><strong>istore 2</strong></p>
<p>å°†æ“ä½œæ•°æ ˆä¸­çš„å…ƒç´ å¼¹å‡ºï¼Œæ”¾åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151432.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151432.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151441.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151441.png" alt="img"></a></p>
<p><strong>iload1 iload2</strong></p>
<p>å°†å±€éƒ¨å˜é‡è¡¨ä¸­1å·ä½ç½®å’Œ2å·ä½ç½®çš„å…ƒç´ æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</p>
<ul>
<li>å› ä¸ºåªèƒ½åœ¨æ“ä½œæ•°æ ˆä¸­æ‰§è¡Œè¿ç®—æ“ä½œ</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151450.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151450.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151459.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151459.png" alt="img"></a></p>
<p><strong>iadd</strong></p>
<p>å°†æ“ä½œæ•°æ ˆä¸­çš„ä¸¤ä¸ªå…ƒç´ <strong>å¼¹å‡ºæ ˆ</strong>å¹¶ç›¸åŠ ï¼Œç»“æœåœ¨å‹å…¥æ“ä½œæ•°æ ˆä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151508.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151508.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151523.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151523.png" alt="img"></a></p>
<p><strong>istore 3</strong></p>
<p>å°†æ“ä½œæ•°æ ˆä¸­çš„å…ƒç´ å¼¹å‡ºï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„3å·ä½ç½®</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151547.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151547.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151555.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151555.png" alt="img"></a></p>
<p><strong>getstatic #4</strong></p>
<p>åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ‰¾åˆ°#4ï¼Œå‘ç°æ˜¯ä¸€ä¸ªå¯¹è±¡</p>
<p>åœ¨å †å†…å­˜ä¸­æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¹¶å°†å…¶<strong>å¼•ç”¨</strong>æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151605.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151605.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151613.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151613.png" alt="img"></a></p>
<p><strong>iload 3</strong></p>
<p>å°†å±€éƒ¨å˜é‡è¡¨ä¸­3å·ä½ç½®çš„å…ƒç´ å‹å…¥æ“ä½œæ•°æ ˆä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151624.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151624.png" alt="img"></a></p>
<p><strong>invokevirtual 5</strong></p>
<p>æ‰¾åˆ°å¸¸é‡æ±  #5 é¡¹ï¼Œå®šä½åˆ°æ–¹æ³•åŒº java/io/PrintStream.println:(I)V æ–¹æ³•</p>
<p>ç”Ÿæˆæ–°çš„æ ˆå¸§ï¼ˆåˆ†é… localsã€stackç­‰ï¼‰</p>
<p>ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç </p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151632.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151632.png" alt="img"></a></p>
<p>æ‰§è¡Œå®Œæ¯•ï¼Œå¼¹å‡ºæ ˆå¸§</p>
<p>æ¸…é™¤ main æ“ä½œæ•°æ ˆå†…å®¹</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151640.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151640.png" alt="img"></a></p>
<p><strong>return</strong><br>å®Œæˆ main æ–¹æ³•è°ƒç”¨ï¼Œå¼¹å‡º main æ ˆå¸§ï¼Œç¨‹åºç»“æŸ</p>
<h4 id="é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜"><a href="#é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜" class="headerlink" title="é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜"></a>é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜</h4><p>ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Demo2 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		int i&#x3D;0;</span><br><span class="line">		int x&#x3D;0;</span><br><span class="line">		while(i&lt;10) &#123;</span><br><span class="line">			x &#x3D; x++;</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(x); &#x2F;&#x2F;æ¥è¿‡ä¸º0</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆæœ€ç»ˆçš„xç»“æœä¸º0å‘¢ï¼Ÿ é€šè¿‡åˆ†æå­—èŠ‚ç æŒ‡ä»¤å³å¯çŸ¥æ™“</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack&#x3D;2, locals&#x3D;3, args_size&#x3D;1	&#x2F;&#x2F;æ“ä½œæ•°æ ˆåˆ†é…2ä¸ªç©ºé—´ï¼Œå±€éƒ¨å˜é‡è¡¨åˆ†é…3ä¸ªç©ºé—´</span><br><span class="line">        0: iconst_0	&#x2F;&#x2F;å‡†å¤‡ä¸€ä¸ªå¸¸æ•°0</span><br><span class="line">        1: istore_1	&#x2F;&#x2F;å°†å¸¸æ•°0æ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„1å·æ§½ä½ i&#x3D;0</span><br><span class="line">        2: iconst_0	&#x2F;&#x2F;å‡†å¤‡ä¸€ä¸ªå¸¸æ•°0</span><br><span class="line">        3: istore_2	&#x2F;&#x2F;å°†å¸¸æ•°0æ”¾å…¥å±€éƒ¨å˜é‡çš„2å·æ§½ä½ x&#x3D;0	</span><br><span class="line">        4: iload_1		&#x2F;&#x2F;å°†å±€éƒ¨å˜é‡è¡¨1å·æ§½ä½çš„æ•°æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</span><br><span class="line">        5: bipush        10	&#x2F;&#x2F;å°†æ•°å­—10æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ­¤æ—¶æ“ä½œæ•°æ ˆä¸­æœ‰2ä¸ªæ•°</span><br><span class="line">        7: if_icmpge     21	&#x2F;&#x2F;æ¯”è¾ƒæ“ä½œæ•°æ ˆä¸­çš„ä¸¤ä¸ªæ•°ï¼Œå¦‚æœä¸‹é¢çš„æ•°å¤§äºä¸Šé¢çš„æ•°ï¼Œå°±è·³è½¬åˆ°21ã€‚è¿™é‡Œçš„æ¯”è¾ƒæ˜¯å°†ä¸¤ä¸ªæ•°åšå‡æ³•ã€‚å› ä¸ºæ¶‰åŠè¿ç®—æ“ä½œï¼Œæ‰€ä»¥ä¼šå°†ä¸¤ä¸ªæ•°å¼¹å‡ºæ“ä½œæ•°æ ˆæ¥è¿›è¡Œè¿ç®—ã€‚è¿ç®—ç»“æŸåæ“ä½œæ•°æ ˆä¸ºç©º</span><br><span class="line">       10: iload_2		&#x2F;&#x2F;å°†å±€éƒ¨å˜é‡2å·æ§½ä½çš„æ•°æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ”¾å…¥çš„å€¼æ˜¯0</span><br><span class="line">       11: iinc          2, 1	&#x2F;&#x2F;å°†å±€éƒ¨å˜é‡2å·æ§½ä½çš„æ•°åŠ 1ï¼Œè‡ªå¢åï¼Œæ§½ä½ä¸­çš„å€¼ä¸º1</span><br><span class="line">       14: istore_2	&#x2F;&#x2F;å°†æ“ä½œæ•°æ ˆä¸­çš„æ•°æ”¾å…¥åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·æ§½ä½ï¼Œ2å·æ§½ä½çš„å€¼åˆå˜ä¸ºäº†0</span><br><span class="line">       15: iinc          1, 1 &#x2F;&#x2F;1å·æ§½ä½çš„å€¼è‡ªå¢1</span><br><span class="line">       18: goto          4 &#x2F;&#x2F;è·³è½¬åˆ°ç¬¬4æ¡æŒ‡ä»¤</span><br><span class="line">       21: getstatic     #2                  &#x2F;&#x2F; Field java&#x2F;lang&#x2F;System.out:Ljava&#x2F;io&#x2F;PrintStream;</span><br><span class="line">       24: iload_2</span><br><span class="line">       25: invokevirtual #3                  &#x2F;&#x2F; Method java&#x2F;io&#x2F;PrintStream.println:(I)V</span><br><span class="line">       28: return</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h4><h5 id="cinit-V"><a href="#cinit-V" class="headerlink" title="cinit()V"></a>cinit()V</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Demo3 &#123;</span><br><span class="line">	static int i &#x3D; 10;</span><br><span class="line"></span><br><span class="line">	static &#123;</span><br><span class="line">		i &#x3D; 20;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	static &#123;</span><br><span class="line">		i &#x3D; 30;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		System.out.println(i); &#x2F;&#x2F;ç»“æœä¸º30</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¼šæŒ‰<strong>ä»ä¸Šè‡³ä¸‹</strong>çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ static é™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œ<strong>åˆå¹¶</strong>ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³• cinit()V ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">stack&#x3D;1, locals&#x3D;0, args_size&#x3D;0</span><br><span class="line">         0: bipush        10</span><br><span class="line">         2: putstatic     #3                  &#x2F;&#x2F; Field i:I</span><br><span class="line">         5: bipush        20</span><br><span class="line">         7: putstatic     #3                  &#x2F;&#x2F; Field i:I</span><br><span class="line">        10: bipush        30</span><br><span class="line">        12: putstatic     #3                  &#x2F;&#x2F; Field i:I</span><br><span class="line">        15: return</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h5 id="init-V"><a href="#init-V" class="headerlink" title="init()V"></a>init()V</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class Demo4 &#123;</span><br><span class="line">	private String a &#x3D; &quot;s1&quot;;</span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line">		b &#x3D; 20;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private int b &#x3D; 10;</span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line">		a &#x3D; &quot;s2&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Demo4(String a, int b) &#123;</span><br><span class="line">		this.a &#x3D; a;</span><br><span class="line">		this.b &#x3D; b;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Demo4 d &#x3D; new Demo4(&quot;s3&quot;, 30);</span><br><span class="line">		System.out.println(d.a);</span><br><span class="line">		System.out.println(d.b);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¼šæŒ‰<strong>ä»ä¸Šè‡³ä¸‹</strong>çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ {} ä»£ç å—å’Œæˆå‘˜å˜é‡èµ‹å€¼çš„ä»£ç ï¼Œ<strong>å½¢æˆæ–°çš„æ„é€ æ–¹æ³•</strong>ï¼Œä½†<strong>åŸå§‹æ„é€ æ–¹æ³•</strong>å†…çš„ä»£ç <strong>æ€»æ˜¯åœ¨å</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack&#x3D;2, locals&#x3D;3, args_size&#x3D;3</span><br><span class="line">        0: aload_0</span><br><span class="line">        1: invokespecial #1                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">        4: aload_0</span><br><span class="line">        5: ldc           #2                  &#x2F;&#x2F; String s1</span><br><span class="line">        7: putfield      #3                  &#x2F;&#x2F; Field a:Ljava&#x2F;lang&#x2F;String;</span><br><span class="line">       10: aload_0</span><br><span class="line">       11: bipush        20</span><br><span class="line">       13: putfield      #4                  &#x2F;&#x2F; Field b:I</span><br><span class="line">       16: aload_0</span><br><span class="line">       17: bipush        10</span><br><span class="line">       19: putfield      #4                  &#x2F;&#x2F; Field b:I</span><br><span class="line">       22: aload_0</span><br><span class="line">       23: ldc           #5                  &#x2F;&#x2F; String s2</span><br><span class="line">       25: putfield      #3                  &#x2F;&#x2F; Field a:Ljava&#x2F;lang&#x2F;String;</span><br><span class="line">       &#x2F;&#x2F;åŸå§‹æ„é€ æ–¹æ³•åœ¨æœ€åæ‰§è¡Œ</span><br><span class="line">       28: aload_0</span><br><span class="line">       29: aload_1</span><br><span class="line">       30: putfield      #3                  &#x2F;&#x2F; Field a:Ljava&#x2F;lang&#x2F;String;</span><br><span class="line">       33: aload_0</span><br><span class="line">       34: iload_2</span><br><span class="line">       35: putfield      #4                  &#x2F;&#x2F; Field b:I</span><br><span class="line">       38: return</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class Demo5 &#123;</span><br><span class="line">	public Demo5() &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private void test1() &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private final void test2() &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void test3() &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void test4() &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Demo5 demo5 &#x3D; new Demo5();</span><br><span class="line">		demo5.test1();</span><br><span class="line">		demo5.test2();</span><br><span class="line">		demo5.test3();</span><br><span class="line">		Demo5.test4();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä¸åŒæ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œå¯¹åº”çš„è™šæ‹ŸæœºæŒ‡ä»¤æœ‰æ‰€åŒºåˆ«</p>
<ul>
<li>ç§æœ‰ã€æ„é€ ã€è¢«finalä¿®é¥°çš„æ–¹æ³•ï¼Œåœ¨è°ƒç”¨æ—¶éƒ½ä½¿ç”¨<strong>invokespecial</strong>æŒ‡ä»¤</li>
<li>æ™®é€šæˆå‘˜æ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œä½¿ç”¨invokespecialæŒ‡ä»¤ã€‚å› ä¸ºç¼–è¯‘æœŸé—´æ— æ³•ç¡®å®šè¯¥æ–¹æ³•çš„å†…å®¹ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®š</li>
<li>é™æ€æ–¹æ³•åœ¨è°ƒç”¨æ—¶ä½¿ç”¨invokestaticæŒ‡ä»¤</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">      stack&#x3D;2, locals&#x3D;2, args_size&#x3D;1</span><br><span class="line">         0: new           #2                  &#x2F;&#x2F; class com&#x2F;nyima&#x2F;JVM&#x2F;day5&#x2F;Demo5 </span><br><span class="line">         3: dup</span><br><span class="line">         4: invokespecial #3                  &#x2F;&#x2F; Method &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         7: astore_1</span><br><span class="line">         8: aload_1</span><br><span class="line">         9: invokespecial #4                  &#x2F;&#x2F; Method test1:()V</span><br><span class="line">        12: aload_1</span><br><span class="line">        13: invokespecial #5                  &#x2F;&#x2F; Method test2:()V</span><br><span class="line">        16: aload_1</span><br><span class="line">        17: invokevirtual #6                  &#x2F;&#x2F; Method test3:()V</span><br><span class="line">        20: invokestatic  #7                  &#x2F;&#x2F; Method test4:()V</span><br><span class="line">        23: return</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€<strong>å¯¹è±¡å¼•ç”¨</strong>ã€‘å‹å…¥æ“ä½œæ•°æ ˆ</li>
<li>dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€<strong>å¯¹è±¡å¼•ç”¨</strong>ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢ï¼Œä¸€ä¸ªæ˜¯è¦é…åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æ„é€ æ–¹æ³• â€œinitâ€:()V ï¼ˆä¼šæ¶ˆè€—æ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨ï¼‰ï¼Œå¦ä¸€ä¸ªè¦ é…åˆ astore_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡</li>
<li>ç»ˆæ–¹æ³•ï¼ˆï¬nalï¼‰ï¼Œç§æœ‰æ–¹æ³•ï¼ˆprivateï¼‰ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±äºé™æ€ç»‘å®š</li>
<li>æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±äº<strong>åŠ¨æ€ç»‘å®š</strong>ï¼Œå³æ”¯æŒå¤šæ€ æˆå‘˜æ–¹æ³•ä¸é™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘</li>
</ul>
<h4 id="å¤šæ€åŸç†"><a href="#å¤šæ€åŸç†" class="headerlink" title="å¤šæ€åŸç†"></a>å¤šæ€åŸç†</h4><p>å› ä¸ºæ™®é€šæˆå‘˜æ–¹æ³•éœ€è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå…·ä½“çš„å†…å®¹ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºéœ€è¦è°ƒç”¨<strong>invokevirtual</strong>æŒ‡ä»¤</p>
<p>åœ¨æ‰§è¡ŒinvokevirtualæŒ‡ä»¤æ—¶ï¼Œç»å†äº†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p>
<ul>
<li>å…ˆé€šè¿‡æ ˆå¸§ä¸­å¯¹è±¡çš„å¼•ç”¨æ‰¾åˆ°å¯¹è±¡</li>
<li>åˆ†æå¯¹è±¡å¤´ï¼Œæ‰¾åˆ°å¯¹è±¡å®é™…çš„Class</li>
<li>Classç»“æ„ä¸­æœ‰<strong>vtable</strong></li>
<li>æŸ¥è¯¢vtableæ‰¾åˆ°æ–¹æ³•çš„å…·ä½“åœ°å€</li>
<li>æ‰§è¡Œæ–¹æ³•çš„å­—èŠ‚ç </li>
</ul>
<h4 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h4><h5 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Demo1 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		int i &#x3D; 0;</span><br><span class="line">		try &#123;</span><br><span class="line">			i &#x3D; 10;</span><br><span class="line">		&#125;catch (Exception e) &#123;</span><br><span class="line">			i &#x3D; 20;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç æŒ‡ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack&#x3D;1, locals&#x3D;3, args_size&#x3D;1</span><br><span class="line">        0: iconst_0</span><br><span class="line">        1: istore_1</span><br><span class="line">        2: bipush        10</span><br><span class="line">        4: istore_1</span><br><span class="line">        5: goto          12</span><br><span class="line">        8: astore_2</span><br><span class="line">        9: bipush        20</span><br><span class="line">       11: istore_1</span><br><span class="line">       12: return</span><br><span class="line">     &#x2F;&#x2F;å¤šå‡ºæ¥ä¸€ä¸ªå¼‚å¸¸è¡¨</span><br><span class="line">     Exception table:</span><br><span class="line">        from    to  target type</span><br><span class="line">            2     5     8   Class java&#x2F;lang&#x2F;Exception</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ª Exception table çš„ç»“æ„ï¼Œ[from, to) æ˜¯<strong>å‰é—­åå¼€</strong>ï¼ˆä¹Ÿå°±æ˜¯æ£€æµ‹2~4è¡Œï¼‰çš„æ£€æµ‹èŒƒå›´ï¼Œä¸€æ—¦è¿™ä¸ªèŒƒå›´å†…çš„å­—èŠ‚ç æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œåˆ™é€šè¿‡ type åŒ¹é…å¼‚å¸¸ç±»å‹ï¼Œå¦‚æœä¸€è‡´ï¼Œè¿›å…¥ target æ‰€æŒ‡ç¤ºè¡Œå·</li>
<li>8è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ astore_2 æ˜¯å°†å¼‚å¸¸å¯¹è±¡å¼•ç”¨å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®ï¼ˆä¸ºeï¼‰</li>
</ul>
<h5 id="å¤šä¸ªsingle-catch"><a href="#å¤šä¸ªsingle-catch" class="headerlink" title="å¤šä¸ªsingle-catch"></a>å¤šä¸ªsingle-catch</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Demo1 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		int i &#x3D; 0;</span><br><span class="line">		try &#123;</span><br><span class="line">			i &#x3D; 10;</span><br><span class="line">		&#125;catch (ArithmeticException e) &#123;</span><br><span class="line">			i &#x3D; 20;</span><br><span class="line">		&#125;catch (Exception e) &#123;</span><br><span class="line">			i &#x3D; 30;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack&#x3D;1, locals&#x3D;3, args_size&#x3D;1</span><br><span class="line">        0: iconst_0</span><br><span class="line">        1: istore_1</span><br><span class="line">        2: bipush        10</span><br><span class="line">        4: istore_1</span><br><span class="line">        5: goto          19</span><br><span class="line">        8: astore_2</span><br><span class="line">        9: bipush        20</span><br><span class="line">       11: istore_1</span><br><span class="line">       12: goto          19</span><br><span class="line">       15: astore_2</span><br><span class="line">       16: bipush        30</span><br><span class="line">       18: istore_1</span><br><span class="line">       19: return</span><br><span class="line">     Exception table:</span><br><span class="line">        from    to  target type</span><br><span class="line">            2     5     8   Class java&#x2F;lang&#x2F;ArithmeticException</span><br><span class="line">            2     5    15   Class java&#x2F;lang&#x2F;Exception</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>å› ä¸ºå¼‚å¸¸å‡ºç°æ—¶ï¼Œ<strong>åªèƒ½è¿›å…¥</strong> Exception table ä¸­<strong>ä¸€ä¸ªåˆ†æ”¯</strong>ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ slot 2 ä½ç½®<strong>è¢«å…±ç”¨</strong></li>
</ul>
<h5 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Demo2 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		int i &#x3D; 0;</span><br><span class="line">		try &#123;</span><br><span class="line">			i &#x3D; 10;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			i &#x3D; 20;</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			i &#x3D; 30;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack&#x3D;1, locals&#x3D;4, args_size&#x3D;1</span><br><span class="line">        0: iconst_0</span><br><span class="line">        1: istore_1</span><br><span class="line">        &#x2F;&#x2F;tryå—</span><br><span class="line">        2: bipush        10</span><br><span class="line">        4: istore_1</span><br><span class="line">        &#x2F;&#x2F;tryå—æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡Œfinally    </span><br><span class="line">        5: bipush        30</span><br><span class="line">        7: istore_1</span><br><span class="line">        8: goto          27</span><br><span class="line">       &#x2F;&#x2F;catchå—     </span><br><span class="line">       11: astore_2 &#x2F;&#x2F;å¼‚å¸¸ä¿¡æ¯æ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„2å·æ§½ä½</span><br><span class="line">       12: bipush        20</span><br><span class="line">       14: istore_1</span><br><span class="line">       &#x2F;&#x2F;catchå—æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡Œfinally        </span><br><span class="line">       15: bipush        30</span><br><span class="line">       17: istore_1</span><br><span class="line">       18: goto          27</span><br><span class="line">       &#x2F;&#x2F;å‡ºç°å¼‚å¸¸ï¼Œä½†æœªè¢«Exceptionæ•è·ï¼Œä¼šæŠ›å‡ºå…¶ä»–å¼‚å¸¸ï¼Œè¿™æ—¶ä¹Ÿéœ€è¦æ‰§è¡Œfinallyå—ä¸­çš„ä»£ç    </span><br><span class="line">       21: astore_3</span><br><span class="line">       22: bipush        30</span><br><span class="line">       24: istore_1</span><br><span class="line">       25: aload_3</span><br><span class="line">       26: athrow  &#x2F;&#x2F;æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">       27: return</span><br><span class="line">     Exception table:</span><br><span class="line">        from    to  target type</span><br><span class="line">            2     5    11   Class java&#x2F;lang&#x2F;Exception</span><br><span class="line">            2     5    21   any</span><br><span class="line">           11    15    21   any</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° ï¬nally ä¸­çš„ä»£ç è¢«<strong>å¤åˆ¶äº† 3 ä»½</strong>ï¼Œåˆ†åˆ«æ”¾å…¥ try æµç¨‹ï¼Œcatch æµç¨‹ä»¥åŠ catchå‰©ä½™çš„å¼‚å¸¸ç±»å‹æµç¨‹</p>
<p><strong>æ³¨æ„</strong>ï¼šè™½ç„¶ä»å­—èŠ‚ç æŒ‡ä»¤çœ‹æ¥ï¼Œæ¯ä¸ªå—ä¸­éƒ½æœ‰finallyå—ï¼Œä½†æ˜¯finallyå—ä¸­çš„ä»£ç <strong>åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡</strong></p>
<h5 id="finallyä¸­çš„return"><a href="#finallyä¸­çš„return" class="headerlink" title="finallyä¸­çš„return"></a>finallyä¸­çš„return</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class Demo3 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		int i &#x3D; Demo3.test();</span><br><span class="line">        &#x2F;&#x2F;ç»“æœä¸º20</span><br><span class="line">		System.out.println(i);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static int test() &#123;</span><br><span class="line">		int i;</span><br><span class="line">		try &#123;</span><br><span class="line">			i &#x3D; 10;</span><br><span class="line">			return i;</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			i &#x3D; 20;</span><br><span class="line">			return i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack&#x3D;1, locals&#x3D;3, args_size&#x3D;0</span><br><span class="line">        0: bipush        10</span><br><span class="line">        2: istore_0</span><br><span class="line">        3: iload_0</span><br><span class="line">        4: istore_1  &#x2F;&#x2F;æš‚å­˜è¿”å›å€¼</span><br><span class="line">        5: bipush        20</span><br><span class="line">        7: istore_0</span><br><span class="line">        8: iload_0</span><br><span class="line">        9: ireturn	&#x2F;&#x2F;ireturnä¼šè¿”å›æ“ä½œæ•°æ ˆé¡¶çš„æ•´å‹å€¼20</span><br><span class="line">       &#x2F;&#x2F;å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œè¿˜æ˜¯ä¼šæ‰§è¡Œfinallyå—ä¸­çš„å†…å®¹ï¼Œæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">       10: astore_2</span><br><span class="line">       11: bipush        20</span><br><span class="line">       13: istore_0</span><br><span class="line">       14: iload_0</span><br><span class="line">       15: ireturn	&#x2F;&#x2F;è¿™é‡Œæ²¡æœ‰athrowäº†ï¼Œä¹Ÿå°±æ˜¯å¦‚æœåœ¨finallyå—ä¸­å¦‚æœæœ‰è¿”å›æ“ä½œçš„è¯ï¼Œä¸”tryå—ä¸­å‡ºç°å¼‚å¸¸ï¼Œä¼šåæ‰å¼‚å¸¸ï¼</span><br><span class="line">     Exception table:</span><br><span class="line">        from    to  target type</span><br><span class="line">            0     5    10   any</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>ç”±äº ï¬nally ä¸­çš„ <strong>ireturn</strong> è¢«æ’å…¥äº†æ‰€æœ‰å¯èƒ½çš„æµç¨‹ï¼Œå› æ­¤è¿”å›ç»“æœè‚¯å®šä»¥ï¬nallyçš„ä¸ºå‡†</li>
<li>è‡³äºå­—èŠ‚ç ä¸­ç¬¬ 2 è¡Œï¼Œä¼¼ä¹æ²¡å•¥ç”¨ï¼Œä¸”ç•™ä¸ªä¼ç¬”ï¼Œçœ‹ä¸‹ä¸ªä¾‹å­</li>
<li>è·Ÿä¸Šä¾‹ä¸­çš„ ï¬nally ç›¸æ¯”ï¼Œå‘ç°<strong>æ²¡æœ‰ athrow äº†</strong>ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æœåœ¨ ï¬nally ä¸­å‡ºç°äº† returnï¼Œä¼š<strong>åæ‰å¼‚å¸¸</strong></li>
<li>æ‰€ä»¥<strong>ä¸è¦åœ¨finallyä¸­è¿›è¡Œè¿”å›æ“ä½œ</strong></li>
</ul>
<h5 id="è¢«åæ‰çš„å¼‚å¸¸"><a href="#è¢«åæ‰çš„å¼‚å¸¸" class="headerlink" title="è¢«åæ‰çš„å¼‚å¸¸"></a>è¢«åæ‰çš„å¼‚å¸¸</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class Demo3 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      int i &#x3D; Demo3.test();</span><br><span class="line">      &#x2F;&#x2F;æœ€ç»ˆç»“æœä¸º20</span><br><span class="line">      System.out.println(i);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public static int test() &#123;</span><br><span class="line">      int i;</span><br><span class="line">      try &#123;</span><br><span class="line">         i &#x3D; 10;</span><br><span class="line">         &#x2F;&#x2F;è¿™é‡Œåº”è¯¥ä¼šæŠ›å‡ºå¼‚å¸¸</span><br><span class="line">         i &#x3D; i&#x2F;0;</span><br><span class="line">         return i;</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">         i &#x3D; 20;</span><br><span class="line">         return i;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä¼šå‘ç°æ‰“å°ç»“æœä¸º20ï¼Œå¹¶æœªæŠ›å‡ºå¼‚å¸¸</p>
<h5 id="finallyä¸å¸¦return"><a href="#finallyä¸å¸¦return" class="headerlink" title="finallyä¸å¸¦return"></a>finallyä¸å¸¦return</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Demo4 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		int i &#x3D; Demo4.test();</span><br><span class="line">		System.out.println(i);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static int test() &#123;</span><br><span class="line">		int i &#x3D; 10;</span><br><span class="line">		try &#123;</span><br><span class="line">			return i;</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			i &#x3D; 20;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack&#x3D;1, locals&#x3D;3, args_size&#x3D;0</span><br><span class="line">        0: bipush        10</span><br><span class="line">        2: istore_0 &#x2F;&#x2F;èµ‹å€¼ç»™i 10</span><br><span class="line">        3: iload_0	&#x2F;&#x2F;åŠ è½½åˆ°æ“ä½œæ•°æ ˆé¡¶</span><br><span class="line">        4: istore_1 &#x2F;&#x2F;åŠ è½½åˆ°å±€éƒ¨å˜é‡è¡¨çš„1å·ä½ç½®</span><br><span class="line">        5: bipush        20</span><br><span class="line">        7: istore_0 &#x2F;&#x2F;èµ‹å€¼ç»™i 20</span><br><span class="line">        8: iload_1 &#x2F;&#x2F;åŠ è½½å±€éƒ¨å˜é‡è¡¨1å·ä½ç½®çš„æ•°10åˆ°æ“ä½œæ•°æ ˆ</span><br><span class="line">        9: ireturn &#x2F;&#x2F;è¿”å›æ“ä½œæ•°æ ˆé¡¶å…ƒç´  10</span><br><span class="line">       10: astore_2</span><br><span class="line">       11: bipush        20</span><br><span class="line">       13: istore_0</span><br><span class="line">       14: aload_2 &#x2F;&#x2F;åŠ è½½å¼‚å¸¸</span><br><span class="line">       15: athrow &#x2F;&#x2F;æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">     Exception table:</span><br><span class="line">        from    to  target type</span><br><span class="line">            3     5    10   any</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Demo5 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		int i &#x3D; 10;</span><br><span class="line">		Lock lock &#x3D; new Lock();</span><br><span class="line">		synchronized (lock) &#123;</span><br><span class="line">			System.out.println(i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Lock&#123;&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack&#x3D;2, locals&#x3D;5, args_size&#x3D;1</span><br><span class="line">        0: bipush        10</span><br><span class="line">        2: istore_1</span><br><span class="line">        3: new           #2                  &#x2F;&#x2F; class com&#x2F;nyima&#x2F;JVM&#x2F;day06&#x2F;Lock</span><br><span class="line">        6: dup &#x2F;&#x2F;å¤åˆ¶ä¸€ä»½ï¼Œæ”¾åˆ°æ“ä½œæ•°æ ˆé¡¶ï¼Œç”¨äºæ„é€ å‡½æ•°æ¶ˆè€—</span><br><span class="line">        7: invokespecial #3                  &#x2F;&#x2F; Method com&#x2F;nyima&#x2F;JVM&#x2F;day06&#x2F;Lock.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">       10: astore_2 &#x2F;&#x2F;å‰©ä¸‹çš„ä¸€ä»½æ”¾åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®</span><br><span class="line">       11: aload_2 &#x2F;&#x2F;åŠ è½½åˆ°æ“ä½œæ•°æ ˆ</span><br><span class="line">       12: dup &#x2F;&#x2F;å¤åˆ¶ä¸€ä»½ï¼Œæ”¾åˆ°æ“ä½œæ•°æ ˆï¼Œç”¨äºåŠ é”æ—¶æ¶ˆè€—</span><br><span class="line">       13: astore_3 &#x2F;&#x2F;å°†æ“ä½œæ•°æ ˆé¡¶å…ƒç´ å¼¹å‡ºï¼Œæš‚å­˜åˆ°å±€éƒ¨å˜é‡è¡¨çš„ä¸‰å·æ§½ä½ã€‚è¿™æ—¶æ“ä½œæ•°æ ˆä¸­æœ‰ä¸€ä»½å¯¹è±¡çš„å¼•ç”¨</span><br><span class="line">       14: monitorenter &#x2F;&#x2F;åŠ é”</span><br><span class="line">       &#x2F;&#x2F;é”ä½åä»£ç å—ä¸­çš„æ“ä½œ    </span><br><span class="line">       15: getstatic     #4                  &#x2F;&#x2F; Field java&#x2F;lang&#x2F;System.out:Ljava&#x2F;io&#x2F;PrintStream;</span><br><span class="line">       18: iload_1</span><br><span class="line">       19: invokevirtual #5                  &#x2F;&#x2F; Method java&#x2F;io&#x2F;PrintStream.println:(I)V</span><br><span class="line">       &#x2F;&#x2F;åŠ è½½å±€éƒ¨å˜é‡è¡¨ä¸­ä¸‰å·æ§½ä½å¯¹è±¡çš„å¼•ç”¨ï¼Œç”¨äºè§£é”    </span><br><span class="line">       22: aload_3    </span><br><span class="line">       23: monitorexit &#x2F;&#x2F;è§£é”</span><br><span class="line">       24: goto          34</span><br><span class="line">       &#x2F;&#x2F;å¼‚å¸¸æ“ä½œ    </span><br><span class="line">       27: astore        4</span><br><span class="line">       29: aload_3</span><br><span class="line">       30: monitorexit &#x2F;&#x2F;è§£é”</span><br><span class="line">       31: aload         4</span><br><span class="line">       33: athrow</span><br><span class="line">       34: return</span><br><span class="line">     &#x2F;&#x2F;å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºä½•æ—¶å‡ºç°å¼‚å¸¸ï¼Œéƒ½ä¼šè·³è½¬åˆ°27è¡Œï¼Œå°†å¼‚å¸¸æ”¾å…¥å±€éƒ¨å˜é‡ä¸­ï¼Œå¹¶è¿›è¡Œè§£é”æ“ä½œï¼Œç„¶ååŠ è½½å¼‚å¸¸å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚      </span><br><span class="line">     Exception table:</span><br><span class="line">        from    to  target type</span><br><span class="line">           15    24    27   any</span><br><span class="line">           27    31    27   any</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="3ã€ç¼–è¯‘æœŸå¤„ç†"><a href="#3ã€ç¼–è¯‘æœŸå¤„ç†" class="headerlink" title="3ã€ç¼–è¯‘æœŸå¤„ç†"></a>3ã€ç¼–è¯‘æœŸå¤„ç†</h3><p>æ‰€è°“çš„ <strong>è¯­æ³•ç³–</strong> ï¼Œå…¶å®å°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ *.java æºç ç¼–è¯‘ä¸º *.class å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>è‡ªåŠ¨ç”Ÿæˆ</strong>å’Œ<strong>è½¬æ¢</strong>çš„ä¸€äº›ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œç®—æ˜¯ java ç¼–è¯‘å™¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé¢å¤–ç¦åˆ©</p>
<p><strong>æ³¨æ„</strong>ï¼Œä»¥ä¸‹ä»£ç çš„åˆ†æï¼Œå€ŸåŠ©äº† javap å·¥å…·ï¼Œidea çš„åç¼–è¯‘åŠŸèƒ½ï¼Œidea æ’ä»¶ jclasslib ç­‰å·¥å…·ã€‚å¦å¤–ï¼Œ ç¼–è¯‘å™¨è½¬æ¢çš„<strong>ç»“æœç›´æ¥å°±æ˜¯ class å­—èŠ‚ç </strong>ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œç»™å‡ºäº† å‡ ä¹ç­‰ä»· çš„ java æºç æ–¹å¼ï¼Œå¹¶ä¸æ˜¯ç¼–è¯‘å™¨è¿˜ä¼šè½¬æ¢å‡ºä¸­é—´çš„ java æºç ï¼Œåˆ‡è®°ã€‚</p>
<h4 id="é»˜è®¤æ„é€ å‡½æ•°"><a href="#é»˜è®¤æ„é€ å‡½æ•°" class="headerlink" title="é»˜è®¤æ„é€ å‡½æ•°"></a>é»˜è®¤æ„é€ å‡½æ•°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public class Candy1 &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡ç¼–è¯‘æœŸä¼˜åŒ–å</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Candy1 &#123;</span><br><span class="line">   &#x2F;&#x2F;è¿™ä¸ªæ— å‚æ„é€ å™¨æ˜¯javaç¼–è¯‘å™¨å¸®æˆ‘ä»¬åŠ ä¸Šçš„</span><br><span class="line">   public Candy1() &#123;</span><br><span class="line">      &#x2F;&#x2F;å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java&#x2F;lang&#x2F;Object.&quot; &lt;init&gt;&quot;:()V</span><br><span class="line">      super();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="è‡ªåŠ¨æ‹†è£…ç®±"><a href="#è‡ªåŠ¨æ‹†è£…ç®±" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±"></a>è‡ªåŠ¨æ‹†è£…ç®±</h4><p>åŸºæœ¬ç±»å‹å’Œå…¶åŒ…è£…ç±»å‹çš„ç›¸äº’è½¬æ¢è¿‡ç¨‹ï¼Œç§°ä¸ºæ‹†è£…ç®±</p>
<p>åœ¨JDK 5ä»¥åï¼Œå®ƒä»¬çš„è½¬æ¢å¯ä»¥åœ¨ç¼–è¯‘æœŸè‡ªåŠ¨å®Œæˆ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Demo2 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      Integer x &#x3D; 1;</span><br><span class="line">      int y &#x3D; x;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Demo2 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      &#x2F;&#x2F;åŸºæœ¬ç±»å‹èµ‹å€¼ç»™åŒ…è£…ç±»å‹ï¼Œç§°ä¸ºè£…ç®±</span><br><span class="line">      Integer x &#x3D; Integer.valueOf(1);</span><br><span class="line">      &#x2F;&#x2F;åŒ…è£…ç±»å‹èµ‹å€¼ç»™åŸºæœ¬ç±»å‹ï¼Œç§°è°“æ‹†ç®±</span><br><span class="line">      int y &#x3D; x.intValue();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="æ³›å‹é›†åˆå–å€¼"><a href="#æ³›å‹é›†åˆå–å€¼" class="headerlink" title="æ³›å‹é›†åˆå–å€¼"></a>æ³›å‹é›†åˆå–å€¼</h4><p>æ³›å‹ä¹Ÿæ˜¯åœ¨ JDK 5 å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨<strong>ç¼–è¯‘æ³›å‹ä»£ç å</strong>ä¼šæ‰§è¡Œ <strong>æ³›å‹æ“¦é™¤</strong> çš„åŠ¨ä½œï¼Œå³æ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åå°±<strong>ä¸¢å¤±</strong>äº†ï¼Œå®é™…çš„ç±»å‹éƒ½å½“åšäº† <strong>Object</strong> ç±»å‹æ¥å¤„ç†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Demo3 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      List&lt;Integer&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">      list.add(10);</span><br><span class="line">      Integer x &#x3D; list.get(0);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">    stack&#x3D;2, locals&#x3D;3, args_size&#x3D;1</span><br><span class="line">       0: new           #2                  &#x2F;&#x2F; class java&#x2F;util&#x2F;ArrayList</span><br><span class="line">       3: dup</span><br><span class="line">       4: invokespecial #3                  &#x2F;&#x2F; Method java&#x2F;util&#x2F;ArrayList.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">       7: astore_1</span><br><span class="line">       8: aload_1</span><br><span class="line">       9: bipush        10</span><br><span class="line">      11: invokestatic  #4                  &#x2F;&#x2F; Method java&#x2F;lang&#x2F;Integer.valueOf:(I)Ljava&#x2F;lang&#x2F;Integer;</span><br><span class="line">      &#x2F;&#x2F;è¿™é‡Œè¿›è¡Œäº†æ³›å‹æ“¦é™¤ï¼Œå®é™…è°ƒç”¨çš„æ˜¯add(Objcet o)</span><br><span class="line">      14: invokeinterface #5,  2            &#x2F;&#x2F; InterfaceMethod java&#x2F;util&#x2F;List.add:(Ljava&#x2F;lang&#x2F;Object;)Z</span><br><span class="line"></span><br><span class="line">      19: pop</span><br><span class="line">      20: aload_1</span><br><span class="line">      21: iconst_0</span><br><span class="line">      &#x2F;&#x2F;è¿™é‡Œä¹Ÿè¿›è¡Œäº†æ³›å‹æ“¦é™¤ï¼Œå®é™…è°ƒç”¨çš„æ˜¯get(Object o)   </span><br><span class="line">      22: invokeinterface #6,  2            &#x2F;&#x2F; InterfaceMethod java&#x2F;util&#x2F;List.get:(I)Ljava&#x2F;lang&#x2F;Object;</span><br><span class="line">&#x2F;&#x2F;è¿™é‡Œè¿›è¡Œäº†ç±»å‹è½¬æ¢ï¼Œå°†Objectè½¬æ¢æˆäº†Integer</span><br><span class="line">      27: checkcast     #7                  &#x2F;&#x2F; class java&#x2F;lang&#x2F;Integer</span><br><span class="line">      30: astore_2</span><br><span class="line">      31: return</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è°ƒç”¨getå‡½æ•°å–å€¼æ—¶ï¼Œæœ‰ä¸€ä¸ªç±»å‹è½¬æ¢çš„æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer x &#x3D; (Integer) list.get(0);</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦å°†è¿”å›ç»“æœèµ‹å€¼ç»™ä¸€ä¸ªintç±»å‹çš„å˜é‡ï¼Œåˆ™è¿˜æœ‰<strong>è‡ªåŠ¨æ‹†ç®±</strong>çš„æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int x &#x3D; (Integer) list.get(0).intValue();</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="å¯å˜å‚æ•°"><a href="#å¯å˜å‚æ•°" class="headerlink" title="å¯å˜å‚æ•°"></a>å¯å˜å‚æ•°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Demo4 &#123;</span><br><span class="line">   public static void foo(String... args) &#123;</span><br><span class="line">      &#x2F;&#x2F;å°†argsèµ‹å€¼ç»™arrï¼Œå¯ä»¥çœ‹å‡ºString...å®é™…å°±æ˜¯String[] </span><br><span class="line">      String[] arr &#x3D; args;</span><br><span class="line">      System.out.println(arr.length);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      foo(&quot;hello&quot;, &quot;world&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯å˜å‚æ•° <strong>Stringâ€¦</strong> args å…¶å®æ˜¯ä¸€ä¸ª <strong>String[]</strong> args ï¼Œä»ä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ åŒ æ · java ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†ä¸Šè¿°ä»£ç å˜æ¢ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Demo4 &#123;</span><br><span class="line">   public Demo4 &#123;&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">   public static void foo(String[] args) &#123;</span><br><span class="line">      String[] arr &#x3D; args;</span><br><span class="line">      System.out.println(arr.length);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      foo(new String[]&#123;&quot;hello&quot;, &quot;world&quot;&#125;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯foo()ï¼Œå³æœªä¼ é€’å‚æ•°æ—¶ï¼Œç­‰ä»·ä»£ç ä¸ºfoo(new String[]{})ï¼Œ<strong>åˆ›å»ºäº†ä¸€ä¸ªç©ºæ•°ç»„</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ é€’çš„null</p>
<h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class Demo5 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">        &#x2F;&#x2F;æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚</span><br><span class="line">		int[] arr &#x3D; &#123;1, 2, 3, 4, 5&#125;;</span><br><span class="line">		for(int x : arr) &#123;</span><br><span class="line">			System.out.println(x);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è½¬æ¢ä¸º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Demo5 &#123;</span><br><span class="line">    public Demo5 &#123;&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		int[] arr &#x3D; new int[]&#123;1, 2, 3, 4, 5&#125;;</span><br><span class="line">		for(int i&#x3D;0; i&lt;arr.length; ++i) &#123;</span><br><span class="line">			int x &#x3D; arr[i];</span><br><span class="line">			System.out.println(x);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœæ˜¯é›†åˆä½¿ç”¨foreach</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Demo5 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      List&lt;Integer&gt; list &#x3D; Arrays.asList(1, 2, 3, 4, 5);</span><br><span class="line">      for (Integer x : list) &#123;</span><br><span class="line">         System.out.println(x);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>é›†åˆè¦ä½¿ç”¨foreachï¼Œéœ€è¦è¯¥é›†åˆç±»å®ç°äº†<strong>Iterableæ¥å£</strong>ï¼Œå› ä¸ºé›†åˆçš„éå†éœ€è¦ç”¨åˆ°<strong>è¿­ä»£å™¨Iterator</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Demo5 &#123;</span><br><span class="line">    public Demo5 &#123;&#125;</span><br><span class="line">    </span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      List&lt;Integer&gt; list &#x3D; Arrays.asList(1, 2, 3, 4, 5);</span><br><span class="line">      &#x2F;&#x2F;è·å¾—è¯¥é›†åˆçš„è¿­ä»£å™¨</span><br><span class="line">      Iterator&lt;Integer&gt; iterator &#x3D; list.iterator();</span><br><span class="line">      while(iterator.hasNext()) &#123;</span><br><span class="line">         Integer x &#x3D; iterator.next();</span><br><span class="line">         System.out.println(x);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="switchå­—ç¬¦ä¸²"><a href="#switchå­—ç¬¦ä¸²" class="headerlink" title="switchå­—ç¬¦ä¸²"></a>switchå­—ç¬¦ä¸²</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Demo6 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      String str &#x3D; &quot;hello&quot;;</span><br><span class="line">      switch (str) &#123;</span><br><span class="line">         case &quot;hello&quot; :</span><br><span class="line">            System.out.println(&quot;h&quot;);</span><br><span class="line">            break;</span><br><span class="line">         case &quot;world&quot; :</span><br><span class="line">            System.out.println(&quot;w&quot;);</span><br><span class="line">            break;</span><br><span class="line">         default:</span><br><span class="line">            break;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¼–è¯‘å™¨ä¸­æ‰§è¡Œçš„æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public class Demo6 &#123;</span><br><span class="line">   public Demo6() &#123;</span><br><span class="line">      </span><br><span class="line">   &#125;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      String str &#x3D; &quot;hello&quot;;</span><br><span class="line">      int x &#x3D; -1;</span><br><span class="line">      &#x2F;&#x2F;é€šè¿‡å­—ç¬¦ä¸²çš„hashCode+valueæ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…</span><br><span class="line">      switch (str.hashCode()) &#123;</span><br><span class="line">         &#x2F;&#x2F;helloçš„hashCode</span><br><span class="line">         case 99162322 :</span><br><span class="line">            &#x2F;&#x2F;å†æ¬¡æ¯”è¾ƒï¼Œå› ä¸ºå­—ç¬¦ä¸²çš„hashCodeæœ‰å¯èƒ½ç›¸ç­‰</span><br><span class="line">            if(str.equals(&quot;hello&quot;)) &#123;</span><br><span class="line">               x &#x3D; 0;</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">         &#x2F;&#x2F;worldçš„hashCode</span><br><span class="line">         case 11331880 :</span><br><span class="line">            if(str.equals(&quot;world&quot;)) &#123;</span><br><span class="line">               x &#x3D; 1;</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">         default:</span><br><span class="line">            break;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F;ç”¨ç¬¬äºŒä¸ªswitchåœ¨è¿›è¡Œè¾“å‡ºåˆ¤æ–­</span><br><span class="line">      switch (x) &#123;</span><br><span class="line">         case 0:</span><br><span class="line">            System.out.println(&quot;h&quot;);</span><br><span class="line">            break;</span><br><span class="line">         case 1:</span><br><span class="line">            System.out.println(&quot;w&quot;);</span><br><span class="line">            break;</span><br><span class="line">         default:</span><br><span class="line">            break;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è¿‡ç¨‹è¯´æ˜ï¼š</p>
<ul>
<li>åœ¨ç¼–è¯‘æœŸé—´ï¼Œå•ä¸ªçš„switchè¢«åˆ†ä¸ºäº†ä¸¤ä¸ª<ul>
<li>ç¬¬ä¸€ä¸ªç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²ï¼Œå¹¶ç»™xèµ‹å€¼<ul>
<li>å­—ç¬¦ä¸²çš„åŒ¹é…ç”¨åˆ°äº†å­—ç¬¦ä¸²çš„hashCodeï¼Œè¿˜ç”¨åˆ°äº†equalsæ–¹æ³•</li>
<li>ä½¿ç”¨hashCodeæ˜¯ä¸ºäº†æé«˜æ¯”è¾ƒæ•ˆç‡ï¼Œä½¿ç”¨equalsæ˜¯é˜²æ­¢æœ‰hashCodeå†²çªï¼ˆå¦‚BMå’ŒC.ï¼‰</li>
</ul>
</li>
<li>ç¬¬äºŒä¸ªç”¨æ¥æ ¹æ®xçš„å€¼æ¥å†³å®šè¾“å‡ºè¯­å¥</li>
</ul>
</li>
</ul>
<h4 id="switchæšä¸¾"><a href="#switchæšä¸¾" class="headerlink" title="switchæšä¸¾"></a>switchæšä¸¾</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Demo7 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      SEX sex &#x3D; SEX.MALE;</span><br><span class="line">      switch (sex) &#123;</span><br><span class="line">         case MALE:</span><br><span class="line">            System.out.println(&quot;man&quot;);</span><br><span class="line">            break;</span><br><span class="line">         case FEMALE:</span><br><span class="line">            System.out.println(&quot;woman&quot;);</span><br><span class="line">            break;</span><br><span class="line">         default:</span><br><span class="line">            break;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum SEX &#123;</span><br><span class="line">   MALE, FEMALE;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¸­æ‰§è¡Œçš„ä»£ç å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">public class Demo7 &#123;</span><br><span class="line">   &#x2F;**     </span><br><span class="line">    * å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰     </span><br><span class="line">    * ç”¨æ¥æ˜ å°„æšä¸¾çš„ ordinal ä¸æ•°ç»„å…ƒç´ çš„å…³ç³»     </span><br><span class="line">    * æšä¸¾çš„ ordinal è¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä» 0 å¼€å§‹     </span><br><span class="line">    * å³ MALE çš„ ordinal()&#x3D;0ï¼ŒFEMALE çš„ ordinal()&#x3D;1     </span><br><span class="line">    *&#x2F; </span><br><span class="line">   static class $MAP &#123;</span><br><span class="line">      &#x2F;&#x2F;æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜æ”¾äº†caseç”¨äºæ¯”è¾ƒçš„æ•°å­—</span><br><span class="line">      static int[] map &#x3D; new int[2];</span><br><span class="line">      static &#123;</span><br><span class="line">         &#x2F;&#x2F;ordinalå³æšä¸¾å…ƒç´ å¯¹åº”æ‰€åœ¨çš„ä½ç½®ï¼ŒMALEä¸º0ï¼ŒFEMALEä¸º1</span><br><span class="line">         map[SEX.MALE.ordinal()] &#x3D; 1;</span><br><span class="line">         map[SEX.FEMALE.ordinal()] &#x3D; 2;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      SEX sex &#x3D; SEX.MALE;</span><br><span class="line">      &#x2F;&#x2F;å°†å¯¹åº”ä½ç½®æšä¸¾å…ƒç´ çš„å€¼èµ‹ç»™xï¼Œç”¨äºcaseæ“ä½œ</span><br><span class="line">      int x &#x3D; $MAP.map[sex.ordinal()];</span><br><span class="line">      switch (x) &#123;</span><br><span class="line">         case 1:</span><br><span class="line">            System.out.println(&quot;man&quot;);</span><br><span class="line">            break;</span><br><span class="line">         case 2:</span><br><span class="line">            System.out.println(&quot;woman&quot;);</span><br><span class="line">            break;</span><br><span class="line">         default:</span><br><span class="line">            break;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum SEX &#123;</span><br><span class="line">   MALE, FEMALE;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="æšä¸¾ç±»"><a href="#æšä¸¾ç±»" class="headerlink" title="æšä¸¾ç±»"></a>æšä¸¾ç±»</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum SEX &#123;</span><br><span class="line">   MALE, FEMALE;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è½¬æ¢åçš„ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public final class Sex extends Enum&lt;Sex&gt; &#123;   </span><br><span class="line">   &#x2F;&#x2F;å¯¹åº”æšä¸¾ç±»ä¸­çš„å…ƒç´ </span><br><span class="line">   public static final Sex MALE;    </span><br><span class="line">   public static final Sex FEMALE;    </span><br><span class="line">   private static final Sex[] $VALUES;</span><br><span class="line">   </span><br><span class="line">    static &#123;       </span><br><span class="line">    	&#x2F;&#x2F;è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä¼ å…¥æšä¸¾å…ƒç´ çš„å€¼åŠordinal</span><br><span class="line">    	MALE &#x3D; new Sex(&quot;MALE&quot;, 0);    </span><br><span class="line">        FEMALE &#x3D; new Sex(&quot;FEMALE&quot;, 1);   </span><br><span class="line">        $VALUES &#x3D; new Sex[]&#123;MALE, FEMALE&#125;; </span><br><span class="line">   &#125;</span><br><span class="line"> 	</span><br><span class="line">   &#x2F;&#x2F;è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³•</span><br><span class="line">    private Sex(String name, int ordinal) &#123;     </span><br><span class="line">        super(name, ordinal);    </span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    public static Sex[] values() &#123;  </span><br><span class="line">        return $VALUES.clone();  </span><br><span class="line">    &#125;</span><br><span class="line">    public static Sex valueOf(String name) &#123; </span><br><span class="line">        return Enum.valueOf(Sex.class, name);  </span><br><span class="line">    &#125; </span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Demo8 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      Runnable runnable &#x3D; new Runnable() &#123;</span><br><span class="line">         @Override</span><br><span class="line">         public void run() &#123;</span><br><span class="line">            System.out.println(&quot;running...&quot;);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è½¬æ¢åçš„ä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Demo8 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      &#x2F;&#x2F;ç”¨é¢å¤–åˆ›å»ºçš„ç±»æ¥åˆ›å»ºåŒ¿åå†…éƒ¨ç±»å¯¹è±¡</span><br><span class="line">      Runnable runnable &#x3D; new Demo8$1();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;åˆ›å»ºäº†ä¸€ä¸ªé¢å¤–çš„ç±»ï¼Œå®ç°äº†Runnableæ¥å£</span><br><span class="line">final class Demo8$1 implements Runnable &#123;</span><br><span class="line">   public Demo8$1() &#123;&#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public void run() &#123;</span><br><span class="line">      System.out.println(&quot;running...&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåŒ¿åå†…éƒ¨ç±»ä¸­å¼•ç”¨äº†<strong>å±€éƒ¨å˜é‡</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Demo8 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      int x &#x3D; 1;</span><br><span class="line">      Runnable runnable &#x3D; new Runnable() &#123;</span><br><span class="line">         @Override</span><br><span class="line">         public void run() &#123;</span><br><span class="line">            System.out.println(x);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è½¬åŒ–åä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class Demo8 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      int x &#x3D; 1;</span><br><span class="line">      Runnable runnable &#x3D; new Runnable() &#123;</span><br><span class="line">         @Override</span><br><span class="line">         public void run() &#123;</span><br><span class="line">            System.out.println(x);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">final class Demo8$1 implements Runnable &#123;</span><br><span class="line">   &#x2F;&#x2F;å¤šåˆ›å»ºäº†ä¸€ä¸ªå˜é‡</span><br><span class="line">   int val$x;</span><br><span class="line">   &#x2F;&#x2F;å˜ä¸ºäº†æœ‰å‚æ„é€ å™¨</span><br><span class="line">   public Demo8$1(int x) &#123;</span><br><span class="line">      this.val$x &#x3D; x;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public void run() &#123;</span><br><span class="line">      System.out.println(val$x);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="4ã€ç±»åŠ è½½é˜¶æ®µ"><a href="#4ã€ç±»åŠ è½½é˜¶æ®µ" class="headerlink" title="4ã€ç±»åŠ è½½é˜¶æ®µ"></a>4ã€ç±»åŠ è½½é˜¶æ®µ</h3><h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><ul>
<li><p>å°†ç±»çš„å­—èŠ‚ç è½½å…¥</p>
<p>æ–¹æ³•åŒº</p>
<p>ï¼ˆ1.8åä¸ºå…ƒç©ºé—´ï¼Œåœ¨æœ¬åœ°å†…å­˜ä¸­ï¼‰ä¸­ï¼Œå†…éƒ¨é‡‡ç”¨ C++ çš„ instanceKlass æè¿° java ç±»ï¼Œå®ƒçš„é‡è¦ ï¬eld æœ‰ï¼š</p>
<ul>
<li>_java_mirror å³ java çš„ç±»é•œåƒï¼Œä¾‹å¦‚å¯¹ String æ¥è¯´ï¼Œå®ƒçš„é•œåƒç±»å°±æ˜¯ String.classï¼Œä½œç”¨æ˜¯æŠŠ klass æš´éœ²ç»™ java ä½¿ç”¨</li>
<li>_super å³çˆ¶ç±»</li>
<li>_ï¬elds å³æˆå‘˜å˜é‡</li>
<li>_methods å³æ–¹æ³•</li>
<li>_constants å³å¸¸é‡æ± </li>
<li>_class_loader å³ç±»åŠ è½½å™¨</li>
<li>_vtable è™šæ–¹æ³•è¡¨</li>
<li>_itable æ¥å£æ–¹æ³•</li>
</ul>
</li>
<li><p>å¦‚æœè¿™ä¸ªç±»è¿˜æœ‰çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œ<strong>å…ˆåŠ è½½çˆ¶ç±»</strong></p>
</li>
<li><p>åŠ è½½å’Œé“¾æ¥å¯èƒ½æ˜¯<strong>äº¤æ›¿è¿è¡Œ</strong>çš„</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611205050.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611205050.png" alt="img"></a></p>
<ul>
<li>instanceKlassä¿å­˜åœ¨<strong>æ–¹æ³•åŒº</strong>ã€‚JDK 8ä»¥åï¼Œæ–¹æ³•åŒºä½äºå…ƒç©ºé—´ä¸­ï¼Œè€Œå…ƒç©ºé—´åˆä½äºæœ¬åœ°å†…å­˜ä¸­</li>
<li>_java_mirroråˆ™æ˜¯ä¿å­˜åœ¨<strong>å †å†…å­˜</strong>ä¸­</li>
<li>InstanceKlasså’Œ*.class(JAVAé•œåƒç±»)äº’ç›¸ä¿å­˜äº†å¯¹æ–¹çš„åœ°å€</li>
<li>ç±»çš„å¯¹è±¡åœ¨å¯¹è±¡å¤´ä¸­ä¿å­˜äº†*.classçš„åœ°å€ã€‚è®©å¯¹è±¡å¯ä»¥é€šè¿‡å…¶æ‰¾åˆ°æ–¹æ³•åŒºä¸­çš„instanceKlassï¼Œä»è€Œè·å–ç±»çš„å„ç§ä¿¡æ¯</li>
</ul>
<h4 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h4><h5 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h5><p>éªŒè¯ç±»æ˜¯å¦ç¬¦åˆ JVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥</p>
<h5 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h5><p>ä¸º static å˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼</p>
<ul>
<li>staticå˜é‡åœ¨JDK 7ä»¥å‰æ˜¯å­˜å‚¨ä¸instanceKlassæœ«å°¾ã€‚ä½†åœ¨JDK 7ä»¥åå°±å­˜å‚¨åœ¨_java_mirroræœ«å°¾äº†</li>
<li>staticå˜é‡åœ¨åˆ†é…ç©ºé—´å’Œèµ‹å€¼æ˜¯åœ¨ä¸¤ä¸ªé˜¶æ®µå®Œæˆçš„ã€‚åˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</li>
<li>å¦‚æœ static å˜é‡æ˜¯ ï¬nal çš„<strong>åŸºæœ¬ç±»å‹</strong>ï¼Œä»¥åŠ<strong>å­—ç¬¦ä¸²å¸¸é‡</strong>ï¼Œé‚£ä¹ˆç¼–è¯‘é˜¶æ®µå€¼å°±ç¡®å®šäº†ï¼Œ<strong>èµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</strong></li>
<li>å¦‚æœ static å˜é‡æ˜¯ ï¬nal çš„ï¼Œä½†å±äº<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨<strong>åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</strong></li>
</ul>
<h5 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h5><p><strong>HSDBçš„ä½¿ç”¨</strong></p>
<ul>
<li>å…ˆè·å¾—è¦æŸ¥çœ‹çš„è¿›ç¨‹ID</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>æ‰“å¼€HSDB</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -cp F:\JAVA\JDK8.0\lib\sa-jdi.jar sun.jvm.hotspot.HSDB</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿è¡Œæ—¶å¯èƒ½ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸º<strong>ç¼ºå°‘ä¸€ä¸ª.dllçš„æ–‡ä»¶</strong>ï¼Œæˆ‘ä»¬åœ¨JDKçš„å®‰è£…ç›®å½•ä¸­æ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œå¤åˆ¶åˆ°ç¼ºå¤±çš„æ–‡ä»¶ä¸‹å³å¯</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221703.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221703.png" alt="img"></a></p>
<ul>
<li>å®šä½éœ€è¦çš„è¿›ç¨‹</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221857.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221857.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611222029.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611222029.png" alt="img"></a></p>
<p><strong>è§£æçš„å«ä¹‰</strong></p>
<p>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</p>
<ul>
<li>æœªè§£ææ—¶ï¼Œå¸¸é‡æ± ä¸­çš„çœ‹åˆ°çš„å¯¹è±¡ä»…æ˜¯ç¬¦å·ï¼ŒæœªçœŸæ­£çš„å­˜åœ¨äºå†…å­˜ä¸­</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class Demo1 &#123;</span><br><span class="line">   public static void main(String[] args) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">      ClassLoader loader &#x3D; Demo1.class.getClassLoader();</span><br><span class="line">      &#x2F;&#x2F;åªåŠ è½½ä¸è§£æ</span><br><span class="line">      Class&lt;?&gt; c &#x3D; loader.loadClass(&quot;com.nyima.JVM.day8.C&quot;);</span><br><span class="line">      &#x2F;&#x2F;ç”¨äºé˜»å¡ä¸»çº¿ç¨‹</span><br><span class="line">      System.in.read();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C &#123;</span><br><span class="line">   D d &#x3D; new D();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class D &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>æ‰“å¼€HSDB<ul>
<li>å¯ä»¥çœ‹åˆ°æ­¤æ—¶åªåŠ è½½äº†ç±»C</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223153.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223153.png" alt="img"></a></p>
<p>æŸ¥çœ‹ç±»Cçš„å¸¸é‡æ± ï¼Œå¯ä»¥çœ‹åˆ°ç±»D<strong>æœªè¢«è§£æ</strong>ï¼Œåªæ˜¯å­˜åœ¨äºå¸¸é‡æ± ä¸­çš„ç¬¦å·</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611230658.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611230658.png" alt="img"></a></p>
<ul>
<li><p>è§£æä»¥åï¼Œä¼šå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</p>
<ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶å·²åŠ è½½å¹¶è§£æäº†ç±»Cå’Œç±»D</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223441.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223441.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200613104723.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200613104723.png" alt="img"></a></p>
</li>
</ul>
<h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯<strong>æ‰§è¡Œç±»æ„é€ å™¨clinit()æ–¹æ³•çš„è¿‡ç¨‹</strong>ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯è¿™ä¸ªç±»çš„ã€æ„é€ æ–¹æ³•ã€çš„çº¿ç¨‹å®‰å…¨</p>
<ul>
<li>clinit()æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„<strong>èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—</strong>ï¼ˆstatic{}å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„</li>
</ul>
<p><strong>æ³¨æ„</strong></p>
<p>ç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­<strong>å‡ºç°çš„é¡ºåºå†³å®š</strong>çš„ï¼Œé™æ€è¯­å¥å—ä¸­åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒ<strong>ä¹‹å</strong>çš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—<strong>å¯ä»¥èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®</strong>ï¼Œå¦‚</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201118204542.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201118204542.png" alt="img"></a></p>
<h5 id="å‘ç”Ÿæ—¶æœº"><a href="#å‘ç”Ÿæ—¶æœº" class="headerlink" title="å‘ç”Ÿæ—¶æœº"></a>å‘ç”Ÿæ—¶æœº</h5><p><strong>ç±»çš„åˆå§‹åŒ–çš„æ‡’æƒ°çš„</strong>ï¼Œä»¥ä¸‹æƒ…å†µä¼šåˆå§‹åŒ–</p>
<ul>
<li>main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ–</li>
<li>é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶</li>
<li>å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘</li>
<li>å­ç±»è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–</li>
<li>Class.forName</li>
<li>new ä¼šå¯¼è‡´åˆå§‹åŒ–</li>
</ul>
<p>ä»¥ä¸‹æƒ…å†µä¸ä¼šåˆå§‹åŒ–</p>
<ul>
<li>è®¿é—®ç±»çš„ static ï¬nal é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼‰</li>
<li>ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li>
<li>åˆ›å»ºè¯¥ç±»å¯¹è±¡çš„æ•°ç»„</li>
<li>ç±»åŠ è½½å™¨çš„.loadClassæ–¹æ³•</li>
<li>Class.forNamedçš„å‚æ•°2ä¸ºfalseæ—¶</li>
</ul>
<p><strong>éªŒè¯ç±»æ˜¯å¦è¢«åˆå§‹åŒ–ï¼Œå¯ä»¥çœ‹æ”¹ç±»çš„é™æ€ä»£ç å—æ˜¯å¦è¢«æ‰§è¡Œ</strong></p>
<h3 id="5ã€ç±»åŠ è½½å™¨"><a href="#5ã€ç±»åŠ è½½å™¨" class="headerlink" title="5ã€ç±»åŠ è½½å™¨"></a>5ã€ç±»åŠ è½½å™¨</h3><p>Javaè™šæ‹Ÿæœºè®¾è®¡å›¢é˜Ÿæœ‰æ„æŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„<strong>â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€</strong>è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€çš„ç±»ã€‚å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç è¢«ç§°ä¸º<strong>â€œç±»åŠ è½½å™¨â€</strong>ï¼ˆClassLoaderï¼‰</p>
<h4 id="ç±»ä¸ç±»åŠ è½½å™¨"><a href="#ç±»ä¸ç±»åŠ è½½å™¨" class="headerlink" title="ç±»ä¸ç±»åŠ è½½å™¨"></a>ç±»ä¸ç±»åŠ è½½å™¨</h4><p>ç±»åŠ è½½å™¨è™½ç„¶åªç”¨äºå®ç°ç±»çš„åŠ è½½åŠ¨ä½œï¼Œä½†å®ƒåœ¨Javaç¨‹åºä¸­èµ·åˆ°çš„ä½œç”¨å´è¿œè¶…ç±»åŠ è½½é˜¶æ®µ</p>
<p>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½å¿…é¡»ç”±åŠ è½½å®ƒçš„<strong>ç±»åŠ è½½å™¨</strong>å’Œè¿™ä¸ª<strong>ç±»æœ¬èº«</strong>ä¸€èµ·å…±åŒç¡®ç«‹å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚è¿™å¥è¯å¯ä»¥è¡¨è¾¾å¾—æ›´é€šä¿—ä¸€äº›ï¼š<strong>æ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦â€œç›¸ç­‰â€ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰</strong>ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªJavaè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰</p>
<p>ä»¥JDK 8ä¸ºä¾‹</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>åŠ è½½çš„ç±»</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Bootstrap ClassLoaderï¼ˆå¯åŠ¨ç±»åŠ è½½å™¨ï¼‰</td>
<td>JAVA_HOME/jre/lib</td>
<td>æ— æ³•ç›´æ¥è®¿é—®</td>
</tr>
<tr>
<td>Extension ClassLoader(æ‹“å±•ç±»åŠ è½½å™¨)</td>
<td>JAVA_HOME/jre/lib/ext</td>
<td>ä¸Šçº§ä¸ºBootstrapï¼Œ<strong>æ˜¾ç¤ºä¸ºnull</strong></td>
</tr>
<tr>
<td>Application ClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</td>
<td>classpath</td>
<td>ä¸Šçº§ä¸ºExtension</td>
</tr>
<tr>
<td>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</td>
<td>è‡ªå®šä¹‰</td>
<td>ä¸Šçº§ä¸ºApplication</td>
</tr>
</tbody></table>
<h4 id="å¯åŠ¨ç±»åŠ è½½å™¨"><a href="#å¯åŠ¨ç±»åŠ è½½å™¨" class="headerlink" title="å¯åŠ¨ç±»åŠ è½½å™¨"></a>å¯åŠ¨ç±»åŠ è½½å™¨</h4><p>å¯é€šè¿‡åœ¨æ§åˆ¶å°è¾“å…¥æŒ‡ä»¤ï¼Œä½¿å¾—ç±»è¢«å¯åŠ¨ç±»åŠ å™¨åŠ è½½</p>
<h4 id="æ‹“å±•ç±»åŠ è½½å™¨"><a href="#æ‹“å±•ç±»åŠ è½½å™¨" class="headerlink" title="æ‹“å±•ç±»åŠ è½½å™¨"></a>æ‹“å±•ç±»åŠ è½½å™¨</h4><p>å¦‚æœclasspathå’ŒJAVA_HOME/jre/lib/ext ä¸‹æœ‰åŒåç±»ï¼ŒåŠ è½½æ—¶ä¼šä½¿ç”¨<strong>æ‹“å±•ç±»åŠ è½½å™¨</strong>åŠ è½½ã€‚å½“åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å‘ç°æ‹“å±•ç±»åŠ è½½å™¨å·²å°†è¯¥åŒåç±»åŠ è½½è¿‡äº†ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŠ è½½</p>
<h4 id="åŒäº²å§”æ´¾æ¨¡å¼"><a href="#åŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å¼"></a>åŒäº²å§”æ´¾æ¨¡å¼</h4><p>åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³è°ƒç”¨ç±»åŠ è½½å™¨ClassLoader çš„ loadClass æ–¹æ³•æ—¶ï¼ŒæŸ¥æ‰¾ç±»çš„è§„åˆ™</p>
<p>loadClassæºç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">protected Class&lt;?&gt; loadClass(String name, boolean resolve)</span><br><span class="line">    throws ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    synchronized (getClassLoadingLock(name)) &#123;</span><br><span class="line">        &#x2F;&#x2F; é¦–å…ˆæŸ¥æ‰¾è¯¥ç±»æ˜¯å¦å·²ç»è¢«è¯¥ç±»åŠ è½½å™¨åŠ è½½è¿‡äº†</span><br><span class="line">        Class&lt;?&gt; c &#x3D; findLoadedClass(name);</span><br><span class="line">        &#x2F;&#x2F;å¦‚æœæ²¡æœ‰è¢«åŠ è½½è¿‡</span><br><span class="line">        if (c &#x3D;&#x3D; null) &#123;</span><br><span class="line">            long t0 &#x3D; System.nanoTime();</span><br><span class="line">            try &#123;</span><br><span class="line">                &#x2F;&#x2F;çœ‹æ˜¯å¦è¢«å®ƒçš„ä¸Šçº§åŠ è½½å™¨åŠ è½½è¿‡äº† Extensionçš„ä¸Šçº§æ˜¯Bootstarpï¼Œä½†å®ƒæ˜¾ç¤ºä¸ºnull</span><br><span class="line">                if (parent !&#x3D; null) &#123;</span><br><span class="line">                    c &#x3D; parent.loadClass(name, false);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    &#x2F;&#x2F;çœ‹æ˜¯å¦è¢«å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½è¿‡</span><br><span class="line">                    c &#x3D; findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">                &#x2F;&#x2F; ClassNotFoundException thrown if class not found</span><br><span class="line">                &#x2F;&#x2F; from the non-null parent class loader</span><br><span class="line">                &#x2F;&#x2F;æ•è·å¼‚å¸¸ï¼Œä½†ä¸åšä»»ä½•å¤„ç†</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (c &#x3D;&#x3D; null) &#123;</span><br><span class="line">                &#x2F;&#x2F;å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œå…ˆè®©æ‹“å±•ç±»åŠ è½½å™¨è°ƒç”¨findClassæ–¹æ³•å»æ‰¾åˆ°è¯¥ç±»ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">                &#x2F;&#x2F;ç„¶åè®©åº”ç”¨ç±»åŠ è½½å™¨å»æ‰¾classpathä¸‹æ‰¾è¯¥ç±»</span><br><span class="line">                long t1 &#x3D; System.nanoTime();</span><br><span class="line">                c &#x3D; findClass(name);</span><br><span class="line"></span><br><span class="line">                &#x2F;&#x2F; è®°å½•æ—¶é—´</span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><h5 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><ul>
<li>æƒ³åŠ è½½é classpath éšæ„è·¯å¾„ä¸­çš„ç±»æ–‡ä»¶</li>
<li>é€šè¿‡æ¥å£æ¥ä½¿ç”¨å®ç°ï¼Œå¸Œæœ›è§£è€¦æ—¶ï¼Œå¸¸ç”¨åœ¨æ¡†æ¶è®¾è®¡</li>
<li>è¿™äº›ç±»å¸Œæœ›äºˆä»¥éš”ç¦»ï¼Œä¸åŒåº”ç”¨çš„åŒåç±»éƒ½å¯ä»¥åŠ è½½ï¼Œä¸å†²çªï¼Œå¸¸è§äº tomcat å®¹å™¨</li>
</ul>
<h5 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h5><ul>
<li>ç»§æ‰¿ClassLoaderçˆ¶ç±»</li>
<li>è¦éµä»åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‡å†™ ï¬ndClass æ–¹æ³•<ul>
<li>ä¸æ˜¯é‡å†™loadClassæ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šèµ°åŒäº²å§”æ´¾æœºåˆ¶</li>
</ul>
</li>
<li>è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç </li>
<li>è°ƒç”¨çˆ¶ç±»çš„ deï¬neClass æ–¹æ³•æ¥åŠ è½½ç±»</li>
<li>ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•</li>
</ul>
<h4 id="ç ´ååŒäº²å§”æ´¾æ¨¡å¼"><a href="#ç ´ååŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="ç ´ååŒäº²å§”æ´¾æ¨¡å¼"></a>ç ´ååŒäº²å§”æ´¾æ¨¡å¼</h4><ul>
<li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸€æ¬¡â€œè¢«ç ´åâ€å…¶å®å‘ç”Ÿåœ¨åŒäº²å§”æ´¾æ¨¡å‹å‡ºç°ä¹‹å‰â€”â€”å³JDK1.2é¢ä¸–ä»¥å‰çš„â€œè¿œå¤â€æ—¶ä»£<ul>
<li>å»ºè®®ç”¨æˆ·é‡å†™findClass()æ–¹æ³•ï¼Œåœ¨ç±»åŠ è½½å™¨ä¸­çš„loadClass()æ–¹æ³•ä¸­ä¹Ÿä¼šè°ƒç”¨è¯¥æ–¹æ³•</li>
</ul>
</li>
<li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬äºŒæ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±è¿™ä¸ªæ¨¡å‹è‡ªèº«çš„ç¼ºé™·å¯¼è‡´çš„<ul>
<li>å¦‚æœæœ‰åŸºç¡€ç±»å‹åˆè¦è°ƒç”¨å›ç”¨æˆ·çš„ä»£ç ï¼Œæ­¤æ—¶ä¹Ÿä¼šç ´ååŒäº²å§”æ´¾æ¨¡å¼</li>
</ul>
</li>
<li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸‰æ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±äºç”¨æˆ·å¯¹ç¨‹åºåŠ¨æ€æ€§çš„è¿½æ±‚è€Œå¯¼è‡´çš„<ul>
<li>è¿™é‡Œæ‰€è¯´çš„â€œåŠ¨æ€æ€§â€æŒ‡çš„æ˜¯ä¸€äº›éå¸¸â€œçƒ­â€é—¨çš„åè¯ï¼šä»£ç çƒ­æ›¿æ¢ï¼ˆHot Swapï¼‰ã€æ¨¡å—çƒ­éƒ¨ç½²ï¼ˆHot Deploymentï¼‰ç­‰</li>
</ul>
</li>
</ul>
<h3 id="6ã€è¿è¡ŒæœŸä¼˜åŒ–"><a href="#6ã€è¿è¡ŒæœŸä¼˜åŒ–" class="headerlink" title="6ã€è¿è¡ŒæœŸä¼˜åŒ–"></a>6ã€è¿è¡ŒæœŸä¼˜åŒ–</h3><h4 id="åˆ†å±‚ç¼–è¯‘"><a href="#åˆ†å±‚ç¼–è¯‘" class="headerlink" title="åˆ†å±‚ç¼–è¯‘"></a>åˆ†å±‚ç¼–è¯‘</h4><p>JVM å°†æ‰§è¡ŒçŠ¶æ€åˆ†æˆäº† 5 ä¸ªå±‚æ¬¡ï¼š</p>
<ul>
<li>0å±‚ï¼šè§£é‡Šæ‰§è¡Œï¼Œç”¨è§£é‡Šå™¨å°†å­—èŠ‚ç ç¿»è¯‘ä¸ºæœºå™¨ç </li>
<li>1å±‚ï¼šä½¿ç”¨ C1 <strong>å³æ—¶ç¼–è¯‘å™¨</strong>ç¼–è¯‘æ‰§è¡Œï¼ˆä¸å¸¦ proï¬lingï¼‰</li>
<li>2å±‚ï¼šä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦åŸºæœ¬çš„profilingï¼‰</li>
<li>3å±‚ï¼šä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦å®Œå…¨çš„profilingï¼‰</li>
<li>4å±‚ï¼šä½¿ç”¨ C2 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ</li>
</ul>
<p>proï¬ling æ˜¯æŒ‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸€äº›ç¨‹åºæ‰§è¡ŒçŠ¶æ€çš„æ•°æ®ï¼Œä¾‹å¦‚ã€æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€‘ï¼Œã€å¾ªç¯çš„ å›è¾¹æ¬¡æ•°ã€‘ç­‰</p>
<h5 id="å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«"><a href="#å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«" class="headerlink" title="å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«"></a>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«</h5><ul>
<li>è§£é‡Šå™¨<ul>
<li>å°†å­—èŠ‚ç <strong>è§£é‡Š</strong>ä¸ºæœºå™¨ç ï¼Œä¸‹æ¬¡å³ä½¿é‡åˆ°ç›¸åŒçš„å­—èŠ‚ç ï¼Œä»ä¼šæ‰§è¡Œé‡å¤çš„è§£é‡Š</li>
<li>æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºé’ˆå¯¹æ‰€æœ‰å¹³å°éƒ½é€šç”¨çš„æœºå™¨ç </li>
</ul>
</li>
<li>å³æ—¶ç¼–è¯‘å™¨<ul>
<li>å°†ä¸€äº›å­—èŠ‚ç <strong>ç¼–è¯‘</strong>ä¸ºæœºå™¨ç ï¼Œ<strong>å¹¶å­˜å…¥ Code Cache</strong>ï¼Œä¸‹æ¬¡é‡åˆ°ç›¸åŒçš„ä»£ç ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ— éœ€å†ç¼–è¯‘</li>
<li>æ ¹æ®å¹³å°ç±»å‹ï¼Œç”Ÿæˆå¹³å°ç‰¹å®šçš„æœºå™¨ç </li>
</ul>
</li>
</ul>
<p>å¯¹äºå¤§éƒ¨åˆ†çš„ä¸å¸¸ç”¨çš„ä»£ç ï¼Œæˆ‘ä»¬æ— éœ€è€—è´¹æ—¶é—´å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œè€Œæ˜¯é‡‡å–è§£é‡Šæ‰§è¡Œçš„æ–¹å¼è¿è¡Œï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹äºä»…å æ®å°éƒ¨åˆ†çš„çƒ­ç‚¹ä»£ç ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»¥è¾¾åˆ°ç†æƒ³çš„è¿è¡Œé€Ÿåº¦ã€‚ æ‰§è¡Œæ•ˆç‡ä¸Šç®€å•æ¯”è¾ƒä¸€ä¸‹ Interpreter &lt; C1 &lt; C2ï¼Œæ€»çš„ç›®æ ‡æ˜¯å‘ç°çƒ­ç‚¹ä»£ç ï¼ˆhotspotåç§°çš„ç”± æ¥ï¼‰ï¼Œå¹¶ä¼˜åŒ–è¿™äº›çƒ­ç‚¹ä»£ç </p>
<h5 id="é€ƒé€¸åˆ†æ"><a href="#é€ƒé€¸åˆ†æ" class="headerlink" title="é€ƒé€¸åˆ†æ"></a>é€ƒé€¸åˆ†æ</h5><p>é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰ç®€å•æ¥è®²å°±æ˜¯ï¼ŒJava Hotspot è™šæ‹Ÿæœºå¯ä»¥åˆ†ææ–°åˆ›å»ºå¯¹è±¡çš„ä½¿ç”¨èŒƒå›´ï¼Œå¹¶å†³å®šæ˜¯å¦åœ¨ Java å †ä¸Šåˆ†é…å†…å­˜çš„ä¸€é¡¹æŠ€æœ¯</p>
<p>é€ƒé€¸åˆ†æçš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¼€å¯é€ƒé€¸åˆ†æï¼š-XX:+DoEscapeAnalysis</li>
<li>å…³é—­é€ƒé€¸åˆ†æï¼š-XX:-DoEscapeAnalysis</li>
<li>æ˜¾ç¤ºåˆ†æç»“æœï¼š-XX:+PrintEscapeAnalysis</li>
</ul>
<p>é€ƒé€¸åˆ†ææŠ€æœ¯åœ¨ Java SE 6u23+ å¼€å§‹æ”¯æŒï¼Œå¹¶é»˜è®¤è®¾ç½®ä¸ºå¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥ä¸ç”¨é¢å¤–åŠ è¿™ä¸ªå‚æ•°</p>
<p><strong>å¯¹è±¡é€ƒé€¸çŠ¶æ€</strong></p>
<p><strong>å…¨å±€é€ƒé€¸ï¼ˆGlobalEscapeï¼‰</strong></p>
<ul>
<li>å³ä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨èŒƒå›´é€ƒå‡ºäº†å½“å‰æ–¹æ³•æˆ–è€…å½“å‰çº¿ç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯ï¼š<ul>
<li>å¯¹è±¡æ˜¯ä¸€ä¸ªé™æ€å˜é‡</li>
<li>å¯¹è±¡æ˜¯ä¸€ä¸ªå·²ç»å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡</li>
<li>å¯¹è±¡ä½œä¸ºå½“å‰æ–¹æ³•çš„è¿”å›å€¼</li>
</ul>
</li>
</ul>
<p><strong>å‚æ•°é€ƒé€¸ï¼ˆArgEscapeï¼‰</strong></p>
<ul>
<li>å³ä¸€ä¸ªå¯¹è±¡è¢«ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’æˆ–è€…è¢«å‚æ•°å¼•ç”¨ï¼Œä½†åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¸ä¼šå‘ç”Ÿå…¨å±€é€ƒé€¸ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯é€šè¿‡è¢«è°ƒæ–¹æ³•çš„å­—èŠ‚ç ç¡®å®šçš„</li>
</ul>
<p><strong>æ²¡æœ‰é€ƒé€¸</strong></p>
<ul>
<li>å³æ–¹æ³•ä¸­çš„å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸</li>
</ul>
<p><strong>é€ƒé€¸åˆ†æä¼˜åŒ–</strong></p>
<p>é’ˆå¯¹ä¸Šé¢ç¬¬ä¸‰ç‚¹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡<strong>æ²¡æœ‰é€ƒé€¸</strong>æ—¶ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹å‡ ä¸ªè™šæ‹Ÿæœºçš„ä¼˜åŒ–</p>
<p><strong>é”æ¶ˆé™¤</strong></p>
<p>æˆ‘ä»¬çŸ¥é“çº¿ç¨‹åŒæ­¥é”æ˜¯éå¸¸ç‰ºç‰²æ€§èƒ½çš„ï¼Œå½“ç¼–è¯‘å™¨ç¡®å®šå½“å‰å¯¹è±¡åªæœ‰å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šç§»é™¤è¯¥å¯¹è±¡çš„åŒæ­¥é”</p>
<p>ä¾‹å¦‚ï¼ŒStringBuffer å’Œ Vector éƒ½æ˜¯ç”¨ synchronized ä¿®é¥°çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½åªæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­ç”¨åˆ°ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¼šä¼˜åŒ–ç§»é™¤æ‰è¿™äº›é”æ“ä½œ</p>
<p>é”æ¶ˆé™¤çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¼€å¯é”æ¶ˆé™¤ï¼š-XX:+EliminateLocks</li>
<li>å…³é—­é”æ¶ˆé™¤ï¼š-XX:-EliminateLocks</li>
</ul>
<p>é”æ¶ˆé™¤åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”é”æ¶ˆé™¤éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š</p>
<p><strong>æ ‡é‡æ›¿æ¢</strong></p>
<p>é¦–å…ˆè¦æ˜ç™½æ ‡é‡å’Œèšåˆé‡ï¼Œ<strong>åŸºç¡€ç±»å‹</strong>å’Œ<strong>å¯¹è±¡çš„å¼•ç”¨</strong>å¯ä»¥ç†è§£ä¸º<strong>æ ‡é‡</strong>ï¼Œå®ƒä»¬ä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£ã€‚è€Œèƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡å°±æ˜¯èšåˆé‡ï¼Œæ¯”å¦‚ï¼šå¯¹è±¡</p>
<p>å¯¹è±¡æ˜¯èšåˆé‡ï¼Œå®ƒåˆå¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æˆæ ‡é‡ï¼Œå°†å…¶æˆå‘˜å˜é‡åˆ†è§£ä¸ºåˆ†æ•£çš„å˜é‡ï¼Œè¿™å°±å«åš<strong>æ ‡é‡æ›¿æ¢</strong>ã€‚</p>
<p>è¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸ï¼Œé‚£å‹æ ¹å°±ä¸ç”¨åˆ›å»ºå®ƒï¼Œåªä¼šåœ¨æ ˆæˆ–è€…å¯„å­˜å™¨ä¸Šåˆ›å»ºå®ƒç”¨åˆ°çš„æˆå‘˜æ ‡é‡ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œä¹Ÿæå‡äº†åº”ç”¨ç¨‹åºæ€§èƒ½</p>
<p>æ ‡é‡æ›¿æ¢çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¼€å¯æ ‡é‡æ›¿æ¢ï¼š-XX:+EliminateAllocations</li>
<li>å…³é—­æ ‡é‡æ›¿æ¢ï¼š-XX:-EliminateAllocations</li>
<li>æ˜¾ç¤ºæ ‡é‡æ›¿æ¢è¯¦æƒ…ï¼š-XX:+PrintEliminateAllocations</li>
</ul>
<p>æ ‡é‡æ›¿æ¢åŒæ ·åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š</p>
<p><strong>æ ˆä¸Šåˆ†é…</strong></p>
<p>å½“å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸æ—¶ï¼Œè¯¥<strong>å¯¹è±¡</strong>å°±å¯ä»¥é€šè¿‡æ ‡é‡æ›¿æ¢åˆ†è§£æˆæˆå‘˜æ ‡é‡åˆ†é…åœ¨<strong>æ ˆå†…å­˜</strong>ä¸­ï¼Œå’Œæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œéšç€æ ˆå¸§å‡ºæ ˆæ—¶é”€æ¯ï¼Œå‡å°‘äº† GC å‹åŠ›ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºæ€§èƒ½</p>
<h4 id="æ–¹æ³•å†…è”"><a href="#æ–¹æ³•å†…è”" class="headerlink" title="æ–¹æ³•å†…è”"></a>æ–¹æ³•å†…è”</h4><h5 id="å†…è”å‡½æ•°"><a href="#å†…è”å‡½æ•°" class="headerlink" title="å†…è”å‡½æ•°"></a><strong>å†…è”å‡½æ•°</strong></h5><p>å†…è”å‡½æ•°å°±æ˜¯åœ¨ç¨‹åºç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨å°†ç¨‹åºä¸­å‡ºç°çš„å†…è”å‡½æ•°çš„è°ƒç”¨è¡¨è¾¾å¼ç”¨å†…è”å‡½æ•°çš„å‡½æ•°ä½“æ¥ç›´æ¥è¿›è¡Œæ›¿æ¢</p>
<h5 id="JVMå†…è”å‡½æ•°"><a href="#JVMå†…è”å‡½æ•°" class="headerlink" title="JVMå†…è”å‡½æ•°"></a><strong>JVMå†…è”å‡½æ•°</strong></h5><p>C++æ˜¯å¦ä¸ºå†…è”å‡½æ•°ç”±è‡ªå·±å†³å®šï¼ŒJavaç”±<strong>ç¼–è¯‘å™¨å†³å®š</strong>ã€‚Javaä¸æ”¯æŒç›´æ¥å£°æ˜ä¸ºå†…è”å‡½æ•°çš„ï¼Œå¦‚æœæƒ³è®©ä»–å†…è”ï¼Œä½ åªèƒ½å¤Ÿå‘ç¼–è¯‘å™¨æå‡ºè¯·æ±‚: å…³é”®å­—<strong>finalä¿®é¥°</strong> ç”¨æ¥æŒ‡æ˜é‚£ä¸ªå‡½æ•°æ˜¯å¸Œæœ›è¢«JVMå†…è”çš„ï¼Œå¦‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public final void doSomething() &#123;  </span><br><span class="line">        &#x2F;&#x2F; to do something  </span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ€»çš„æ¥è¯´ï¼Œä¸€èˆ¬çš„å‡½æ•°éƒ½ä¸ä¼šè¢«å½“åšå†…è”å‡½æ•°ï¼Œåªæœ‰å£°æ˜äº†finalåï¼Œç¼–è¯‘å™¨æ‰ä¼šè€ƒè™‘æ˜¯ä¸æ˜¯è¦æŠŠä½ çš„å‡½æ•°å˜æˆå†…è”å‡½æ•°</p>
<p>JVMå†…å»ºæœ‰è®¸å¤šè¿è¡Œæ—¶ä¼˜åŒ–ã€‚é¦–å…ˆ<strong>çŸ­æ–¹æ³•</strong>æ›´åˆ©äºJVMæ¨æ–­ã€‚æµç¨‹æ›´æ˜æ˜¾ï¼Œä½œç”¨åŸŸæ›´çŸ­ï¼Œå‰¯ä½œç”¨ä¹Ÿæ›´æ˜æ˜¾ã€‚å¦‚æœæ˜¯é•¿æ–¹æ³•JVMå¯èƒ½ç›´æ¥å°±è·ªäº†ã€‚</p>
<p>ç¬¬äºŒä¸ªåŸå› åˆ™æ›´é‡è¦ï¼š<strong>æ–¹æ³•å†…è”</strong></p>
<p>å¦‚æœJVMç›‘æµ‹åˆ°ä¸€äº›<strong>å°æ–¹æ³•è¢«é¢‘ç¹çš„æ‰§è¡Œ</strong>ï¼Œå®ƒä¼šæŠŠæ–¹æ³•çš„è°ƒç”¨æ›¿æ¢æˆæ–¹æ³•ä½“æœ¬èº«ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private int add4(int x1, int x2, int x3, int x4) &#123; </span><br><span class="line">		&#x2F;&#x2F;è¿™é‡Œè°ƒç”¨äº†add2æ–¹æ³•</span><br><span class="line">        return add2(x1, x2) + add2(x3, x4);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    private int add2(int x1, int x2) &#123;  </span><br><span class="line">        return x1 + x2;  </span><br><span class="line">    &#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•è°ƒç”¨è¢«æ›¿æ¢å</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private int add4(int x1, int x2, int x3, int x4) &#123;  </span><br><span class="line">    	&#x2F;&#x2F;è¢«æ›¿æ¢ä¸ºäº†æ–¹æ³•æœ¬èº«</span><br><span class="line">        return x1 + x2 + x3 + x4;  </span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="åå°„ä¼˜åŒ–"><a href="#åå°„ä¼˜åŒ–" class="headerlink" title="åå°„ä¼˜åŒ–"></a>åå°„ä¼˜åŒ–</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Reflect1 &#123;</span><br><span class="line">   public static void foo() &#123;</span><br><span class="line">      System.out.println(&quot;foo...&quot;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">      Method foo &#x3D; Demo3.class.getMethod(&quot;foo&quot;);</span><br><span class="line">      for(int i &#x3D; 0; i&lt;&#x3D;16; i++) &#123;</span><br><span class="line">         foo.invoke(null);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>foo.invoke å‰é¢ 0 ~ 15 æ¬¡è°ƒç”¨ä½¿ç”¨çš„æ˜¯ MethodAccessor çš„ NativeMethodAccessorImpl å®ç°</p>
<p>invokeæ–¹æ³•æºç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@CallerSensitive</span><br><span class="line">public Object invoke(Object obj, Object... args)</span><br><span class="line">    throws IllegalAccessException, IllegalArgumentException,</span><br><span class="line">       InvocationTargetException</span><br><span class="line">&#123;</span><br><span class="line">    if (!override) &#123;</span><br><span class="line">        if (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;</span><br><span class="line">            Class&lt;?&gt; caller &#x3D; Reflection.getCallerClass();</span><br><span class="line">            checkAccess(caller, clazz, obj, modifiers);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;MethodAccessoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰3ä¸ªå®ç°ç±»ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯æŠ½è±¡ç±»</span><br><span class="line">    MethodAccessor ma &#x3D; methodAccessor;             &#x2F;&#x2F; read volatile</span><br><span class="line">    if (ma &#x3D;&#x3D; null) &#123;</span><br><span class="line">        ma &#x3D; acquireMethodAccessor();</span><br><span class="line">    &#125;</span><br><span class="line">    return ma.invoke(obj, args);</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614133554.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614133554.png" alt="img"></a></p>
<p>ä¼šç”±DelegatingMehodAccessorImplå»è°ƒç”¨NativeMethodAccessorImpl</p>
<p>NativeMethodAccessorImplæºç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class NativeMethodAccessorImpl extends MethodAccessorImpl &#123;</span><br><span class="line">    private final Method method;</span><br><span class="line">    private DelegatingMethodAccessorImpl parent;</span><br><span class="line">    private int numInvocations;</span><br><span class="line"></span><br><span class="line">    NativeMethodAccessorImpl(Method var1) &#123;</span><br><span class="line">        this.method &#x3D; var1;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F;æ¯æ¬¡è¿›è¡Œåå°„è°ƒç”¨ï¼Œä¼šè®©numInvocationä¸ReflectionFactory.inflationThresholdçš„å€¼ï¼ˆ15ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä½¿ä½¿å¾—numInvocationçš„å€¼åŠ ä¸€</span><br><span class="line">	&#x2F;&#x2F;å¦‚æœnumInvocation&gt;ReflectionFactory.inflationThresholdï¼Œåˆ™ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•invoke0æ–¹æ³•</span><br><span class="line">    public Object invoke(Object var1, Object[] var2) throws IllegalArgumentException, InvocationTargetException &#123;</span><br><span class="line">        if (++this.numInvocations &gt; ReflectionFactory.inflationThreshold() &amp;&amp; !ReflectUtil.isVMAnonymousClass(this.method.getDeclaringClass())) &#123;</span><br><span class="line">            MethodAccessorImpl var3 &#x3D; (MethodAccessorImpl)(new MethodAccessorGenerator()).generateMethod(this.method.getDeclaringClass(), this.method.getName(), this.method.getParameterTypes(), this.method.getReturnType(), this.method.getExceptionTypes(), this.method.getModifiers());</span><br><span class="line">            this.parent.setDelegate(var3);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return invoke0(this.method, var1, var2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void setParent(DelegatingMethodAccessorImpl var1) &#123;</span><br><span class="line">        this.parent &#x3D; var1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static native Object invoke0(Method var0, Object var1, Object[] var2);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;ReflectionFactory.inflationThreshold()æ–¹æ³•çš„è¿”å›å€¼</span><br><span class="line">private static int inflationThreshold &#x3D; 15;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸€å¼€å§‹ifæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•invoke0</li>
<li>éšç€numInvocationçš„å¢å¤§ï¼Œå½“å®ƒå¤§äºReflectionFactory.inflationThresholdçš„å€¼16æ—¶ï¼Œå°±ä¼šæœ¬åœ°æ–¹æ³•è®¿é—®å™¨æ›¿æ¢ä¸ºä¸€ä¸ªè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„è®¿é—®å™¨ï¼Œæ¥æé«˜æ•ˆç‡<ul>
<li>è¿™æ—¶ä¼šä»åå°„è°ƒç”¨å˜ä¸º<strong>æ­£å¸¸è°ƒç”¨</strong>ï¼Œå³ç›´æ¥è°ƒç”¨ Reflect1.foo()</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614135011.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614135011.png" alt="img"></a></p>
<h2 id="äº”ã€å†…å­˜æ¨¡å‹"><a href="#äº”ã€å†…å­˜æ¨¡å‹" class="headerlink" title="äº”ã€å†…å­˜æ¨¡å‹"></a>äº”ã€å†…å­˜æ¨¡å‹</h2><p>å†…å­˜æ¨¡å‹å†…å®¹è¯¦è§ <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/04/17/JUC/#%E5%9B%9B%E3%80%81%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E5%86%85%E5%AD%98">JAVAå¹¶å‘ ç¬¬å››ç« </a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/18/jvm%E5%AD%A6%E4%B9%A0/" data-id="cknyemfop000a6oubb9mnfj48" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-jucå­¦ä¹ " class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/18/juc%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2021-04-18T08:11:13.000Z" itemprop="datePublished">2021-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/18/juc%E5%AD%A6%E4%B9%A0/">jucå­¦ä¹ </a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="å¹¶å‘ç¼–ç¨‹ç¬”è®°"><a href="#å¹¶å‘ç¼–ç¨‹ç¬”è®°" class="headerlink" title="å¹¶å‘ç¼–ç¨‹ç¬”è®°"></a>å¹¶å‘ç¼–ç¨‹ç¬”è®°</h1><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av81461839?from=search&seid=8445102345230304010"><strong>é»‘é©¬javaå¹¶å‘ç¼–ç¨‹æ•™ç¨‹</strong></a>æ•™å­¦è§†é¢‘çš„ç¬”è®°ï¼ˆè½¬è½½<a target="_blank" rel="noopener" href="https://nyimac.gitee.io/2020/06/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">nyimac</a>ï¼Œå†è½¬ä¸€ç¯‡å­¦ä¹ å­¦ä¹ ï¼Œç­‰çœ‹ä¸€éã€Šjavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹åï¼Œå†æ•´ç†è‡ªå·±çš„å­¦ä¹ noteå§ï¼‰</p>
<h1 id="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"><a href="#ä¸€ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"></a>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h1><h2 id="1ã€è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#1ã€è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="1ã€è¿›ç¨‹ä¸çº¿ç¨‹"></a>1ã€è¿›ç¨‹ä¸çº¿ç¨‹</h2><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><ul>
<li>ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³ CPUï¼Œæ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ã€‚</li>
<li>å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚</li>
<li>è¿›ç¨‹å°±å¯ä»¥è§†ä¸ºç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ã€‚å¤§éƒ¨åˆ†ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚è®°äº‹æœ¬ã€ç”»å›¾ã€æµè§ˆå™¨ ç­‰ï¼‰ï¼Œä¹Ÿæœ‰çš„ç¨‹åºåªèƒ½å¯åŠ¨ä¸€ä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚ç½‘æ˜“äº‘éŸ³ä¹ã€360 å®‰å…¨å«å£«ç­‰ï¼‰</li>
</ul>
<h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><ul>
<li>ä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚</li>
<li>ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ ã€‚</li>
<li>Java ä¸­ï¼Œçº¿ç¨‹ä½œä¸ºå°è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„å°å•ä½ã€‚ åœ¨ windows ä¸­è¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œ ä¸ºçº¿ç¨‹çš„å®¹å™¨</li>
</ul>
<h3 id="äºŒè€…å¯¹æ¯”"><a href="#äºŒè€…å¯¹æ¯”" class="headerlink" title="äºŒè€…å¯¹æ¯”"></a>äºŒè€…å¯¹æ¯”</h3><ul>
<li>è¿›ç¨‹åŸºæœ¬ä¸Šç›¸äº’ç‹¬ç«‹çš„ï¼Œè€Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›† è¿›ç¨‹æ‹¥æœ‰å…±äº«çš„èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ç­‰ï¼Œä¾›å…¶å†…éƒ¨çš„çº¿ç¨‹å…±äº«<ul>
<li>è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ åŒä¸€å°è®¡ç®—æœºçš„è¿›ç¨‹é€šä¿¡ç§°ä¸º IPCï¼ˆInter-process communicationï¼‰</li>
<li>ä¸åŒè®¡ç®—æœºä¹‹é—´çš„è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œï¼Œå¹¶éµå®ˆå…±åŒçš„åè®®ï¼Œä¾‹å¦‚ HTTP</li>
</ul>
</li>
<li>çº¿ç¨‹é€šä¿¡ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å…±äº«è¿›ç¨‹å†…çš„å†…å­˜ï¼Œä¸€ä¸ªä¾‹å­æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡ çº¿ç¨‹æ›´è½»é‡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬ä¸Šè¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½</li>
</ul>
<h4 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢</h4><p><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong></p>
<p>å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹ç»´æŒä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚<strong>ä¸Šä¸‹æ–‡å°±æ˜¯å†…æ ¸é‡æ–°å¯åŠ¨ä¸€ä¸ªè¢«æŠ¢å çš„è¿›ç¨‹æ‰€éœ€çš„çŠ¶æ€ã€‚</strong>åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>é€šç”¨ç›®çš„å¯„å­˜å™¨</li>
<li>æµ®ç‚¹å¯„å­˜å™¨</li>
<li>ç¨‹åºè®¡æ•°å™¨</li>
<li>ç”¨æˆ·æ ˆ</li>
<li>çŠ¶æ€å¯„å­˜å™¨</li>
<li>å†…æ ¸æ ˆ</li>
<li>å„ç§å†…æ ¸æ•°æ®ç»“æ„ï¼šæ¯”å¦‚æç»˜åœ°å€ç©ºé—´çš„<strong>é¡µè¡¨</strong>ï¼ŒåŒ…å«æœ‰å…³å½“å‰è¿›ç¨‹ä¿¡æ¯çš„<strong>è¿›ç¨‹è¡¨</strong>ï¼Œä»¥åŠåŒ…å«è¿›ç¨‹å·²æ‰“å¼€æ–‡ä»¶çš„ä¿¡æ¯çš„<strong>æ–‡ä»¶è¡¨</strong></li>
</ul>
<p><strong>è¿›ç¨‹åˆ‡æ¢å’Œçº¿ç¨‹åˆ‡æ¢çš„ä¸»è¦åŒºåˆ«</strong></p>
<p>æœ€ä¸»è¦çš„ä¸€ä¸ªåŒºåˆ«åœ¨äº<strong>è¿›ç¨‹åˆ‡æ¢æ¶‰åŠè™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ‡æ¢è€Œçº¿ç¨‹ä¸ä¼š</strong>ã€‚å› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè€Œ<strong>çº¿ç¨‹æ˜¯å…±äº«æ‰€åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„</strong>ï¼Œå› æ­¤åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹è¿›è¡Œçº¿ç¨‹åˆ‡æ¢æ—¶ä¸æ¶‰åŠè™šæ‹Ÿåœ°å€ç©ºé—´çš„è½¬æ¢</p>
<p>é¡µè¡¨æŸ¥æ‰¾æ˜¯ä¸€ä¸ªå¾ˆæ…¢çš„è¿‡ç¨‹ï¼Œå› æ­¤é€šå¸¸ä½¿ç”¨cacheæ¥ç¼“å­˜å¸¸ç”¨çš„åœ°å€æ˜ å°„ï¼Œè¿™æ ·å¯ä»¥åŠ é€Ÿé¡µè¡¨æŸ¥æ‰¾ï¼Œè¿™ä¸ªcacheå°±æ˜¯å¿«è¡¨TLBï¼ˆtranslation Lookaside Bufferï¼Œç”¨æ¥åŠ é€Ÿé¡µè¡¨æŸ¥æ‰¾ï¼‰ã€‚ç”±äºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé‚£ä¹ˆæ˜¾ç„¶æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œé‚£ä¹ˆ<strong>å½“è¿›ç¨‹åˆ‡æ¢åé¡µè¡¨ä¹Ÿè¦è¿›è¡Œåˆ‡æ¢ï¼Œé¡µè¡¨åˆ‡æ¢åTLBå°±å¤±æ•ˆäº†</strong>ï¼Œcacheå¤±æ•ˆå¯¼è‡´å‘½ä¸­ç‡é™ä½ï¼Œé‚£ä¹ˆè™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€å°±ä¼šå˜æ…¢ï¼Œè¡¨ç°å‡ºæ¥çš„å°±æ˜¯ç¨‹åºè¿è¡Œä¼šå˜æ…¢ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢åˆ™ä¸ä¼šå¯¼è‡´TLBå¤±æ•ˆï¼Œå› ä¸ºçº¿ç¨‹çº¿ç¨‹æ— éœ€åˆ‡æ¢åœ°å€ç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸è¯´çº¿ç¨‹åˆ‡æ¢è¦æ¯”è¾ƒè¿›ç¨‹åˆ‡æ¢å¿«</p>
<p>è€Œä¸”è¿˜å¯èƒ½å‡ºç°<strong>ç¼ºé¡µä¸­æ–­</strong>ï¼Œè¿™å°±éœ€è¦æ“ä½œç³»ç»Ÿå°†éœ€è¦çš„å†…å®¹è°ƒå…¥å†…å­˜ä¸­ï¼Œè‹¥å†…å­˜å·²æ»¡åˆ™è¿˜éœ€è¦å°†ä¸ç”¨çš„å†…å®¹è°ƒå‡ºå†…å­˜ï¼Œè¿™ä¹Ÿéœ€è¦èŠ±è´¹æ—¶é—´</p>
<p><strong>ä¸ºä»€ä¹ˆTLBèƒ½åŠ å¿«è®¿é—®é€Ÿåº¦</strong></p>
<p>å¿«è¡¨å¯ä»¥é¿å…æ¯æ¬¡éƒ½å¯¹é¡µå·è¿›è¡Œåœ°å€çš„æœ‰æ•ˆæ€§åˆ¤æ–­ã€‚å¿«è¡¨ä¸­ä¿å­˜äº†å¯¹åº”çš„ç‰©ç†å—å·ï¼Œå¯ä»¥ç›´æ¥è®¡ç®—å‡ºç‰©ç†åœ°å€ï¼Œæ— éœ€å†è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥</p>
<h2 id="2ã€å¹¶å‘ä¸å¹¶è¡Œ"><a href="#2ã€å¹¶å‘ä¸å¹¶è¡Œ" class="headerlink" title="2ã€å¹¶å‘ä¸å¹¶è¡Œ"></a>2ã€å¹¶å‘ä¸å¹¶è¡Œ</h2><p>å¹¶å‘æ˜¯ä¸€ä¸ªCPUåœ¨ä¸åŒçš„æ—¶é—´å»ä¸åŒçº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡ä»¤ã€‚</p>
<p>å¹¶è¡Œæ˜¯å¤šä¸ªCPUåŒæ—¶å¤„ç†ä¸åŒçš„çº¿ç¨‹ã€‚</p>
<p>å¼•ç”¨ Rob Pike çš„ä¸€æ®µæè¿°ï¼š</p>
<ul>
<li>å¹¶å‘ï¼ˆconcurrentï¼‰æ˜¯åŒä¸€æ—¶é—´<strong>åº”å¯¹</strong>ï¼ˆdealing withï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›</li>
<li>å¹¶è¡Œï¼ˆparallelï¼‰æ˜¯åŒä¸€æ—¶é—´<strong>åŠ¨æ‰‹åš</strong>ï¼ˆdoingï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›</li>
</ul>
<h3 id="3ã€åº”ç”¨"><a href="#3ã€åº”ç”¨" class="headerlink" title="3ã€åº”ç”¨"></a>3ã€åº”ç”¨</h3><h4 id="åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰"><a href="#åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰" class="headerlink" title="åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰"></a>åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰</h4><p>ä»¥è°ƒç”¨æ–¹è§’åº¦æ¥è®²ï¼Œå¦‚æœ</p>
<ul>
<li>éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯åŒæ­¥</li>
<li>ä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯å¼‚æ­¥</li>
</ul>
<ol>
<li>è®¾è®¡<br>å¤šçº¿ç¨‹å¯ä»¥è®©æ–¹æ³•æ‰§è¡Œå˜ä¸ºå¼‚æ­¥çš„ï¼ˆå³ä¸è¦å·´å·´å¹²ç­‰ç€ï¼‰æ¯”å¦‚è¯´è¯»å–ç£ç›˜æ–‡ä»¶æ—¶ï¼Œå‡è®¾è¯»å–æ“ä½œèŠ±è´¹äº† 5 ç§’é’Ÿï¼Œå¦‚ æœæ²¡æœ‰çº¿ç¨‹è°ƒåº¦æœºåˆ¶ï¼Œè¿™ 5 ç§’ cpu ä»€ä¹ˆéƒ½åšä¸äº†ï¼Œå…¶å®ƒä»£ç éƒ½å¾—æš‚åœâ€¦</li>
<li>ç»“è®º</li>
</ol>
<ul>
<li>æ¯”å¦‚åœ¨é¡¹ç›®ä¸­ï¼Œè§†é¢‘æ–‡ä»¶éœ€è¦è½¬æ¢æ ¼å¼ç­‰æ“ä½œæ¯”è¾ƒè´¹æ—¶ï¼Œè¿™æ—¶å¼€ä¸€ä¸ªæ–°çº¿ç¨‹å¤„ç†è§†é¢‘è½¬æ¢ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹</li>
<li>tomcat çš„å¼‚æ­¥ servlet ä¹Ÿæ˜¯ç±»ä¼¼çš„ç›®çš„ï¼Œè®©ç”¨æˆ·çº¿ç¨‹å¤„ç†è€—æ—¶è¾ƒé•¿çš„æ“ä½œï¼Œé¿å…é˜»å¡</li>
<li>tomcat çš„å·¥ä½œçº¿ç¨‹ ui ç¨‹åºä¸­ï¼Œå¼€çº¿ç¨‹è¿›è¡Œå…¶ä»–æ“ä½œï¼Œé¿å…é˜»å¡ ui çº¿ç¨‹</li>
</ul>
<p>ç»“è®º</p>
<ol>
<li>å•æ ¸ cpu ä¸‹ï¼Œå¤šçº¿ç¨‹ä¸èƒ½å®é™…æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œåªæ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸åŒçš„ä»»åŠ¡ä¹‹é—´åˆ‡æ¢ï¼Œä¸åŒçº¿ç¨‹è½®æµä½¿ç”¨ cpu ï¼Œä¸è‡³äºä¸€ä¸ªçº¿ç¨‹æ€»å ç”¨ cpuï¼Œåˆ«çš„çº¿ç¨‹æ²¡æ³•å¹²æ´»</li>
<li>å¤šæ ¸ cpu å¯ä»¥å¹¶è¡Œè·‘å¤šä¸ªçº¿ç¨‹ï¼Œä½†èƒ½å¦æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡è¿˜æ˜¯è¦åˆ†æƒ…å†µçš„<ul>
<li>æœ‰äº›ä»»åŠ¡ï¼Œç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå°†ä»»åŠ¡æ‹†åˆ†ï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œå½“ç„¶å¯ä»¥æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚ä½†ä¸æ˜¯æ‰€æœ‰è®¡ç®—ä»» åŠ¡éƒ½èƒ½æ‹†åˆ†ï¼ˆå‚è€ƒåæ–‡çš„ã€é˜¿å§†è¾¾å°”å®šå¾‹ã€‘ï¼‰</li>
<li>ä¹Ÿä¸æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æ‹†åˆ†ï¼Œä»»åŠ¡çš„ç›®çš„å¦‚æœä¸åŒï¼Œè°ˆæ‹†åˆ†å’Œæ•ˆç‡æ²¡å•¥æ„ä¹‰</li>
</ul>
</li>
<li>IO æ“ä½œä¸å ç”¨ cpuï¼Œåªæ˜¯æˆ‘ä»¬ä¸€èˆ¬æ‹·è´æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ã€é˜»å¡ IOã€‘ï¼Œè¿™æ—¶ç›¸å½“äºçº¿ç¨‹è™½ç„¶ä¸ç”¨ cpuï¼Œä½†éœ€è¦ä¸€ ç›´ç­‰å¾… IO ç»“æŸï¼Œæ²¡èƒ½å……åˆ†åˆ©ç”¨çº¿ç¨‹ã€‚æ‰€ä»¥æ‰æœ‰åé¢çš„ã€éé˜»å¡ IOã€‘å’Œã€å¼‚æ­¥ IOã€‘ä¼˜åŒ–</li>
</ol>
<h1 id="äºŒã€çº¿ç¨‹çš„åˆ›å»º"><a href="#äºŒã€çº¿ç¨‹çš„åˆ›å»º" class="headerlink" title="äºŒã€çº¿ç¨‹çš„åˆ›å»º"></a>äºŒã€çº¿ç¨‹çš„åˆ›å»º</h1><h2 id="1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰"><a href="#1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰" class="headerlink" title="1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰"></a>1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰</h2><h3 id="æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿Threadåˆ›å»ºçº¿ç¨‹"><a href="#æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿Threadåˆ›å»ºçº¿ç¨‹" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿Threadåˆ›å»ºçº¿ç¨‹"></a>æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿Threadåˆ›å»ºçº¿ç¨‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class CreateThread &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Thread myThread &#x3D; new MyThread();</span><br><span class="line">        &#x2F;&#x2F; å¯åŠ¨çº¿ç¨‹</span><br><span class="line">		myThread.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyThread extends Thread &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void run() &#123;</span><br><span class="line">		System.out.println(&quot;my thread running...&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ç»§æ‰¿æ–¹å¼çš„å¥½å¤„æ˜¯ï¼Œåœ¨runï¼ˆï¼‰æ–¹æ³•å†…è·å–å½“å‰çº¿ç¨‹ç›´æ¥ä½¿ç”¨thiså°±å¯ä»¥äº†ï¼Œæ— é¡»ä½¿ç”¨Thread.currentThreadï¼ˆï¼‰æ–¹æ³•ï¼›ä¸å¥½çš„åœ°æ–¹æ˜¯Javaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œå¦‚æœç»§æ‰¿äº†Threadç±»ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ã€‚å¦å¤–ä»»åŠ¡ä¸ä»£ç æ²¡æœ‰åˆ†ç¦»ï¼Œå½“å¤šä¸ªçº¿ç¨‹æ‰§è¡Œä¸€æ ·çš„ä»»åŠ¡æ—¶éœ€è¦å¤šä»½ä»»åŠ¡ä»£ç </p>
<h3 id="æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread-æ¨è"><a href="#æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread-æ¨è" class="headerlink" title="æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread(æ¨è)"></a>æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread(æ¨è)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Test2 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		&#x2F;&#x2F;åˆ›å»ºçº¿ç¨‹ä»»åŠ¡</span><br><span class="line">		Runnable r &#x3D; new Runnable() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public void run() &#123;</span><br><span class="line">				System.out.println(&quot;Runnable running&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		&#x2F;&#x2F;å°†Runnableå¯¹è±¡ä¼ ç»™Thread</span><br><span class="line">		Thread t &#x3D; new Thread(r);</span><br><span class="line">		&#x2F;&#x2F;å¯åŠ¨çº¿ç¨‹</span><br><span class="line">		t.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class CreateThread2 &#123;</span><br><span class="line">   private static class MyRunnable implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">      @Override</span><br><span class="line">      public void run() &#123;</span><br><span class="line">         System.out.println(&quot;my runnable running...&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      MyRunnable myRunnable &#x3D; new MyRunnable();</span><br><span class="line">      Thread thread &#x3D; new Thread(myRunnable);</span><br><span class="line">      thread.start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å®ç°Runnableæ¥å£ï¼Œå¹¶ä¸”å®ç°run()æ–¹æ³•ã€‚åœ¨åˆ›å»ºçº¿ç¨‹æ—¶ä½œä¸ºå‚æ•°ä¼ å…¥è¯¥ç±»çš„å®ä¾‹å³å¯</p>
<h4 id="æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ"><a href="#æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ" class="headerlink" title="æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ"></a>æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ</h4><p><strong>å½“ä¸€ä¸ªæ¥å£å¸¦æœ‰@FunctionalInterfaceæ³¨è§£æ—¶ï¼Œæ˜¯å¯ä»¥ä½¿ç”¨lambdaæ¥ç®€åŒ–æ“ä½œçš„</strong></p>
<p>æ‰€ä»¥æ–¹æ³•äºŒä¸­çš„ä»£ç å¯ä»¥è¢«ç®€åŒ–ä¸º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class Test2 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		&#x2F;&#x2F;åˆ›å»ºçº¿ç¨‹ä»»åŠ¡</span><br><span class="line">		Runnable r &#x3D; () -&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F;ç›´æ¥å†™æ–¹æ³•ä½“å³å¯</span><br><span class="line">			System.out.println(&quot;Runnable running&quot;);</span><br><span class="line">			System.out.println(&quot;Hello Thread&quot;);</span><br><span class="line">		&#125;;</span><br><span class="line">		&#x2F;&#x2F;å°†Runnableå¯¹è±¡ä¼ ç»™Thread</span><br><span class="line">		Thread t &#x3D; new Thread(r);</span><br><span class="line">		&#x2F;&#x2F;å¯åŠ¨çº¿ç¨‹</span><br><span class="line">		t.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å†Runnableä¸Šä½¿ç”¨Alt+Enter</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144534.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144534.png" alt="img"></a></p>
<h4 id="åŸç†ä¹‹-Thread-ä¸-Runnable-çš„å…³ç³»"><a href="#åŸç†ä¹‹-Thread-ä¸-Runnable-çš„å…³ç³»" class="headerlink" title="åŸç†ä¹‹ Thread ä¸ Runnable çš„å…³ç³»"></a>åŸç†ä¹‹ Thread ä¸ Runnable çš„å…³ç³»</h4><p>åˆ†æ Thread çš„æºç ï¼Œç†æ¸…å®ƒä¸ Runnable çš„å…³ç³»<br><strong>å°ç»“</strong></p>
<ul>
<li>æ–¹æ³•1 æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆå¹¶åœ¨äº†ä¸€èµ·</li>
<li>æ–¹æ³•2 æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆ†å¼€äº†</li>
<li>ç”¨ Runnable æ›´å®¹æ˜“ä¸çº¿ç¨‹æ± ç­‰é«˜çº§ API é…åˆ ç”¨ Runnable è®©ä»»åŠ¡ç±»è„±ç¦»äº† Thread ç»§æ‰¿ä½“ç³»ï¼Œæ›´çµæ´»</li>
</ul>
<h3 id="æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ"><a href="#æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ"></a>æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ</h3><p><strong>ä½¿ç”¨FutureTaskå¯ä»¥ç”¨æ³›å‹æŒ‡å®šçº¿ç¨‹çš„è¿”å›å€¼ç±»å‹ï¼ˆRunnableçš„runæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼‰</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class Test3 &#123;</span><br><span class="line">	public static void main(String[] args) throws ExecutionException, InterruptedException &#123;</span><br><span class="line">        &#x2F;&#x2F;éœ€è¦ä¼ å…¥ä¸€ä¸ªCallableå¯¹è±¡</span><br><span class="line">		FutureTask&lt;Integer&gt; task &#x3D; new FutureTask&lt;Integer&gt;(new Callable&lt;Integer&gt;() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public Integer call() throws Exception &#123;</span><br><span class="line">				System.out.println(&quot;çº¿ç¨‹æ‰§è¡Œ!&quot;);</span><br><span class="line">				Thread.sleep(1000);</span><br><span class="line">				return 100;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		Thread r1 &#x3D; new Thread(task, &quot;t2&quot;);</span><br><span class="line">		r1.start();</span><br><span class="line">		&#x2F;&#x2F;è·å–çº¿ç¨‹ä¸­æ–¹æ³•æ‰§è¡Œåçš„è¿”å›ç»“æœ</span><br><span class="line">		System.out.println(task.get());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æˆ–</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class UseFutureTask &#123;</span><br><span class="line">   public static void main(String[] args) throws ExecutionException, InterruptedException &#123;</span><br><span class="line">      FutureTask&lt;String&gt; futureTask &#x3D; new FutureTask&lt;&gt;(new MyCall());</span><br><span class="line">      Thread thread &#x3D; new Thread(futureTask);</span><br><span class="line">      thread.start();</span><br><span class="line">      &#x2F;&#x2F; è·å¾—çº¿ç¨‹è¿è¡Œåçš„è¿”å›å€¼</span><br><span class="line">      System.out.println(futureTask.get());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyCall implements Callable&lt;String&gt; &#123;</span><br><span class="line">   @Override</span><br><span class="line">   public String call() throws Exception &#123;</span><br><span class="line">      return &quot;hello world&quot;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä½¿ç”¨<strong>ç»§æ‰¿æ–¹å¼çš„å¥½å¤„æ˜¯æ–¹ä¾¿ä¼ å‚</strong>ï¼Œä½ å¯ä»¥åœ¨å­ç±»é‡Œé¢æ·»åŠ æˆå‘˜å˜é‡ï¼Œé€šè¿‡setæ–¹æ³•è®¾ç½®å‚æ•°æˆ–è€…é€šè¿‡æ„é€ å‡½æ•°è¿›è¡Œä¼ é€’ï¼Œè€Œå¦‚æœä½¿ç”¨Runnableæ–¹å¼ï¼Œåˆ™åªèƒ½ä½¿ç”¨ä¸»çº¿ç¨‹é‡Œé¢è¢«å£°æ˜ä¸ºfinalçš„å˜é‡ã€‚<strong>ä¸å¥½çš„åœ°æ–¹æ˜¯Javaä¸æ”¯æŒå¤šç»§æ‰¿</strong>ï¼Œå¦‚æœç»§æ‰¿äº†Threadç±»ï¼Œé‚£ä¹ˆå­ç±»ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ï¼Œè€ŒRunableåˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚<strong>å‰ä¸¤ç§æ–¹å¼éƒ½æ²¡åŠæ³•æ‹¿åˆ°ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œä½†æ˜¯Futuretaskæ–¹å¼å¯ä»¥</strong></p>
<h3 id="ï¼ˆå¸¸ç”¨ï¼‰æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹æ–¹æ³•â­"><a href="#ï¼ˆå¸¸ç”¨ï¼‰æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹æ–¹æ³•â­" class="headerlink" title="ï¼ˆå¸¸ç”¨ï¼‰æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹æ–¹æ³•â­"></a>ï¼ˆå¸¸ç”¨ï¼‰æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹æ–¹æ³•â­</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_1_20210417.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_1_20210417.png" alt="img"></a></p>
<h2 id="2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ"><a href="#2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ" class="headerlink" title="2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ"></a>2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ</h2><h4 id="æ ˆä¸æ ˆå¸§"><a href="#æ ˆä¸æ ˆå¸§" class="headerlink" title="æ ˆä¸æ ˆå¸§"></a>æ ˆä¸æ ˆå¸§</h4><p>Java Virtual Machine Stacks ï¼ˆJava è™šæ‹Ÿæœºæ ˆï¼‰ æˆ‘ä»¬éƒ½çŸ¥é“ JVM ä¸­ç”±å †ã€æ ˆã€æ–¹æ³•åŒºæ‰€ç»„æˆï¼Œå…¶ä¸­æ ˆå†…å­˜æ˜¯ç»™è°ç”¨çš„å‘¢ï¼Ÿ</p>
<ul>
<li>å…¶å®å°±æ˜¯çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯åŠ¨åï¼Œè™šæ‹Ÿæœºå°±ä¼šä¸ºå…¶åˆ†é…ä¸€å—<strong>æ ˆå†…å­˜</strong></li>
<li>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡<strong>æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜</strong></li>
<li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</li>
</ul>
<h4 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread-Context-Switchï¼‰"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread-Context-Switchï¼‰" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread Context Switchï¼‰"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread Context Switchï¼‰</h4><p>å› ä¸ºä»¥ä¸‹ä¸€äº›åŸå› å¯¼è‡´ cpu ä¸å†æ‰§è¡Œå½“å‰çš„çº¿ç¨‹ï¼Œè½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„ä»£ç </p>
<ul>
<li>çº¿ç¨‹çš„ cpu æ—¶é—´ç‰‡ç”¨å®Œ</li>
<li>åƒåœ¾å›æ”¶ æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦è¿è¡Œ</li>
<li>çº¿ç¨‹è‡ªå·±è°ƒç”¨äº† sleepã€yieldã€waitã€joinã€parkã€synchronizedã€lock ç­‰æ–¹æ³•</li>
</ul>
<p>å½“ Context Switch å‘ç”Ÿæ—¶ï¼Œéœ€è¦ç”±æ“ä½œç³»ç»Ÿä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶æ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼ŒJava ä¸­å¯¹åº”çš„æ¦‚å¿µ å°±æ˜¯ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®°ä½ä¸‹ä¸€æ¡ jvm æŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„</p>
<ul>
<li>çŠ¶æ€åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆä¸­æ¯ä¸ªæ ˆå¸§çš„ä¿¡æ¯ï¼Œå¦‚å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€è¿”å›åœ°å€ç­‰</li>
<li>Context Switch é¢‘ç¹å‘ç”Ÿä¼šå½±å“æ€§èƒ½</li>
</ul>
<h2 id="3ã€å¸¸ç”¨æ–¹æ³•"><a href="#3ã€å¸¸ç”¨æ–¹æ³•" class="headerlink" title="3ã€å¸¸ç”¨æ–¹æ³•"></a>3ã€å¸¸ç”¨æ–¹æ³•</h2><h3 id="1-start-vs-run"><a href="#1-start-vs-run" class="headerlink" title="(1)start() vs run()"></a>(1)start() vs run()</h3><p>è¢«åˆ›å»ºçš„Threadå¯¹è±¡ç›´æ¥è°ƒç”¨é‡å†™çš„runæ–¹æ³•æ—¶ï¼Œ runæ–¹æ³•æ˜¯åœ¨<strong>ä¸»çº¿ç¨‹</strong>ä¸­è¢«æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨æˆ‘ä»¬æ‰€åˆ›å»ºçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚æ‰€ä»¥å¦‚æœæƒ³è¦åœ¨æ‰€åˆ›å»ºçš„çº¿ç¨‹ä¸­æ‰§è¡Œrunæ–¹æ³•ï¼Œ<strong>éœ€è¦ä½¿ç”¨Threadå¯¹è±¡çš„startæ–¹æ³•ã€‚</strong></p>
<h3 id="2-sleep-ä¸yield"><a href="#2-sleep-ä¸yield" class="headerlink" title="(2)sleep()ä¸yield()"></a>(2)sleep()ä¸yield()</h3><h4 id="sleep-ä½¿çº¿ç¨‹é˜»å¡"><a href="#sleep-ä½¿çº¿ç¨‹é˜»å¡" class="headerlink" title="sleep (ä½¿çº¿ç¨‹é˜»å¡)"></a><strong>sleep</strong> (ä½¿çº¿ç¨‹é˜»å¡)</h4><ol>
<li><p>è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä» <strong>Running è¿›å…¥ Timed Waiting çŠ¶æ€ï¼ˆé˜»å¡ï¼‰</strong>ï¼Œå¯é€šè¿‡state()æ–¹æ³•æŸ¥çœ‹</p>
</li>
<li><p>å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ <strong>interrupt</strong> æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º InterruptedException</p>
</li>
<li><p>ç¡çœ ç»“æŸåçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œ</p>
</li>
<li><p>å»ºè®®ç”¨ <strong>TimeUnit çš„ sleep</strong> ä»£æ›¿ Thread çš„ sleep æ¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§ ã€‚å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ä¼‘çœ ä¸€ç§’</span><br><span class="line">TimeUnit.SECONDS.sleep(1);</span><br><span class="line">&#x2F;&#x2F;ä¼‘çœ ä¸€åˆ†é’Ÿ</span><br><span class="line">TimeUnit.MINUTES.sleep(1);</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="yield-ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰"><a href="#yield-ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰" class="headerlink" title="yield ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰"></a>yield ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰</h4><ol>
<li>è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä» <strong>Running è¿›å…¥ Runnable å°±ç»ªçŠ¶æ€</strong>ï¼ˆä»ç„¶æœ‰å¯èƒ½è¢«æ‰§è¡Œï¼‰ï¼Œç„¶åè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹</li>
<li>å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨</li>
</ol>
<h4 id="çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="çº¿ç¨‹ä¼˜å…ˆçº§"></a>çº¿ç¨‹ä¼˜å…ˆçº§</h4><ul>
<li><p>çº¿ç¨‹ä¼˜å…ˆçº§ä¼šæç¤ºï¼ˆhintï¼‰è°ƒåº¦å™¨ä¼˜å…ˆè°ƒåº¦è¯¥çº¿ç¨‹ï¼Œä½†å®ƒä»…ä»…æ˜¯ä¸€ä¸ªæç¤ºï¼Œè°ƒåº¦å™¨å¯ä»¥å¿½ç•¥å®ƒ</p>
</li>
<li><p>å¦‚æœ cpu æ¯”è¾ƒå¿™ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ä¼šè·å¾—æ›´å¤šçš„æ—¶é—´ç‰‡ï¼Œä½† cpu é—²æ—¶ï¼Œä¼˜å…ˆçº§å‡ ä¹æ²¡ä½œç”¨</p>
</li>
<li><p>è®¾ç½®æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">thread1.setPriority(Thread.MAX_PRIORITY); &#x2F;&#x2F;è®¾ç½®ä¸ºä¼˜å…ˆçº§æœ€é«˜</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-join-æ–¹æ³•"><a href="#3-join-æ–¹æ³•" class="headerlink" title="(3)join()æ–¹æ³•"></a>(3)join()æ–¹æ³•</h3><p>ç”¨äºç­‰å¾…æŸä¸ªçº¿ç¨‹ç»“æŸã€‚å“ªä¸ªçº¿ç¨‹å†…è°ƒç”¨join()æ–¹æ³•ï¼Œå°±ç­‰å¾…å“ªä¸ªçº¿ç¨‹ç»“æŸï¼Œç„¶åå†å»æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚</p>
<p>å¦‚åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ti.join()ï¼Œåˆ™æ˜¯ä¸»çº¿ç¨‹ç­‰å¾…t1çº¿ç¨‹ç»“æŸ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Thread thread &#x3D; new Thread();</span><br><span class="line">&#x2F;&#x2F;ç­‰å¾…threadçº¿ç¨‹æ‰§è¡Œç»“æŸ</span><br><span class="line">thread.join();</span><br><span class="line">&#x2F;&#x2F;æœ€å¤šç­‰å¾…1000ms,å¦‚æœ1000mså†…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™ä¼šç›´æ¥æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œä¸ä¼šç­‰å¤Ÿ1000ms</span><br><span class="line">thread.join(1000);</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="4-interrupt-æ–¹æ³•"><a href="#4-interrupt-æ–¹æ³•" class="headerlink" title="(4)interrupt()æ–¹æ³•"></a>(4)interrupt()æ–¹æ³•</h3><p>ç”¨äºæ‰“æ–­<strong>é˜»å¡</strong>(sleep wait joinâ€¦)çš„çº¿ç¨‹ã€‚ å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼ŒCPUä¸ä¼šç»™å…¶åˆ†é…æ—¶é—´ç‰‡ã€‚</p>
<ul>
<li>å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨åœ¨è¿è¡Œä¸­è¢«æ‰“æ–­ï¼Œæ‰“æ–­æ ‡è®°ä¼šè¢«ç½®ä¸ºtrueã€‚</li>
<li>å¦‚æœæ˜¯æ‰“æ–­å› sleep wait joinæ–¹æ³•è€Œè¢«é˜»å¡çš„çº¿ç¨‹ï¼Œä¼šå°†æ‰“æ–­æ ‡è®°ç½®ä¸ºfalse</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ç”¨äºæŸ¥çœ‹æ‰“æ–­æ ‡è®°ï¼Œè¿”å›å€¼è¢«booleanç±»å‹</span><br><span class="line">t1.isInterrupted();</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹åœ¨è¢«æ‰“æ–­åï¼Œ<strong>ä¸ä¼šåœæ­¢</strong>ï¼Œä¼šç»§ç»­æ‰§è¡Œã€‚å¦‚æœè¦è®©çº¿ç¨‹åœ¨è¢«æ‰“æ–­ååœä¸‹æ¥ï¼Œéœ€è¦<strong>ä½¿ç”¨æ‰“æ–­æ ‡è®°æ¥åˆ¤æ–­</strong>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">while(true) &#123;</span><br><span class="line">    if(Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h5 id="interruptæ–¹æ³•çš„åº”ç”¨â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"><a href="#interruptæ–¹æ³•çš„åº”ç”¨â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼" class="headerlink" title="interruptæ–¹æ³•çš„åº”ç”¨â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"></a><strong>interruptæ–¹æ³•çš„åº”ç”¨</strong>â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</h5><p>å½“æˆ‘ä»¬åœ¨æ‰§è¡Œçº¿ç¨‹ä¸€æ—¶ï¼Œæƒ³è¦ç»ˆæ­¢çº¿ç¨‹äºŒï¼Œè¿™æ˜¯å°±éœ€è¦ä½¿ç”¨interruptæ–¹æ³•æ¥<strong>ä¼˜é›…</strong>çš„åœæ­¢çº¿ç¨‹äºŒã€‚</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144553.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144553.png" alt="img"></a></p>
<p><strong>ä»£ç </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">public class Test7 &#123;</span><br><span class="line">	public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">		Monitor monitor &#x3D; new Monitor();</span><br><span class="line">		monitor.start();</span><br><span class="line">		Thread.sleep(3500);</span><br><span class="line">		monitor.stop();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Monitor &#123;</span><br><span class="line"></span><br><span class="line">	Thread monitor;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	public void start() &#123;</span><br><span class="line">		&#x2F;&#x2F;è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span><br><span class="line">		monitor &#x3D; new Thread() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public void run() &#123;</span><br><span class="line">				&#x2F;&#x2F;å¼€å§‹ä¸åœçš„ç›‘æ§</span><br><span class="line">				while (true) &#123;</span><br><span class="line">                    &#x2F;&#x2F;åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­äº†</span><br><span class="line">					if(Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">						System.out.println(&quot;å¤„ç†åç»­ä»»åŠ¡&quot;);</span><br><span class="line">                        &#x2F;&#x2F;ç»ˆæ­¢çº¿ç¨‹æ‰§è¡Œ</span><br><span class="line">						break;</span><br><span class="line">					&#125;</span><br><span class="line">					System.out.println(&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;);</span><br><span class="line">					try &#123;</span><br><span class="line">						&#x2F;&#x2F;çº¿ç¨‹ä¼‘çœ </span><br><span class="line">						Thread.sleep(1000);</span><br><span class="line">					&#125; catch (InterruptedException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">						&#x2F;&#x2F;å¦‚æœæ˜¯åœ¨ä¼‘çœ çš„æ—¶å€™è¢«æ‰“æ–­ï¼Œä¸ä¼šå°†æ‰“æ–­æ ‡è®°è®¾ç½®ä¸ºtrueï¼Œè¿™æ—¶è¦é‡æ–°è®¾ç½®æ‰“æ–­æ ‡è®°</span><br><span class="line">						Thread.currentThread().interrupt();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		monitor.start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 	ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	public void stop() &#123;</span><br><span class="line">		&#x2F;&#x2F;æ‰“æ–­çº¿ç¨‹</span><br><span class="line">		monitor.interrupt();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="5-ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•"><a href="#5-ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•" class="headerlink" title="(5)ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•"></a>(5)ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•</h3><ul>
<li>stopæ–¹æ³• åœæ­¢çº¿ç¨‹è¿è¡Œï¼ˆå¯èƒ½é€ æˆå…±äº«èµ„æºæ— æ³•è¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•ä½¿ç”¨è¿™äº›å…±äº«èµ„æºï¼‰</li>
<li>suspendï¼ˆæš‚åœçº¿ç¨‹ï¼‰/resumeï¼ˆæ¢å¤çº¿ç¨‹ï¼‰æ–¹æ³•</li>
</ul>
<h3 id="6-å®ˆæŠ¤çº¿ç¨‹"><a href="#6-å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="(6)å®ˆæŠ¤çº¿ç¨‹"></a>(6)å®ˆæŠ¤çº¿ç¨‹</h3><p>å½“JAVAè¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ï¼Œåªæœ‰å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼ŒJAVAè¿›ç¨‹æ‰ä¼šç»“æŸã€‚<strong>ä½†å½“éå®ˆæŠ¤çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åï¼Œå®ˆæŠ¤çº¿ç¨‹æ— è®ºæ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿä¼šä¸€åŒç»“æŸã€‚</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å°†çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹, é»˜è®¤ä¸ºfalse</span><br><span class="line">monitor.setDaemon(true); </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>å®ˆæŠ¤çº¿ç¨‹çš„åº”ç”¨</strong></p>
<ul>
<li>åƒåœ¾å›æ”¶å™¨çº¿ç¨‹å°±æ˜¯ä¸€ç§å®ˆæŠ¤çº¿ç¨‹</li>
<li>Tomcat ä¸­çš„ Acceptor å’Œ Poller çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥ Tomcat æ¥æ”¶åˆ° shutdown å‘½ä»¤åï¼Œä¸ä¼šç­‰ å¾…å®ƒä»¬å¤„ç†å®Œå½“å‰è¯·æ±‚</li>
</ul>
<h2 id="4ã€çº¿ç¨‹çš„çŠ¶æ€"><a href="#4ã€çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="4ã€çº¿ç¨‹çš„çŠ¶æ€"></a>4ã€çº¿ç¨‹çš„çŠ¶æ€</h2><h3 id="1-äº”ç§çŠ¶æ€"><a href="#1-äº”ç§çŠ¶æ€" class="headerlink" title="(1)äº”ç§çŠ¶æ€"></a>(1)äº”ç§çŠ¶æ€</h3><p>è¿™æ˜¯ä» <strong>æ“ä½œç³»ç»Ÿ</strong> å±‚é¢æ¥æè¿°çš„</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144606.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144606.png" alt="img"></a></p>
<ul>
<li>ã€åˆå§‹çŠ¶æ€ã€‘ä»…æ˜¯åœ¨è¯­è¨€å±‚é¢åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œè¿˜æœªä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼ˆä¾‹å¦‚çº¿ç¨‹è°ƒç”¨äº†startæ–¹æ³•ï¼‰</li>
<li>ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰æŒ‡è¯¥çº¿ç¨‹å·²ç»è¢«åˆ›å»ºï¼ˆä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼‰ï¼Œå¯ä»¥ç”± CPU è°ƒåº¦æ‰§è¡Œ</li>
<li>ã€è¿è¡ŒçŠ¶æ€ã€‘æŒ‡è·å–äº† CPU æ—¶é—´ç‰‡è¿è¡Œä¸­çš„çŠ¶æ€<ul>
<li>å½“ CPU æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¼šä»ã€è¿è¡ŒçŠ¶æ€ã€‘è½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼Œä¼šå¯¼è‡´çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</li>
</ul>
</li>
<li>ã€é˜»å¡çŠ¶æ€ã€‘<ul>
<li>å¦‚æœè°ƒç”¨äº†é˜»å¡ APIï¼Œå¦‚ BIO è¯»å†™æ–‡ä»¶ï¼Œè¿™æ—¶è¯¥çº¿ç¨‹å®é™…ä¸ä¼šç”¨åˆ° CPUï¼Œä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥ ã€é˜»å¡çŠ¶æ€ã€‘</li>
<li>ç­‰ BIO æ“ä½œå®Œæ¯•ï¼Œä¼šç”±æ“ä½œç³»ç»Ÿå”¤é†’é˜»å¡çš„çº¿ç¨‹ï¼Œè½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘</li>
<li>ä¸ã€å¯è¿è¡ŒçŠ¶æ€ã€‘çš„åŒºåˆ«æ˜¯ï¼Œå¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„çº¿ç¨‹æ¥è¯´åªè¦å®ƒä»¬ä¸€ç›´ä¸å”¤é†’ï¼Œè°ƒåº¦å™¨å°±ä¸€ç›´ä¸ä¼šè€ƒè™‘è°ƒåº¦å®ƒä»¬</li>
</ul>
</li>
<li>ã€ç»ˆæ­¢çŠ¶æ€ã€‘è¡¨ç¤ºçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œä¸ä¼šå†è½¬æ¢ä¸ºå…¶å®ƒçŠ¶æ€</li>
</ul>
<h3 id="2-å…­ç§çŠ¶æ€"><a href="#2-å…­ç§çŠ¶æ€" class="headerlink" title="(2)å…­ç§çŠ¶æ€"></a>(2)å…­ç§çŠ¶æ€</h3><p>è¿™æ˜¯ä» <strong>Java API</strong> å±‚é¢æ¥æè¿°çš„<br>æ ¹æ® Thread.State æšä¸¾ï¼Œåˆ†ä¸ºå…­ç§çŠ¶æ€</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144621.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144621.png" alt="img"></a></p>
<ul>
<li><strong>NEW</strong> çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨ start() æ–¹æ³•</li>
<li><strong>RUNNABLE</strong> å½“è°ƒç”¨äº† start() æ–¹æ³•ä¹‹åï¼Œæ³¨æ„ï¼ŒJava API å±‚é¢çš„ RUNNABLE çŠ¶æ€æ¶µç›–äº†æ“ä½œç³»ç»Ÿå±‚é¢çš„ ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ã€ã€è¿è¡ŒçŠ¶æ€ã€‘å’Œã€é˜»å¡çŠ¶æ€ã€‘ï¼ˆç”±äº BIO å¯¼è‡´çš„çº¿ç¨‹é˜»å¡ï¼Œåœ¨ Java é‡Œæ— æ³•åŒºåˆ†ï¼Œä»ç„¶è®¤ä¸º æ˜¯å¯è¿è¡Œï¼‰</li>
<li><strong>BLOCKED ï¼Œ WAITING ï¼Œ TIMED_WAITING</strong> éƒ½æ˜¯ <strong>Java API å±‚é¢</strong>å¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„ç»†åˆ†ï¼Œå¦‚sleepå°±ä½TIMED_WAITINGï¼Œ joinä¸ºWAITINGçŠ¶æ€ã€‚åé¢ä¼šåœ¨çŠ¶æ€è½¬æ¢ä¸€èŠ‚è¯¦è¿°ã€‚</li>
<li><strong>TERMINATED</strong> å½“çº¿ç¨‹ä»£ç è¿è¡Œç»“æŸ</li>
</ul>
<h1 id="ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"><a href="#ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹" class="headerlink" title="ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"></a>ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹</h1><h2 id="1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜"><a href="#1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜"></a>1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜</h2><h3 id="1-ä¸´ç•ŒåŒº-Critical-Section"><a href="#1-ä¸´ç•ŒåŒº-Critical-Section" class="headerlink" title="(1)ä¸´ç•ŒåŒº Critical Section"></a>(1)ä¸´ç•ŒåŒº Critical Section</h3><ul>
<li>ä¸€ä¸ªç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„</li>
<li>é—®é¢˜å‡ºåœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æº<ul>
<li>å¤šä¸ªçº¿ç¨‹è¯»å…±äº«èµ„æºå…¶å®ä¹Ÿæ²¡æœ‰é—®é¢˜</li>
<li>åœ¨å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¯»å†™æ“ä½œæ—¶å‘ç”ŸæŒ‡ä»¤äº¤é”™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜</li>
</ul>
</li>
<li>ä¸€æ®µä»£ç å—å†…å¦‚æœå­˜åœ¨å¯¹å…±äº«èµ„æºçš„å¤šçº¿ç¨‹è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸º<strong>ä¸´ç•ŒåŒº</strong><br>ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­çš„ä¸´ç•ŒåŒº</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">static int counter &#x3D; 0;</span><br><span class="line"> </span><br><span class="line">static void increment() </span><br><span class="line">&#x2F;&#x2F; ä¸´ç•ŒåŒº </span><br><span class="line">&#123;   </span><br><span class="line">    counter++; </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">static void decrement() </span><br><span class="line">&#x2F;&#x2F; ä¸´ç•ŒåŒº </span><br><span class="line">&#123; </span><br><span class="line">    counter--; </span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="2-ç«æ€æ¡ä»¶-Race-Condition"><a href="#2-ç«æ€æ¡ä»¶-Race-Condition" class="headerlink" title="(2)ç«æ€æ¡ä»¶ Race Condition"></a><strong>(2)ç«æ€æ¡ä»¶ Race Condition</strong></h3><p>å¤šä¸ªçº¿ç¨‹åœ¨<strong>ä¸´ç•ŒåŒº</strong>å†…æ‰§è¡Œï¼Œç”±äºä»£ç çš„æ‰§è¡Œåºåˆ—ä¸åŒè€Œå¯¼è‡´ç»“æœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹ä¸ºå‘ç”Ÿäº†<strong>ç«æ€æ¡ä»¶</strong></p>
<h2 id="2ã€synchronized-è§£å†³æ–¹æ¡ˆ"><a href="#2ã€synchronized-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2ã€synchronized è§£å†³æ–¹æ¡ˆ"></a>2ã€synchronized è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-è§£å†³æ‰‹æ®µ"><a href="#1-è§£å†³æ‰‹æ®µ" class="headerlink" title="(1)è§£å†³æ‰‹æ®µ"></a>(1)è§£å†³æ‰‹æ®µ</h3><p>ä¸ºäº†é¿å…ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿï¼Œæœ‰å¤šç§æ‰‹æ®µå¯ä»¥è¾¾åˆ°ç›®çš„ã€‚</p>
<ul>
<li>é˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šsynchronizedï¼ŒLock</li>
<li>éé˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šåŸå­å˜é‡</li>
</ul>
<p>æœ¬æ¬¡è¯¾ä½¿ç”¨é˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼š<strong>synchronized</strong>ï¼Œæ¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå³ä¿—ç§°çš„<strong>ã€å¯¹è±¡é”ã€‘</strong>ï¼Œå®ƒé‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€ æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ã€å¯¹è±¡é”ã€‘ï¼Œå…¶å®ƒçº¿ç¨‹å†æƒ³è·å–è¿™ä¸ªã€å¯¹è±¡é”ã€‘æ—¶å°±ä¼šé˜»å¡ä½(blocked)ã€‚è¿™æ ·å°±èƒ½ä¿è¯æ‹¥æœ‰é” çš„çº¿ç¨‹å¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸´ç•ŒåŒºå†…çš„ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</p>
<h3 id="2-synchronizedè¯­æ³•"><a href="#2-synchronizedè¯­æ³•" class="headerlink" title="(2)synchronizedè¯­æ³•"></a>(2)synchronizedè¯­æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">synchronized(å¯¹è±¡) &#123;</span><br><span class="line">	&#x2F;&#x2F;ä¸´ç•ŒåŒº</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">static int counter &#x3D; 0; </span><br><span class="line">&#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªå…¬å…±å¯¹è±¡ï¼Œä½œä¸ºå¯¹è±¡é”çš„å¯¹è±¡</span><br><span class="line">static final Object room &#x3D; new Object();</span><br><span class="line"> </span><br><span class="line">public static void main(String[] args) throws InterruptedException &#123;    </span><br><span class="line">	Thread t1 &#x3D; new Thread(() -&gt; &#123;        </span><br><span class="line">    for (int i &#x3D; 0; i &lt; 5000; i++) &#123;            </span><br><span class="line">        synchronized (room) &#123;     </span><br><span class="line">        counter++;            </span><br><span class="line">       	 &#125;       </span><br><span class="line"> 	   &#125;    </span><br><span class="line">    &#125;, &quot;t1&quot;);</span><br><span class="line"> </span><br><span class="line">    Thread t2 &#x3D; new Thread(() -&gt; &#123;       </span><br><span class="line">        for (int i &#x3D; 0; i &lt; 5000; i++) &#123;         </span><br><span class="line">            synchronized (room) &#123;            </span><br><span class="line">            counter--;          </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;, &quot;t2&quot;);</span><br><span class="line"> </span><br><span class="line">    t1.start();    </span><br><span class="line">    t2.start(); </span><br><span class="line">    t1.join();   </span><br><span class="line">    t2.join();    </span><br><span class="line">    log.debug(&quot;&#123;&#125;&quot;,counter); </span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="3-synchronizedåŠ åœ¨æ–¹æ³•ä¸Š"><a href="#3-synchronizedåŠ åœ¨æ–¹æ³•ä¸Š" class="headerlink" title="(3)synchronizedåŠ åœ¨æ–¹æ³•ä¸Š"></a>(3)synchronizedåŠ åœ¨æ–¹æ³•ä¸Š</h3><ul>
<li><p>åŠ åœ¨æˆå‘˜æ–¹æ³•ä¸Š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Demo &#123;</span><br><span class="line">	&#x2F;&#x2F;åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šsynchronizedå…³é”®å­—</span><br><span class="line">	public synchronized void test() &#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;ç­‰ä»·äº</span><br><span class="line">	public void test() &#123;</span><br><span class="line">		synchronized(this) &#123;</span><br><span class="line">		</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>åŠ åœ¨é™æ€æ–¹æ³•ä¸Š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Demo &#123;</span><br><span class="line">	&#x2F;&#x2F;åœ¨é™æ€æ–¹æ³•ä¸ŠåŠ ä¸Šsynchronizedå…³é”®å­—</span><br><span class="line">	public synchronized static void test() &#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;ç­‰ä»·äº</span><br><span class="line">	public void test() &#123;</span><br><span class="line">		synchronized(Demo.class) &#123;</span><br><span class="line">		</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"><a href="#3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ" class="headerlink" title="3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"></a>3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ</h2><h4 id="æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><ul>
<li>å¦‚æœå®ƒä»¬æ²¡æœ‰å…±äº«ï¼Œåˆ™çº¿ç¨‹å®‰å…¨</li>
<li>å¦‚æœå®ƒä»¬è¢«å…±äº«äº†ï¼Œæ ¹æ®å®ƒä»¬çš„çŠ¶æ€æ˜¯å¦èƒ½å¤Ÿæ”¹å˜ï¼Œåˆåˆ†ä¸¤ç§æƒ…å†µ<ul>
<li>å¦‚æœåªæœ‰è¯»æ“ä½œï¼Œåˆ™çº¿ç¨‹å®‰å…¨</li>
<li>å¦‚æœæœ‰è¯»å†™æ“ä½œï¼Œåˆ™è¿™æ®µä»£ç æ˜¯ä¸´ç•ŒåŒºï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</li>
</ul>
</li>
</ul>
<h4 id="å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><ul>
<li><p>å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
</li>
<li><p>ä½†å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡åˆ™æœªå¿… ï¼ˆè¦çœ‹è¯¥å¯¹è±¡</p>
<p>æ˜¯å¦è¢«å…±äº«</p>
<p>ä¸”è¢«æ‰§è¡Œäº†è¯»å†™æ“ä½œï¼‰</p>
<ul>
<li>å¦‚æœè¯¥å¯¹è±¡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
<li>å¦‚æœè¯¥å¯¹è±¡é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</li>
</ul>
</li>
<li><p>å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„â€”â€”æ¯ä¸ªæ–¹æ³•éƒ½åœ¨å¯¹åº”çº¿ç¨‹çš„æ ˆä¸­åˆ›å»ºæ ˆå¸§ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å…±äº«</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144636.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144636.png" alt="img"></a></p>
<ul>
<li>å¦‚æœè°ƒç”¨çš„å¯¹è±¡è¢«å…±äº«ï¼Œä¸”æ‰§è¡Œäº†è¯»å†™æ“ä½œï¼Œåˆ™<strong>çº¿ç¨‹ä¸å®‰å…¨</strong></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144649.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144649.png" alt="img"></a></p>
<ul>
<li>å¦‚æœæ˜¯å±€éƒ¨å˜é‡ï¼Œåˆ™ä¼šåœ¨å †ä¸­åˆ›å»ºå¯¹åº”çš„å¯¹è±¡ï¼Œä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144702.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144702.png" alt="img"></a></p>
<h3 id="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"><a href="#å¸¸è§çº¿ç¨‹å®‰å…¨ç±»" class="headerlink" title="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"></a>å¸¸è§çº¿ç¨‹å®‰å…¨ç±»</h3><ul>
<li>String</li>
<li>Integer</li>
<li>StringBuï¬€er</li>
<li>Random</li>
<li>Vector ï¼ˆListçš„çº¿ç¨‹å®‰å…¨å®ç°ç±»ï¼‰</li>
<li>Hashtable ï¼ˆHashçš„çº¿ç¨‹å®‰å…¨å®ç°ç±»ï¼‰</li>
<li>java.util.concurrent åŒ…ä¸‹çš„ç±»</li>
</ul>
<p>è¿™é‡Œè¯´å®ƒä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„æ˜¯æŒ‡ï¼Œå¤šä¸ªçº¿ç¨‹è°ƒç”¨å®ƒä»¬<strong>åŒä¸€ä¸ªå®ä¾‹çš„æŸä¸ªæ–¹æ³•æ—¶</strong>ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
<ul>
<li>å®ƒä»¬çš„æ¯ä¸ªæ–¹æ³•æ˜¯åŸå­çš„ï¼ˆéƒ½è¢«åŠ ä¸Šäº†synchronizedï¼‰</li>
<li>ä½†æ³¨æ„å®ƒä»¬<strong>å¤šä¸ªæ–¹æ³•çš„ç»„åˆä¸æ˜¯åŸå­çš„</strong>ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144903.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144903.png" alt="img"></a></p>
<h3 id="ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§"><a href="#ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§"></a>ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§</h3><p>Stringã€Integer ç­‰éƒ½æ˜¯<strong>ä¸å¯å˜ç±»</strong>ï¼Œå› ä¸ºå…¶å†…éƒ¨çš„çŠ¶æ€ä¸å¯ä»¥æ”¹å˜ï¼Œå› æ­¤å®ƒä»¬çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
<p>æœ‰åŒå­¦æˆ–è®¸æœ‰ç–‘é—®ï¼ŒString æœ‰ replaceï¼Œsubstring ç­‰æ–¹æ³•ã€å¯ä»¥ã€‘æ”¹å˜å€¼å•Šï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•åˆæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰ å…¨çš„å‘¢ï¼Ÿ</p>
<p>è¿™æ˜¯å› ä¸ºè¿™äº›æ–¹æ³•çš„è¿”å›å€¼éƒ½<strong>åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥æ”¹å˜Stringã€Integerå¯¹è±¡æœ¬èº«ã€‚</p>
<h2 id="4ã€Monitoræ¦‚å¿µ"><a href="#4ã€Monitoræ¦‚å¿µ" class="headerlink" title="4ã€Monitoræ¦‚å¿µ"></a>4ã€Monitoræ¦‚å¿µ</h2><h3 id="1-åŸç†ä¹‹Monitor"><a href="#1-åŸç†ä¹‹Monitor" class="headerlink" title="(1)åŸç†ä¹‹Monitor"></a>(1)åŸç†ä¹‹Monitor</h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144917.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144917.png" alt="img"></a></p>
<ul>
<li><p>å½“çº¿ç¨‹æ‰§è¡Œåˆ°ä¸´ç•ŒåŒºä»£ç æ—¶ï¼Œå¦‚æœä½¿ç”¨äº†synchronizedï¼Œä¼šå…ˆæŸ¥è¯¢synchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)<strong>æ˜¯å¦ç»‘å®šäº†Monitor</strong>ã€‚</p>
<ul>
<li><p>å¦‚æœ<strong>æ²¡æœ‰ç»‘å®š</strong>ï¼Œåˆ™ä¼šå…ˆå»å»ä¸Monitorç»‘å®šï¼Œå¹¶ä¸”å°†Ownerè®¾ä¸ºå½“å‰çº¿ç¨‹ã€‚</p>
</li>
<li><p>å¦‚æœ</p>
<p>å·²ç»ç»‘å®š</p>
<p>ï¼Œåˆ™ä¼šå»æŸ¥è¯¢è¯¥Monitoræ˜¯å¦å·²ç»æœ‰äº†Owner</p>
<ul>
<li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™Ownerä¸å°†å½“å‰çº¿ç¨‹ç»‘å®š</li>
<li>å¦‚æœæœ‰ï¼Œåˆ™æ”¾å…¥EntryListï¼Œè¿›å…¥é˜»å¡çŠ¶æ€(blocked)</li>
</ul>
</li>
</ul>
</li>
<li><p>å½“Monitorçš„Ownerå°†ä¸´ç•ŒåŒºä¸­ä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒOwnerä¾¿ä¼šè¢«æ¸…ç©ºï¼Œæ­¤æ—¶EntryListä¸­å¤„äº<strong>é˜»å¡</strong>çŠ¶æ€çš„çº¿ç¨‹ä¼šè¢«<strong>å«é†’å¹¶ç«äº‰</strong>ï¼Œæ­¤æ—¶çš„ç«äº‰æ˜¯<strong>éå…¬å¹³çš„</strong></p>
</li>
<li><p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>å¯¹è±¡åœ¨ä½¿ç”¨äº†synchronizedåä¸Monitorç»‘å®šæ—¶ï¼Œä¼šå°†å¯¹è±¡å¤´ä¸­çš„<strong>Mark Word</strong>ç½®ä¸ºMonitoræŒ‡é’ˆã€‚</li>
<li>æ¯ä¸ªå¯¹è±¡éƒ½ä¼šç»‘å®šä¸€ä¸ª<strong>å”¯ä¸€çš„Monitor</strong>ï¼Œå¦‚æœsynchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)<strong>ä¸åŒ</strong>ï¼Œåˆ™ä¼šç»‘å®š<strong>ä¸åŒ</strong>çš„Monitor</li>
</ul>
</li>
</ul>
<h2 id="5ã€SynchronizedåŸç†è¿›é˜¶"><a href="#5ã€SynchronizedåŸç†è¿›é˜¶" class="headerlink" title="5ã€SynchronizedåŸç†è¿›é˜¶"></a>5ã€SynchronizedåŸç†è¿›é˜¶</h2><h3 id="å¯¹è±¡å¤´æ ¼å¼"><a href="#å¯¹è±¡å¤´æ ¼å¼" class="headerlink" title="å¯¹è±¡å¤´æ ¼å¼"></a>å¯¹è±¡å¤´æ ¼å¼</h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144926.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144926.png" alt="img"></a></p>
<h3 id="1-è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰"><a href="#1-è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰" class="headerlink" title="(1)è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰"></a>(1)è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰</h3><p><strong>è½»é‡çº§é”ä½¿ç”¨åœºæ™¯ï¼š</strong>å½“ä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œä½†è®¿é—®çš„æ—¶é—´æ˜¯<strong>é”™å¼€çš„ï¼ˆä¸å­˜åœ¨ç«äº‰ï¼‰</strong>ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨<strong>è½»é‡çº§é”</strong>æ¥ä¼˜åŒ–ã€‚</p>
<ul>
<li><p>åˆ›å»º<strong>é”è®°å½•</strong>ï¼ˆLock Recordï¼‰å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•å¯¹è±¡ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„mark wordï¼ˆä¸å†ä¸€å¼€å§‹å°±ä½¿ç”¨Monitorï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144942.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144942.png" alt="img"></a></p>
</li>
<li><p>è®©é”è®°å½•ä¸­çš„Object referenceæŒ‡å‘é”å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œå¹¶å°è¯•ç”¨caså»æ›¿æ¢Objectä¸­çš„mark wordï¼Œå°†æ­¤mark wordæ”¾å…¥lock recordä¸­ä¿å­˜</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144950.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144950.png" alt="img"></a></p>
<ul>
<li>å¦‚æœcasæ›¿æ¢æˆåŠŸï¼Œåˆ™å°†Objectçš„å¯¹è±¡å¤´æ›¿æ¢ä¸º<strong>é”è®°å½•çš„åœ°å€</strong>å’Œ<strong>çŠ¶æ€ 00ï¼ˆè½»é‡çº§é”çŠ¶æ€ï¼‰</strong>ï¼Œå¹¶ç”±è¯¥çº¿ç¨‹ç»™å¯¹è±¡åŠ é”</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144957.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144957.png" alt="img"></a></p>
<h3 id="2-é”è†¨èƒ€"><a href="#2-é”è†¨èƒ€" class="headerlink" title="(2)é”è†¨èƒ€"></a>(2)é”è†¨èƒ€</h3><ul>
<li>å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨ç»™ä¸€ä¸ªå¯¹è±¡åŠ è½»é‡çº§é”æ—¶ï¼Œ<strong>casæ›¿æ¢æ“ä½œå¤±è´¥</strong>ï¼ˆå› ä¸ºæ­¤æ—¶å…¶ä»–çº¿ç¨‹å·²ç»ç»™å¯¹è±¡åŠ äº†è½»é‡çº§é”ï¼‰ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹å°±ä¼šè¿›å…¥<strong>é”è†¨èƒ€</strong>è¿‡ç¨‹</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145004.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145004.png" alt="img"></a></p>
<ul>
<li><p>æ­¤æ—¶ä¾¿ä¼šç»™å¯¹è±¡åŠ ä¸Šé‡é‡çº§é”ï¼ˆä½¿ç”¨Monitorï¼‰</p>
<ul>
<li><p>å°†å¯¹è±¡å¤´çš„Mark Wordæ”¹ä¸ºMonitorçš„åœ°å€ï¼Œå¹¶ä¸”çŠ¶æ€æ”¹ä¸º01(é‡é‡çº§é”)</p>
</li>
<li><p>å¹¶ä¸”è¯¥çº¿ç¨‹æ”¾å…¥å…¥EntryListä¸­ï¼Œå¹¶è¿›å…¥é˜»å¡çŠ¶æ€(blocked)</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145148.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145148.png" alt="img"></a></p>
</li>
</ul>
</li>
</ul>
<h3 id="3-è‡ªæ—‹ä¼˜åŒ–"><a href="#3-è‡ªæ—‹ä¼˜åŒ–" class="headerlink" title="(3)è‡ªæ—‹ä¼˜åŒ–"></a>(3)è‡ªæ—‹ä¼˜åŒ–</h3><p><strong>é‡é‡çº§é”</strong>ç«äº‰æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªé€‰æ¥ä¼˜åŒ–ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨<strong>è‡ªæ—‹æˆåŠŸ</strong>ï¼ˆä½¿ç”¨é”çš„çº¿ç¨‹é€€å‡ºäº†åŒæ­¥å—ï¼Œ<strong>é‡Šæ”¾äº†é”</strong>ï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥é¿å…çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p>
<ul>
<li>ç¬¬ä¸€ç§æƒ…å†µ</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145136.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145136.png" alt="img"></a></p>
<ul>
<li>ç¬¬äºŒç§æƒ…å†µ</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145125.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145125.png" alt="img"></a></p>
<h3 id="4-åå‘é”-ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥"><a href="#4-åå‘é”-ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥" class="headerlink" title="(4)åå‘é”(ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥)"></a>(4)åå‘é”(ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥)</h3><p>è½»é‡çº§é”åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œæ¯æ¬¡<strong>é‡å…¥</strong>ï¼ˆè¯¥çº¿ç¨‹æ‰§è¡Œçš„æ–¹æ³•ä¸­å†æ¬¡é”ä½è¯¥å¯¹è±¡ï¼‰æ“ä½œä»éœ€è¦casæ›¿æ¢æ“ä½œï¼Œè¿™æ ·æ˜¯ä¼šä½¿æ€§èƒ½é™ä½çš„ã€‚</p>
<p>æ‰€ä»¥å¼•å…¥äº†<strong>åå‘é”</strong>å¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼šåœ¨<strong>ç¬¬ä¸€æ¬¡</strong>casæ—¶ä¼šå°†<strong>çº¿ç¨‹çš„ID</strong>å†™å…¥å¯¹è±¡çš„Mark Wordä¸­ã€‚æ­¤åå‘ç°è¿™ä¸ªçº¿ç¨‹IDå°±æ˜¯è‡ªå·±çš„ï¼Œå°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œå°±ä¸éœ€è¦å†æ¬¡casï¼Œä»¥ååªè¦ä¸å‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145109.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145109.png" alt="img"></a></p>
<h4 id="åå‘çŠ¶æ€"><a href="#åå‘çŠ¶æ€" class="headerlink" title="åå‘çŠ¶æ€"></a>åå‘çŠ¶æ€</h4><ul>
<li>Normalï¼šä¸€èˆ¬çŠ¶æ€ï¼Œæ²¡æœ‰åŠ ä»»ä½•é”ï¼Œå‰é¢62ä½ä¿å­˜çš„æ˜¯å¯¹è±¡çš„ä¿¡æ¯ï¼Œ<strong>æœ€å2ä½ä¸ºçŠ¶æ€ï¼ˆ01ï¼‰ï¼Œå€’æ•°ç¬¬ä¸‰ä½è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨åå‘é”ï¼ˆæœªä½¿ç”¨ï¼š0ï¼‰</strong></li>
<li>Biasedï¼šåå‘çŠ¶æ€ï¼Œä½¿ç”¨åå‘é”ï¼Œå‰é¢54ä½ä¿å­˜çš„å½“å‰çº¿ç¨‹çš„IDï¼Œ<strong>æœ€å2ä½ä¸ºçŠ¶æ€ï¼ˆ01ï¼‰ï¼Œå€’æ•°ç¬¬ä¸‰ä½è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨åå‘é”ï¼ˆä½¿ç”¨ï¼š1ï¼‰</strong></li>
<li>Lightweightï¼šä½¿ç”¨è½»é‡çº§é”ï¼Œå‰62ä½ä¿å­˜çš„æ˜¯é”è®°å½•çš„æŒ‡é’ˆï¼Œ<strong>æœ€åä¸¤ä½ä¸ºçŠ¶æ€ï¼ˆ00ï¼‰</strong></li>
<li>Heavyweightï¼šä½¿ç”¨é‡é‡çº§é”ï¼Œå‰62ä½ä¿å­˜çš„æ˜¯Monitorçš„åœ°å€æŒ‡é’ˆï¼Œ<strong>åä¸¤ä½ä¸ºçŠ¶æ€(10)</strong></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145101.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145101.png" alt="img"></a></p>
<ul>
<li>å¦‚æœå¼€å¯äº†åå‘é”ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¯¹è±¡çš„Mark Wordåä¸‰ä½åº”è¯¥æ˜¯101</li>
<li>ä½†æ˜¯åå‘é”é»˜è®¤æ˜¯<strong>æœ‰å»¶è¿Ÿ</strong>çš„ï¼Œä¸ä¼šå†ç¨‹åºä¸€å¯åŠ¨å°±ç”Ÿæ•ˆï¼Œè€Œæ˜¯ä¼šåœ¨ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´ï¼ˆå‡ ç§’ä¹‹åï¼‰ï¼Œæ‰ä¼šå¯¹åˆ›å»ºçš„å¯¹è±¡è®¾ç½®ä¸ºåå‘çŠ¶æ€</li>
<li>å¦‚æœæ²¡æœ‰å¼€å¯åå‘é”ï¼Œå¯¹è±¡çš„Mark Wordåä¸‰ä½åº”è¯¥æ˜¯001</li>
</ul>
<h4 id="æ’¤é”€åå‘"><a href="#æ’¤é”€åå‘" class="headerlink" title="æ’¤é”€åå‘"></a>æ’¤é”€åå‘</h4><p>ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šä½¿å¯¹è±¡çš„åå‘é”å¤±æ•ˆ</p>
<ul>
<li>è°ƒç”¨å¯¹è±¡çš„hashCodeæ–¹æ³•</li>
<li>å¤šä¸ªçº¿ç¨‹ä½¿ç”¨è¯¥å¯¹è±¡</li>
<li><strong>è°ƒç”¨äº†wait/notifyæ–¹æ³•</strong>ï¼ˆè°ƒç”¨waitæ–¹æ³•ä¼šå¯¼è‡´é”è†¨èƒ€è€Œä½¿ç”¨<strong>é‡é‡çº§é”</strong>ï¼‰</li>
</ul>
<h3 id="5-æ‰¹é‡é‡åå‘"><a href="#5-æ‰¹é‡é‡åå‘" class="headerlink" title="(5)æ‰¹é‡é‡åå‘"></a>(5)æ‰¹é‡é‡åå‘</h3><ul>
<li>å¦‚æœå¯¹è±¡è™½ç„¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯çº¿ç¨‹é—´ä¸å­˜åœ¨ç«äº‰ï¼Œè¿™æ—¶åå‘T1çš„å¯¹è±¡ä»æœ‰æœºä¼šé‡æ–°åå‘T2<ul>
<li>é‡åå‘ä¼šé‡ç½®Thread ID</li>
</ul>
</li>
<li>å½“æ’¤é”€è¶…è¿‡20æ¬¡åï¼ˆè¶…è¿‡é˜ˆå€¼ï¼‰ï¼ŒJVMä¼šè§‰å¾—æ˜¯ä¸æ˜¯åå‘é”™äº†ï¼Œè¿™æ—¶ä¼šåœ¨ç»™å¯¹è±¡åŠ é”æ—¶ï¼Œé‡æ–°åå‘è‡³åŠ é”çº¿ç¨‹ã€‚</li>
</ul>
<h3 id="6-æ‰¹é‡æ’¤é”€"><a href="#6-æ‰¹é‡æ’¤é”€" class="headerlink" title="(6)æ‰¹é‡æ’¤é”€"></a>(6)æ‰¹é‡æ’¤é”€</h3><p>å½“æ’¤é”€åå‘é”çš„é˜ˆå€¼è¶…è¿‡40ä»¥åï¼Œå°±ä¼šå°†<strong>æ•´ä¸ªç±»çš„å¯¹è±¡éƒ½æ”¹ä¸ºä¸å¯åå‘çš„</strong></p>
<h2 id="6ã€Wait-Notify"><a href="#6ã€Wait-Notify" class="headerlink" title="6ã€Wait/Notify"></a>6ã€Wait/Notify</h2><h3 id="1-åŸç†"><a href="#1-åŸç†" class="headerlink" title="(1)åŸç†"></a>(1)åŸç†</h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145204.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145204.png" alt="img"></a></p>
<ul>
<li><p>é”å¯¹è±¡è°ƒç”¨waitæ–¹æ³•ï¼ˆobj.waitï¼‰ï¼Œå°±ä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥WaitSetä¸­ï¼Œå˜ä¸ºWAITINGçŠ¶æ€ã€‚</p>
</li>
<li><p>å¤„äºBLOCKEDå’ŒWAITINGçŠ¶æ€çš„çº¿ç¨‹éƒ½ä¸º</p>
<p>é˜»å¡</p>
<p>çŠ¶æ€ï¼ŒCPUéƒ½ä¸ä¼šåˆ†ç»™ä»–ä»¬æ—¶é—´ç‰‡ã€‚ä½†æ˜¯æœ‰æ‰€åŒºåˆ«ï¼š</p>
<ul>
<li>BLOCKEDçŠ¶æ€çš„çº¿ç¨‹æ˜¯åœ¨ç«äº‰å¯¹è±¡æ—¶ï¼Œå‘ç°Monitorçš„Ownerå·²ç»æ˜¯åˆ«çš„çº¿ç¨‹äº†ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥EntryListä¸­ï¼Œå¹¶å¤„äºBLOCKEDçŠ¶æ€</li>
<li>WAITINGçŠ¶æ€çš„çº¿ç¨‹æ˜¯è·å¾—äº†å¯¹è±¡çš„é”ï¼Œä½†æ˜¯è‡ªèº«å› ä¸ºæŸäº›åŸå› éœ€è¦è¿›å…¥é˜»å¡çŠ¶æ€æ—¶ï¼Œé”å¯¹è±¡è°ƒç”¨äº†waitæ–¹æ³•è€Œè¿›å…¥äº†WaitSetä¸­ï¼Œå¤„äºWAITINGçŠ¶æ€</li>
</ul>
</li>
<li><p>BLOCKEDçŠ¶æ€çš„çº¿ç¨‹ä¼šåœ¨é”è¢«é‡Šæ”¾çš„æ—¶å€™è¢«å”¤é†’ï¼Œä½†æ˜¯å¤„äºWAITINGçŠ¶æ€çš„çº¿ç¨‹åªæœ‰è¢«é”å¯¹è±¡è°ƒç”¨äº†notifyæ–¹æ³•(obj.notify/obj.notifyAll)ï¼Œæ‰ä¼šè¢«å”¤é†’ã€‚</p>
</li>
</ul>
<p><strong>æ³¨ï¼šåªæœ‰å½“å¯¹è±¡è¢«é”ä»¥åï¼Œæ‰èƒ½è°ƒç”¨waitå’Œnotifyæ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class Test1 &#123;</span><br><span class="line">	final static Object LOCK &#x3D; new Object();</span><br><span class="line">	public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        &#x2F;&#x2F;åªæœ‰åœ¨å¯¹è±¡è¢«é”ä½åæ‰èƒ½è°ƒç”¨waitæ–¹æ³•</span><br><span class="line">		synchronized (LOCK) &#123;</span><br><span class="line">			LOCK.wait();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="2-Waitä¸Sleepçš„åŒºåˆ«"><a href="#2-Waitä¸Sleepçš„åŒºåˆ«" class="headerlink" title="(2)Waitä¸Sleepçš„åŒºåˆ«"></a>(2)Waitä¸Sleepçš„åŒºåˆ«</h3><p><strong>ä¸åŒç‚¹</strong></p>
<ul>
<li>Sleepæ˜¯Threadç±»çš„é™æ€æ–¹æ³•ï¼ŒWaitæ˜¯Objectçš„æ–¹æ³•ï¼ŒObjectåˆæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œæ‰€ä»¥æ‰€æœ‰ç±»éƒ½æœ‰Waitæ–¹æ³•ã€‚</li>
<li>Sleepåœ¨é˜»å¡çš„æ—¶å€™ä¸ä¼šé‡Šæ”¾é”ï¼Œè€ŒWaitåœ¨é˜»å¡çš„æ—¶å€™ä¼šé‡Šæ”¾é”</li>
<li>Sleepä¸éœ€è¦ä¸synchronizedä¸€èµ·ä½¿ç”¨ï¼Œè€ŒWaitéœ€è¦ä¸synchronizedä¸€èµ·ä½¿ç”¨ï¼ˆå¯¹è±¡è¢«é”ä»¥åæ‰èƒ½ä½¿ç”¨ï¼‰</li>
</ul>
<p><strong>ç›¸åŒç‚¹</strong></p>
<ul>
<li>é˜»å¡çŠ¶æ€éƒ½ä¸º<strong>TIMED_WAITING</strong></li>
</ul>
<h3 id="3-ä¼˜é›…åœ°ä½¿ç”¨wait-notify"><a href="#3-ä¼˜é›…åœ°ä½¿ç”¨wait-notify" class="headerlink" title="(3)ä¼˜é›…åœ°ä½¿ç”¨wait/notify"></a>(3)ä¼˜é›…åœ°ä½¿ç”¨wait/notify</h3><p><strong>ä»€ä¹ˆæ—¶å€™é€‚åˆä½¿ç”¨wait</strong></p>
<ul>
<li>å½“çº¿ç¨‹<strong>ä¸æ»¡è¶³æŸäº›æ¡ä»¶</strong>ï¼Œéœ€è¦æš‚åœè¿è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨waitã€‚è¿™æ ·ä¼šå°†<strong>å¯¹è±¡çš„é”é‡Šæ”¾</strong>ï¼Œè®©å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç»§ç»­è¿è¡Œã€‚å¦‚æœæ­¤æ—¶ä½¿ç”¨sleepï¼Œä¼šå¯¼è‡´æ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥é˜»å¡ï¼Œå¯¼è‡´æ‰€æœ‰çº¿ç¨‹éƒ½æ²¡æ³•è¿è¡Œï¼Œç›´åˆ°å½“å‰çº¿ç¨‹sleepç»“æŸåï¼Œè¿è¡Œå®Œæ¯•ï¼Œæ‰èƒ½å¾—åˆ°æ‰§è¡Œã€‚</li>
</ul>
<p><strong>ä½¿ç”¨wait/notifyéœ€è¦æ³¨æ„ä»€ä¹ˆ</strong></p>
<ul>
<li>å½“æœ‰<strong>å¤šä¸ª</strong>çº¿ç¨‹åœ¨è¿è¡Œæ—¶ï¼Œå¯¹è±¡è°ƒç”¨äº†waitæ–¹æ³•ï¼Œæ­¤æ—¶è¿™äº›çº¿ç¨‹éƒ½ä¼šè¿›å…¥WaitSetä¸­ç­‰å¾…ã€‚å¦‚æœè¿™æ—¶ä½¿ç”¨äº†<strong>notify</strong>æ–¹æ³•ï¼Œå¯èƒ½ä¼šé€ æˆ<strong>è™šå‡å”¤é†’</strong>ï¼ˆå”¤é†’çš„ä¸æ˜¯æ»¡è¶³æ¡ä»¶çš„ç­‰å¾…çº¿ç¨‹ï¼‰ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨<strong>notifyAll</strong>æ–¹æ³•</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">synchronized (LOCK) &#123;</span><br><span class="line">	while(&#x2F;&#x2F;ä¸æ»¡è¶³æ¡ä»¶ï¼Œä¸€ç›´ç­‰å¾…ï¼Œé¿å…è™šå‡å”¤é†’) &#123;</span><br><span class="line">		LOCK.wait();</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;æ»¡è¶³æ¡ä»¶åå†è¿è¡Œ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">synchronized (LOCK) &#123;</span><br><span class="line">	&#x2F;&#x2F;å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span><br><span class="line">	LOCK.notifyAll();</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="7ã€æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ"><a href="#7ã€æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ" class="headerlink" title="7ã€æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ"></a>7ã€æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ</h2><h3 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="(1)å®šä¹‰"></a>(1)å®šä¹‰</h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145223.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145223.png" alt="img"></a></p>
<h3 id="2-ä¸¾ä¾‹"><a href="#2-ä¸¾ä¾‹" class="headerlink" title="(2)ä¸¾ä¾‹"></a>(2)ä¸¾ä¾‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">public class Test2 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		String hello &#x3D; &quot;hello thread!&quot;;</span><br><span class="line">		Guarded guarded &#x3D; new Guarded();</span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			System.out.println(&quot;æƒ³è¦å¾—åˆ°ç»“æœ&quot;);</span><br><span class="line">			synchronized (guarded) &#123;</span><br><span class="line">				System.out.println(&quot;ç»“æœæ˜¯ï¼š&quot;+guarded.getResponse());</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(&quot;å¾—åˆ°ç»“æœ&quot;);</span><br><span class="line">		&#125;).start();</span><br><span class="line"></span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			System.out.println(&quot;è®¾ç½®ç»“æœ&quot;);</span><br><span class="line">			synchronized (guarded) &#123;</span><br><span class="line">				guarded.setResponse(hello);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Guarded &#123;</span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * è¦è¿”å›çš„ç»“æœ</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	private Object response;</span><br><span class="line">	</span><br><span class="line">    &#x2F;&#x2F;ä¼˜é›…åœ°ä½¿ç”¨wait&#x2F;notify</span><br><span class="line">	public Object getResponse() &#123;</span><br><span class="line">		&#x2F;&#x2F;å¦‚æœè¿”å›ç»“æœä¸ºç©ºå°±ä¸€ç›´ç­‰å¾…ï¼Œé¿å…è™šå‡å”¤é†’</span><br><span class="line">		while(response &#x3D;&#x3D; null) &#123;</span><br><span class="line">			synchronized (this) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					this.wait();</span><br><span class="line">				&#125; catch (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return response;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setResponse(Object response) &#123;</span><br><span class="line">		this.response &#x3D; response;</span><br><span class="line">		synchronized (this) &#123;</span><br><span class="line">			&#x2F;&#x2F;å”¤é†’ä¼‘çœ çš„çº¿ç¨‹</span><br><span class="line">			this.notifyAll();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public String toString() &#123;</span><br><span class="line">		return &quot;Guarded&#123;&quot; +</span><br><span class="line">				&quot;response&#x3D;&quot; + response +</span><br><span class="line">				&#39;&#125;&#39;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>å¸¦è¶…æ—¶åˆ¤æ–­çš„æš‚åœ</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public Object getResponse(long time) &#123;</span><br><span class="line">		synchronized (this) &#123;</span><br><span class="line">			&#x2F;&#x2F;è·å–å¼€å§‹æ—¶é—´</span><br><span class="line">			long currentTime &#x3D; System.currentTimeMillis();</span><br><span class="line">			&#x2F;&#x2F;ç”¨äºä¿å­˜å·²ç»ç­‰å¾…äº†çš„æ—¶é—´</span><br><span class="line">			long passedTime &#x3D; 0;</span><br><span class="line">			while(response &#x3D;&#x3D; null) &#123;</span><br><span class="line">				&#x2F;&#x2F;çœ‹ç»è¿‡çš„æ—¶é—´-å¼€å§‹æ—¶é—´æ˜¯å¦è¶…è¿‡äº†æŒ‡å®šæ—¶é—´</span><br><span class="line">				long waitTime &#x3D; time -passedTime;</span><br><span class="line">				if(waitTime &lt;&#x3D; 0) &#123;</span><br><span class="line">					break;</span><br><span class="line">				&#125;</span><br><span class="line">				try &#123;</span><br><span class="line">                   	&#x2F;&#x2F;ç­‰å¾…å‰©ä½™æ—¶é—´</span><br><span class="line">					this.wait(waitTime);</span><br><span class="line">				&#125; catch (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">				&#x2F;&#x2F;è·å–å½“å‰æ—¶é—´</span><br><span class="line">				passedTime &#x3D; System.currentTimeMillis()-currentTime		</span><br><span class="line">            &#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return response;</span><br><span class="line">	&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="3-joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼"><a href="#3-joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼" class="headerlink" title="(3)joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼"></a>(3)joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public final synchronized void join(long millis)</span><br><span class="line">    throws InterruptedException &#123;</span><br><span class="line">        long base &#x3D; System.currentTimeMillis();</span><br><span class="line">        long now &#x3D; 0;</span><br><span class="line"></span><br><span class="line">        if (millis &lt; 0) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;timeout value is negative&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (millis &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            while (isAlive()) &#123;</span><br><span class="line">                wait(0);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            while (isAlive()) &#123;</span><br><span class="line">                long delay &#x3D; millis - now;</span><br><span class="line">                if (delay &lt;&#x3D; 0) &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                wait(delay);</span><br><span class="line">                now &#x3D; System.currentTimeMillis() - base;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="8ã€park-unpark"><a href="#8ã€park-unpark" class="headerlink" title="8ã€park/unpark"></a>8ã€park/unpark</h2><h3 id="1-åŸºæœ¬ä½¿ç”¨"><a href="#1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="(1)åŸºæœ¬ä½¿ç”¨"></a>(1)åŸºæœ¬ä½¿ç”¨</h3><p><strong>park/unparkéƒ½æ˜¯LockSupportç±»ä¸­çš„çš„æ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æš‚åœçº¿ç¨‹è¿è¡Œ</span><br><span class="line">LockSupport.park;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;æ¢å¤çº¿ç¨‹è¿è¡Œ</span><br><span class="line">LockSupport.unpark(thread);Copy</span><br><span class="line">public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">		Thread thread &#x3D; new Thread(()-&gt; &#123;</span><br><span class="line">			System.out.println(&quot;park&quot;);</span><br><span class="line">            &#x2F;&#x2F;æš‚åœçº¿ç¨‹è¿è¡Œ</span><br><span class="line">			LockSupport.park();</span><br><span class="line">			System.out.println(&quot;resume&quot;);</span><br><span class="line">		&#125;, &quot;t1&quot;);</span><br><span class="line">		thread.start();</span><br><span class="line"></span><br><span class="line">		Thread.sleep(1000);</span><br><span class="line">		System.out.println(&quot;unpark&quot;);</span><br><span class="line">    	&#x2F;&#x2F;æ¢å¤çº¿ç¨‹è¿è¡Œ</span><br><span class="line">		LockSupport.unpark(thread);</span><br><span class="line">	&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="2-ç‰¹ç‚¹"><a href="#2-ç‰¹ç‚¹" class="headerlink" title="(2)ç‰¹ç‚¹"></a>(2)ç‰¹ç‚¹</h3><p><strong>ä¸wait/notifyçš„åŒºåˆ«</strong></p>
<ul>
<li>waitï¼Œnotify å’Œ notifyAll å¿…é¡»é…åˆ<strong>Object Monitor</strong>ä¸€èµ·ä½¿ç”¨ï¼Œè€Œparkï¼Œunparkä¸å¿…</li>
<li>park ï¼Œunpark æ˜¯ä»¥<strong>çº¿ç¨‹ä¸ºå•ä½</strong>æ¥<strong>é˜»å¡</strong>å’Œ<strong>å”¤é†’</strong>çº¿ç¨‹ï¼Œè€Œ notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAll æ˜¯å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œå°±ä¸é‚£ä¹ˆç²¾ç¡®</li>
<li>park &amp; unpark å¯ä»¥<strong>å…ˆ unpark</strong>ï¼Œè€Œ wait &amp; notify ä¸èƒ½å…ˆ notify</li>
<li><strong>parkä¸ä¼šé‡Šæ”¾é”</strong>ï¼Œè€Œwaitä¼šé‡Šæ”¾é”</li>
</ul>
<h3 id="3-åŸç†"><a href="#3-åŸç†" class="headerlink" title="(3)åŸç†"></a>(3)åŸç†</h3><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„<strong>Parkå¯¹è±¡</strong>ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡**_counter, _cond,__mutex**ç»„æˆ</p>
<ul>
<li><p>å…ˆè°ƒç”¨parkå†è°ƒç”¨unparkæ—¶</p>
<ul>
<li><p>å…ˆè°ƒç”¨park</p>
<ul>
<li>çº¿ç¨‹è¿è¡Œæ—¶ï¼Œä¼šå°†Parkå¯¹è±¡ä¸­çš„**_counterçš„å€¼è®¾ä¸º0**ï¼›</li>
<li>è°ƒç”¨parkæ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹counterçš„å€¼æ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0ï¼Œåˆ™å°†çº¿ç¨‹æ”¾å…¥é˜»å¡é˜Ÿåˆ—condä¸­</li>
<li>æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­åï¼Œä¼š<strong>å†æ¬¡</strong>å°†counterè®¾ç½®ä¸º0</li>
</ul>
</li>
<li><p>ç„¶åè°ƒç”¨unpark</p>
<ul>
<li><p>è°ƒç”¨unparkæ–¹æ³•åï¼Œä¼šå°†counterçš„å€¼è®¾ç½®ä¸º1</p>
</li>
<li><p>å»å”¤é†’é˜»å¡é˜Ÿåˆ—condä¸­çš„çº¿ç¨‹</p>
</li>
<li><p>çº¿ç¨‹ç»§ç»­è¿è¡Œå¹¶å°†counterçš„å€¼è®¾ä¸º0</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145250.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145250.png" alt="img"></a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145303.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145303.png" alt="img"></a></p>
<ul>
<li>å…ˆè°ƒç”¨unparkï¼Œå†è°ƒç”¨park<ul>
<li>è°ƒç”¨unpark<ul>
<li>ä¼šå°†counterè®¾ç½®ä¸º1ï¼ˆè¿è¡Œæ—¶0ï¼‰</li>
</ul>
</li>
<li>è°ƒç”¨parkæ–¹æ³•<ul>
<li>æŸ¥çœ‹counteræ˜¯å¦ä¸º0</li>
<li>å› ä¸ºunparkå·²ç»æŠŠcounterè®¾ç½®ä¸º1ï¼Œæ‰€ä»¥æ­¤æ—¶å°†counterè®¾ç½®ä¸º0ï¼Œä½†<strong>ä¸æ”¾å…¥</strong>é˜»å¡é˜Ÿåˆ—condä¸­</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145313.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145313.png" alt="img"></a></p>
<h2 id="9ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢"><a href="#9ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢" class="headerlink" title="9ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢"></a>9ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢</h2><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145330.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145330.png" alt="img"></a></p>
<h3 id="æƒ…å†µä¸€ï¼šNEW-â€“-gt-RUNNABLE"><a href="#æƒ…å†µä¸€ï¼šNEW-â€“-gt-RUNNABLE" class="headerlink" title="æƒ…å†µä¸€ï¼šNEW â€“&gt; RUNNABLE"></a>æƒ…å†µä¸€ï¼šNEW â€“&gt; RUNNABLE</h3><ul>
<li>å½“è°ƒç”¨äº†t.start()æ–¹æ³•æ—¶ï¼Œç”± NEW â€“&gt; RUNNABLE</li>
</ul>
<h3 id="æƒ…å†µäºŒï¼š-RUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µäºŒï¼š-RUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µäºŒï¼š RUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µäºŒï¼š RUNNABLE &lt;â€“&gt; WAITING</h3><ul>
<li>å½“è°ƒç”¨äº†t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”å<ul>
<li>è°ƒç”¨ obj.wait() æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» RUNNABLE â€“&gt; WAITING</li>
<li>è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.interrupt() æ—¶<ul>
<li>ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» WAITING â€“&gt; RUNNABLE</li>
<li>ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» WAITING â€“&gt; BLOCKED</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="æƒ…å†µä¸‰ï¼šRUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µä¸‰ï¼šRUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µä¸‰ï¼šRUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µä¸‰ï¼šRUNNABLE &lt;â€“&gt; WAITING</h3><ul>
<li><p>å½“å‰çº¿ç¨‹</p>
<p>è°ƒç”¨ t.join() æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; WAITING</p>
<ul>
<li>æ³¨æ„æ˜¯<strong>å½“å‰çº¿ç¨‹</strong>åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾…</li>
</ul>
</li>
<li><p>t çº¿ç¨‹<strong>è¿è¡Œç»“æŸ</strong>ï¼Œæˆ–è°ƒç”¨äº†<strong>å½“å‰çº¿ç¨‹</strong>çš„ interrupt() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» WAITING â€“&gt; RUNNABLE</p>
</li>
</ul>
<h3 id="æƒ…å†µå››ï¼š-RUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µå››ï¼š-RUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µå››ï¼š RUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µå››ï¼š RUNNABLE &lt;â€“&gt; WAITING</h3><ul>
<li>å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.park() æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; WAITING</li>
<li>è°ƒç”¨ LockSupport.unpark(ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä» WAITING â€“&gt; RUNNABLE</li>
</ul>
<h3 id="æƒ…å†µäº”ï¼š-RUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µäº”ï¼š-RUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µäº”ï¼š RUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µäº”ï¼š RUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><p>t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”å</p>
<ul>
<li>è°ƒç”¨ obj.wait(<strong>long n</strong>) æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</li>
<li>t çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.interrupt() æ—¶<ul>
<li>ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» TIMED_WAITING â€“&gt; RUNNABLE</li>
<li>ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» TIMED_WAITING â€“&gt; BLOCKED</li>
</ul>
</li>
</ul>
<h3 id="æƒ…å†µå…­ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µå…­ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µå…­ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µå…­ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><ul>
<li><p>å½“å‰çº¿ç¨‹è°ƒç”¨ t.join</p>
<p>(long n</p>
<p>) æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</p>
<ul>
<li>æ³¨æ„æ˜¯å½“å‰çº¿ç¨‹åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾…</li>
</ul>
</li>
<li><p>å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–t çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è°ƒç”¨äº†å½“å‰çº¿ç¨‹çš„ interrupt() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» TIMED_WAITING â€“&gt; RUNNABLE</p>
</li>
</ul>
<h3 id="æƒ…å†µä¸ƒï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µä¸ƒï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µä¸ƒï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µä¸ƒï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><ul>
<li>å½“å‰çº¿ç¨‹è°ƒç”¨ Thread.sleep(long n) ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</li>
<li>å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œå½“å‰çº¿ç¨‹ä» TIMED_WAITING â€“&gt; RUNNABLE</li>
</ul>
<h3 id="æƒ…å†µå…«ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µå…«ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µå…«ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µå…«ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><ul>
<li>å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.parkNanos(long nanos) æˆ– LockSupport.parkUntil(long millis) æ—¶ï¼Œå½“å‰çº¿ ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</li>
<li>è°ƒç”¨ LockSupport.unpark(ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œæˆ–æ˜¯ç­‰å¾…è¶…æ—¶ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä» TIMED_WAITINGâ€“&gt; RUNNABLE</li>
</ul>
<h3 id="æƒ…å†µä¹ï¼šRUNNABLE-lt-â€“-gt-BLOCKED"><a href="#æƒ…å†µä¹ï¼šRUNNABLE-lt-â€“-gt-BLOCKED" class="headerlink" title="æƒ…å†µä¹ï¼šRUNNABLE &lt;â€“&gt; BLOCKED"></a>æƒ…å†µä¹ï¼šRUNNABLE &lt;â€“&gt; BLOCKED</h3><ul>
<li>t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”æ—¶å¦‚æœ<strong>ç«äº‰å¤±è´¥</strong>ï¼Œä» RUNNABLE â€“&gt; BLOCKED</li>
<li>æŒ obj é”çº¿ç¨‹çš„åŒæ­¥ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œä¼šå”¤é†’è¯¥å¯¹è±¡ä¸Šæ‰€æœ‰ BLOCKED çš„çº¿ç¨‹é‡æ–°ç«äº‰ï¼Œå¦‚æœå…¶ä¸­ t çº¿ç¨‹ç«äº‰ æˆåŠŸï¼Œä» BLOCKED â€“&gt; RUNNABLE ï¼Œå…¶å®ƒ<strong>å¤±è´¥</strong>çš„çº¿ç¨‹ä»ç„¶ BLOCKED</li>
</ul>
<h3 id="æƒ…å†µåï¼š-RUNNABLE-lt-â€“-gt-TERMINATED"><a href="#æƒ…å†µåï¼š-RUNNABLE-lt-â€“-gt-TERMINATED" class="headerlink" title="æƒ…å†µåï¼š RUNNABLE &lt;â€“&gt; TERMINATED"></a>æƒ…å†µåï¼š RUNNABLE &lt;â€“&gt; TERMINATED</h3><p>å½“å‰çº¿<strong>ç¨‹æ‰€æœ‰ä»£ç è¿è¡Œå®Œæ¯•</strong>ï¼Œè¿›å…¥ TERMINATED</p>
<h2 id="10ã€å¤šæŠŠé”"><a href="#10ã€å¤šæŠŠé”" class="headerlink" title="10ã€å¤šæŠŠé”"></a>10ã€å¤šæŠŠé”</h2><p><strong>å°†é”çš„ç²’åº¦ç»†åˆ†</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class BigRoom &#123;</span><br><span class="line">    &#x2F;&#x2F;é¢å¤–åˆ›å»ºå¯¹è±¡æ¥ä½œä¸ºé”</span><br><span class="line">	private final Object studyRoom &#x3D; new Object();</span><br><span class="line">	private final Object bedRoom &#x3D; new Object();</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="11ã€æ´»è·ƒæ€§"><a href="#11ã€æ´»è·ƒæ€§" class="headerlink" title="11ã€æ´»è·ƒæ€§"></a>11ã€æ´»è·ƒæ€§</h2><h3 id="1-å®šä¹‰-1"><a href="#1-å®šä¹‰-1" class="headerlink" title="(1)å®šä¹‰"></a>(1)å®šä¹‰</h3><p>å› ä¸ºæŸç§åŸå› ï¼Œä½¿å¾—ä»£ç ä¸€ç›´æ— æ³•æ‰§è¡Œå®Œæ¯•ï¼Œè¿™æ ·çš„ç°è±¡å«åšæ´»è·ƒæ€§</p>
<h3 id="2-æ­»é”"><a href="#2-æ­»é”" class="headerlink" title="(2)æ­»é”"></a>(2)æ­»é”</h3><p>æœ‰è¿™æ ·çš„æƒ…å†µï¼šä¸€ä¸ªçº¿ç¨‹éœ€è¦<strong>åŒæ—¶è·å–å¤šæŠŠé”</strong>ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é”</p>
<p>å¦‚ï¼št1çº¿ç¨‹è·å¾—Aå¯¹è±¡ é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Bå¯¹è±¡çš„é”t2çº¿ç¨‹è·å¾—Bå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Aå¯¹è±¡çš„é”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">		final Object A &#x3D; new Object();</span><br><span class="line">		final Object B &#x3D; new Object();</span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			synchronized (A) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					Thread.sleep(2000);</span><br><span class="line">				&#125; catch (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">				synchronized (B) &#123;</span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).start();</span><br><span class="line"></span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			synchronized (B) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					Thread.sleep(1000);</span><br><span class="line">				&#125; catch (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">				synchronized (A) &#123;</span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"><a href="#å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶" class="headerlink" title="å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"></a>å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶</h4><ul>
<li>äº’æ–¥æ¡ä»¶<ul>
<li>åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œä¸€ç§èµ„æºåªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹æ‰€ä½¿ç”¨</li>
</ul>
</li>
<li>è¯·æ±‚å’Œä¿æŒæ¡ä»¶<ul>
<li>è¿›ç¨‹å·²ç»æ‹¥æœ‰äº†è‡³å°‘ä¸€ç§èµ„æºï¼ŒåŒæ—¶åˆå»ç”³è¯·å…¶ä»–èµ„æºã€‚å› ä¸ºå…¶ä»–èµ„æºè¢«åˆ«çš„è¿›ç¨‹æ‰€ä½¿ç”¨ï¼Œè¯¥è¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶ä¸”ä¸é‡Šæ”¾è‡ªå·±å·²æœ‰çš„èµ„æº</li>
</ul>
</li>
<li>ä¸å¯æŠ¢å æ¡ä»¶<ul>
<li>è¿›ç¨‹å¯¹å·²è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæˆå‰ä¸èƒ½è¢«å¼ºå ï¼Œåªèƒ½åœ¨è¿›ç¨‹ä½¿ç”¨å®Œåè‡ªå·±é‡Šæ”¾</li>
</ul>
</li>
<li>å¾ªç¯ç­‰å¾…æ¡ä»¶<ul>
<li>å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹â€”â€”èµ„æºçš„å¾ªç¯é“¾ã€‚</li>
</ul>
</li>
</ul>
<h4 id="å®šä½æ­»é”çš„æ–¹æ³•"><a href="#å®šä½æ­»é”çš„æ–¹æ³•" class="headerlink" title="å®šä½æ­»é”çš„æ–¹æ³•"></a>å®šä½æ­»é”çš„æ–¹æ³•</h4><ul>
<li><p>jps+jstack ThreadID</p>
<ul>
<li><p>åœ¨JAVAæ§åˆ¶å°ä¸­çš„Terminalä¸­è¾“å…¥<strong>jps</strong>æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹è¿è¡Œä¸­çš„çº¿ç¨‹IDï¼Œä½¿ç”¨<strong>jstack ThreadID</strong>å¯ä»¥æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145351.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145351.png" alt="img"></a></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">F:\Thread_study&gt;jps</span><br><span class="line">20672 RemoteMavenServer36</span><br><span class="line">22880 Jps</span><br><span class="line">4432 Launcher</span><br><span class="line">5316 Test5</span><br><span class="line">20184 KotlinCompileDaemon</span><br><span class="line">11132</span><br><span class="line"></span><br><span class="line">F:\Thread_study&gt;jstack 5316 </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æ‰“å°çš„ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ‰¾åˆ°ä¸€ä¸ªjavaçº§åˆ«çš„æ­»é”</span><br><span class="line">Found one Java-level deadlock:</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&quot;Thread-1&quot;:</span><br><span class="line">  waiting to lock monitor 0x0000000017f40de8 (object 0x00000000d6188880, a java.lang.Object),</span><br><span class="line">  which is held by &quot;Thread-0&quot;</span><br><span class="line">&quot;Thread-0&quot;:</span><br><span class="line">  waiting to lock monitor 0x0000000017f43678 (object 0x00000000d6188890, a java.lang.Object),</span><br><span class="line">  which is held by &quot;Thread-1&quot; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>jconsoleæ£€æµ‹æ­»é”</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145405.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145405.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145416.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145416.png" alt="img"></a></p>
</li>
</ul>
<h4 id="å“²å­¦å®¶å°±é¤é—®é¢˜"><a href="#å“²å­¦å®¶å°±é¤é—®é¢˜" class="headerlink" title="å“²å­¦å®¶å°±é¤é—®é¢˜"></a>å“²å­¦å®¶å°±é¤é—®é¢˜</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145436.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145436.png" alt="img"></a></p>
<h4 id="é¿å…æ­»é”çš„æ–¹æ³•"><a href="#é¿å…æ­»é”çš„æ–¹æ³•" class="headerlink" title="é¿å…æ­»é”çš„æ–¹æ³•"></a>é¿å…æ­»é”çš„æ–¹æ³•</h4><p>åœ¨çº¿ç¨‹ä½¿ç”¨é”å¯¹è±¡æ—¶<strong>ï¼Œé¡ºåºåŠ é”</strong>å³å¯é¿å…æ­»é”</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145450.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145450.png" alt="img"></a></p>
<h3 id="3-æ´»é”"><a href="#3-æ´»é”" class="headerlink" title="(3)æ´»é”"></a>(3)æ´»é”</h3><p>æ´»é”å‡ºç°åœ¨ä¸¤ä¸ªçº¿ç¨‹<strong>äº’ç›¸æ”¹å˜å¯¹æ–¹çš„ç»“æŸæ¡ä»¶</strong>ï¼Œåè°ä¹Ÿæ— æ³•ç»“æŸã€‚</p>
<h4 id="é¿å…æ´»é”çš„æ–¹æ³•"><a href="#é¿å…æ´»é”çš„æ–¹æ³•" class="headerlink" title="é¿å…æ´»é”çš„æ–¹æ³•"></a>é¿å…æ´»é”çš„æ–¹æ³•</h4><p>åœ¨çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¸­é€”ç»™äºˆ<strong>ä¸åŒçš„é—´éš”æ—¶é—´</strong>å³å¯ã€‚</p>
<h4 id="æ­»é”ä¸æ´»é”çš„åŒºåˆ«"><a href="#æ­»é”ä¸æ´»é”çš„åŒºåˆ«" class="headerlink" title="æ­»é”ä¸æ´»é”çš„åŒºåˆ«"></a>æ­»é”ä¸æ´»é”çš„åŒºåˆ«</h4><ul>
<li>æ­»é”æ˜¯å› ä¸ºçº¿ç¨‹äº’ç›¸æŒæœ‰å¯¹è±¡æƒ³è¦çš„é”ï¼Œå¹¶ä¸”éƒ½ä¸é‡Šæ”¾ï¼Œæœ€ååˆ°æ—¶<strong>çº¿ç¨‹é˜»å¡</strong>ï¼Œ<strong>åœæ­¢è¿è¡Œ</strong>çš„ç°è±¡ã€‚</li>
<li>æ´»é”æ˜¯å› ä¸ºçº¿ç¨‹é—´ä¿®æ”¹äº†å¯¹æ–¹çš„ç»“æŸæ¡ä»¶ï¼Œè€Œå¯¼è‡´ä»£ç <strong>ä¸€ç›´åœ¨è¿è¡Œ</strong>ï¼Œå´ä¸€ç›´<strong>è¿è¡Œä¸å®Œ</strong>çš„ç°è±¡ã€‚</li>
</ul>
<h3 id="4-é¥¥é¥¿"><a href="#4-é¥¥é¥¿" class="headerlink" title="(4)é¥¥é¥¿"></a>(4)é¥¥é¥¿</h3><p>æŸäº›çº¿ç¨‹å› ä¸ºä¼˜å…ˆçº§å¤ªä½ï¼Œå¯¼è‡´ä¸€ç›´æ— æ³•è·å¾—èµ„æºçš„ç°è±¡ã€‚</p>
<p>åœ¨ä½¿ç”¨é¡ºåºåŠ é”æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°é¥¥é¥¿ç°è±¡</p>
<h2 id="12ã€ReentrantLock"><a href="#12ã€ReentrantLock" class="headerlink" title="12ã€ReentrantLock"></a>12ã€ReentrantLock</h2><p><strong>å’Œsynchronizedç›¸æ¯”å…·æœ‰çš„çš„ç‰¹ç‚¹</strong></p>
<ul>
<li>å¯ä¸­æ–­</li>
<li>å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´</li>
<li>å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é” (å…ˆåˆ°å…ˆå¾—)</li>
<li>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡( å…·æœ‰<strong>å¤šä¸ª</strong>waitset)</li>
</ul>
<p><strong>åŸºæœ¬è¯­æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;è·å–ReentrantLockå¯¹è±¡</span><br><span class="line">private ReentrantLock lock &#x3D; new ReentrantLock();</span><br><span class="line">&#x2F;&#x2F;åŠ é”</span><br><span class="line">lock.lock();</span><br><span class="line">try &#123;</span><br><span class="line">	&#x2F;&#x2F;éœ€è¦æ‰§è¡Œçš„ä»£ç </span><br><span class="line">&#125;finally &#123;</span><br><span class="line">	&#x2F;&#x2F;é‡Šæ”¾é”</span><br><span class="line">	lock.unlock();</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="å¯é‡å…¥"><a href="#å¯é‡å…¥" class="headerlink" title="å¯é‡å…¥"></a>å¯é‡å…¥</h4><ul>
<li>å¯é‡å…¥æ˜¯æŒ‡åŒä¸€ä¸ªçº¿ç¨‹å¦‚æœé¦–æ¬¡è·å¾—äº†è¿™æŠŠé”ï¼Œé‚£ä¹ˆå› ä¸ºå®ƒæ˜¯è¿™æŠŠé”çš„æ‹¥æœ‰è€…ï¼Œå› æ­¤æœ‰æƒåˆ©å†æ¬¡è·å–è¿™æŠŠé”</li>
<li>å¦‚æœæ˜¯ä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡è·å¾—é”æ—¶ï¼Œè‡ªå·±ä¹Ÿä¼šè¢«é”æŒ¡ä½</li>
</ul>
<h4 id="å¯æ‰“æ–­"><a href="#å¯æ‰“æ–­" class="headerlink" title="å¯æ‰“æ–­"></a>å¯æ‰“æ–­</h4><p>å¦‚æœæŸä¸ªçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¯ä»¥è°ƒç”¨å…¶interruptæ–¹æ³•è®©å…¶åœæ­¢é˜»å¡ï¼Œè·å¾—é”å¤±è´¥</p>
<p><strong>ç®€è€Œè¨€ä¹‹</strong>å°±æ˜¯ï¼šå¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼Œè¢«æ‰“æ–­äº†å°±ä¸ç”¨é˜»å¡äº†ï¼Œç›´æ¥åœæ­¢è¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">		ReentrantLock lock &#x3D; new ReentrantLock();</span><br><span class="line">		Thread t1 &#x3D; new Thread(()-&gt; &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				&#x2F;&#x2F;åŠ é”ï¼Œå¯æ‰“æ–­é”</span><br><span class="line">				lock.lockInterruptibly();</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">                &#x2F;&#x2F;è¢«æ‰“æ–­ï¼Œè¿”å›ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œ</span><br><span class="line">				return;</span><br><span class="line">			&#125;finally &#123;</span><br><span class="line">				&#x2F;&#x2F;é‡Šæ”¾é”</span><br><span class="line">				lock.unlock();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		lock.lock();</span><br><span class="line">		try &#123;</span><br><span class="line">			t1.start();</span><br><span class="line">			Thread.sleep(1000);</span><br><span class="line">			&#x2F;&#x2F;æ‰“æ–­</span><br><span class="line">			t1.interrupt();</span><br><span class="line">		&#125; catch (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="é”è¶…æ—¶"><a href="#é”è¶…æ—¶" class="headerlink" title="é”è¶…æ—¶"></a>é”è¶…æ—¶</h4><p>ä½¿ç”¨<strong>lock.tryLock</strong>æ–¹æ³•ä¼šè¿”å›è·å–é”æ˜¯å¦æˆåŠŸã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›trueï¼Œåä¹‹åˆ™è¿”å›falseã€‚</p>
<p>å¹¶ä¸”tryLockæ–¹æ³•å¯ä»¥<strong>æŒ‡å®šç­‰å¾…æ—¶é—´</strong>ï¼Œå‚æ•°ä¸ºï¼štryLock(long timeout, TimeUnit unit), å…¶ä¸­timeoutä¸ºæœ€é•¿ç­‰å¾…æ—¶é—´ï¼ŒTimeUnitä¸ºæ—¶é—´å•ä½</p>
<p><strong>ç®€è€Œè¨€ä¹‹</strong>å°±æ˜¯ï¼šè·å–å¤±è´¥äº†ã€è·å–è¶…æ—¶äº†æˆ–è€…è¢«æ‰“æ–­äº†ï¼Œä¸å†é˜»å¡ï¼Œç›´æ¥åœæ­¢è¿è¡Œ</p>
<p>ä¸è®¾ç½®ç­‰å¾…æ—¶é—´</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">		ReentrantLock lock &#x3D; new ReentrantLock();</span><br><span class="line">		Thread t1 &#x3D; new Thread(()-&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F;æœªè®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œä¸€æ—¦è·å–å¤±è´¥ï¼Œç›´æ¥è¿”å›false</span><br><span class="line">			if(!lock.tryLock()) &#123;</span><br><span class="line">				System.out.println(&quot;è·å–å¤±è´¥&quot;);</span><br><span class="line">                &#x2F;&#x2F;è·å–å¤±è´¥ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œï¼Œè¿”å›</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(&quot;å¾—åˆ°äº†é”&quot;);</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		lock.lock();</span><br><span class="line">		try&#123;</span><br><span class="line">			t1.start();</span><br><span class="line">			Thread.sleep(3000);</span><br><span class="line">		&#125; catch (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ç­‰å¾…æ—¶é—´</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">		ReentrantLock lock &#x3D; new ReentrantLock();</span><br><span class="line">		Thread t1 &#x3D; new Thread(()-&gt; &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				&#x2F;&#x2F;åˆ¤æ–­è·å–é”æ˜¯å¦æˆåŠŸï¼Œæœ€å¤šç­‰å¾…1ç§’</span><br><span class="line">				if(!lock.tryLock(1, TimeUnit.SECONDS)) &#123;</span><br><span class="line">					System.out.println(&quot;è·å–å¤±è´¥&quot;);</span><br><span class="line">					&#x2F;&#x2F;è·å–å¤±è´¥ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œï¼Œç›´æ¥è¿”å›</span><br><span class="line">					return;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">				&#x2F;&#x2F;è¢«æ‰“æ–­ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œï¼Œç›´æ¥è¿”å›</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(&quot;å¾—åˆ°äº†é”&quot;);</span><br><span class="line">			&#x2F;&#x2F;é‡Šæ”¾é”</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		lock.lock();</span><br><span class="line">		try&#123;</span><br><span class="line">			t1.start();</span><br><span class="line">			&#x2F;&#x2F;æ‰“æ–­ç­‰å¾…</span><br><span class="line">			t1.interrupt();</span><br><span class="line">			Thread.sleep(3000);</span><br><span class="line">		&#125; catch (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="å…¬å¹³é”"><a href="#å…¬å¹³é”" class="headerlink" title="å…¬å¹³é”"></a>å…¬å¹³é”</h4><p>åœ¨çº¿ç¨‹è·å–é”å¤±è´¥ï¼Œè¿›å…¥é˜»å¡é˜Ÿåˆ—æ—¶ï¼Œ<strong>å…ˆè¿›å…¥</strong>çš„ä¼šåœ¨é”è¢«é‡Šæ”¾å<strong>å…ˆè·å¾—</strong>é”ã€‚è¿™æ ·çš„è·å–æ–¹å¼å°±æ˜¯<strong>å…¬å¹³</strong>çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;é»˜è®¤æ˜¯ä¸å…¬å¹³é”ï¼Œéœ€è¦åœ¨åˆ›å»ºæ—¶æŒ‡å®šä¸ºå…¬å¹³é”</span><br><span class="line">ReentrantLock lock &#x3D; new ReentrantLock(true); </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="æ¡ä»¶å˜é‡"><a href="#æ¡ä»¶å˜é‡" class="headerlink" title="æ¡ä»¶å˜é‡"></a>æ¡ä»¶å˜é‡</h4><p>synchronized ä¸­ä¹Ÿæœ‰æ¡ä»¶å˜é‡ï¼Œå°±æ˜¯æˆ‘ä»¬è®²åŸç†æ—¶é‚£ä¸ª waitSet ä¼‘æ¯å®¤ï¼Œå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶è¿›å…¥waitSet ç­‰å¾…</p>
<p>ReentrantLock çš„æ¡ä»¶å˜é‡æ¯” synchronized å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œå®ƒæ˜¯æ”¯æŒ<strong>å¤šä¸ª</strong>æ¡ä»¶å˜é‡çš„ï¼Œè¿™å°±å¥½æ¯”</p>
<ul>
<li>synchronized æ˜¯é‚£äº›ä¸æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹éƒ½åœ¨ä¸€é—´ä¼‘æ¯å®¤ç­‰æ¶ˆæ¯</li>
<li>è€Œ ReentrantLock æ”¯æŒå¤šé—´ä¼‘æ¯å®¤ï¼Œæœ‰ä¸“é—¨ç­‰çƒŸçš„ä¼‘æ¯å®¤ã€ä¸“é—¨ç­‰æ—©é¤çš„ä¼‘æ¯å®¤ã€å”¤é†’æ—¶ä¹Ÿæ˜¯æŒ‰ä¼‘æ¯å®¤æ¥å”¤ é†’</li>
</ul>
<p>ä½¿ç”¨è¦ç‚¹ï¼š</p>
<ul>
<li>await å‰éœ€è¦<strong>è·å¾—é”</strong></li>
<li>await æ‰§è¡Œåï¼Œä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ conditionObject ç­‰å¾…</li>
<li>await çš„çº¿ç¨‹è¢«å”¤é†’ï¼ˆæˆ–æ‰“æ–­ã€æˆ–è¶…æ—¶ï¼‰å–é‡æ–°ç«äº‰ lock é”</li>
<li>ç«äº‰ lock é”æˆåŠŸåï¼Œä» await åç»§ç»­æ‰§</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">static Boolean judge &#x3D; false;</span><br><span class="line">public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">	ReentrantLock lock &#x3D; new ReentrantLock();</span><br><span class="line">	&#x2F;&#x2F;è·å¾—æ¡ä»¶å˜é‡</span><br><span class="line">	Condition condition &#x3D; lock.newCondition();</span><br><span class="line">	new Thread(()-&gt;&#123;</span><br><span class="line">		lock.lock();</span><br><span class="line">		try&#123;</span><br><span class="line">			while(!judge) &#123;</span><br><span class="line">				System.out.println(&quot;ä¸æ»¡è¶³æ¡ä»¶ï¼Œç­‰å¾…...&quot;);</span><br><span class="line">				&#x2F;&#x2F;ç­‰å¾…</span><br><span class="line">				condition.await();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			System.out.println(&quot;æ‰§è¡Œå®Œæ¯•ï¼&quot;);</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).start();</span><br><span class="line"></span><br><span class="line">	new Thread(()-&gt;&#123;</span><br><span class="line">		lock.lock();</span><br><span class="line">		try &#123;</span><br><span class="line">			Thread.sleep(1);</span><br><span class="line">			judge &#x3D; true;</span><br><span class="line">			&#x2F;&#x2F;é‡Šæ”¾</span><br><span class="line">			condition.signal();</span><br><span class="line">		&#125; catch (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;).start();</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”"><a href="#é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”" class="headerlink" title="é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”"></a>é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">public class MyLock implements Lock &#123;</span><br><span class="line">   private static class Sync extends AbstractQueuedSynchronizer &#123;</span><br><span class="line">      @Override</span><br><span class="line">      protected boolean tryAcquire(int arg) &#123;</span><br><span class="line">         if (getExclusiveOwnerThread() &#x3D;&#x3D; null) &#123;</span><br><span class="line">            if (compareAndSetState(0, 1)) &#123;</span><br><span class="line">               setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">               return true;</span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         if (getExclusiveOwnerThread() &#x3D;&#x3D; Thread.currentThread()) &#123;</span><br><span class="line">            int state &#x3D; getState();</span><br><span class="line">            compareAndSetState(state, state + 1);</span><br><span class="line">            return true;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         return false;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      @Override</span><br><span class="line">      protected boolean tryRelease(int arg) &#123;</span><br><span class="line">         if (getState() &lt;&#x3D; 0) &#123;</span><br><span class="line">            throw new IllegalMonitorStateException();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         if (getExclusiveOwnerThread() !&#x3D; Thread.currentThread()) &#123;</span><br><span class="line">            throw new IllegalMonitorStateException();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         int state &#x3D; getState();</span><br><span class="line">         if (state &#x3D;&#x3D; 1) &#123;</span><br><span class="line">            setExclusiveOwnerThread(null);</span><br><span class="line">            compareAndSetState(state, 0);</span><br><span class="line">         &#125; else &#123;</span><br><span class="line">            compareAndSetState(state, state - 1);</span><br><span class="line">         &#125;</span><br><span class="line">         return true;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      @Override</span><br><span class="line">      protected boolean isHeldExclusively() &#123;</span><br><span class="line">         return getState() &gt;&#x3D; 1;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      public Condition newCondition() &#123;</span><br><span class="line">         return new ConditionObject();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   Sync sync &#x3D; new Sync();</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public void lock() &#123;</span><br><span class="line">      sync.acquire(1);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public void lockInterruptibly() throws InterruptedException &#123;</span><br><span class="line">      sync.acquireInterruptibly(1);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public boolean tryLock() &#123;</span><br><span class="line">      return sync.tryAcquire(1);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public boolean tryLock(long time, TimeUnit unit) throws InterruptedException &#123;</span><br><span class="line">      return sync.tryAcquireNanos(1, time);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public void unlock() &#123;</span><br><span class="line">      sync.release(1);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public Condition newCondition() &#123;</span><br><span class="line">      return sync.newCondition();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Main &#123;</span><br><span class="line">   static int num &#x3D; 0;</span><br><span class="line">   public static void main(String[] args) throws InterruptedException, IOException &#123;</span><br><span class="line">      MyLock lock &#x3D; new MyLock();</span><br><span class="line"></span><br><span class="line">      Object syncLock &#x3D; new Object();</span><br><span class="line"></span><br><span class="line">      Thread t1 &#x3D; new Thread(() -&gt; &#123;</span><br><span class="line">         for (int i &#x3D; 0; i &lt; 10000; i++) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            try &#123;</span><br><span class="line">               lock.lock();</span><br><span class="line">               try &#123;</span><br><span class="line">                  lock.lock();</span><br><span class="line">                  try &#123;</span><br><span class="line">                     num++;</span><br><span class="line">                  &#125; finally &#123;</span><br><span class="line">                     lock.unlock();</span><br><span class="line">                  &#125;</span><br><span class="line">               &#125; finally &#123;</span><br><span class="line">                  lock.unlock();</span><br><span class="line">               &#125;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">               lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      Thread t2 &#x3D; new Thread(() -&gt; &#123;</span><br><span class="line">         for (int i &#x3D; 0; i &lt; 10000; i++) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            try &#123;</span><br><span class="line">               lock.lock();</span><br><span class="line">               try &#123;</span><br><span class="line">                  lock.lock();</span><br><span class="line">                  try &#123;</span><br><span class="line">                     num--;</span><br><span class="line">                  &#125; finally &#123;</span><br><span class="line">                     lock.unlock();</span><br><span class="line">                  &#125;</span><br><span class="line">               &#125; finally &#123;</span><br><span class="line">                  lock.unlock();</span><br><span class="line">               &#125;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">               lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      t1.start();</span><br><span class="line">      t2.start();</span><br><span class="line">      t1.join();</span><br><span class="line">      t2.join();</span><br><span class="line"></span><br><span class="line">      int x &#x3D; 0;</span><br><span class="line">   &#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="13ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶"><a href="#13ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶" class="headerlink" title="13ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶"></a>13ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶</h2><h3 id="Wait-Notifyç‰ˆæœ¬"><a href="#Wait-Notifyç‰ˆæœ¬" class="headerlink" title="Wait/Notifyç‰ˆæœ¬"></a>Wait/Notifyç‰ˆæœ¬</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">static final Object LOCK &#x3D; new Object();</span><br><span class="line">&#x2F;&#x2F;åˆ¤æ–­å…ˆæ‰§è¡Œçš„å†…å®¹æ˜¯å¦æ‰§è¡Œå®Œæ¯•</span><br><span class="line">static Boolean judge &#x3D; false;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">	new Thread(()-&gt;&#123;</span><br><span class="line">		synchronized (LOCK) &#123;</span><br><span class="line">			while (!judge) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					LOCK.wait();</span><br><span class="line">				&#125; catch (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(&quot;2&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).start();</span><br><span class="line"></span><br><span class="line">	new Thread(()-&gt;&#123;</span><br><span class="line">		synchronized (LOCK) &#123;</span><br><span class="line">			System.out.println(&quot;1&quot;);</span><br><span class="line">			judge &#x3D; true;</span><br><span class="line">               &#x2F;&#x2F;æ‰§è¡Œå®Œæ¯•ï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span><br><span class="line">			LOCK.notifyAll();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).start();</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="äº¤æ›¿è¾“å‡º"><a href="#äº¤æ›¿è¾“å‡º" class="headerlink" title="äº¤æ›¿è¾“å‡º"></a>äº¤æ›¿è¾“å‡º</h3><p><strong>wait/notifyç‰ˆæœ¬</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">public class Test4 &#123;</span><br><span class="line">	static Symbol symbol &#x3D; new Symbol();</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			symbol.run(&quot;a&quot;, 1, 2);</span><br><span class="line">		&#125;).start();</span><br><span class="line"></span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			symbol.run(&quot;b&quot;, 2, 3);</span><br><span class="line"></span><br><span class="line">		&#125;).start();</span><br><span class="line">		symbol.run(&quot;c&quot;, 3, 1);</span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line"></span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Symbol &#123;</span><br><span class="line">	public synchronized void run(String str, int flag, int nextFlag) &#123;</span><br><span class="line">		for(int i&#x3D;0; i&lt;loopNumber; i++) &#123;</span><br><span class="line">			while(flag !&#x3D; this.flag) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					this.wait();</span><br><span class="line">				&#125; catch (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(str);</span><br><span class="line">			&#x2F;&#x2F;è®¾ç½®ä¸‹ä¸€ä¸ªè¿è¡Œçš„çº¿ç¨‹æ ‡è®°</span><br><span class="line">			this.flag &#x3D; nextFlag;</span><br><span class="line">			&#x2F;&#x2F;å”¤é†’æ‰€æœ‰çº¿ç¨‹</span><br><span class="line">			this.notifyAll();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * çº¿ç¨‹çš„æ‰§è¡Œæ ‡è®°ï¼Œ 1-&gt;a 2-&gt;b 3-&gt;c</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	private int flag &#x3D; 1;</span><br><span class="line">	private int loopNumber &#x3D; 5;</span><br><span class="line"></span><br><span class="line">	public int getFlag() &#123;</span><br><span class="line">		return flag;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setFlag(int flag) &#123;</span><br><span class="line">		this.flag &#x3D; flag;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public int getLoopNumber() &#123;</span><br><span class="line">		return loopNumber;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setLoopNumber(int loopNumber) &#123;</span><br><span class="line">		this.loopNumber &#x3D; loopNumber;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>await/signalç‰ˆæœ¬</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">public class Test5 &#123;</span><br><span class="line">	static AwaitSignal awaitSignal &#x3D; new AwaitSignal();</span><br><span class="line">	static Condition conditionA &#x3D; awaitSignal.newCondition();</span><br><span class="line">	static Condition conditionB &#x3D; awaitSignal.newCondition();</span><br><span class="line">	static Condition conditionC &#x3D; awaitSignal.newCondition();</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			awaitSignal.run(&quot;a&quot;, conditionA, conditionB);</span><br><span class="line">		&#125;).start();</span><br><span class="line"></span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			awaitSignal.run(&quot;b&quot;, conditionB, conditionC);</span><br><span class="line">		&#125;).start();</span><br><span class="line"></span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			awaitSignal.run(&quot;c&quot;, conditionC, conditionA);</span><br><span class="line">		&#125;).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		try &#123;</span><br><span class="line">			Thread.sleep(1000);</span><br><span class="line">		&#125; catch (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		awaitSignal.lock();</span><br><span class="line">		try &#123;</span><br><span class="line">            &#x2F;&#x2F;å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹</span><br><span class="line">			conditionA.signal();</span><br><span class="line">		&#125;finally &#123;</span><br><span class="line">			awaitSignal.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class AwaitSignal extends ReentrantLock&#123;</span><br><span class="line">	public void run(String str, Condition thisCondition, Condition nextCondition) &#123;</span><br><span class="line">		for(int i&#x3D;0; i&lt;loopNumber; i++) &#123;</span><br><span class="line">			lock();</span><br><span class="line">			try &#123;</span><br><span class="line">                &#x2F;&#x2F;å…¨éƒ¨è¿›å…¥ç­‰å¾…çŠ¶æ€</span><br><span class="line">				thisCondition.await();</span><br><span class="line">				System.out.print(str);</span><br><span class="line">				nextCondition.signal();</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; finally &#123;</span><br><span class="line">				unlock();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private int loopNumber&#x3D;5;</span><br><span class="line"></span><br><span class="line">	public int getLoopNumber() &#123;</span><br><span class="line">		return loopNumber;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setLoopNumber(int loopNumber) &#123;</span><br><span class="line">		this.loopNumber &#x3D; loopNumber;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="14ã€ThreadLocal"><a href="#14ã€ThreadLocal" class="headerlink" title="14ã€ThreadLocal"></a>14ã€ThreadLocal</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ThreadLocalæ˜¯JDKåŒ…æä¾›çš„ï¼Œå®ƒæä¾›äº†çº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œé‚£ä¹ˆ<strong>è®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„ä¸€ä¸ªæœ¬åœ°å‰¯æœ¬</strong>ã€‚å½“å¤šä¸ªçº¿ç¨‹æ“ä½œè¿™ä¸ªå˜é‡æ—¶ï¼Œå®é™…æ“ä½œçš„æ˜¯è‡ªå·±æœ¬åœ°å†…å­˜é‡Œé¢çš„å˜é‡ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜</p>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">public class ThreadLocalStudy &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      &#x2F;&#x2F; åˆ›å»ºThreadLocalå˜é‡</span><br><span class="line">      ThreadLocal&lt;String&gt; stringThreadLocal &#x3D; new ThreadLocal&lt;&gt;();</span><br><span class="line">      ThreadLocal&lt;User&gt; userThreadLocal &#x3D; new ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸Šé¢çš„ä¸¤ä¸ªThreadLocalå˜é‡</span><br><span class="line">      Thread thread1 &#x3D; new Thread(()-&gt;&#123;</span><br><span class="line">         &#x2F;&#x2F; stringThreadLocalç¬¬ä¸€æ¬¡èµ‹å€¼</span><br><span class="line">         stringThreadLocal.set(&quot;thread1 stringThreadLocal first&quot;);</span><br><span class="line">         &#x2F;&#x2F; stringThreadLocalç¬¬äºŒæ¬¡èµ‹å€¼</span><br><span class="line">         stringThreadLocal.set(&quot;thread1 stringThreadLocal second&quot;);</span><br><span class="line">         &#x2F;&#x2F; userThreadLocalèµ‹å€¼</span><br><span class="line">         userThreadLocal.set(new User(&quot;Nyima&quot;, 20));</span><br><span class="line"></span><br><span class="line">         &#x2F;&#x2F; å–å€¼</span><br><span class="line">         System.out.println(stringThreadLocal.get());</span><br><span class="line">         System.out.println(userThreadLocal.get());</span><br><span class="line">          </span><br><span class="line">          &#x2F;&#x2F; ç§»é™¤</span><br><span class="line">		 userThreadLocal.remove();</span><br><span class="line">		 System.out.println(userThreadLocal.get());</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      Thread thread2 &#x3D; new Thread(()-&gt;&#123;</span><br><span class="line">         &#x2F;&#x2F; stringThreadLocalç¬¬ä¸€æ¬¡èµ‹å€¼</span><br><span class="line">         stringThreadLocal.set(&quot;thread2 stringThreadLocal first&quot;);</span><br><span class="line">         &#x2F;&#x2F; stringThreadLocalç¬¬äºŒæ¬¡èµ‹å€¼</span><br><span class="line">         stringThreadLocal.set(&quot;thread2 stringThreadLocal second&quot;);</span><br><span class="line">         &#x2F;&#x2F; userThreadLocalèµ‹å€¼</span><br><span class="line">         userThreadLocal.set(new User(&quot;Hulu&quot;, 20));</span><br><span class="line"></span><br><span class="line">         &#x2F;&#x2F; å–å€¼</span><br><span class="line">         System.out.println(stringThreadLocal.get());</span><br><span class="line">         System.out.println(userThreadLocal.get());</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; å¯åŠ¨çº¿ç¨‹</span><br><span class="line">      thread1.start();</span><br><span class="line">      thread2.start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class User &#123;</span><br><span class="line">   String name;</span><br><span class="line">   int age;</span><br><span class="line"></span><br><span class="line">   public User(String name, int age) &#123;</span><br><span class="line">      this.name &#x3D; name;</span><br><span class="line">      this.age &#x3D; age;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public String toString() &#123;</span><br><span class="line">      return &quot;User&#123;&quot; +</span><br><span class="line">            &quot;name&#x3D;&#39;&quot; + name + &#39;\&#39;&#39; +</span><br><span class="line">            &quot;, age&#x3D;&quot; + age +</span><br><span class="line">            &#39;&#125;&#39;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>è¿è¡Œç»“æœ</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">thread1 stringThreadLocal second</span><br><span class="line">thread2 stringThreadLocal second</span><br><span class="line">User&#123;name&#x3D;&#39;Nyima&#39;, age&#x3D;20&#125;</span><br><span class="line">User&#123;name&#x3D;&#39;Hulu&#39;, age&#x3D;20&#125;</span><br><span class="line">null </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡º</p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹ä¸­çš„ThreadLocalå˜é‡æ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„ï¼Œè€Œä¸æ˜¯å…±äº«çš„<ul>
<li>ä»çº¿ç¨‹1å’Œçº¿ç¨‹2çš„æ‰“å°ç»“æœå¯ä»¥çœ‹å‡º</li>
</ul>
</li>
<li>ThreadLocalå…¶å®å°±ç›¸å½“äºå…¶æ³›å‹ç±»å‹çš„ä¸€ä¸ªå˜é‡ï¼Œåªä¸è¿‡æ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„<ul>
<li>stringThreadLocalè¢«èµ‹å€¼äº†ä¸¤æ¬¡ï¼Œä¿å­˜çš„æ˜¯æœ€åä¸€æ¬¡èµ‹å€¼çš„ç»“æœ</li>
</ul>
</li>
<li>ThreadLocalå¯ä»¥è¿›è¡Œä»¥ä¸‹å‡ ä¸ªæ“ä½œ<ul>
<li>set è®¾ç½®å€¼</li>
<li>get å–å‡ºå€¼</li>
<li>remove ç§»é™¤å€¼</li>
</ul>
</li>
</ul>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="Threadä¸­çš„threadLocals"><a href="#Threadä¸­çš„threadLocals" class="headerlink" title="Threadä¸­çš„threadLocals"></a>Threadä¸­çš„threadLocals</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class Thread implements Runnable &#123;</span><br><span class="line"> ...</span><br><span class="line"></span><br><span class="line"> ThreadLocal.ThreadLocalMap threadLocals &#x3D; null;</span><br><span class="line"></span><br><span class="line"> &#x2F;&#x2F; æ”¾åœ¨åé¢è¯´</span><br><span class="line"> ThreadLocal.ThreadLocalMap inheritableThreadLocals &#x3D; null;</span><br><span class="line"></span><br><span class="line"> ...</span><br><span class="line">&#125;Copy</span><br><span class="line">static class ThreadLocalMap &#123;</span><br><span class="line">    static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">        &#x2F;** The value associated with this ThreadLocal. *&#x2F;</span><br><span class="line">        Object value;</span><br><span class="line"></span><br><span class="line">        Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">            super(k);</span><br><span class="line">            value &#x3D; v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºThreadç±»ä¸­æœ‰ä¸€ä¸ªthreadLocalså’Œä¸€ä¸ªinheritableThreadLocalsï¼Œå®ƒä»¬éƒ½æ˜¯ThreadLocalMapç±»å‹çš„å˜é‡ï¼Œè€ŒThreadLocalMapæ˜¯ä¸€ä¸ªå®šåˆ¶åŒ–çš„Hashmapã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­çš„è¿™ä¸¤ä¸ªå˜é‡éƒ½ä¸ºnullã€‚æ­¤å¤„å…ˆè®¨è®ºthreadLocalsï¼ŒinheritableThreadLocalsæ”¾åœ¨åé¢è®¨è®º</p>
<h4 id="ThreadLocalä¸­çš„æ–¹æ³•"><a href="#ThreadLocalä¸­çš„æ–¹æ³•" class="headerlink" title="ThreadLocalä¸­çš„æ–¹æ³•"></a><strong>ThreadLocalä¸­çš„æ–¹æ³•</strong></h4><p><strong>setæ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public void set(T value) &#123;</span><br><span class="line">    &#x2F;&#x2F; è·å–å½“å‰çº¿ç¨‹</span><br><span class="line">    Thread t &#x3D; Thread.currentThread();</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; è·å¾—ThreadLocalMapå¯¹è±¡ </span><br><span class="line">    &#x2F;&#x2F; è¿™é‡Œçš„getä¼šè¿”å›Threadç±»ä¸­çš„threadLocals</span><br><span class="line">    ThreadLocalMap map &#x3D; getMap(t);</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; åˆ¤æ–­mapæ˜¯å¦å·²ç»åˆ›å»ºï¼Œæ²¡åˆ›å»ºå°±åˆ›å»ºå¹¶æ”¾å…¥å€¼ï¼Œåˆ›å»ºäº†å°±ç›´æ¥æ”¾å…¥</span><br><span class="line">    if (map !&#x3D; null)</span><br><span class="line">        &#x2F;&#x2F; ThreadLocalè‡ªç”Ÿçš„å¼•ç”¨ä½œä¸ºkeyï¼Œä¼ å…¥çš„å€¼ä½œä¸ºvalue</span><br><span class="line">        map.set(this, value);</span><br><span class="line">    else</span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœæœªåˆ›å»º</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void createMap(Thread t, T firstValue) &#123;</span><br><span class="line">    &#x2F;&#x2F; åˆ›å»ºçš„åŒæ—¶è®¾ç½®æƒ³æ”¾å…¥çš„å€¼</span><br><span class="line">    &#x2F;&#x2F; hreadLocalè‡ªç”Ÿçš„å¼•ç”¨ä½œä¸ºkeyï¼Œä¼ å…¥çš„å€¼ä½œä¸ºvalue</span><br><span class="line">    t.threadLocals &#x3D; new ThreadLocalMap(this, firstValue);</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>getæ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public T get() &#123;</span><br><span class="line">    &#x2F;&#x2F; è·å–å½“å‰çº¿ç¨‹</span><br><span class="line">    Thread t &#x3D; Thread.currentThread();</span><br><span class="line">	&#x2F;&#x2F; è·å–å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡</span><br><span class="line">    ThreadLocalMap map &#x3D; getMap(t);</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; åˆ¤æ–­threadLocalsæ˜¯å¦è¢«åˆå§‹åŒ–äº†</span><br><span class="line">    if (map !&#x3D; null) &#123;</span><br><span class="line">        &#x2F;&#x2F; å·²ç»åˆå§‹åŒ–åˆ™ç›´æ¥è¿”å›</span><br><span class="line">        ThreadLocalMap.Entry e &#x3D; map.getEntry(this);</span><br><span class="line">        if (e !&#x3D; null) &#123;</span><br><span class="line">            @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">            T result &#x3D; (T)e.value;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; å¦åˆ™å°±åˆ›å»ºthreadLocals</span><br><span class="line">    return setInitialValue();</span><br><span class="line">&#125;Copy</span><br><span class="line">private T setInitialValue() &#123;</span><br><span class="line">    &#x2F;&#x2F; è¿™ä¸ªæ–¹æ³•è¿”å›æ˜¯null</span><br><span class="line">    T value &#x3D; initialValue();</span><br><span class="line">    Thread t &#x3D; Thread.currentThread();</span><br><span class="line">    ThreadLocalMap map &#x3D; getMap(t);</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; æ— è®ºmapåˆ›å»ºä¸å¦ï¼Œæœ€ç»ˆvalueçš„å€¼éƒ½ä¸ºnull</span><br><span class="line">    if (map !&#x3D; null)</span><br><span class="line">        map.set(this, value);</span><br><span class="line">    else</span><br><span class="line">        createMap(t, value);</span><br><span class="line">    return value;</span><br><span class="line">&#125;Copy</span><br><span class="line">protected T initialValue() &#123;</span><br><span class="line">    return null;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>removeæ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void remove() &#123;</span><br><span class="line">    ThreadLocalMap m &#x3D; getMap(Thread.currentThread());</span><br><span class="line">    if (m !&#x3D; null)</span><br><span class="line">        &#x2F;&#x2F; å¦‚æœthreadLocalså·²ç»è¢«åˆå§‹åŒ–ï¼Œåˆ™ç§»é™¤</span><br><span class="line">        m.remove(this);</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h4><p>åœ¨æ¯ä¸ªçº¿ç¨‹å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªåä¸ºthreadLocalsçš„æˆå‘˜å˜é‡ï¼Œè¯¥å˜é‡çš„ç±»å‹ä¸ºHashMapï¼Œå…¶ä¸­<strong>keyä¸ºæˆ‘ä»¬å®šä¹‰çš„ThreadLocalå˜é‡çš„thiså¼•ç”¨ï¼Œvalueåˆ™ä¸ºæˆ‘ä»¬ä½¿ç”¨setæ–¹æ³•è®¾ç½®çš„å€¼</strong>ã€‚æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡å­˜æ”¾åœ¨çº¿ç¨‹è‡ªå·±çš„å†…å­˜å˜é‡threadLocalsä¸­</p>
<p>åªæœ‰å½“å‰çº¿ç¨‹<strong>ç¬¬ä¸€æ¬¡è°ƒç”¨ThreadLocalçš„setæˆ–è€…getæ–¹æ³•æ—¶æ‰ä¼šåˆ›å»ºthreadLocals</strong>ï¼ˆinheritableThreadLocalsä¹Ÿæ˜¯ä¸€æ ·ï¼‰ã€‚å…¶å®æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡ä¸æ˜¯å­˜æ”¾åœ¨ThreadLocalå®ä¾‹é‡Œé¢ï¼Œè€Œæ˜¯å­˜æ”¾åœ¨è°ƒç”¨çº¿ç¨‹çš„threadLocalså˜é‡é‡Œé¢</p>
<h2 id="15ã€InheritableThreadLocal"><a href="#15ã€InheritableThreadLocal" class="headerlink" title="15ã€InheritableThreadLocal"></a>15ã€InheritableThreadLocal</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ä»ThreadLocalçš„æºç å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºæ˜¯setã€getã€è¿˜æ˜¯removeï¼Œéƒ½æ˜¯ç›¸å¯¹äºå½“å‰çº¿ç¨‹æ“ä½œçš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread.currentThread()Copy</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ThreadLocalæ— æ³•ä»çˆ¶çº¿ç¨‹ä¼ å‘å­çº¿ç¨‹ï¼Œæ‰€ä»¥InheritableThreadLocalå‡ºç°äº†ï¼Œ<strong>å®ƒèƒ½å¤Ÿè®©çˆ¶çº¿ç¨‹ä¸­ThreadLocalçš„å€¼ä¼ ç»™å­çº¿ç¨‹ã€‚</strong></p>
<p>ä¹Ÿå°±æ˜¯ä»mainæ‰€åœ¨çš„çº¿ç¨‹ï¼Œä¼ ç»™thread1æˆ–thread2</p>
<h3 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class Demo1 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      ThreadLocal&lt;String&gt; stringThreadLocal &#x3D; new ThreadLocal&lt;&gt;();</span><br><span class="line">      InheritableThreadLocal&lt;String&gt; stringInheritable &#x3D; new InheritableThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; ä¸»çº¿ç¨‹èµ‹å¯¹ä¸Šé¢ä¸¤ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼</span><br><span class="line">      stringThreadLocal.set(&quot;this is threadLocal&quot;);</span><br><span class="line">      stringInheritable.set(&quot;this is inheritableThreadLocal&quot;);</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; åˆ›å»ºçº¿ç¨‹</span><br><span class="line">      Thread thread1 &#x3D; new Thread(()-&gt;&#123;</span><br><span class="line">         &#x2F;&#x2F; è·å¾—ThreadLocalä¸­å­˜æ”¾çš„å€¼</span><br><span class="line">         System.out.println(stringThreadLocal.get());</span><br><span class="line"></span><br><span class="line">         &#x2F;&#x2F; è·å¾—InheritableThreadLocalå­˜æ”¾çš„å€¼</span><br><span class="line">         System.out.println(stringInheritable.get());</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      thread1.start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>è¿è¡Œç»“æœ</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">null</span><br><span class="line">this is inheritableThreadLocal </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºInheritableThreadLocalçš„å€¼æˆåŠŸä»ä¸»çº¿ç¨‹ä¼ å…¥äº†å­çº¿ç¨‹ï¼Œè€ŒThreadLocalåˆ™æ²¡æœ‰</p>
<h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="InheritableThreadLocal"><a href="#InheritableThreadLocal" class="headerlink" title="InheritableThreadLocal"></a>InheritableThreadLocal</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class InheritableThreadLocal&lt;T&gt; extends ThreadLocal&lt;T&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; ä¼ å…¥çˆ¶çº¿ç¨‹ä¸­çš„ä¸€ä¸ªå€¼ï¼Œç„¶åç›´æ¥è¿”å›</span><br><span class="line">    protected T childValue(T parentValue) &#123;</span><br><span class="line">        return parentValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	&#x2F;&#x2F; è¿”å›ä¼ å…¥çº¿ç¨‹çš„inheritableThreadLocals</span><br><span class="line">    &#x2F;&#x2F; Threadä¸­æœ‰ä¸€ä¸ªinheritableThreadLocalså˜é‡</span><br><span class="line">    &#x2F;&#x2F; ThreadLocal.ThreadLocalMap inheritableThreadLocals &#x3D; null;</span><br><span class="line">    ThreadLocalMap getMap(Thread t) &#123;</span><br><span class="line">       return t.inheritableThreadLocals;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> 	&#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªinheritableThreadLocals</span><br><span class="line">    void createMap(Thread t, T firstValue) &#123;</span><br><span class="line">        t.inheritableThreadLocals &#x3D; new ThreadLocalMap(this, firstValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ç”±å¦‚ä¸Šä»£ç å¯çŸ¥ï¼ŒInheritableThreadLocalç»§æ‰¿äº†ThreadLocalï¼Œå¹¶é‡å†™äº†ä¸‰ä¸ªæ–¹æ³•ã€‚InheritableThreadLocalé‡å†™äº†<strong>createMapæ–¹æ³•</strong>ï¼Œé‚£ä¹ˆç°åœ¨å½“ç¬¬ä¸€æ¬¡è°ƒç”¨setæ–¹æ³•æ—¶ï¼Œåˆ›å»ºçš„æ˜¯å½“å‰çº¿ç¨‹çš„inheritableThreadLocalså˜é‡çš„å®ä¾‹è€Œä¸å†æ˜¯threadLocalsã€‚å½“è°ƒç”¨<strong>getMapæ–¹æ³•</strong>è·å–å½“å‰çº¿ç¨‹å†…éƒ¨çš„mapå˜é‡æ—¶ï¼Œè·å–çš„æ˜¯inheritableThreadLocalsè€Œä¸å†æ˜¯threadLocals</p>
<h4 id="childValue-T-parentValue-æ–¹æ³•çš„è°ƒç”¨"><a href="#childValue-T-parentValue-æ–¹æ³•çš„è°ƒç”¨" class="headerlink" title="childValue(T parentValue)æ–¹æ³•çš„è°ƒç”¨"></a>childValue(T parentValue)æ–¹æ³•çš„è°ƒç”¨</h4><p>åœ¨ä¸»å‡½æ•°è¿è¡Œæ—¶ï¼Œä¼šè°ƒç”¨Threadçš„é»˜è®¤æ„é€ å‡½æ•°ï¼ˆ<strong>åˆ›å»ºä¸»çº¿ç¨‹</strong>ï¼Œä¹Ÿå°±æ˜¯çˆ¶çº¿ç¨‹ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹çœ‹Threadçš„é»˜è®¤æ„é€ å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public Thread() &#123;</span><br><span class="line">    init(null, null, &quot;Thread-&quot; + nextThreadNum(), 0);</span><br><span class="line">&#125;Copy</span><br><span class="line">private void init(ThreadGroup g, Runnable target, String name,</span><br><span class="line">                  long stackSize, AccessControlContext acc,</span><br><span class="line">                  boolean inheritThreadLocals) &#123;</span><br><span class="line">   	...</span><br><span class="line">        </span><br><span class="line">	&#x2F;&#x2F; è·å¾—å½“å‰çº¿ç¨‹çš„ï¼Œåœ¨è¿™é‡Œæ˜¯ä¸»çº¿ç¨‹</span><br><span class="line">    Thread parent &#x3D; currentThread();</span><br><span class="line">   </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; å¦‚æœçˆ¶çº¿ç¨‹çš„inheritableThreadLocalså­˜åœ¨</span><br><span class="line">    &#x2F;&#x2F; æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨setå’Œgetæ—¶ï¼Œä¼šåˆ›å»ºinheritableThreadLocals</span><br><span class="line">    if (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals !&#x3D; null)</span><br><span class="line">        &#x2F;&#x2F; è®¾ç½®å­çº¿ç¨‹çš„inheritableThreadLocals</span><br><span class="line">        this.inheritableThreadLocals &#x3D;</span><br><span class="line">            ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);</span><br><span class="line">    </span><br><span class="line">    &#x2F;* Stash the specified stack size in case the VM cares *&#x2F;</span><br><span class="line">    this.stackSize &#x3D; stackSize;</span><br><span class="line"></span><br><span class="line">    &#x2F;* Set thread ID *&#x2F;</span><br><span class="line">    tid &#x3D; nextThreadID();</span><br><span class="line">&#125;Copy</span><br><span class="line">static ThreadLocalMap createInheritedMap(ThreadLocalMap parentMap) &#123;</span><br><span class="line">    return new ThreadLocalMap(parentMap);</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>åœ¨createInheritedMapå†…éƒ¨ä½¿ç”¨çˆ¶çº¿ç¨‹çš„inheritableThreadLocalså˜é‡ä½œä¸ºæ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ThreadLocalMapå˜é‡ï¼Œç„¶åèµ‹å€¼ç»™äº†å­çº¿ç¨‹çš„inheritableThreadLocalså˜é‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">private ThreadLocalMap(ThreadLocalMap parentMap) &#123;</span><br><span class="line">    Entry[] parentTable &#x3D; parentMap.table;</span><br><span class="line">    int len &#x3D; parentTable.length;</span><br><span class="line">    setThreshold(len);</span><br><span class="line">    table &#x3D; new Entry[len];</span><br><span class="line"></span><br><span class="line">    for (int j &#x3D; 0; j &lt; len; j++) &#123;</span><br><span class="line">        Entry e &#x3D; parentTable[j];</span><br><span class="line">        if (e !&#x3D; null) &#123;</span><br><span class="line">            @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">            ThreadLocal&lt;Object&gt; key &#x3D; (ThreadLocal&lt;Object&gt;) e.get();</span><br><span class="line">            if (key !&#x3D; null) &#123;</span><br><span class="line">                &#x2F;&#x2F; è¿™é‡Œè°ƒç”¨äº† childValue æ–¹æ³•</span><br><span class="line">                &#x2F;&#x2F; è¯¥æ–¹æ³•ä¼šè¿”å›parentçš„å€¼</span><br><span class="line">                Object value &#x3D; key.childValue(e.value);</span><br><span class="line">                </span><br><span class="line">                Entry c &#x3D; new Entry(key, value);</span><br><span class="line">                int h &#x3D; key.threadLocalHashCode &amp; (len - 1);</span><br><span class="line">                while (table[h] !&#x3D; null)</span><br><span class="line">                    h &#x3D; nextIndex(h, len);</span><br><span class="line">                table[h] &#x3D; c;</span><br><span class="line">                size++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥æ„é€ å‡½æ•°å†…éƒ¨æŠŠçˆ¶çº¿ç¨‹çš„inheritableThreadLocalsæˆå‘˜å˜é‡çš„å€¼å¤åˆ¶åˆ°æ–°çš„ThreadLocalMapå¯¹è±¡ä¸­</p>
<h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>InheritableThreadLocalç±»é€šè¿‡é‡å†™getMapå’ŒcreateMapï¼Œè®©æœ¬åœ°å˜é‡ä¿å­˜åˆ°äº†å…·ä½“çº¿ç¨‹çš„inheritableThreadLocalså˜é‡é‡Œé¢ï¼Œé‚£ä¹ˆçº¿ç¨‹åœ¨é€šè¿‡InheritableThreadLocalç±»å®ä¾‹çš„setæˆ–è€…getæ–¹æ³•è®¾ç½®å˜é‡æ—¶ï¼Œå°±ä¼šåˆ›å»ºå½“å‰çº¿ç¨‹çš„inheritableThreadLocalså˜é‡ã€‚</p>
<p><strong>å½“çˆ¶çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œæ„é€ å‡½æ•°ä¼šæŠŠçˆ¶çº¿ç¨‹ä¸­inheritableThreadLocalså˜é‡é‡Œé¢çš„æœ¬åœ°å˜é‡å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å­çº¿ç¨‹çš„inheritableThreadLocalså˜é‡é‡Œé¢ã€‚</strong></p>
<h1 id="å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜"><a href="#å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜" class="headerlink" title="å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜"></a>å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜</h1><h2 id="1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"><a href="#1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰" class="headerlink" title="1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"></a>1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰</h2><p>JMM å³ Java Memory Modelï¼Œå®ƒå®šä¹‰äº†<strong>ä¸»å­˜ï¼ˆå…±äº«å†…å­˜ï¼‰ã€å·¥ä½œå†…å­˜ï¼ˆçº¿ç¨‹ç§æœ‰ï¼‰</strong>æŠ½è±¡æ¦‚å¿µï¼Œåº•å±‚å¯¹åº”ç€ CPU å¯„å­˜å™¨ã€ç¼“å­˜ã€ç¡¬ä»¶å†…å­˜ã€ CPU æŒ‡ä»¤ä¼˜åŒ–ç­‰ã€‚</p>
<p><strong>JMMä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢</strong></p>
<ul>
<li>åŸå­æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå—åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å½±å“</li>
<li>å¯è§æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu ç¼“å­˜çš„å½±å“</li>
<li>æœ‰åºæ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu æŒ‡ä»¤å¹¶è¡Œä¼˜åŒ–çš„å½±å“</li>
</ul>
<h2 id="2ã€å¯è§æ€§"><a href="#2ã€å¯è§æ€§" class="headerlink" title="2ã€å¯è§æ€§"></a>2ã€å¯è§æ€§</h2><h4 id="å¼•ä¾‹"><a href="#å¼•ä¾‹" class="headerlink" title="å¼•ä¾‹"></a>å¼•ä¾‹</h4><p><strong>é€€å‡ºä¸å‡ºçš„å¾ªç¯</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">static Boolean run &#x3D; true;</span><br><span class="line">	public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">		new Thread(()-&gt;&#123;</span><br><span class="line">			while (run) &#123;</span><br><span class="line">				&#x2F;&#x2F;å¦‚æœrunä¸ºçœŸï¼Œåˆ™ä¸€ç›´æ‰§è¡Œ</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).start();</span><br><span class="line"></span><br><span class="line">		Thread.sleep(1000);</span><br><span class="line">		System.out.println(&quot;æ”¹å˜runçš„å€¼ä¸ºfalse&quot;);</span><br><span class="line">		run &#x3D; false;</span><br><span class="line">	&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆæ— æ³•é€€å‡ºè¯¥å¾ªç¯</strong></p>
<ul>
<li>åˆå§‹çŠ¶æ€ï¼Œ t çº¿ç¨‹åˆšå¼€å§‹ä»<strong>ä¸»å†…å­˜</strong>è¯»å–äº† run çš„å€¼åˆ°<strong>å·¥ä½œå†…å­˜</strong>ã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145505.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145505.png" alt="img"></a></p>
<ul>
<li>å› ä¸º t çº¿ç¨‹è¦é¢‘ç¹ä»ä¸»å†…å­˜ä¸­è¯»å– run çš„å€¼ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°† run çš„å€¼<strong>ç¼“å­˜è‡³è‡ªå·±å·¥ä½œå†…å­˜</strong>ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œ å‡å°‘å¯¹ä¸»å­˜ä¸­ run çš„è®¿é—®ï¼Œæé«˜æ•ˆç‡</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145517.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145517.png" alt="img"></a></p>
<ul>
<li>1 ç§’ä¹‹åï¼Œmain çº¿ç¨‹ä¿®æ”¹äº† run çš„å€¼ï¼Œå¹¶åŒæ­¥è‡³ä¸»å­˜ï¼Œè€Œ t æ˜¯ä»è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­è¯»å–è¿™ä¸ªå˜é‡ çš„å€¼ï¼Œç»“æœæ°¸è¿œæ˜¯<strong>æ—§å€¼</strong></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145529.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145529.png" alt="img"></a></p>
<p><strong>è§£å†³æ–¹æ³•</strong></p>
<ul>
<li>ä½¿ç”¨<strong>volatile</strong>æ˜“å˜å…³é”®å­—</li>
<li>å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°<strong>æˆå‘˜å˜é‡</strong>å’Œ<strong>é™æ€æˆå‘˜å˜é‡</strong>ï¼ˆæ”¾åœ¨ä¸»å­˜ä¸­çš„å˜é‡ï¼‰ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­è·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯<strong>ç›´æ¥æ“ä½œä¸»å­˜</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ä½¿ç”¨æ˜“å˜å…³é”®å­—</span><br><span class="line">volatile static Boolean run &#x3D; true;</span><br><span class="line">public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">	new Thread(()-&gt;&#123;</span><br><span class="line">		while (run) &#123;</span><br><span class="line">			&#x2F;&#x2F;å¦‚æœrunä¸ºçœŸï¼Œåˆ™ä¸€ç›´æ‰§è¡Œ</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).start();</span><br><span class="line"></span><br><span class="line">	Thread.sleep(1000);</span><br><span class="line">	System.out.println(&quot;æ”¹å˜runçš„å€¼ä¸ºfalse&quot;);</span><br><span class="line">	run &#x3D; false;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="å¯è§æ€§ä¸åŸå­æ€§"><a href="#å¯è§æ€§ä¸åŸå­æ€§" class="headerlink" title="å¯è§æ€§ä¸åŸå­æ€§"></a>å¯è§æ€§ä¸åŸå­æ€§</h4><p>å‰é¢ä¾‹å­ä½“ç°çš„å®é™…å°±æ˜¯<strong>å¯è§æ€§</strong>ï¼Œå®ƒä¿è¯çš„æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹<strong>volatileå˜é‡</strong>çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œ <strong>ä¸èƒ½</strong>ä¿è¯åŸå­æ€§ï¼Œä»…ç”¨åœ¨<strong>ä¸€ä¸ªå†™</strong>çº¿ç¨‹ï¼Œ<strong>å¤šä¸ªè¯»</strong>çº¿ç¨‹çš„æƒ…å†µ</p>
<ul>
<li><p>æ³¨æ„ synchronized è¯­å¥å—æ—¢å¯ä»¥ä¿è¯ä»£ç å—çš„<strong>åŸå­æ€§</strong>ï¼Œä¹ŸåŒæ—¶ä¿è¯ä»£ç å—å†…å˜é‡çš„<strong>å¯è§æ€§</strong>ã€‚</p>
</li>
<li><p>ä½†ç¼ºç‚¹æ˜¯ synchronized æ˜¯å±äº<strong>é‡é‡çº§</strong>æ“ä½œï¼Œæ€§èƒ½ç›¸å¯¹æ›´ä½ã€‚</p>
</li>
<li><p>å¦‚æœåœ¨å‰é¢ç¤ºä¾‹çš„æ­»å¾ªç¯ä¸­åŠ å…¥ System.out.println() ä¼šå‘ç°å³ä½¿ä¸åŠ  volatile ä¿®é¥°ç¬¦ï¼Œçº¿ç¨‹ t ä¹Ÿèƒ½æ­£ç¡®çœ‹åˆ° å¯¹ run å˜é‡çš„ä¿®æ”¹äº†ï¼Œæƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆï¼Ÿ</p>
<ul>
<li><p>å› ä¸ºä½¿ç”¨äº†<strong>synchronized</strong>å…³é”®å­—</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void println(String x) &#123;</span><br><span class="line">		&#x2F;&#x2F;ä½¿ç”¨äº†synchronizedå…³é”®å­—</span><br><span class="line">        synchronized (this) &#123;</span><br><span class="line">            print(x);</span><br><span class="line">            newLine();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–"><a href="#ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–" class="headerlink" title="ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–"></a>ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">public class Test7 &#123;</span><br><span class="line">	public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">		Monitor monitor &#x3D; new Monitor();</span><br><span class="line">		monitor.start();</span><br><span class="line">		Thread.sleep(3500);</span><br><span class="line">		monitor.stop();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Monitor &#123;</span><br><span class="line"></span><br><span class="line">	Thread monitor;</span><br><span class="line">	&#x2F;&#x2F;è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¢«ç»ˆæ­¢äº†</span><br><span class="line">	private volatile boolean stop &#x3D; false;</span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	public void start() &#123;</span><br><span class="line">		&#x2F;&#x2F;è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span><br><span class="line">		monitor &#x3D; new Thread() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public void run() &#123;</span><br><span class="line">				&#x2F;&#x2F;å¼€å§‹ä¸åœçš„ç›‘æ§</span><br><span class="line">				while (true) &#123;</span><br><span class="line">					if(stop) &#123;</span><br><span class="line">						System.out.println(&quot;å¤„ç†åç»­ä»»åŠ¡&quot;);</span><br><span class="line">						break;</span><br><span class="line">					&#125;</span><br><span class="line">					System.out.println(&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;);</span><br><span class="line">					try &#123;</span><br><span class="line">						&#x2F;&#x2F;çº¿ç¨‹ä¼‘çœ </span><br><span class="line">						Thread.sleep(1000);</span><br><span class="line">					&#125; catch (InterruptedException e) &#123;</span><br><span class="line">						System.out.println(&quot;è¢«æ‰“æ–­äº†&quot;);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		monitor.start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 	ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	public void stop() &#123;</span><br><span class="line">		&#x2F;&#x2F;æ‰“æ–­çº¿ç¨‹</span><br><span class="line">		monitor.interrupt();</span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹æ ‡è®°</span><br><span class="line">		stop &#x3D; true;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼"><a href="#åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼" class="headerlink" title="åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼"></a>åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼</h4><p><strong>å®šä¹‰</strong></p>
<p>Balking ï¼ˆçŠ¹è±«ï¼‰æ¨¡å¼ç”¨åœ¨ä¸€ä¸ªçº¿ç¨‹å‘ç°å¦ä¸€ä¸ªçº¿ç¨‹æˆ–æœ¬çº¿ç¨‹<strong>å·²ç»åšäº†æŸä¸€ä»¶ç›¸åŒ</strong>çš„äº‹ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹å°±æ— éœ€å†åš äº†ï¼Œ<strong>ç›´æ¥ç»“æŸè¿”å›</strong></p>
<ul>
<li>ç”¨ä¸€ä¸ªæ ‡è®°æ¥åˆ¤æ–­è¯¥ä»»åŠ¡æ˜¯å¦å·²ç»è¢«æ‰§è¡Œè¿‡äº†</li>
<li>éœ€è¦é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜<ul>
<li>åŠ é”çš„ä»£ç å—è¦å°½é‡çš„å°ï¼Œä»¥ä¿è¯æ€§èƒ½</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">package com.nyima.day1;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author Chen Panwen</span><br><span class="line"> * @data 2020&#x2F;3&#x2F;26 16:11</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class Test7 &#123;</span><br><span class="line">	public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">		Monitor monitor &#x3D; new Monitor();</span><br><span class="line">		monitor.start();</span><br><span class="line">		monitor.start();</span><br><span class="line">		Thread.sleep(3500);</span><br><span class="line">		monitor.stop();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Monitor &#123;</span><br><span class="line"></span><br><span class="line">	Thread monitor;</span><br><span class="line">	&#x2F;&#x2F;è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¢«ç»ˆæ­¢äº†</span><br><span class="line">	private volatile boolean stop &#x3D; false;</span><br><span class="line">	&#x2F;&#x2F;è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å·²ç»å¯åŠ¨è¿‡äº†</span><br><span class="line">	private boolean starting &#x3D; false;</span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	public void start() &#123;</span><br><span class="line">		&#x2F;&#x2F;ä¸Šé”ï¼Œé¿å…å¤šçº¿ç¨‹è¿è¡Œæ—¶å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜</span><br><span class="line">		synchronized (this) &#123;</span><br><span class="line">			if (starting) &#123;</span><br><span class="line">				&#x2F;&#x2F;å·²è¢«å¯åŠ¨ï¼Œç›´æ¥è¿”å›</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">			&#x2F;&#x2F;å¯åŠ¨ç›‘è§†å™¨ï¼Œæ”¹å˜æ ‡è®°</span><br><span class="line">			starting &#x3D; true;</span><br><span class="line">		&#125;</span><br><span class="line">		&#x2F;&#x2F;è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span><br><span class="line">		monitor &#x3D; new Thread() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public void run() &#123;</span><br><span class="line">				&#x2F;&#x2F;å¼€å§‹ä¸åœçš„ç›‘æ§</span><br><span class="line">				while (true) &#123;</span><br><span class="line">					if(stop) &#123;</span><br><span class="line">						System.out.println(&quot;å¤„ç†åç»­ä»»åŠ¡&quot;);</span><br><span class="line">						break;</span><br><span class="line">					&#125;</span><br><span class="line">					System.out.println(&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;);</span><br><span class="line">					try &#123;</span><br><span class="line">						&#x2F;&#x2F;çº¿ç¨‹ä¼‘çœ </span><br><span class="line">						Thread.sleep(1000);</span><br><span class="line">					&#125; catch (InterruptedException e) &#123;</span><br><span class="line">						System.out.println(&quot;è¢«æ‰“æ–­äº†&quot;);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		monitor.start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * 	ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	public void stop() &#123;</span><br><span class="line">		&#x2F;&#x2F;æ‰“æ–­çº¿ç¨‹</span><br><span class="line">		monitor.interrupt();</span><br><span class="line">		stop &#x3D; true;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="3ã€æœ‰åºæ€§"><a href="#3ã€æœ‰åºæ€§" class="headerlink" title="3ã€æœ‰åºæ€§"></a>3ã€æœ‰åºæ€§</h2><h3 id="æŒ‡ä»¤é‡æ’"><a href="#æŒ‡ä»¤é‡æ’" class="headerlink" title="æŒ‡ä»¤é‡æ’"></a>æŒ‡ä»¤é‡æ’</h3><ul>
<li>JVM ä¼šåœ¨<strong>ä¸å½±å“æ­£ç¡®æ€§</strong>çš„å‰æä¸‹ï¼Œå¯ä»¥<strong>è°ƒæ•´</strong>è¯­å¥çš„æ‰§è¡Œ<strong>é¡ºåº</strong></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145546.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145546.png" alt="img"></a></p>
<p>è¿™ç§ç‰¹æ€§ç§°ä¹‹ä¸ºã€<strong>æŒ‡ä»¤é‡æ’</strong>ã€ï¼Œ<strong>å¤šçº¿ç¨‹ä¸‹ã€æŒ‡ä»¤é‡æ’ã€ä¼šå½±å“æ­£ç¡®æ€§</strong>ã€‚</p>
<h3 id="æŒ‡ä»¤é‡æ’åºä¼˜åŒ–"><a href="#æŒ‡ä»¤é‡æ’åºä¼˜åŒ–" class="headerlink" title="æŒ‡ä»¤é‡æ’åºä¼˜åŒ–"></a>æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</h3><ul>
<li>äº‹å®ä¸Šï¼Œç°ä»£å¤„ç†å™¨ä¼šè®¾è®¡ä¸ºä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆä¸€æ¡æ‰§è¡Œæ—¶é—´é•¿çš„ CPU æŒ‡ä»¤ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥æƒ³åˆ°æŒ‡ä»¤è¿˜å¯ä»¥å†åˆ’åˆ†æˆä¸€ä¸ªä¸ªæ›´å°çš„é˜¶æ®µï¼Œä¾‹å¦‚ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½å¯ä»¥åˆ†ä¸ºï¼š <strong>å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›</strong> è¿™5 ä¸ªé˜¶æ®µ</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145615.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145615.png" alt="img"></a></p>
<ul>
<li><p>åœ¨ä¸æ”¹å˜ç¨‹åºç»“æœçš„å‰æä¸‹ï¼Œè¿™äº›æŒ‡ä»¤çš„å„ä¸ªé˜¶æ®µå¯ä»¥é€šè¿‡<strong>é‡æ’åº</strong>å’Œ<strong>ç»„åˆ</strong>æ¥å®ç°<strong>æŒ‡ä»¤çº§å¹¶è¡Œ</strong></p>
</li>
<li><p>æŒ‡ä»¤é‡æ’çš„å‰ææ˜¯ï¼Œé‡æ’æŒ‡ä»¤<strong>ä¸èƒ½å½±å“ç»“æœ</strong>ï¼Œä¾‹å¦‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å¯ä»¥é‡æ’çš„ä¾‹å­ </span><br><span class="line">int a &#x3D; 10; </span><br><span class="line">int b &#x3D; 20; </span><br><span class="line">System.out.println( a + b );</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ä¸èƒ½é‡æ’çš„ä¾‹å­ </span><br><span class="line">int a &#x3D; 10;</span><br><span class="line">int b &#x3D; a - 5; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨"><a href="#æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨" class="headerlink" title="æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨"></a>æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨</h3><p>ç°ä»£ CPU æ”¯æŒå¤šçº§<strong>æŒ‡ä»¤æµæ°´çº¿</strong>ï¼Œä¾‹å¦‚æ”¯æŒ<strong>åŒæ—¶</strong>æ‰§è¡Œ <strong>å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›</strong> çš„å¤„ç†å™¨ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸ºäº”çº§æŒ‡ä»¤æµæ°´çº¿ã€‚è¿™æ—¶ CPU å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒåŒæ—¶è¿è¡Œäº”æ¡æŒ‡ä»¤çš„ä¸åŒé˜¶æ®µï¼ˆç›¸å½“äºä¸€ æ¡æ‰§è¡Œæ—¶é—´é•¿çš„å¤æ‚æŒ‡ä»¤ï¼‰ï¼ŒIPC = 1ï¼Œæœ¬è´¨ä¸Šï¼Œæµæ°´çº¿æŠ€æœ¯å¹¶ä¸èƒ½ç¼©çŸ­å•æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œä½†å®ƒå˜ç›¸åœ°æé«˜äº†æŒ‡ä»¤åœ°<strong>ååç‡</strong>ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145602.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145602.png" alt="img"></a></p>
<p><strong>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½å¯¼è‡´å‡ºç°æ„æ–™ä¹‹å¤–çš„ç»“æœ</strong></p>
<h3 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h3><p><strong>volatile</strong> ä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥<strong>ç¦ç”¨</strong>æŒ‡ä»¤é‡æ’</p>
<ul>
<li>ç¦æ­¢çš„æ˜¯åŠ volatileå…³é”®å­—å˜é‡ä¹‹å‰çš„ä»£ç è¢«é‡æ’åº</li>
</ul>
<h2 id="4ã€å†…å­˜å±éšœ"><a href="#4ã€å†…å­˜å±éšœ" class="headerlink" title="4ã€å†…å­˜å±éšœ"></a>4ã€å†…å­˜å±éšœ</h2><ul>
<li>å¯è§æ€§<ul>
<li><strong>å†™å±éšœ</strong>ï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœ<strong>ä¹‹å‰</strong>çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</li>
<li><strong>è¯»å±éšœ</strong>ï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœ<strong>ä¹‹å</strong>ï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æ–°æ•°æ®</li>
</ul>
</li>
<li>æœ‰åºæ€§<ul>
<li>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†<strong>å†™å±éšœä¹‹å‰</strong>çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å</li>
<li>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†<strong>è¯»å±éšœä¹‹å</strong>çš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰</li>
</ul>
</li>
</ul>
<h2 id="5ã€volatile-åŸç†"><a href="#5ã€volatile-åŸç†" class="headerlink" title="5ã€volatile åŸç†"></a>5ã€volatile åŸç†</h2><p>volatileçš„åº•å±‚å®ç°åŸç†æ˜¯<strong>å†…å­˜å±éšœ</strong>ï¼ŒMemory Barrierï¼ˆMemory Fenceï¼‰</p>
<ul>
<li>å¯¹ volatile å˜é‡çš„å†™æŒ‡ä»¤åä¼šåŠ å…¥å†™å±éšœ</li>
<li>å¯¹ volatile å˜é‡çš„è¯»æŒ‡ä»¤å‰ä¼šåŠ å…¥è¯»å±éšœ</li>
</ul>
<h3 id="å¦‚ä½•ä¿è¯å¯è§æ€§"><a href="#å¦‚ä½•ä¿è¯å¯è§æ€§" class="headerlink" title="å¦‚ä½•ä¿è¯å¯è§æ€§"></a>å¦‚ä½•ä¿è¯å¯è§æ€§</h3><ul>
<li><p>å†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145630.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145630.png" alt="img"></a></p>
</li>
<li><p>è€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹åï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æ–°æ•°æ®</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145713.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145713.png" alt="img"></a></p>
</li>
</ul>
<h3 id="å¦‚ä½•ä¿è¯æœ‰åºæ€§"><a href="#å¦‚ä½•ä¿è¯æœ‰åºæ€§" class="headerlink" title="å¦‚ä½•ä¿è¯æœ‰åºæ€§"></a>å¦‚ä½•ä¿è¯æœ‰åºæ€§</h3><ul>
<li><p>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145723.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145723.png" alt="img"></a></p>
</li>
<li><p>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åçš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145729.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145729.png" alt="img"></a></p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145741.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145741.png" alt="img"></a></p>
<p><strong>ä½†æ˜¯ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜</strong></p>
<ul>
<li>å†™å±éšœä»…ä»…æ˜¯ä¿è¯ä¹‹åçš„è¯»èƒ½å¤Ÿè¯»åˆ°æ–°çš„ç»“æœï¼Œä½†ä¸èƒ½ä¿è¯è¯»è·‘åˆ°å®ƒå‰é¢å»</li>
<li>è€Œæœ‰åºæ€§çš„ä¿è¯ä¹Ÿåªæ˜¯ä¿è¯äº†<strong>æœ¬çº¿ç¨‹å†…</strong>ç›¸å…³ä»£ç ä¸è¢«é‡æ’åº</li>
</ul>
<h3 id="å®ç°åŸç†ä¹‹Lockå‰ç¼€"><a href="#å®ç°åŸç†ä¹‹Lockå‰ç¼€" class="headerlink" title="å®ç°åŸç†ä¹‹Lockå‰ç¼€"></a>å®ç°åŸç†ä¹‹Lockå‰ç¼€</h3><p>åœ¨X86å¤„ç†å™¨ä¸‹é€šè¿‡å·¥å…·è·å–JITç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤æ¥æŸ¥çœ‹å¯¹volatileè¿›è¡Œå†™æ“ä½œæ—¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">instance &#x3D; new Singleton(); </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„æ±‡ç¼–ä»£ç æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">... lock addl ... </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æœ‰volatileå˜é‡ä¿®é¥°çš„å…±äº«å˜é‡è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ä¼šå¤šå‡ºç¬¬äºŒè¡Œæ±‡ç¼–ä»£ç ï¼Œé€šè¿‡æŸ¥IA-32æ¶æ„è½¯ä»¶å¼€å‘è€…æ‰‹å†Œå¯çŸ¥ï¼Œ<strong>Lockå‰ç¼€</strong>çš„æŒ‡ä»¤åœ¨å¤šæ ¸å¤„ç†å™¨ä¸‹ä¼šå¼•å‘äº†ä¸¤ä»¶äº‹</p>
<ul>
<li><p>Lockå‰ç¼€æŒ‡ä»¤ä¼šå¼•èµ·å¤„ç†å™¨</p>
<p>ç¼“å­˜å›å†™åˆ°å†…å­˜</p>
<ul>
<li>Lockå‰ç¼€æŒ‡ä»¤å¯¼è‡´åœ¨æ‰§è¡ŒæŒ‡ä»¤æœŸé—´ï¼Œå£°è¨€å¤„ç†å™¨çš„LOCK#ä¿¡å·ã€‚åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­ï¼ŒLOCK#ä¿¡å·ç¡®ä¿åœ¨å£°è¨€è¯¥ä¿¡å·æœŸé—´ï¼Œå¤„ç†å™¨å¯ä»¥ç‹¬å ä»»ä½•å…±äº«å†…å­˜ã€‚ä½†æ˜¯ï¼Œåœ¨æœ€è¿‘çš„å¤„ç†å™¨é‡Œï¼ŒLOCK #ä¿¡å·ä¸€èˆ¬ä¸é”æ€»çº¿ï¼Œè€Œæ˜¯<strong>é”ç¼“å­˜</strong>ï¼Œæ¯•ç«Ÿé”æ€»çº¿å¼€é”€çš„æ¯”è¾ƒå¤§ã€‚ä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ç¡®ä¿ä¿®æ”¹çš„åŸå­æ€§ï¼Œæ­¤æ“ä½œè¢«ç§°ä¸ºâ€œç¼“å­˜é”å®šâ€ï¼Œ<strong>ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”±ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®</strong></li>
</ul>
</li>
<li><p>ä¸€ä¸ªå¤„ç†å™¨çš„ç¼“å­˜å›å†™åˆ°å†…å­˜ä¼š</p>
<p>å¯¼è‡´å…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜æ— æ•ˆ</p>
<ul>
<li>åœ¨å¤šæ ¸å¤„ç†å™¨ç³»ç»Ÿä¸­è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼ŒIA-32å’ŒIntel 64å¤„ç†å™¨èƒ½<strong>å—…æ¢å…¶ä»–å¤„ç†å™¨è®¿é—®ç³»ç»Ÿå†…å­˜å’Œå®ƒä»¬çš„å†…éƒ¨ç¼“å­˜</strong>ã€‚å¤„ç†å™¨ä½¿ç”¨å—…æ¢æŠ€æœ¯ä¿è¯å®ƒçš„å†…éƒ¨ç¼“å­˜ã€ç³»ç»Ÿå†…å­˜å’Œå…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜çš„æ•°æ®åœ¨æ€»çº¿ä¸Šä¿æŒä¸€è‡´</li>
</ul>
</li>
</ul>
<h1 id="äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”"><a href="#äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”" class="headerlink" title="äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”"></a>äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”</h1><h2 id="1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜</h2><ul>
<li><p>ä½¿ç”¨<strong>åŸå­æ•´æ•°</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AtomicInteger balance &#x3D; new AtomicInteger();Copy</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">interface Account &#123;</span><br><span class="line">	Integer getBalance();</span><br><span class="line"></span><br><span class="line">	void withdraw(Integer amount);</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * æ–¹æ³•å†…ä¼šå¯åŠ¨ 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åš -10 å…ƒ çš„æ“ä½œ     * å¦‚æœåˆå§‹ä½™é¢ä¸º 10000 é‚£ä¹ˆæ­£ç¡®çš„ç»“æœåº”å½“æ˜¯ 0</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	static void demo(Account account) &#123;</span><br><span class="line">		List&lt;Thread&gt; ts &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">		long start &#x3D; System.nanoTime();</span><br><span class="line">		for (int i &#x3D; 0; i &lt; 1000; i++) &#123;</span><br><span class="line">			ts.add(new Thread(() -&gt; &#123;</span><br><span class="line">				account.withdraw(10);</span><br><span class="line">			&#125;));</span><br><span class="line">		&#125;</span><br><span class="line">		ts.forEach(Thread::start);</span><br><span class="line">		ts.forEach(t -&gt; &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				t.join();</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		long end &#x3D; System.nanoTime();</span><br><span class="line">		System.out.println(account.getBalance() + &quot; cost: &quot; + (end - start) &#x2F; 1000_000 + &quot; ms&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;çº¿ç¨‹ä¸å®‰å…¨çš„åšæ³•</span><br><span class="line">class AccountUnsafe implements Account &#123;</span><br><span class="line">	private Integer balance;</span><br><span class="line"></span><br><span class="line">	public AccountUnsafe(Integer balance) &#123;</span><br><span class="line">		this.balance &#x3D; balance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public Integer getBalance() &#123;</span><br><span class="line">		return this.balance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public synchronized void withdraw(Integer amount) &#123;</span><br><span class="line">		balance -&#x3D; amount;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Account.demo(new AccountUnsafe(10000));</span><br><span class="line">		Account.demo(new AccountCas(10000));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;çº¿ç¨‹å®‰å…¨çš„åšæ³•</span><br><span class="line">class AccountCas implements Account &#123;</span><br><span class="line">	&#x2F;&#x2F;ä½¿ç”¨åŸå­æ•´æ•°</span><br><span class="line">	private AtomicInteger balance;</span><br><span class="line"></span><br><span class="line">	public AccountCas(int balance) &#123;</span><br><span class="line">		this.balance &#x3D; new AtomicInteger(balance);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public Integer getBalance() &#123;</span><br><span class="line">		&#x2F;&#x2F;å¾—åˆ°åŸå­æ•´æ•°çš„å€¼</span><br><span class="line">		return balance.get();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void withdraw(Integer amount) &#123;</span><br><span class="line">		while(true) &#123;</span><br><span class="line">			&#x2F;&#x2F;è·å¾—ä¿®æ”¹å‰çš„å€¼</span><br><span class="line">			int prev &#x3D; balance.get();</span><br><span class="line">			&#x2F;&#x2F;è·å¾—ä¿®æ”¹åçš„å€¼</span><br><span class="line">			int next &#x3D; prev-amount;</span><br><span class="line">			&#x2F;&#x2F;æ¯”è¾ƒå¹¶è®¾å€¼</span><br><span class="line">			if(balance.compareAndSet(prev, next)) &#123;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="2ã€CASä¸volatile"><a href="#2ã€CASä¸volatile" class="headerlink" title="2ã€CASä¸volatile"></a>2ã€CASä¸volatile</h2><p>å‰é¢çœ‹åˆ°çš„ AtomicInteger çš„è§£å†³æ–¹æ³•ï¼Œå†…éƒ¨å¹¶æ²¡æœ‰ç”¨é”æ¥ä¿æŠ¤å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨ã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<p>å…¶ä¸­çš„<strong>å…³é”®æ˜¯ compareAndSwap</strong>ï¼ˆæ¯”è¾ƒå¹¶è®¾ç½®å€¼ï¼‰ï¼Œå®ƒçš„<strong>ç®€ç§°å°±æ˜¯ CAS</strong> ï¼ˆä¹Ÿæœ‰ Compare And Swap çš„è¯´æ³•ï¼‰ï¼Œå®ƒå¿…é¡»æ˜¯<strong>åŸå­æ“ä½œ</strong>ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145914.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145914.png" alt="img"></a></p>
<h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a><strong>å·¥ä½œæµç¨‹</strong></h3><ul>
<li>å½“ä¸€ä¸ªçº¿ç¨‹è¦å»ä¿®æ”¹Accountå¯¹è±¡ä¸­çš„å€¼æ—¶ï¼Œå…ˆè·å–å€¼preï¼ˆè°ƒç”¨getæ–¹æ³•ï¼‰ï¼Œç„¶åå†å°†å…¶è®¾ç½®ä¸ºæ–°çš„å€¼nextï¼ˆè°ƒç”¨casæ–¹æ³•ï¼‰ã€‚åœ¨è°ƒç”¨casæ–¹æ³•æ—¶ï¼Œä¼šå°†preä¸Accountä¸­çš„ä½™é¢è¿›è¡Œæ¯”è¾ƒã€‚<ul>
<li>å¦‚æœ<strong>ä¸¤è€…ç›¸ç­‰</strong>ï¼Œå°±è¯´æ˜è¯¥å€¼è¿˜æœªè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œæ­¤æ—¶ä¾¿å¯ä»¥è¿›è¡Œä¿®æ”¹æ“ä½œã€‚</li>
<li>å¦‚æœ<strong>ä¸¤è€…ä¸ç›¸ç­‰</strong>ï¼Œå°±ä¸è®¾ç½®å€¼ï¼Œé‡æ–°è·å–å€¼preï¼ˆè°ƒç”¨getæ–¹æ³•ï¼‰ï¼Œç„¶åå†å°†å…¶è®¾ç½®ä¸ºæ–°çš„å€¼nextï¼ˆè°ƒç”¨casæ–¹æ³•ï¼‰ï¼Œç›´åˆ°ä¿®æ”¹æˆåŠŸä¸ºæ­¢ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„</strong></p>
<ul>
<li>å…¶å® CAS çš„åº•å±‚æ˜¯ <strong>lock cmpxchg</strong> æŒ‡ä»¤ï¼ˆX86 æ¶æ„ï¼‰ï¼Œåœ¨å•æ ¸ CPU å’Œå¤šæ ¸ CPU ä¸‹éƒ½èƒ½å¤Ÿä¿è¯ã€æ¯”è¾ƒ-äº¤æ¢ã€‘çš„<strong>åŸå­æ€§</strong>ã€‚</li>
<li>åœ¨å¤šæ ¸çŠ¶æ€ä¸‹ï¼ŒæŸä¸ªæ ¸æ‰§è¡Œåˆ°å¸¦ lock çš„æŒ‡ä»¤æ—¶ï¼ŒCPU ä¼šè®©æ€»çº¿é”ä½ï¼Œå½“è¿™ä¸ªæ ¸æŠŠæ­¤æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œå†å¼€å¯æ€»çº¿ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šè¢«çº¿ç¨‹çš„è°ƒåº¦æœºåˆ¶æ‰€æ‰“æ–­ï¼Œä¿è¯äº†å¤šä¸ªçº¿ç¨‹å¯¹å†…å­˜æ“ä½œçš„å‡†ç¡®æ€§ï¼Œæ˜¯åŸå­çš„ã€‚</li>
</ul>
<h3 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h3><p>è·å–å…±äº«å˜é‡æ—¶ï¼Œä¸ºäº†ä¿è¯è¯¥å˜é‡çš„<strong>å¯è§æ€§</strong>ï¼Œéœ€è¦ä½¿ç”¨ <strong>volatile</strong> ä¿®é¥°ã€‚<br>å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°<strong>ä¸»å­˜ä¸­è·å–</strong> å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯ç›´æ¥æ“ä½œä¸»å­˜ã€‚å³ä¸€ä¸ªçº¿ç¨‹å¯¹ volatile å˜é‡çš„ä¿®æ”¹ï¼Œå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚</p>
<p><strong>æ³¨æ„</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volatile ä»…ä»…ä¿è¯äº†å…±äº«å˜é‡çš„å¯è§æ€§ï¼Œè®©å…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°æ–°å€¼ï¼Œä½†ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜ï¼ˆä¸èƒ½ä¿è¯åŸå­æ€§ï¼‰ </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>CAS å¿…é¡»å€ŸåŠ© volatile</strong> æ‰èƒ½è¯»å–åˆ°å…±äº«å˜é‡çš„æ–°å€¼æ¥å®ç°ã€æ¯”è¾ƒå¹¶äº¤æ¢ã€‘çš„æ•ˆæœ</p>
<h3 id="æ•ˆç‡é—®é¢˜"><a href="#æ•ˆç‡é—®é¢˜" class="headerlink" title="æ•ˆç‡é—®é¢˜"></a>æ•ˆç‡é—®é¢˜</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ— é”æ¯”ä½¿ç”¨åŠ é”çš„<strong>æ•ˆç‡æ›´é«˜ã€‚</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145931.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145931.png" alt="img"></a></p>
<p><strong>åŸå› </strong></p>
<h3 id="CASç‰¹ç‚¹"><a href="#CASç‰¹ç‚¹" class="headerlink" title="CASç‰¹ç‚¹"></a>CASç‰¹ç‚¹</h3><p>ç»“åˆ CAS å’Œ volatile å¯ä»¥å®ç°<strong>æ— é”å¹¶å‘</strong>ï¼Œé€‚ç”¨äº<strong>çº¿ç¨‹æ•°å°‘ã€å¤šæ ¸ CPU</strong> çš„åœºæ™¯ä¸‹ã€‚</p>
<ul>
<li><p>CAS æ˜¯åŸºäº<strong>ä¹è§‚é”</strong>çš„æ€æƒ³ï¼šä¹è§‚çš„ä¼°è®¡ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œå°±ç®—æ”¹äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘åƒäºç‚¹å†é‡è¯•å‘—ã€‚</p>
</li>
<li><p>synchronized æ˜¯åŸºäºæ‚²è§‚é”çš„æ€æƒ³ï¼šæ‚²è§‚çš„ä¼°è®¡ï¼Œå¾—é˜²ç€å…¶å®ƒçº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œæˆ‘ä¸Šäº†é”ä½ ä»¬éƒ½åˆ«æƒ³æ”¹ï¼Œæˆ‘æ”¹å®Œäº†è§£å¼€é”ï¼Œä½ ä»¬æ‰æœ‰æœºä¼šã€‚</p>
</li>
<li><p>CAS ä½“ç°çš„æ˜¯</p>
<p>æ— é”å¹¶å‘ã€æ— é˜»å¡å¹¶å‘</p>
<p>ï¼Œè¯·ä»”ç»†ä½“ä¼šè¿™ä¸¤å¥è¯çš„æ„æ€</p>
<ul>
<li>å› ä¸ºæ²¡æœ‰ä½¿ç”¨ synchronizedï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡ï¼Œè¿™æ˜¯æ•ˆç‡æå‡çš„å› ç´ ä¹‹ä¸€</li>
<li>ä½†å¦‚æœç«äº‰æ¿€çƒˆï¼Œå¯ä»¥æƒ³åˆ°é‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆç‡ä¼šå—å½±å“</li>
</ul>
</li>
</ul>
<h2 id="3ã€åŸå­æ•´æ•°"><a href="#3ã€åŸå­æ•´æ•°" class="headerlink" title="3ã€åŸå­æ•´æ•°"></a>3ã€åŸå­æ•´æ•°</h2><p>J.U.C å¹¶å‘åŒ…æä¾›äº†</p>
<ul>
<li>AtomicBoolean</li>
<li>AtomicInteger</li>
<li>AtomicLong</li>
</ul>
<p><strong>ä»¥ AtomicInteger ä¸ºä¾‹</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> AtomicInteger i &#x3D; new AtomicInteger(0);</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è·å–å¹¶è‡ªå¢ï¼ˆi &#x3D; 0, ç»“æœ i &#x3D; 1, è¿”å› 0ï¼‰ï¼Œç±»ä¼¼äº i++ System.out.println(i.getAndIncrement());</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è‡ªå¢å¹¶è·å–ï¼ˆi &#x3D; 1, ç»“æœ i &#x3D; 2, è¿”å› 2ï¼‰ï¼Œç±»ä¼¼äº ++i System.out.println(i.incrementAndGet());</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è‡ªå‡å¹¶è·å–ï¼ˆi &#x3D; 2, ç»“æœ i &#x3D; 1, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº --i System.out.println(i.decrementAndGet());</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è·å–å¹¶è‡ªå‡ï¼ˆi &#x3D; 1, ç»“æœ i &#x3D; 0, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº i--</span><br><span class="line">System.out.println(i.getAndDecrement());</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è·å–å¹¶åŠ å€¼ï¼ˆi &#x3D; 0, ç»“æœ i &#x3D; 5, è¿”å› 0ï¼‰ </span><br><span class="line">System.out.println(i.getAndAdd(5));</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; åŠ å€¼å¹¶è·å–ï¼ˆi &#x3D; 5, ç»“æœ i &#x3D; 0, è¿”å› 0ï¼‰ </span><br><span class="line">System.out.println(i.addAndGet(-5));</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è·å–å¹¶æ›´æ–°ï¼ˆi &#x3D; 0, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i &#x3D; -2, è¿”å› 0ï¼‰ </span><br><span class="line">&#x2F;&#x2F; å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ </span><br><span class="line">System.out.println(i.getAndUpdate(p -&gt; p - 2));</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; æ›´æ–°å¹¶è·å–ï¼ˆi &#x3D; -2, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i &#x3D; 0, è¿”å› 0ï¼‰</span><br><span class="line">&#x2F;&#x2F; å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ </span><br><span class="line">System.out.println(i.updateAndGet(p -&gt; p + 2));</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è·å–å¹¶è®¡ç®—ï¼ˆi &#x3D; 0, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i &#x3D; 10, è¿”å› 0ï¼‰ </span><br><span class="line">&#x2F;&#x2F; å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ &#x2F;&#x2F; getAndUpdate å¦‚æœåœ¨ lambda ä¸­å¼•ç”¨äº†å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè¦ä¿è¯è¯¥å±€éƒ¨å˜é‡æ˜¯ final çš„ </span><br><span class="line">&#x2F;&#x2F; getAndAccumulate å¯ä»¥é€šè¿‡ å‚æ•°1 æ¥å¼•ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºå…¶ä¸åœ¨ lambda ä¸­å› æ­¤ä¸å¿…æ˜¯ </span><br><span class="line">final System.out.println(i.getAndAccumulate(10, (p, x) -&gt; p + x));</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è®¡ç®—å¹¶è·å–ï¼ˆi &#x3D; 10, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i &#x3D; 0, è¿”å› 0ï¼‰ </span><br><span class="line">&#x2F;&#x2F; å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span><br><span class="line">System.out.println(i.accumulateAndGet(-10, (p, x) -&gt; p + x)); </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="4ã€åŸå­å¼•ç”¨"><a href="#4ã€åŸå­å¼•ç”¨" class="headerlink" title="4ã€åŸå­å¼•ç”¨"></a>4ã€åŸå­å¼•ç”¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">public interface DecimalAccount &#123;</span><br><span class="line">	BigDecimal getBalance();</span><br><span class="line"></span><br><span class="line">	void withdraw(BigDecimal amount);</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * æ–¹æ³•å†…ä¼šå¯åŠ¨ 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åš -10 å…ƒ çš„æ“ä½œ    </span><br><span class="line">     * å¦‚æœåˆå§‹ä½™é¢ä¸º 10000 é‚£ä¹ˆæ­£ç¡®çš„ç»“æœåº”å½“æ˜¯ 0</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	static void demo(DecimalAccountImpl account) &#123;</span><br><span class="line">		List&lt;Thread&gt; ts &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">		long start &#x3D; System.nanoTime();</span><br><span class="line">		for (int i &#x3D; 0; i &lt; 1000; i++) &#123;</span><br><span class="line">			ts.add(new Thread(() -&gt; &#123;</span><br><span class="line">				account.withdraw(BigDecimal.TEN);</span><br><span class="line">			&#125;));</span><br><span class="line">		&#125;</span><br><span class="line">		ts.forEach(Thread::start);</span><br><span class="line">		ts.forEach(t -&gt; &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				t.join();</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		long end &#x3D; System.nanoTime();</span><br><span class="line">		System.out.println(account.getBalance() + &quot; cost: &quot; + (end - start) &#x2F; 1000_000 + &quot; ms&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DecimalAccountImpl implements DecimalAccount &#123;</span><br><span class="line">	&#x2F;&#x2F;åŸå­å¼•ç”¨ï¼Œæ³›å‹ç±»å‹ä¸ºå°æ•°ç±»å‹</span><br><span class="line">	AtomicReference&lt;BigDecimal&gt; balance;</span><br><span class="line"></span><br><span class="line">	public DecimalAccountImpl(BigDecimal balance) &#123;</span><br><span class="line">		this.balance &#x3D; new AtomicReference&lt;BigDecimal&gt;(balance);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public BigDecimal getBalance() &#123;</span><br><span class="line">		return balance.get();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void withdraw(BigDecimal amount) &#123;</span><br><span class="line">		while(true) &#123;</span><br><span class="line">			BigDecimal pre &#x3D; balance.get();</span><br><span class="line">			BigDecimal next &#x3D; pre.subtract(amount);</span><br><span class="line">			if(balance.compareAndSet(pre, next)) &#123;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		DecimalAccount.demo(new DecimalAccountImpl(new BigDecimal(&quot;10000&quot;)));</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="5ã€ABAé—®é¢˜"><a href="#5ã€ABAé—®é¢˜" class="headerlink" title="5ã€ABAé—®é¢˜"></a>5ã€ABAé—®é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public class Demo3 &#123;</span><br><span class="line">	static AtomicReference&lt;String&gt; str &#x3D; new AtomicReference&lt;&gt;(&quot;A&quot;);</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		new Thread(() -&gt; &#123;</span><br><span class="line">			String pre &#x3D; str.get();</span><br><span class="line">			System.out.println(&quot;change&quot;);</span><br><span class="line">			try &#123;</span><br><span class="line">				other();</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			try &#123;</span><br><span class="line">				Thread.sleep(1000);</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			&#x2F;&#x2F;æŠŠsträ¸­çš„Aæ”¹ä¸ºC</span><br><span class="line">			System.out.println(&quot;change A-&gt;C &quot; + str.compareAndSet(pre, &quot;C&quot;));</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	static void other() throws InterruptedException &#123;</span><br><span class="line">		new Thread(()-&gt; &#123;</span><br><span class="line">			System.out.println(&quot;change A-&gt;B &quot; + str.compareAndSet(&quot;A&quot;, &quot;B&quot;));</span><br><span class="line">		&#125;).start();</span><br><span class="line">		Thread.sleep(500);</span><br><span class="line">		new Thread(()-&gt; &#123;</span><br><span class="line">			System.out.println(&quot;change B-&gt;A &quot; + str.compareAndSet(&quot;B&quot;, &quot;A&quot;));</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145952.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145952.png" alt="img"></a></p>
<p>ä¸»çº¿ç¨‹ä»…èƒ½åˆ¤æ–­å‡ºå…±äº«å˜é‡çš„å€¼ä¸åˆå€¼ A <strong>æ˜¯å¦ç›¸åŒ</strong>ï¼Œä¸èƒ½æ„ŸçŸ¥åˆ°è¿™ç§ä» A æ”¹ä¸º B åˆ æ”¹å› A çš„æƒ…å†µï¼Œå¦‚æœä¸»çº¿ç¨‹å¸Œæœ›ï¼š<br>åªè¦æœ‰å…¶å®ƒçº¿ç¨‹ã€<strong>åŠ¨è¿‡äº†</strong>ã€‘å…±äº«å˜é‡ï¼Œé‚£ä¹ˆè‡ªå·±çš„ <strong>cas å°±ç®—å¤±è´¥</strong>ï¼Œè¿™æ—¶ï¼Œä»…æ¯”è¾ƒå€¼æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦å†åŠ ä¸€ä¸ª<strong>ç‰ˆæœ¬å·</strong></p>
<h3 id="AtomicStampedReference"><a href="#AtomicStampedReference" class="headerlink" title="AtomicStampedReference"></a><strong>AtomicStampedReference</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">public class Demo3 &#123;</span><br><span class="line">	&#x2F;&#x2F;æŒ‡å®šç‰ˆæœ¬å·</span><br><span class="line">	static AtomicStampedReference&lt;String&gt; str &#x3D; new AtomicStampedReference&lt;&gt;(&quot;A&quot;, 0);</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		new Thread(() -&gt; &#123;</span><br><span class="line">			String pre &#x3D; str.getReference();</span><br><span class="line">			&#x2F;&#x2F;è·å¾—ç‰ˆæœ¬å·</span><br><span class="line">			int stamp &#x3D; str.getStamp();</span><br><span class="line">			System.out.println(&quot;change&quot;);</span><br><span class="line">			try &#123;</span><br><span class="line">				other();</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			try &#123;</span><br><span class="line">				Thread.sleep(1000);</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			&#x2F;&#x2F;æŠŠsträ¸­çš„Aæ”¹ä¸ºC,å¹¶æ¯”å¯¹ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ç›¸åŒï¼Œå°±æ‰§è¡Œæ›¿æ¢ï¼Œå¹¶è®©ç‰ˆæœ¬å·+1</span><br><span class="line">			System.out.println(&quot;change A-&gt;C stamp &quot; + stamp + str.compareAndSet(pre, &quot;C&quot;, stamp, stamp+1));</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	static void other() throws InterruptedException &#123;</span><br><span class="line">		new Thread(()-&gt; &#123;</span><br><span class="line">			int stamp &#x3D; str.getStamp();</span><br><span class="line">			System.out.println(&quot;change A-&gt;B stamp &quot; + stamp + str.compareAndSet(&quot;A&quot;, &quot;B&quot;, stamp, stamp+1));</span><br><span class="line">		&#125;).start();</span><br><span class="line">		Thread.sleep(500);</span><br><span class="line">		new Thread(()-&gt; &#123;</span><br><span class="line">			int stamp &#x3D; str.getStamp();</span><br><span class="line">			System.out.println(&quot;change B-&gt;A stamp &quot; + stamp +  str.compareAndSet(&quot;B&quot;, &quot;A&quot;, stamp, stamp+1));</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150003.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150003.png" alt="img"></a></p>
<h3 id="AtomicMarkableReference"><a href="#AtomicMarkableReference" class="headerlink" title="AtomicMarkableReference"></a>AtomicMarkableReference</h3><p>AtomicStampedReference å¯ä»¥ç»™åŸå­å¼•ç”¨åŠ ä¸Šç‰ˆæœ¬å·ï¼Œè¿½è¸ªåŸå­å¼•ç”¨æ•´ä¸ªçš„å˜åŒ–è¿‡ç¨‹ï¼Œå¦‚ï¼š A -&gt; B -&gt; A -&gt; C ï¼Œé€šè¿‡AtomicStampedReferenceï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¼•ç”¨å˜é‡ä¸­é€”è¢«æ›´æ”¹äº†å‡ æ¬¡ã€‚<br>ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå¹¶ä¸å…³å¿ƒå¼•ç”¨å˜é‡æ›´æ”¹äº†å‡ æ¬¡ï¼Œåªæ˜¯å•çº¯çš„å…³å¿ƒ<strong>æ˜¯å¦æ›´æ”¹è¿‡</strong>ï¼Œæ‰€ä»¥å°±æœ‰äº† <strong>AtomicMarkableReference</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class Demo4 &#123;</span><br><span class="line">	&#x2F;&#x2F;æŒ‡å®šç‰ˆæœ¬å·</span><br><span class="line">	static AtomicMarkableReference&lt;String&gt; str &#x3D; new AtomicMarkableReference&lt;&gt;(&quot;A&quot;, true);</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		new Thread(() -&gt; &#123;</span><br><span class="line">			String pre &#x3D; str.getReference();</span><br><span class="line">			System.out.println(&quot;change&quot;);</span><br><span class="line">			try &#123;</span><br><span class="line">				other();</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			try &#123;</span><br><span class="line">				Thread.sleep(1000);</span><br><span class="line">			&#125; catch (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			&#x2F;&#x2F;æŠŠsträ¸­çš„Aæ”¹ä¸ºC,å¹¶æ¯”å¯¹ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ç›¸åŒï¼Œå°±æ‰§è¡Œæ›¿æ¢ï¼Œå¹¶è®©ç‰ˆæœ¬å·+1</span><br><span class="line">			System.out.println(&quot;change A-&gt;C mark &quot; +  str.compareAndSet(pre, &quot;C&quot;, true, false));</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	static void other() throws InterruptedException &#123;</span><br><span class="line">		new Thread(() -&gt; &#123;</span><br><span class="line">			System.out.println(&quot;change A-&gt;A mark &quot; + str.compareAndSet(&quot;A&quot;, &quot;A&quot;, true, false));</span><br><span class="line">		&#125;).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150017.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150017.png" alt="img"></a></p>
<h3 id="ä¸¤è€…çš„åŒºåˆ«"><a href="#ä¸¤è€…çš„åŒºåˆ«" class="headerlink" title="ä¸¤è€…çš„åŒºåˆ«"></a>ä¸¤è€…çš„åŒºåˆ«</h3><ul>
<li><strong>AtomicStampedReference</strong> éœ€è¦æˆ‘ä»¬ä¼ å…¥<strong>æ•´å‹å˜é‡</strong>ä½œä¸ºç‰ˆæœ¬å·ï¼Œæ¥åˆ¤å®šæ˜¯å¦è¢«æ›´æ”¹è¿‡</li>
<li><strong>AtomicMarkableReference</strong>éœ€è¦æˆ‘ä»¬ä¼ å…¥<strong>å¸ƒå°”å˜é‡</strong>ä½œä¸ºæ ‡è®°ï¼Œæ¥åˆ¤æ–­æ˜¯å¦è¢«æ›´æ”¹è¿‡</li>
</ul>
<h2 id="6ã€åŸå­æ•°ç»„"><a href="#6ã€åŸå­æ•°ç»„" class="headerlink" title="6ã€åŸå­æ•°ç»„"></a>6ã€åŸå­æ•°ç»„</h2><ul>
<li>AtomicIntegerArray</li>
<li>AtomicLongArray</li>
<li>AtomicReferenceArray</li>
</ul>
<h3 id="lambaè¡¨è¾¾å¼çš„ä½¿ç”¨"><a href="#lambaè¡¨è¾¾å¼çš„ä½¿ç”¨" class="headerlink" title="lambaè¡¨è¾¾å¼çš„ä½¿ç”¨"></a>lambaè¡¨è¾¾å¼çš„ä½¿ç”¨</h3><ul>
<li>æä¾›è€…<ul>
<li>æ— å‚åˆè¿”å›</li>
<li>()-&gt;è¿”å›ç»“æœ</li>
</ul>
</li>
<li>æ–¹æ³•<ul>
<li>æœ‰å‚æœ‰è¿”å›</li>
<li>(å‚æ•°ä¸€â€¦)-&gt;è¿”å›ç»“æœ</li>
</ul>
</li>
<li>æ¶ˆè´¹è€…<ul>
<li>æœ‰å‚æ— è¿”å›</li>
<li>(å‚æ•°ä¸€â€¦)-&gt;void</li>
</ul>
</li>
</ul>
<h2 id="7ã€åŸå­æ›´æ–°å™¨"><a href="#7ã€åŸå­æ›´æ–°å™¨" class="headerlink" title="7ã€åŸå­æ›´æ–°å™¨"></a>7ã€åŸå­æ›´æ–°å™¨</h2><ul>
<li>AtomicReferenceFieldUpdater // åŸŸ å­—æ®µ</li>
<li>AtomicIntegerFieldUpdater</li>
<li>AtomicLongFieldUpdate</li>
</ul>
<p>åŸå­æ›´æ–°å™¨ç”¨äºå¸®åŠ©æˆ‘ä»¬æ”¹å˜æŸä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class Demo1 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      Student student &#x3D; new Student();</span><br><span class="line">       </span><br><span class="line">      &#x2F;&#x2F; è·å¾—åŸå­æ›´æ–°å™¨</span><br><span class="line">      &#x2F;&#x2F; æ³›å‹</span><br><span class="line">      &#x2F;&#x2F; å‚æ•°1 æŒæœ‰å±æ€§çš„ç±» å‚æ•°2 è¢«æ›´æ–°çš„å±æ€§çš„ç±»</span><br><span class="line">      &#x2F;&#x2F; newUpdaterä¸­çš„å‚æ•°ï¼šç¬¬ä¸‰ä¸ªä¸ºå±æ€§çš„åç§°</span><br><span class="line">      AtomicReferenceFieldUpdater&lt;Student, String&gt; updater &#x3D; AtomicReferenceFieldUpdater.newUpdater(Student.class, String.class, &quot;name&quot;);</span><br><span class="line">       </span><br><span class="line">      &#x2F;&#x2F; ä¿®æ”¹</span><br><span class="line">      updater.compareAndSet(student, null, &quot;Nyima&quot;);</span><br><span class="line">      System.out.println(student);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Student &#123;</span><br><span class="line">   volatile String name;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public String toString() &#123;</span><br><span class="line">      return &quot;Student&#123;&quot; +</span><br><span class="line">            &quot;name&#x3D;&#39;&quot; + name + &#39;\&#39;&#39; +</span><br><span class="line">            &#39;&#125;&#39;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹"><a href="#åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹"></a>åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹</h3><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼ŒåŸå­æ›´æ–°å™¨æ˜¯é€šè¿‡newUpdateræ¥è·å–å®ä¾‹çš„ã€‚å…¶ä¸­ä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°</p>
<ul>
<li>æ‹¥æœ‰å±æ€§çš„ç±»çš„Class</li>
<li>å±æ€§çš„Class</li>
<li>å±æ€§çš„åç§°</li>
</ul>
<p>å¤§æ¦‚å¯ä»¥çŒœå‡ºæ¥ï¼Œ<strong>åˆå§‹åŒ–è¿‡ç¨‹ç”¨åˆ°äº†åå°„</strong>ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æºç æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªçŒœæµ‹ã€‚</p>
<h4 id="newUpdateræ–¹æ³•"><a href="#newUpdateræ–¹æ³•" class="headerlink" title="newUpdateræ–¹æ³•"></a>newUpdateræ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;U,W&gt; AtomicReferenceFieldUpdater&lt;U,W&gt; newUpdater(Class&lt;U&gt; tclass,</span><br><span class="line">                                                                Class&lt;W&gt; vclass,</span><br><span class="line">                                                                String fieldName) &#123;</span><br><span class="line">    &#x2F;&#x2F; è¿”å›äº†ä¸€ä¸ªAtomicReferenceFieldUpdaterImplå®ä¾‹</span><br><span class="line">    return new AtomicReferenceFieldUpdaterImpl&lt;U,W&gt;</span><br><span class="line">        (tclass, vclass, fieldName, Reflection.getCallerClass());</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä»newUpdateræ–¹æ³•è¿˜å¹¶ä¸èƒ½çœ‹å‡ºæ¥å…·ä½“çš„åˆå§‹åŒ–è¿‡ç¨‹</p>
<h4 id="å†…éƒ¨å®ç°ç±»"><a href="#å†…éƒ¨å®ç°ç±»" class="headerlink" title="å†…éƒ¨å®ç°ç±»"></a>å†…éƒ¨å®ç°ç±»</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145006.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145006.png" alt="img"></a></p>
<p>AtomicReferenceFieldUpdaterä¸ºæŠ½è±¡ç±»ï¼Œè¯¥ç±»<strong>å†…éƒ¨æœ‰ä¸€ä¸ªè‡ªå·±çš„å®ç°ç±»AtomicReferenceFieldUpdaterImpl</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private static final class AtomicReferenceFieldUpdaterImpl&lt;T,V&gt;</span><br><span class="line">        extends AtomicReferenceFieldUpdater&lt;T,V&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145119.png" alt="img"></a></p>
<p><strong>æ„é€ æ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">AtomicReferenceFieldUpdaterImpl(final Class&lt;T&gt; tclass,</span><br><span class="line">                                final Class&lt;V&gt; vclass,</span><br><span class="line">                                final String fieldName,</span><br><span class="line">                                final Class&lt;?&gt; caller) &#123;</span><br><span class="line">    &#x2F;&#x2F; ç”¨äºä¿å­˜è¦è¢«ä¿®æ”¹çš„å±æ€§</span><br><span class="line">    final Field field;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; å±æ€§çš„Class</span><br><span class="line">    final Class&lt;?&gt; fieldClass;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; fieldçš„ä¿®é¥°ç¬¦</span><br><span class="line">    final int modifiers;</span><br><span class="line">    try &#123;</span><br><span class="line">        &#x2F;&#x2F; åå°„è·å¾—å±æ€§</span><br><span class="line">        field &#x3D; AccessController.doPrivileged(</span><br><span class="line">            new PrivilegedExceptionAction&lt;Field&gt;() &#123;</span><br><span class="line">                public Field run() throws NoSuchFieldException &#123;</span><br><span class="line">                    &#x2F;&#x2F; tclassä¸ºä¼ å…¥çš„å±æ€§çš„Classï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è·å¾—å±æ€§</span><br><span class="line">                    return tclass.getDeclaredField(fieldName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; è·å¾—å±æ€§çš„ä¿®é¥°ç¬¦ï¼Œä¸»è¦ç”¨äºåˆ¤æ–­</span><br><span class="line">        &#x2F;&#x2F; 1ã€vclass ä¸ å±æ€§ç¡®åˆ‡çš„ç±»å‹æ˜¯å¦åŒ¹é…</span><br><span class="line">        &#x2F;&#x2F; 2ã€æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹</span><br><span class="line">        &#x2F;&#x2F; 3ã€è¢«ä¿®æ”¹çš„å±æ€§æ˜¯å¦åŠ äº†volatileå…³é”®å­—</span><br><span class="line">        modifiers &#x3D; field.getModifiers();</span><br><span class="line">        sun.reflect.misc.ReflectUtil.ensureMemberAccess(</span><br><span class="line">            caller, tclass, null, modifiers);</span><br><span class="line">        ClassLoader cl &#x3D; tclass.getClassLoader();</span><br><span class="line">        ClassLoader ccl &#x3D; caller.getClassLoader();</span><br><span class="line">        if ((ccl !&#x3D; null) &amp;&amp; (ccl !&#x3D; cl) &amp;&amp;</span><br><span class="line">            ((cl &#x3D;&#x3D; null) || !isAncestor(cl, ccl))) &#123;</span><br><span class="line">            sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; è·å¾—å±æ€§ç±»çš„Class</span><br><span class="line">        fieldClass &#x3D; field.getType();</span><br><span class="line">    &#125; catch (PrivilegedActionException pae) &#123;</span><br><span class="line">        throw new RuntimeException(pae.getException());</span><br><span class="line">    &#125; catch (Exception ex) &#123;</span><br><span class="line">        throw new RuntimeException(ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (vclass !&#x3D; fieldClass)</span><br><span class="line">        throw new ClassCastException();</span><br><span class="line">    if (vclass.isPrimitive())</span><br><span class="line">        throw new IllegalArgumentException(&quot;Must be reference type&quot;);</span><br><span class="line"></span><br><span class="line">    if (!Modifier.isVolatile(modifiers))</span><br><span class="line">        throw new IllegalArgumentException(&quot;Must be volatile type&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Access to protected field members is restricted to receivers only</span><br><span class="line">    &#x2F;&#x2F; of the accessing class, or one of its subclasses, and the</span><br><span class="line">    &#x2F;&#x2F; accessing class must in turn be a subclass (or package sibling)</span><br><span class="line">    &#x2F;&#x2F; of the protected member&#39;s defining class.</span><br><span class="line">    &#x2F;&#x2F; If the updater refers to a protected field of a declaring class</span><br><span class="line">    &#x2F;&#x2F; outside the current package, the receiver argument will be</span><br><span class="line">    &#x2F;&#x2F; narrowed to the type of the accessing class.</span><br><span class="line"> 	&#x2F;&#x2F; å¯¹ç±»ä¸­çš„å±æ€§è¿›è¡Œåˆå§‹åŒ–</span><br><span class="line">    this.cclass &#x3D; (Modifier.isProtected(modifiers) &amp;&amp;</span><br><span class="line">                   tclass.isAssignableFrom(caller) &amp;&amp;</span><br><span class="line">                   !isSamePackage(tclass, caller))</span><br><span class="line">                  ? caller : tclass;</span><br><span class="line">    this.tclass &#x3D; tclass;</span><br><span class="line">    this.vclass &#x3D; vclass;</span><br><span class="line">    &#x2F;&#x2F; è·å¾—åç§»é‡</span><br><span class="line">    this.offset &#x3D; U.objectFieldOffset(field);</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>å¯ä»¥çœ‹å‡ºï¼ŒåŸå­å¼•ç”¨æ›´æ–°å™¨ç¡®å®ä½¿ç”¨äº†åå°„</strong></p>
<h2 id="8ã€LongAdderåŸç†"><a href="#8ã€LongAdderåŸç†" class="headerlink" title="8ã€LongAdderåŸç†"></a>8ã€LongAdderåŸç†</h2><h3 id="åŸç†ä¹‹ä¼ªå…±äº«"><a href="#åŸç†ä¹‹ä¼ªå…±äº«" class="headerlink" title="åŸç†ä¹‹ä¼ªå…±äº«"></a>åŸç†ä¹‹ä¼ªå…±äº«</h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150037.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150037.png" alt="img"></a></p>
<p>ç¼“å­˜è¡Œä¼ªå…±äº«å¾—ä»ç¼“å­˜è¯´èµ·<br>ç¼“å­˜ä¸å†…å­˜çš„é€Ÿåº¦æ¯”è¾ƒ</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150051.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150051.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150102.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150102.png" alt="img"></a></p>
<p>å› ä¸º CPU ä¸ å†…å­˜çš„é€Ÿåº¦å·®å¼‚å¾ˆå¤§ï¼Œéœ€è¦é é¢„è¯»æ•°æ®è‡³<strong>ç¼“å­˜</strong>æ¥æå‡æ•ˆç‡ã€‚<br>è€Œç¼“å­˜ä»¥<strong>ç¼“å­˜è¡Œ</strong>ä¸ºå•ä½ï¼Œæ¯ä¸ªç¼“å­˜è¡Œå¯¹åº”ç€ä¸€å—å†…å­˜ï¼Œä¸€èˆ¬æ˜¯ <strong>64 byte</strong>ï¼ˆ8 ä¸ª longï¼‰<br>ç¼“å­˜çš„åŠ å…¥ä¼šé€ æˆæ•°æ®å‰¯æœ¬çš„äº§ç”Ÿï¼Œå³åŒä¸€ä»½æ•°æ®ä¼šç¼“å­˜åœ¨ä¸åŒæ ¸å¿ƒçš„ç¼“å­˜è¡Œä¸­<br>CPU è¦ä¿è¯æ•°æ®çš„<strong>ä¸€è‡´æ€§</strong>ï¼Œå¦‚æœæŸä¸ª CPU æ ¸å¿ƒ<strong>æ›´æ”¹</strong>äº†æ•°æ®ï¼Œå…¶å®ƒ CPU æ ¸å¿ƒå¯¹åº”çš„æ•´ä¸ªç¼“å­˜è¡Œå¿…é¡»<strong>å¤±æ•ˆ</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150111.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150111.png" alt="img"></a></p>
<p>å› ä¸º Cell æ˜¯æ•°ç»„å½¢å¼ï¼Œåœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œä¸€ä¸ª Cell ä¸º 24 å­—èŠ‚ï¼ˆ16 å­—èŠ‚çš„å¯¹è±¡å¤´å’Œ 8 å­—èŠ‚çš„ valueï¼‰ï¼Œå›  æ­¤ç¼“å­˜è¡Œå¯ä»¥å­˜ä¸‹ 2 ä¸ªçš„ Cell å¯¹è±¡ã€‚è¿™æ ·é—®é¢˜æ¥äº†ï¼š</p>
<ul>
<li>Core-0 è¦ä¿®æ”¹ Cell[0]</li>
<li>Core-1 è¦ä¿®æ”¹ Cell[1]</li>
</ul>
<p>æ— è®ºè°ä¿®æ”¹æˆåŠŸï¼Œéƒ½ä¼šå¯¼è‡´å¯¹æ–¹ Core çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œ</p>
<p>æ¯”å¦‚ Core-0 ä¸­ Cell[0]=6000, Cell[1]=8000 è¦ç´¯åŠ  Cell[0]=6001, Cell[1]=8000 ï¼Œè¿™æ—¶ä¼šè®© Core-1 çš„ç¼“å­˜è¡Œå¤±æ•ˆ</p>
<p>@sun.misc.Contended ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒçš„åŸç†æ˜¯åœ¨ä½¿ç”¨æ­¤æ³¨è§£çš„å¯¹è±¡æˆ–å­—æ®µçš„<strong>å‰åå„å¢åŠ  128 å­—èŠ‚å¤§å°çš„ padding</strong>ï¼ˆç©ºç™½ï¼‰ï¼Œä»è€Œè®© CPU å°†å¯¹è±¡é¢„è¯»è‡³ç¼“å­˜æ—¶<strong>å ç”¨ä¸åŒçš„ç¼“å­˜è¡Œ</strong>ï¼Œè¿™æ ·ï¼Œä¸ä¼šé€ æˆå¯¹æ–¹ç¼“å­˜è¡Œçš„å¤±æ•ˆ</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150119.png" alt="img"></a></p>
<p><strong>ç´¯åŠ ä¸»è¦è°ƒç”¨ä»¥ä¸‹æ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public void add(long x) &#123;</span><br><span class="line">       Cell[] as; long b, v; int m; Cell a;</span><br><span class="line">       if ((as &#x3D; cells) !&#x3D; null || !casBase(b &#x3D; base, b + x)) &#123;</span><br><span class="line">           boolean uncontended &#x3D; true;</span><br><span class="line">           if (as &#x3D;&#x3D; null || (m &#x3D; as.length - 1) &lt; 0 ||</span><br><span class="line">               (a &#x3D; as[getProbe() &amp; m]) &#x3D;&#x3D; null ||</span><br><span class="line">               !(uncontended &#x3D; a.cas(v &#x3D; a.value, v + x)))</span><br><span class="line">               longAccumulate(x, null, uncontended);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>ç´¯åŠ æµç¨‹å›¾</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150129.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150129.png" alt="img"></a></p>
<h2 id="9ã€Unsafe"><a href="#9ã€Unsafe" class="headerlink" title="9ã€Unsafe"></a>9ã€Unsafe</h2><p>Unsafe å¯¹è±¡æä¾›äº†éå¸¸åº•å±‚çš„ï¼Œæ“ä½œå†…å­˜ã€çº¿ç¨‹çš„æ–¹æ³•ï¼ŒUnsafe å¯¹è±¡ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡<strong>åå°„</strong>è·å¾—</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public class GetUnsafe &#123;</span><br><span class="line">	public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, NoSuchFieldException &#123;</span><br><span class="line">		&#x2F;&#x2F; é€šè¿‡åå°„è·å¾—Unsafeå¯¹è±¡</span><br><span class="line">		Class unsafeClass &#x3D; Unsafe.class;</span><br><span class="line">		&#x2F;&#x2F; è·å¾—æ„é€ å‡½æ•°ï¼ŒUnsafeçš„æ„é€ å‡½æ•°ä¸ºç§æœ‰çš„</span><br><span class="line">		Constructor constructor &#x3D; unsafeClass.getDeclaredConstructor();</span><br><span class="line">		&#x2F;&#x2F; è®¾ç½®ä¸ºå…è®¸è®¿é—®ç§æœ‰å†…å®¹</span><br><span class="line">		constructor.setAccessible(true);</span><br><span class="line">		&#x2F;&#x2F; åˆ›å»ºUnsafeå¯¹è±¡</span><br><span class="line">		Unsafe unsafe &#x3D; (Unsafe) constructor.newInstance();</span><br><span class="line">		</span><br><span class="line">		&#x2F;&#x2F; åˆ›å»ºPersonå¯¹è±¡</span><br><span class="line">		Person person &#x3D; new Person();</span><br><span class="line">		&#x2F;&#x2F; è·å¾—å…¶å±æ€§ name çš„åç§»é‡</span><br><span class="line">		Field field &#x3D; Person.class.getDeclaredField(&quot;name&quot;);</span><br><span class="line">		long offset &#x3D; unsafe.objectFieldOffset(field);</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; é€šè¿‡unsafeçš„CASæ“ä½œæ”¹å˜å€¼</span><br><span class="line">		unsafe.compareAndSwapObject(person, offset, null, &quot;Nyima&quot;);</span><br><span class="line">		System.out.println(person);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Person &#123;</span><br><span class="line">    &#x2F;&#x2F; é…åˆCASæ“ä½œï¼Œå¿…é¡»ç”¨volatileä¿®é¥°</span><br><span class="line"> 	volatile String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public String toString() &#123;</span><br><span class="line">		return &quot;Person&#123;&quot; +</span><br><span class="line">				&quot;name&#x3D;&#39;&quot; + name + &#39;\&#39;&#39; +</span><br><span class="line">				&#39;&#125;&#39;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h1 id="å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜"><a href="#å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜" class="headerlink" title="å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜"></a>å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜</h1><h3 id="1ã€ä¸å¯å˜"><a href="#1ã€ä¸å¯å˜" class="headerlink" title="1ã€ä¸å¯å˜"></a>1ã€ä¸å¯å˜</h3><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨<strong>ä¸èƒ½å¤Ÿä¿®</strong>æ”¹å…¶å†…éƒ¨çŠ¶æ€ï¼ˆå±æ€§ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºä¸å­˜åœ¨å¹¶å‘ä¿®æ”¹ã€‚</p>
<h3 id="2ã€ä¸å¯å˜è®¾è®¡"><a href="#2ã€ä¸å¯å˜è®¾è®¡" class="headerlink" title="2ã€ä¸å¯å˜è®¾è®¡"></a>2ã€ä¸å¯å˜è®¾è®¡</h3><h4 id="Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°"><a href="#Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°" class="headerlink" title="Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°"></a>Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public final class String</span><br><span class="line">    implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123;</span><br><span class="line">    &#x2F;** The value is used for character storage. *&#x2F;</span><br><span class="line">    private final char value[];</span><br><span class="line"></span><br><span class="line">    &#x2F;** Cache the hash code for the string *&#x2F;</span><br><span class="line">    private int hash; &#x2F;&#x2F; Default to 0</span><br><span class="line">    </span><br><span class="line">   &#x2F;&#x2F;....</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>ï¬nal çš„ä½¿ç”¨ **<br>å‘ç°è¯¥ç±»ã€ç±»ä¸­æ‰€æœ‰å±æ€§éƒ½æ˜¯ **ï¬nal</strong> çš„</p>
<ul>
<li>å±æ€§ç”¨ ï¬nal ä¿®é¥°ä¿è¯äº†è¯¥å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸èƒ½ä¿®æ”¹</li>
<li>ç±»ç”¨ ï¬nal ä¿®é¥°ä¿è¯äº†è¯¥ç±»ä¸­çš„æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ï¼Œ<strong>é˜²æ­¢å­ç±»æ— æ„é—´ç ´åä¸å¯å˜æ€§</strong></li>
</ul>
<p>**ä¿æŠ¤æ€§æ‹·è´ **</p>
<p>ä½†æœ‰åŒå­¦ä¼šè¯´ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿæœ‰ä¸€äº›è·Ÿä¿®æ”¹ç›¸å…³çš„æ–¹æ³•å•Šï¼Œæ¯”å¦‚ substring ç­‰ï¼Œé‚£ä¹ˆä¸‹é¢å°±çœ‹ä¸€çœ‹è¿™äº›æ–¹æ³•æ˜¯ å¦‚ä½•å®ç°çš„ï¼Œå°±ä»¥ substring ä¸ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public String substring(int beginIndex) &#123;</span><br><span class="line">        if (beginIndex &lt; 0) &#123;</span><br><span class="line">            throw new StringIndexOutOfBoundsException(beginIndex);</span><br><span class="line">        &#125;</span><br><span class="line">        int subLen &#x3D; value.length - beginIndex;</span><br><span class="line">        if (subLen &lt; 0) &#123;</span><br><span class="line">            throw new StringIndexOutOfBoundsException(subLen);</span><br><span class="line">        &#125;</span><br><span class="line">    	&#x2F;&#x2F;è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡</span><br><span class="line">        return (beginIndex &#x3D;&#x3D; 0) ? this : new String(value, beginIndex, subLen);</span><br><span class="line">    &#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å‘ç°å…¶å†…éƒ¨æ˜¯è°ƒç”¨ String çš„æ„é€ æ–¹æ³•<strong>åˆ›å»ºäº†ä¸€ä¸ªæ–°å­—ç¬¦ä¸²</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public String(char value[], int offset, int count) &#123;</span><br><span class="line">        if (offset &lt; 0) &#123;</span><br><span class="line">            throw new StringIndexOutOfBoundsException(offset);</span><br><span class="line">        &#125;</span><br><span class="line">        if (count &lt;&#x3D; 0) &#123;</span><br><span class="line">            if (count &lt; 0) &#123;</span><br><span class="line">                throw new StringIndexOutOfBoundsException(count);</span><br><span class="line">            &#125;</span><br><span class="line">            if (offset &lt;&#x3D; value.length) &#123;</span><br><span class="line">                this.value &#x3D; &quot;&quot;.value;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; Note: offset or count might be near -1&gt;&gt;&gt;1.</span><br><span class="line">        if (offset &gt; value.length - count) &#123;</span><br><span class="line">            throw new StringIndexOutOfBoundsException(offset + count);</span><br><span class="line">        &#125;</span><br><span class="line">        this.value &#x3D; Arrays.copyOfRange(value, offset, offset+count);</span><br><span class="line">    &#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ„é€ æ–°å­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼Œä¼šç”Ÿæˆæ–°çš„ char[] valueï¼Œå¯¹å†…å®¹è¿›è¡Œå¤åˆ¶ ã€‚è¿™ç§é€šè¿‡åˆ›å»ºå‰¯æœ¬å¯¹è±¡æ¥é¿å…å…±äº«çš„æ‰‹æ®µç§°ä¹‹ä¸ºã€<strong>ä¿æŠ¤æ€§æ‹·è´</strong>ï¼ˆdefensive copyï¼‰ã€‘</p>
<h1 id="ä¸ƒã€çº¿ç¨‹æ± "><a href="#ä¸ƒã€çº¿ç¨‹æ± " class="headerlink" title="ä¸ƒã€çº¿ç¨‹æ± "></a>ä¸ƒã€çº¿ç¨‹æ± </h1><h2 id="1ã€è‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#1ã€è‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="1ã€è‡ªå®šä¹‰çº¿ç¨‹æ± "></a>1ã€è‡ªå®šä¹‰çº¿ç¨‹æ± </h2><h3 id="å›¾è§£"><a href="#å›¾è§£" class="headerlink" title="å›¾è§£"></a>å›¾è§£</h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201021154837.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201021154837.png" alt="img"></a></p>
<ul>
<li>é˜»å¡é˜Ÿåˆ—ä¸­ç»´æŠ¤äº†ç”±ä¸»çº¿ç¨‹ï¼ˆæˆ–è€…å…¶ä»–çº¿ç¨‹ï¼‰æ‰€äº§ç”Ÿçš„çš„ä»»åŠ¡</li>
<li>ä¸»çº¿ç¨‹ç±»ä¼¼äº<strong>ç”Ÿäº§è€…</strong>ï¼Œäº§ç”Ÿä»»åŠ¡å¹¶æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­</li>
<li>çº¿ç¨‹æ± ç±»ä¼¼äº<strong>æ¶ˆè´¹è€…</strong>ï¼Œå¾—åˆ°é˜»å¡é˜Ÿåˆ—ä¸­å·²æœ‰çš„ä»»åŠ¡å¹¶æ‰§è¡Œ</li>
</ul>
<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line">public class Demo3 &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      ThreadPool threadPool &#x3D; new ThreadPool(2,  TimeUnit.SECONDS, 1, 4);</span><br><span class="line">      for (int i &#x3D; 0; i &lt; 10; i++) &#123;</span><br><span class="line">         threadPool.execute(()-&gt;&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">               TimeUnit.SECONDS.sleep(10000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ!&quot;);</span><br><span class="line">         &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * è‡ªå®šä¹‰çº¿ç¨‹æ± </span><br><span class="line"> *&#x2F;</span><br><span class="line">class ThreadPool &#123;</span><br><span class="line">   &#x2F;**</span><br><span class="line">    * è‡ªå®šä¹‰é˜»å¡é˜Ÿåˆ—</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private BlockingQueue&lt;Runnable&gt; blockingQueue;</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * æ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private int coreSize;</span><br><span class="line"></span><br><span class="line">   private HashSet&lt;Worker&gt; workers &#x3D; new HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * ç”¨äºæŒ‡å®šçº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private TimeUnit timeUnit;</span><br><span class="line">   private long timeout;</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * å·¥ä½œçº¿ç¨‹ç±»</span><br><span class="line">    * å†…éƒ¨å°è£…äº†Threadç±»ï¼Œå¹¶ä¸”æ·»åŠ äº†ä¸€äº›å±æ€§</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private class Worker extends Thread &#123;</span><br><span class="line">      Runnable task;</span><br><span class="line"></span><br><span class="line">      public Worker(Runnable task) &#123;</span><br><span class="line">         System.out.println(&quot;åˆå§‹åŒ–ä»»åŠ¡&quot;);</span><br><span class="line">         this.task &#x3D; task;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      @Override</span><br><span class="line">      public void run() &#123;</span><br><span class="line">         &#x2F;&#x2F; å¦‚æœæœ‰ä»»åŠ¡å°±æ‰§è¡Œ</span><br><span class="line">         &#x2F;&#x2F; å¦‚æœé˜»å¡é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡ï¼Œå°±ç»§ç»­æ‰§è¡Œ</span><br><span class="line">         while (task !&#x3D; null || (task &#x3D; blockingQueue.take()) !&#x3D; null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">               System.out.println(&quot;æ‰§è¡Œä»»åŠ¡&quot;);</span><br><span class="line">               task.run();</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">               &#x2F;&#x2F; ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè®¾ä¸ºç©º</span><br><span class="line">               System.out.println(&quot;ä»»åŠ¡æ‰§è¡Œå®Œæ¯•&quot;);</span><br><span class="line">               task &#x3D; null;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         &#x2F;&#x2F; ç§»é™¤ä»»åŠ¡</span><br><span class="line">         synchronized (workers) &#123;</span><br><span class="line">            System.out.println(&quot;ç§»é™¤ä»»åŠ¡&quot;);</span><br><span class="line">            workers.remove(this);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public ThreadPool(int coreSize, TimeUnit timeUnit, long timeout, int capacity) &#123;</span><br><span class="line">      this.coreSize &#x3D; coreSize;</span><br><span class="line">      this.timeUnit &#x3D; timeUnit;</span><br><span class="line">      blockingQueue &#x3D; new BlockingQueue&lt;&gt;(capacity);</span><br><span class="line">      this.timeout &#x3D; timeout;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public void execute(Runnable task) &#123;</span><br><span class="line">      synchronized (workers) &#123;</span><br><span class="line">         &#x2F;&#x2F; åˆ›å»ºä»»åŠ¡</span><br><span class="line">         &#x2F;&#x2F; æ± ä¸­è¿˜æœ‰ç©ºä½™çº¿ç¨‹æ—¶ï¼Œå¯ä»¥è¿è¡Œä»»åŠ¡</span><br><span class="line">         &#x2F;&#x2F; å¦åˆ™é˜»å¡</span><br><span class="line">         if (workers.size() &lt; coreSize) &#123;</span><br><span class="line">            Worker worker &#x3D; new Worker(task);</span><br><span class="line">            workers.add(worker);</span><br><span class="line">            worker.start();</span><br><span class="line">         &#125; else &#123;</span><br><span class="line">            System.out.println(&quot;çº¿ç¨‹æ± ä¸­çº¿ç¨‹å·²ç”¨å®Œï¼Œè¯·ç¨ç­‰&quot;);</span><br><span class="line">            blockingQueue.put(task);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * é˜»å¡é˜Ÿåˆ—</span><br><span class="line"> * ç”¨äºå­˜æ”¾ä¸»çº¿ç¨‹æˆ–å…¶ä»–çº¿ç¨‹äº§ç”Ÿçš„ä»»åŠ¡</span><br><span class="line"> *&#x2F;</span><br><span class="line">class BlockingQueue&lt;T&gt; &#123;</span><br><span class="line">   &#x2F;**</span><br><span class="line">    * é˜»å¡é˜Ÿåˆ—</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private  Deque&lt;T&gt; blockingQueue;</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * é˜»å¡é˜Ÿåˆ—å®¹é‡</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private int capacity;</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * é”</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private ReentrantLock lock;</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * æ¡ä»¶é˜Ÿåˆ—</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private Condition fullQueue;</span><br><span class="line">   private Condition emptyQueue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   public BlockingQueue(int capacity) &#123;</span><br><span class="line">      blockingQueue &#x3D; new ArrayDeque&lt;&gt;(capacity);</span><br><span class="line">      lock &#x3D; new ReentrantLock();</span><br><span class="line">      fullQueue &#x3D; lock.newCondition();</span><br><span class="line">      emptyQueue &#x3D; lock.newCondition();</span><br><span class="line">      this.capacity &#x3D; capacity;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * è·å–ä»»åŠ¡çš„æ–¹æ³•</span><br><span class="line">    *&#x2F;</span><br><span class="line">   public T take() &#123;</span><br><span class="line">      &#x2F;&#x2F; åŠ é”</span><br><span class="line">      lock.lock();</span><br><span class="line">      try &#123;</span><br><span class="line">         &#x2F;&#x2F; å¦‚æœé˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼ˆæ²¡æœ‰ä»»åŠ¡ï¼‰ï¼Œå°±ä¸€ç›´ç­‰å¾…</span><br><span class="line">         while (blockingQueue.isEmpty()) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">               emptyQueue.await();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         &#x2F;&#x2F; è·å–ä»»åŠ¡å¹¶å”¤é†’ç”Ÿäº§è€…çº¿ç¨‹</span><br><span class="line">         T task &#x3D; blockingQueue.removeFirst();</span><br><span class="line">         fullQueue.signalAll();</span><br><span class="line">         return task;</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">         lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public T takeNanos(long timeout, TimeUnit unit) &#123;</span><br><span class="line">      &#x2F;&#x2F; è½¬æ¢ç­‰å¾…æ—¶é—´</span><br><span class="line">      lock.lock();</span><br><span class="line">      try &#123;</span><br><span class="line">         long nanos &#x3D; unit.toNanos(timeout);</span><br><span class="line">         while (blockingQueue.isEmpty()) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">               &#x2F;&#x2F; awaitNanosä¼šè¿”å›å‰©ä¸‹çš„ç­‰å¾…æ—¶é—´</span><br><span class="line">               nanos &#x3D; emptyQueue.awaitNanos(nanos);</span><br><span class="line">               if (nanos &lt; 0) &#123;</span><br><span class="line">                  return null;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         T task &#x3D; blockingQueue.removeFirst();</span><br><span class="line">         fullQueue.signalAll();</span><br><span class="line">         return task;</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">         lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   &#x2F;**</span><br><span class="line">    * æ”¾å…¥ä»»åŠ¡çš„æ–¹æ³•</span><br><span class="line">    * @param task æ”¾å…¥é˜»å¡é˜Ÿåˆ—çš„ä»»åŠ¡</span><br><span class="line">    *&#x2F;</span><br><span class="line">   public void put(T task) &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      try &#123;</span><br><span class="line">         while (blockingQueue.size() &#x3D;&#x3D; capacity) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">               System.out.println(&quot;é˜»å¡é˜Ÿåˆ—å·²æ»¡&quot;);</span><br><span class="line">               fullQueue.await();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         blockingQueue.add(task);</span><br><span class="line">         &#x2F;&#x2F; å”¤é†’ç­‰å¾…çš„æ¶ˆè´¹è€…</span><br><span class="line">         emptyQueue.signalAll();</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">         lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public int getSize() &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      try &#123;</span><br><span class="line">         return blockingQueue.size();</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">         lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å®ç°äº†ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± </p>
<ul>
<li>é˜»å¡é˜Ÿåˆ—BlockingQueueç”¨äºæš‚å­˜æ¥ä¸åŠè¢«çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡<ul>
<li>ä¹Ÿå¯ä»¥è¯´æ˜¯å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ‰§è¡Œé€Ÿåº¦ä¸Šçš„å·®å¼‚</li>
<li>é‡Œé¢çš„è·å–ä»»åŠ¡å’Œæ”¾å…¥ä»»åŠ¡ç”¨åˆ°äº†<strong>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼</strong></li>
</ul>
</li>
<li>çº¿ç¨‹æ± ä¸­å¯¹çº¿ç¨‹Threadè¿›è¡Œäº†å†æ¬¡çš„å°è£…ï¼Œå°è£…ä¸ºäº†Worker<ul>
<li>åœ¨è°ƒç”¨ä»»åŠ¡çš„runæ–¹æ³•æ—¶ï¼Œçº¿ç¨‹ä¼šå»æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åè¿˜ä¼š<strong>åˆ°é˜»å¡é˜Ÿåˆ—ä¸­è·å–æ–°ä»»åŠ¡æ¥æ‰§è¡Œ</strong></li>
</ul>
</li>
<li>çº¿ç¨‹æ± ä¸­æ‰§è¡Œä»»åŠ¡çš„ä¸»è¦æ–¹æ³•ä¸ºexecuteæ–¹æ³•<ul>
<li>æ‰§è¡Œæ—¶è¦åˆ¤æ–­æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ•°æ˜¯å¦å¤§äºäº†çº¿ç¨‹æ± å®¹é‡</li>
</ul>
</li>
</ul>
<h2 id="2ã€ThreadPoolExecutor"><a href="#2ã€ThreadPoolExecutor" class="headerlink" title="2ã€ThreadPoolExecutor"></a>2ã€ThreadPoolExecutor</h2><h3 id="ç»§æ‰¿å…³ç³»"><a href="#ç»§æ‰¿å…³ç³»" class="headerlink" title="ç»§æ‰¿å…³ç³»"></a>ç»§æ‰¿å…³ç³»</h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022212832.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022212832.png" alt="img"></a></p>
<h3 id="çº¿ç¨‹æ± çŠ¶æ€"><a href="#çº¿ç¨‹æ± çŠ¶æ€" class="headerlink" title="çº¿ç¨‹æ± çŠ¶æ€"></a>çº¿ç¨‹æ± çŠ¶æ€</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; çº¿ç¨‹æ± çŠ¶æ€</span><br><span class="line">&#x2F;&#x2F; runState is stored in the high-order bits</span><br><span class="line">&#x2F;&#x2F; RUNNING é«˜3ä½ä¸º111</span><br><span class="line">private static final int RUNNING    &#x3D; -1 &lt;&lt; COUNT_BITS;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; SHUTDOWN é«˜3ä½ä¸º000</span><br><span class="line">private static final int SHUTDOWN   &#x3D;  0 &lt;&lt; COUNT_BITS;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; é«˜3ä½ 001</span><br><span class="line">private static final int STOP       &#x3D;  1 &lt;&lt; COUNT_BITS;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; é«˜3ä½ 010</span><br><span class="line">private static final int TIDYING    &#x3D;  2 &lt;&lt; COUNT_BITS;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; é«˜3ä½ 011</span><br><span class="line">private static final int TERMINATED &#x3D;  3 &lt;&lt; COUNT_BITS;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>çŠ¶æ€åç§°</th>
<th>é«˜3ä½çš„å€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>RUNNING</td>
<td>111</td>
<td>æ¥æ”¶æ–°ä»»åŠ¡ï¼ŒåŒæ—¶å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>SHUTDOWN</td>
<td>000</td>
<td>ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä½†æ˜¯å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>STOP</td>
<td>001</td>
<td>ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒåŒæ—¶æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td>
</tr>
<tr>
<td>TIDYING</td>
<td>010</td>
<td>ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ´»åŠ¨çº¿ç¨‹ä¸º0æ—¶ï¼Œå³å°†è¿›å…¥ç»ˆç»“é˜¶æ®µ</td>
</tr>
<tr>
<td>TERMINATED</td>
<td>011</td>
<td>ç»ˆç»“çŠ¶æ€</td>
</tr>
</tbody></table>
<p>çº¿ç¨‹æ± çŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡<strong>ç”±ä¸€ä¸ªåŸå­æ•´å‹ctlæ¥å…±åŒè¡¨ç¤º</strong></p>
<ul>
<li>ä½¿ç”¨ä¸€ä¸ªæ•°æ¥è¡¨ç¤ºä¸¤ä¸ªå€¼çš„ä¸»è¦åŸå› æ˜¯ï¼š<strong>å¯ä»¥é€šè¿‡ä¸€æ¬¡CASåŒæ—¶æ›´æ”¹ä¸¤ä¸ªå±æ€§çš„å€¼</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; åŸå­æ•´æ•°ï¼Œå‰3ä½ä¿å­˜äº†çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå‰©ä½™ä½ä¿å­˜çš„æ˜¯çº¿ç¨‹æ•°é‡</span><br><span class="line">private final AtomicInteger ctl &#x3D; new AtomicInteger(ctlOf(RUNNING, 0));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å¹¶ä¸æ˜¯æ‰€æœ‰å¹³å°çš„intéƒ½æ˜¯32ä½ã€‚</span><br><span class="line">&#x2F;&#x2F; å»æ‰å‰ä¸‰ä½ä¿å­˜çº¿ç¨‹çŠ¶æ€çš„ä½æ•°ï¼Œå‰©ä¸‹çš„ç”¨äºä¿å­˜çº¿ç¨‹æ•°é‡</span><br><span class="line">&#x2F;&#x2F; é«˜3ä½ä¸º0ï¼Œå‰©ä½™ä½æ•°å…¨ä¸º1</span><br><span class="line">private static final int COUNT_BITS &#x3D; Integer.SIZE - 3;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 2^COUNT_BITSæ¬¡æ–¹ï¼Œè¡¨ç¤ºå¯ä»¥ä¿å­˜çš„æœ€å¤§çº¿ç¨‹æ•°</span><br><span class="line">&#x2F;&#x2F; CAPACITY çš„é«˜3ä½ä¸º 0</span><br><span class="line">private static final int CAPACITY   &#x3D; (1 &lt;&lt; COUNT_BITS) - 1;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è·å–çº¿ç¨‹æ± çŠ¶æ€ã€çº¿ç¨‹æ•°é‡ä»¥åŠåˆå¹¶ä¸¤ä¸ªå€¼çš„æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Packing and unpacking ctl</span><br><span class="line">&#x2F;&#x2F; è·å–è¿è¡ŒçŠ¶æ€</span><br><span class="line">&#x2F;&#x2F; è¯¥æ“ä½œä¼šè®©é™¤é«˜3ä½ä»¥å¤–çš„æ•°å…¨éƒ¨å˜ä¸º0</span><br><span class="line">private static int runStateOf(int c)     &#123; return c &amp; ~CAPACITY; &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; è·å–è¿è¡Œçº¿ç¨‹æ•°</span><br><span class="line">&#x2F;&#x2F; è¯¥æ“ä½œä¼šè®©é«˜3ä½ä¸º0</span><br><span class="line">private static int workerCountOf(int c)  &#123; return c &amp; CAPACITY; &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; è®¡ç®—ctlæ–°å€¼</span><br><span class="line">private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="çº¿ç¨‹æ± å±æ€§"><a href="#çº¿ç¨‹æ± å±æ€§" class="headerlink" title="çº¿ç¨‹æ± å±æ€§"></a>çº¿ç¨‹æ± å±æ€§</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å·¥ä½œçº¿ç¨‹ï¼Œå†…éƒ¨å°è£…äº†Thread</span><br><span class="line">private final class Worker</span><br><span class="line">        extends AbstractQueuedSynchronizer</span><br><span class="line">        implements Runnable &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; é˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºå­˜æ”¾æ¥ä¸åŠè¢«æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡</span><br><span class="line">private final BlockingQueue&lt;Runnable&gt; workQueue;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; é”</span><br><span class="line">private final ReentrantLock mainLock &#x3D; new ReentrantLock();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;  ç”¨äºå­˜æ”¾æ ¸å¿ƒçº¿ç¨‹çš„å®¹å™¨ï¼Œåªæœ‰å½“æŒæœ‰é”æ—¶æ‰èƒ½å¤Ÿè·å–å…¶ä¸­çš„å…ƒç´ ï¼ˆæ ¸å¿ƒçº¿ç¨‹ï¼‰</span><br><span class="line">private final HashSet&lt;Worker&gt; workers &#x3D; new HashSet&lt;Worker&gt;();</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="æ„é€ æ–¹æ³•æå…¶å‚æ•°"><a href="#æ„é€ æ–¹æ³•æå…¶å‚æ•°" class="headerlink" title="æ„é€ æ–¹æ³•æå…¶å‚æ•°"></a>æ„é€ æ–¹æ³•æå…¶å‚æ•°</h3><p><strong>ThreadPoolExecutoræœ€å…¨é¢çš„æ„é€ æ–¹æ³•</strong></p>
<p>ä¹Ÿæ˜¯æ„é€ è‡ªå®šä¹‰çº¿ç¨‹æ± çš„æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public ThreadPoolExecutor(int corePoolSize,</span><br><span class="line">                          int maximumPoolSize,</span><br><span class="line">                          long keepAliveTime,</span><br><span class="line">                          TimeUnit unit,</span><br><span class="line">                          BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="line">                          ThreadFactory threadFactory,</span><br><span class="line">                          RejectedExecutionHandler handler)</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="å‚æ•°è§£é‡Š"><a href="#å‚æ•°è§£é‡Š" class="headerlink" title="å‚æ•°è§£é‡Š"></a><strong>å‚æ•°è§£é‡Š</strong></h4><ul>
<li>corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°</li>
<li>maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°<ul>
<li>maximumPoolSize - corePoolSize = æ•‘æ€¥çº¿ç¨‹æ•°</li>
</ul>
</li>
<li>keepAliveTimeï¼šæ•‘æ€¥çº¿ç¨‹ç©ºé—²æ—¶çš„æœ€å¤§ç”Ÿå­˜æ—¶é—´</li>
<li>unitï¼šæ—¶é—´å•ä½</li>
<li>workQueueï¼šé˜»å¡é˜Ÿåˆ—ï¼ˆå­˜æ”¾ä»»åŠ¡ï¼‰<ul>
<li>æœ‰ç•Œé˜»å¡é˜Ÿåˆ— ArrayBlockingQueue</li>
<li>æ— ç•Œé˜»å¡é˜Ÿåˆ— LinkedBlockingQueue</li>
<li>æœ€å¤šåªæœ‰ä¸€ä¸ªåŒæ­¥å…ƒç´ çš„ SynchronousQueue</li>
<li>ä¼˜å…ˆé˜Ÿåˆ— PriorityBlockingQueue</li>
</ul>
</li>
<li>threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼ˆç»™çº¿ç¨‹å–åå­—ï¼‰</li>
<li>handlerï¼šæ‹’ç»ç­–ç•¥</li>
</ul>
<h4 id="å·¥ä½œæ–¹å¼"><a href="#å·¥ä½œæ–¹å¼" class="headerlink" title="å·¥ä½œæ–¹å¼"></a>å·¥ä½œæ–¹å¼</h4><ul>
<li>å½“ä¸€ä¸ªä»»åŠ¡ä¼ ç»™çº¿ç¨‹æ± ä»¥åï¼Œå¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½<ul>
<li>å°†ä»»åŠ¡åˆ†é…ç»™ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œ</li>
<li>æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå°†ä»»åŠ¡æ”¾åˆ°é˜»å¡é˜Ÿåˆ—workQueueä¸­ç­‰å¾…è¢«æ‰§è¡Œ</li>
<li>é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä½¿ç”¨æ•‘æ€¥çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡<ul>
<li>æ•‘æ€¥çº¿ç¨‹ç”¨å®Œä»¥åï¼Œè¶…è¿‡ç”Ÿå­˜æ—¶é—´ï¼ˆkeepAliveTimeï¼‰åä¼šè¢«é‡Šæ”¾</li>
</ul>
</li>
<li>ä»»åŠ¡æ€»æ•°å¤§äºäº† æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰ä¸é˜»å¡é˜Ÿåˆ—å®¹é‡çš„æœ€å¤§å€¼ï¼ˆworkQueue.capacityï¼‰ï¼Œä½¿ç”¨æ‹’æ¥ç­–ç•¥</li>
</ul>
</li>
</ul>
<h4 id="æ‹’ç»ç­–ç•¥"><a href="#æ‹’ç»ç­–ç•¥" class="headerlink" title="æ‹’ç»ç­–ç•¥"></a>æ‹’ç»ç­–ç•¥</h4><p>å¦‚æœçº¿ç¨‹åˆ°è¾¾ maximumPoolSize ä»ç„¶æœ‰æ–°ä»»åŠ¡è¿™æ—¶ä¼šæ‰§è¡Œ<strong>æ‹’ç»ç­–ç•¥</strong>ã€‚æ‹’ç»ç­–ç•¥ jdk æä¾›äº† 4 ç§å®ç°</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022194718.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022194718.png" alt="img"></a></p>
<ul>
<li>AbortPolicyï¼šè®©è°ƒç”¨è€…æŠ›å‡º RejectedExecutionException å¼‚å¸¸ï¼Œ<strong>è¿™æ˜¯é»˜è®¤ç­–ç•¥</strong></li>
<li>CallerRunsPolicyï¼šè®©è°ƒç”¨è€…è¿è¡Œä»»åŠ¡</li>
<li>DiscardPolicyï¼šæ”¾å¼ƒæœ¬æ¬¡ä»»åŠ¡</li>
<li>DiscardOldestPolicyï¼šæ”¾å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—©çš„ä»»åŠ¡ï¼Œæœ¬ä»»åŠ¡å–è€Œä»£ä¹‹</li>
</ul>
<h4 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public class Demo1 &#123;</span><br><span class="line">   static AtomicInteger threadId &#x3D; new AtomicInteger(0);</span><br><span class="line"></span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      &#x2F;&#x2F; æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span><br><span class="line">      &#x2F;&#x2F; åˆ›å»ºæœ‰ç•Œé˜»å¡é˜Ÿåˆ—</span><br><span class="line">      ArrayBlockingQueue&lt;Runnable&gt; runnable &#x3D; new ArrayBlockingQueue&lt;Runnable&gt;(10);</span><br><span class="line">      &#x2F;&#x2F; åˆ›å»ºçº¿ç¨‹å·¥å‚</span><br><span class="line">      ThreadFactory threadFactory &#x3D; new ThreadFactory() &#123;</span><br><span class="line">         @Override</span><br><span class="line">         public Thread newThread(Runnable r) &#123;</span><br><span class="line">            Thread thread &#x3D; new Thread(r, &quot;working_thread_&quot;+threadId.getAndIncrement());</span><br><span class="line">            return thread;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span><br><span class="line">      &#x2F;&#x2F; æ‹’ç»ç­–ç•¥é‡‡ç”¨é»˜è®¤ç­–ç•¥</span><br><span class="line">      ThreadPoolExecutor executor &#x3D; new ThreadPoolExecutor(5, 7, 10, TimeUnit.SECONDS, runnable, threadFactory);</span><br><span class="line"></span><br><span class="line">      for (int i &#x3D; 0; i &lt; 20; i++) &#123;</span><br><span class="line">         executor.execute(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">               System.out.println(Thread.currentThread());</span><br><span class="line">               try &#123;</span><br><span class="line">                  Thread.sleep(100000);</span><br><span class="line">               &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                  e.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="FixedThreadPool"><a href="#FixedThreadPool" class="headerlink" title="FixedThreadPool"></a>FixedThreadPool</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class TestFixedThreadPool &#123;</span><br><span class="line">   public static void main(String[] args) &#123;</span><br><span class="line">      &#x2F;&#x2F; è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚</span><br><span class="line">      ThreadFactory factory &#x3D; new ThreadFactory() &#123;</span><br><span class="line">         AtomicInteger atomicInteger &#x3D; new AtomicInteger(1);</span><br><span class="line"></span><br><span class="line">         @Override</span><br><span class="line">         public Thread newThread(Runnable r) &#123;</span><br><span class="line">            return new Thread(r, &quot;myThread_&quot; + atomicInteger.getAndIncrement());</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º2çš„çº¿ç¨‹æ± </span><br><span class="line">      &#x2F;&#x2F; é€šè¿‡ ThreadFactoryå¯ä»¥ç»™çº¿ç¨‹æ·»åŠ åå­—</span><br><span class="line"></span><br><span class="line">      ExecutorService executorService &#x3D; Executors.newFixedThreadPool(2, factory);</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; ä»»åŠ¡</span><br><span class="line">      Runnable runnable &#x3D; new Runnable() &#123;</span><br><span class="line">         @Override</span><br><span class="line">         public void run() &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName());</span><br><span class="line">            System.out.println(&quot;this is fixedThreadPool&quot;);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      </span><br><span class="line">      executorService.execute(runnable);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å›ºå®šå¤§å°çš„çº¿ç¨‹æ± å¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°</p>
<ul>
<li>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼šnThreads</li>
<li>çº¿ç¨‹å·¥å‚ï¼šthreadFactory</li>
</ul>
<p>å†…éƒ¨è°ƒç”¨çš„æ„é€ æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                              0L, TimeUnit.MILLISECONDS,</span><br><span class="line">                              new LinkedBlockingQueue&lt;Runnable&gt;(),</span><br><span class="line">                              threadFactory);</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="CachedThreadPool"><a href="#CachedThreadPool" class="headerlink" title="CachedThreadPool"></a>CachedThreadPool</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executorService &#x3D; Executors.newCachedThreadPool();</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>å†…éƒ¨æ„é€ æ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor(0, Integer.MAX_VALUE,</span><br><span class="line">                              60L, TimeUnit.SECONDS,</span><br><span class="line">                              new SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUEï¼Œ<strong>æ‰€æœ‰åˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯æ•‘æ€¥çº¿ç¨‹</strong>ï¼Œç©ºé—²æ—¶ç”Ÿå­˜æ—¶é—´ä¸º60ç§’</p>
</li>
<li><p>é˜»å¡é˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯SynchronousQueue</p>
<ul>
<li><p>SynchronousQueue</p>
<p>æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—</p>
<ul>
<li><strong>æ²¡æœ‰å®¹é‡</strong>ï¼Œæ²¡æœ‰çº¿ç¨‹æ¥å–æ˜¯æ”¾ä¸è¿›å»çš„</li>
<li>åªæœ‰å½“çº¿ç¨‹å–ä»»åŠ¡æ—¶ï¼Œæ‰ä¼šå°†ä»»åŠ¡æ”¾å…¥è¯¥é˜»å¡é˜Ÿåˆ—ä¸­</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="SingleThread"><a href="#SingleThread" class="headerlink" title="SingleThread"></a>SingleThread</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService service &#x3D; Executors.newSingleThreadExecutor();</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>å†…éƒ¨æ„é€ æ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new FinalizableDelegatedExecutorService</span><br><span class="line">    (new ThreadPoolExecutor(1, 1,</span><br><span class="line">                            0L, TimeUnit.MILLISECONDS,</span><br><span class="line">                            new LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å†…éƒ¨è°ƒç”¨äº†<strong>new ThreadPoolExecutor</strong>çš„æ„é€ æ–¹æ³•ï¼Œä¼ å…¥çš„corePoolSizeå’ŒmaximumPoolSizeéƒ½ä¸º1ã€‚ç„¶åå°†è¯¥å¯¹è±¡ä¼ ç»™äº†FinalizableDelegatedExecutorServiceã€‚è¯¥ç±»ä¿®é¥°äº†ThreadPoolExecutorï¼Œè®©å¤–éƒ¨æ— æ³•è°ƒç”¨ThreadPoolExecutorå†…éƒ¨çš„æŸäº›æ–¹æ³•æ¥ä¿®æ”¹æ‰€åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°ã€‚</p>
<h4 id="å‡ ä¸ªæ³¨æ„"><a href="#å‡ ä¸ªæ³¨æ„" class="headerlink" title="å‡ ä¸ªæ³¨æ„"></a>å‡ ä¸ªæ³¨æ„</h4><ul>
<li><p>SingleThreadå’Œè‡ªå·±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥è¿è¡Œå¤šä¸ªä»»åŠ¡çš„åŒºåˆ«</p>
<ul>
<li>å½“çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå¦‚æœæ˜¯è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ï¼Œè¯¥ä»»åŠ¡å’Œå‰©ä½™çš„ä»»åŠ¡å°±æ— æ³•å†ç»§ç»­è¿è¡Œä¸‹å»ã€‚è€ŒSingleThreadä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—ä¸­å‰©ä½™çš„ä»»åŠ¡ã€‚</li>
</ul>
</li>
<li><p>SingleThreadå’ŒnewFixedThreadPool(1)çš„åŒºåˆ«</p>
<ul>
<li>newFixedThreadPool(1)ä¼ å€¼ä¸º1ï¼Œå¯ä»¥å°†FixedThreadPoolå¼ºè½¬ä¸ºThreadPoolExecutorï¼Œç„¶åé€šè¿‡setCorePoolSizeæ”¹å˜æ ¸å¿ƒçº¿ç¨‹æ•°</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å¼ºè½¬ä¸ºThreadPoolExecutor</span><br><span class="line">ThreadPoolExecutor threadPool &#x3D; (ThreadPoolExecutor) Executors.newFixedThreadPool(1);</span><br><span class="line">&#x2F;&#x2F; æ”¹å˜æ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class="line">threadPool.setCorePoolSize(2);</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>è€ŒSingleThreadæ— æ³•ä¿®æ”¹æ ¸å¿ƒçº¿ç¨‹æ•°</li>
</ul>
</li>
</ul>
<h3 id="æ‰§è¡Œä»»åŠ¡"><a href="#æ‰§è¡Œä»»åŠ¡" class="headerlink" title="æ‰§è¡Œä»»åŠ¡"></a>æ‰§è¡Œä»»åŠ¡</h3><h4 id="execute-æ–¹æ³•"><a href="#execute-æ–¹æ³•" class="headerlink" title="execute()æ–¹æ³•"></a>execute()æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">execute(Runnable command)</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä¼ å…¥ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œæ‰§è¡Œå…¶ä¸­çš„runæ–¹æ³•</p>
<p><strong>æºç è§£æ</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public void execute(Runnable command) &#123;</span><br><span class="line">    if (command &#x3D;&#x3D; null)</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; è·å–ctl</span><br><span class="line">    int c &#x3D; ctl.get();</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; åˆ¤æ–­å½“å‰å¯ç”¨çš„çº¿ç¨‹æ•°æ˜¯å¦å°äºæ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class="line">    if (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">        &#x2F;&#x2F; ä¸ºè¯¥ä»»åŠ¡åˆ†é…çº¿ç¨‹</span><br><span class="line">        if (addWorker(command, true))</span><br><span class="line">            &#x2F;&#x2F; åˆ†é…æˆåŠŸå°±è¿”å›</span><br><span class="line">            return;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; åˆ†é…å¤±è´¥å†æ¬¡è·å–ctl</span><br><span class="line">        c &#x3D; ctl.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; åˆ†é…å’Œä¿¡æ¯çº¿ç¨‹å¤±è´¥ä»¥å</span><br><span class="line">    &#x2F;&#x2F; å¦‚æœæ± çŠ¶æ€ä¸ºRUNNINGå¹¶ä¸”æ’å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—æˆåŠŸ</span><br><span class="line">    if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; åŒé‡æ£€æµ‹ï¼Œå¯èƒ½åœ¨æ·»åŠ åçº¿ç¨‹æ± çŠ¶æ€å˜ä¸ºäº†éRUNNING</span><br><span class="line">        int recheck &#x3D; ctl.get();</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; å¦‚æœæ± çŠ¶æ€ä¸ºéRUNNINGï¼Œåˆ™ä¸ä¼šæ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡</span><br><span class="line">        &#x2F;&#x2F; å°†è¯¥ä»»åŠ¡ä»é˜»å¡é˜Ÿåˆ—ä¸­ç§»é™¤</span><br><span class="line">        if (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">            &#x2F;&#x2F; è°ƒç”¨æ‹’ç»ç­–ç•¥ï¼Œæ‹’ç»è¯¥ä»»åŠ¡çš„æ‰§è¡Œ</span><br><span class="line">            reject(command);</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; å¦‚æœæ²¡æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹</span><br><span class="line">        else if (workerCountOf(recheck) &#x3D;&#x3D; 0)</span><br><span class="line">            &#x2F;&#x2F; å°±åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡</span><br><span class="line">            addWorker(null, false);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; å¦‚æœæ·»åŠ å¤±è´¥äº†ï¼ˆä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œå°±è°ƒç”¨æ‹’ç»ç­–ç•¥</span><br><span class="line">    else if (!addWorker(command, false))</span><br><span class="line">        reject(command);</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­è°ƒç”¨äº†**addWoker()**æ–¹æ³•ï¼Œå†çœ‹çœ‹çœ‹è¿™ä¸ªæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">private boolean addWorker(Runnable firstTask, boolean core) &#123;</span><br><span class="line">    retry:</span><br><span class="line">    for (;;) &#123;</span><br><span class="line">        int c &#x3D; ctl.get();</span><br><span class="line">        int rs &#x3D; runStateOf(c);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; Check if queue empty only if necessary.</span><br><span class="line">        &#x2F;&#x2F; å¦‚æœæ± çŠ¶æ€ä¸ºéRUNNINGçŠ¶æ€ã€çº¿ç¨‹æ± ä¸ºSHUTDOWNä¸”è¯¥ä»»åŠ¡ä¸ºç©º æˆ–è€…é˜»å¡é˜Ÿåˆ—ä¸­å·²ç»æœ‰ä»»åŠ¡</span><br><span class="line">        if (rs &gt;&#x3D; SHUTDOWN &amp;&amp;</span><br><span class="line">            ! (rs &#x3D;&#x3D; SHUTDOWN &amp;&amp;</span><br><span class="line">               firstTask &#x3D;&#x3D; null &amp;&amp;</span><br><span class="line">               ! workQueue.isEmpty()))</span><br><span class="line">            &#x2F;&#x2F; åˆ›å»ºæ–°çº¿ç¨‹å¤±è´¥</span><br><span class="line">            return false;</span><br><span class="line"></span><br><span class="line">        for (;;) &#123;</span><br><span class="line">            &#x2F;&#x2F; è·å¾—å½“å‰å·¥ä½œçº¿ç¨‹æ•°</span><br><span class="line">            int wc &#x3D; workerCountOf(c);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; å‚æ•°ä¸­ core ä¸ºtrue</span><br><span class="line">            &#x2F;&#x2F; CAPACITY ä¸º 1 &lt;&lt; COUNT_BITS-1ï¼Œä¸€èˆ¬ä¸ä¼šè¶…è¿‡</span><br><span class="line">            &#x2F;&#x2F; å¦‚æœå·¥ä½œçº¿ç¨‹æ•°å¤§äºäº†æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºå¤±è´¥</span><br><span class="line">            if (wc &gt;&#x3D; CAPACITY ||</span><br><span class="line">                wc &gt;&#x3D; (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                return false;</span><br><span class="line">            &#x2F;&#x2F; é€šè¿‡CASæ“ä½œæ”¹å˜cçš„å€¼</span><br><span class="line">            if (compareAndIncrementWorkerCount(c))</span><br><span class="line">                &#x2F;&#x2F; æ›´æ”¹æˆåŠŸå°±è·³å‡ºå¤šé‡å¾ªç¯ï¼Œä¸”ä¸å†è¿è¡Œå¾ªç¯</span><br><span class="line">                break retry;</span><br><span class="line">            &#x2F;&#x2F; æ›´æ”¹å¤±è´¥ï¼Œé‡æ–°è·å–ctlçš„å€¼</span><br><span class="line">            c &#x3D; ctl.get();  &#x2F;&#x2F; Re-read ctl</span><br><span class="line">            if (runStateOf(c) !&#x3D; rs)</span><br><span class="line">                &#x2F;&#x2F; è·³å‡ºå¤šé‡å¾ªç¯ï¼Œä¸”é‡æ–°è¿›å…¥å¾ªç¯</span><br><span class="line">                continue retry;</span><br><span class="line">            &#x2F;&#x2F; else CAS failed due to workerCount change; retry inner loop</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; ç”¨äºæ ‡è®°workä¸­çš„ä»»åŠ¡æ˜¯å¦æˆåŠŸæ‰§è¡Œ</span><br><span class="line">    boolean workerStarted &#x3D; false;</span><br><span class="line">    &#x2F;&#x2F; ç”¨äºæ ‡è®°workeræ˜¯å¦æˆåŠŸåŠ å…¥äº†çº¿ç¨‹æ± ä¸­</span><br><span class="line">    boolean workerAdded &#x3D; false;</span><br><span class="line">    Worker w &#x3D; null;</span><br><span class="line">    try &#123;</span><br><span class="line">        &#x2F;&#x2F; åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</span><br><span class="line">        w &#x3D; new Worker(firstTask);</span><br><span class="line">        final Thread t &#x3D; w.thread;</span><br><span class="line">        if (t !&#x3D; null) &#123;</span><br><span class="line">            final ReentrantLock mainLock &#x3D; this.mainLock;</span><br><span class="line">            &#x2F;&#x2F; åŠ é”</span><br><span class="line">            mainLock.lock();</span><br><span class="line">            try &#123;</span><br><span class="line">                &#x2F;&#x2F; Recheck while holding lock.</span><br><span class="line">                &#x2F;&#x2F; Back out on ThreadFactory failure or if</span><br><span class="line">                &#x2F;&#x2F; shut down before lock acquired.</span><br><span class="line">                &#x2F;&#x2F; åŠ é”çš„åŒæ—¶å†æ¬¡æ£€æµ‹</span><br><span class="line">                &#x2F;&#x2F; é¿å…åœ¨é‡Šæ”¾é”ä¹‹å‰è°ƒç”¨äº†shut down</span><br><span class="line">                int rs &#x3D; runStateOf(ctl.get());</span><br><span class="line"></span><br><span class="line">                if (rs &lt; SHUTDOWN ||</span><br><span class="line">                    (rs &#x3D;&#x3D; SHUTDOWN &amp;&amp; firstTask &#x3D;&#x3D; null)) &#123;</span><br><span class="line">                    if (t.isAlive()) &#x2F;&#x2F; precheck that t is startable</span><br><span class="line">                        throw new IllegalThreadStateException();</span><br><span class="line">                    &#x2F;&#x2F; å°†çº¿ç¨‹æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­</span><br><span class="line">                    workers.add(w);</span><br><span class="line">                    int s &#x3D; workers.size();</span><br><span class="line">                    if (s &gt; largestPoolSize)</span><br><span class="line">                        largestPoolSize &#x3D; s;</span><br><span class="line">                    &#x2F;&#x2F; æ·»åŠ æˆåŠŸæ ‡å¿—ä½å˜ä¸ºtrue</span><br><span class="line">                    workerAdded &#x3D; true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                mainLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F; å¦‚æœworkeræˆåŠŸåŠ å…¥äº†çº¿ç¨‹æ± ï¼Œå°±æ‰§è¡Œå…¶ä¸­çš„ä»»åŠ¡</span><br><span class="line">            if (workerAdded) &#123;</span><br><span class="line">                t.start();</span><br><span class="line">                &#x2F;&#x2F; å¯åŠ¨æˆåŠŸ</span><br><span class="line">                workerStarted &#x3D; true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        &#x2F;&#x2F; å¦‚æœæ‰§è¡Œå¤±è´¥</span><br><span class="line">        if (! workerStarted)</span><br><span class="line">            &#x2F;&#x2F; è°ƒç”¨æ·»åŠ å¤±è´¥çš„å‡½æ•°</span><br><span class="line">            addWorkerFailed(w);</span><br><span class="line">    &#125;</span><br><span class="line">    return workerStarted;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="submit-æ–¹æ³•"><a href="#submit-æ–¹æ³•" class="headerlink" title="submit()æ–¹æ³•"></a>submit()æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;T&gt; submit(Callable&lt;T&gt; task) </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä¼ å…¥ä¸€ä¸ªCallableå¯¹è±¡ï¼Œç”¨Futureæ¥<strong>æ•è·è¿”å›å€¼</strong></p>
<p><strong>ä½¿ç”¨</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; é€šè¿‡submitæ‰§è¡ŒCallableä¸­çš„callæ–¹æ³•</span><br><span class="line">&#x2F;&#x2F; é€šè¿‡Futureæ¥æ•è·è¿”å›å€¼</span><br><span class="line">Future&lt;String&gt; future &#x3D; threadPool.submit(new Callable&lt;String&gt;() &#123;</span><br><span class="line">   @Override</span><br><span class="line">   public String call() throws Exception &#123;</span><br><span class="line">      return &quot;hello submit&quot;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; æŸ¥çœ‹æ•è·çš„è¿”å›å€¼</span><br><span class="line">System.out.println(future.get());</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="åœæ­¢"><a href="#åœæ­¢" class="headerlink" title="åœæ­¢"></a>åœæ­¢</h3><h4 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown()"></a>shutdown()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* å°†çº¿ç¨‹æ± çš„çŠ¶æ€æ”¹ä¸º SHUTDOWN</span><br><span class="line">* ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä½†æ˜¯ä¼šå°†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œ</span><br><span class="line">*&#x2F;</span><br><span class="line">public void shutdown() &#123;</span><br><span class="line">    final ReentrantLock mainLock &#x3D; this.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    try &#123;</span><br><span class="line">        checkShutdownAccess();</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ä¸º SHUTDOWN</span><br><span class="line">        advanceRunState(SHUTDOWN);</span><br><span class="line">        </span><br><span class="line">  		&#x2F;&#x2F; ä¸­æ–­ç©ºé—²çº¿ç¨‹ï¼ˆæ²¡æœ‰æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼‰</span><br><span class="line">        &#x2F;&#x2F; Idleï¼šç©ºé—²çš„</span><br><span class="line">        interruptIdleWorkers();</span><br><span class="line">        onShutdown(); &#x2F;&#x2F; hook for ScheduledThreadPoolExecutor</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; å°è¯•ç»ˆç»“ï¼Œä¸ä¸€å®šæˆåŠŸ</span><br><span class="line">    &#x2F;&#x2F; </span><br><span class="line">    tryTerminate();</span><br><span class="line">&#125;Copy</span><br><span class="line">final void tryTerminate() &#123;</span><br><span class="line">    for (;;) &#123;</span><br><span class="line">        int c &#x3D; ctl.get();</span><br><span class="line">        &#x2F;&#x2F; ç»ˆç»“å¤±è´¥çš„æ¡ä»¶</span><br><span class="line">        &#x2F;&#x2F; çº¿ç¨‹æ± çŠ¶æ€ä¸ºRUNNING</span><br><span class="line">        &#x2F;&#x2F; çº¿ç¨‹æ± çŠ¶æ€ä¸º RUNNING SHUTDOWN STOP ï¼ˆçŠ¶æ€å€¼å¤§äºTIDYINGï¼‰</span><br><span class="line">        &#x2F;&#x2F; çº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNï¼Œä½†é˜»å¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡ç­‰å¾…æ‰§è¡Œ</span><br><span class="line">        if (isRunning(c) ||</span><br><span class="line">            runStateAtLeast(c, TIDYING) ||</span><br><span class="line">            (runStateOf(c) &#x3D;&#x3D; SHUTDOWN &amp;&amp; ! workQueue.isEmpty()))</span><br><span class="line">            return;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; å¦‚æœæ´»è·ƒçº¿ç¨‹æ•°ä¸ä¸º0</span><br><span class="line">        if (workerCountOf(c) !&#x3D; 0) &#123; &#x2F;&#x2F; Eligible to terminate</span><br><span class="line">            &#x2F;&#x2F; ä¸­æ–­ç©ºé—²çº¿ç¨‹</span><br><span class="line">            interruptIdleWorkers(ONLY_ONE);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        final ReentrantLock mainLock &#x3D; this.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F; å¤„äºå¯ä»¥ç»ˆç»“çš„çŠ¶æ€</span><br><span class="line">            &#x2F;&#x2F; é€šè¿‡CASå°†çº¿ç¨‹æ± çŠ¶æ€æ”¹ä¸ºTIDYING</span><br><span class="line">            if (ctl.compareAndSet(c, ctlOf(TIDYING, 0))) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    terminated();</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    &#x2F;&#x2F; é€šè¿‡CASå°†çº¿ç¨‹æ± çŠ¶æ€æ”¹ä¸ºTERMINATED</span><br><span class="line">                    ctl.set(ctlOf(TERMINATED, 0));</span><br><span class="line">                    termination.signalAll();</span><br><span class="line">                &#125;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; else retry on failed CAS</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="shutdownNow"><a href="#shutdownNow" class="headerlink" title="shutdownNow()"></a>shutdownNow()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* å°†çº¿ç¨‹æ± çš„çŠ¶æ€æ”¹ä¸º STOP</span><br><span class="line">* ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šåœ¨æ‰§è¡Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span><br><span class="line">* ä¼šå°†é˜»å¡é˜Ÿåˆ—ä¸­æœªæ‰§è¡Œçš„ä»»åŠ¡è¿”å›ç»™è°ƒç”¨è€…</span><br><span class="line">*&#x2F;</span><br><span class="line">public List&lt;Runnable&gt; shutdownNow() &#123;</span><br><span class="line">    List&lt;Runnable&gt; tasks;</span><br><span class="line">    final ReentrantLock mainLock &#x3D; this.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    try &#123;</span><br><span class="line">        checkShutdownAccess();</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€ä¸ºSTOPï¼Œä¸æ‰§è¡Œä»»ä½•ä»»åŠ¡</span><br><span class="line">        advanceRunState(STOP);</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; ä¸­æ–­æ‰€æœ‰çº¿ç¨‹</span><br><span class="line">        interruptWorkers();</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; å°†æœªæ‰§è¡Œçš„ä»»åŠ¡ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œç„¶åè¿”å›ç»™è°ƒç”¨è€…</span><br><span class="line">        tasks &#x3D; drainQueue();</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; å°è¯•ç»ˆç»“ï¼Œä¸€å®šä¼šæˆåŠŸï¼Œå› ä¸ºé˜»å¡é˜Ÿåˆ—ä¸ºç©ºäº†</span><br><span class="line">    tryTerminate();</span><br><span class="line">    return tasks;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/18/juc%E5%AD%A6%E4%B9%A0/" data-id="cknyemfpw000b6oub8t0dhjbt" data-title="jucå­¦ä¹ " class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/07/hello-world/" class="article-date">
  <time class="dt-published" datetime="2021-04-07T01:44:31.831Z" itemprop="datePublished">2021-04-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/07/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/07/hello-world/" data-id="cknyemfc100006oub2volcifa" data-title="Hello World" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/06/redis%E9%9B%86%E7%BE%A4%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2021-04-06T11:36:22.000Z" itemprop="datePublished">2021-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/06/redis%E9%9B%86%E7%BE%A4%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ"><a href="#Redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ"></a>Redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ</h1><p>åŸºäº<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1CJ411m7Gc">é»‘é©¬Redis</a>çš„è§†é¢‘çš„å­¦ä¹ ç¬”è®°</p>
<h2 id="1-ä¸»ä»å¤åˆ¶"><a href="#1-ä¸»ä»å¤åˆ¶" class="headerlink" title="1. ä¸»ä»å¤åˆ¶"></a>1. ä¸»ä»å¤åˆ¶</h2><h3 id="1-1-ä¸»ä»å¤åˆ¶ç®€ä»‹"><a href="#1-1-ä¸»ä»å¤åˆ¶ç®€ä»‹" class="headerlink" title="1.1 ä¸»ä»å¤åˆ¶ç®€ä»‹"></a>1.1 ä¸»ä»å¤åˆ¶ç®€ä»‹</h3><h4 id="1-1-1-äº’è”ç½‘â€œä¸‰é«˜â€æ¶æ„"><a href="#1-1-1-äº’è”ç½‘â€œä¸‰é«˜â€æ¶æ„" class="headerlink" title="1.1.1 äº’è”ç½‘â€œä¸‰é«˜â€æ¶æ„"></a>1.1.1 äº’è”ç½‘â€œä¸‰é«˜â€æ¶æ„</h4><ul>
<li>é«˜å¹¶å‘</li>
<li>é«˜æ€§èƒ½</li>
<li>é«˜å¯ç”¨</li>
</ul>
<h4 id="1-1-2-å•æœºredisçš„é£é™©å’Œé—®é¢˜"><a href="#1-1-2-å•æœºredisçš„é£é™©å’Œé—®é¢˜" class="headerlink" title="1.1.2 å•æœºredisçš„é£é™©å’Œé—®é¢˜"></a>1.1.2 å•æœºredisçš„é£é™©å’Œé—®é¢˜</h4><ul>
<li>æœºå™¨æ•…éšœ</li>
<li>å®¹é‡ç“¶é¢ˆ</li>
<li>ç»“è®ºï¼š<ul>
<li>é¿å…å•ç‚¹redisæœåŠ¡å™¨æ•…éšœï¼Œå‡†å¤‡å •èƒæœåŠ¡å™¨äº’è”</li>
<li>äº’è”æœåŠ¡å™¨ä¿è¯æ•°æ®åŒæ­¥</li>
<li>å®ç°Redisé«˜å¯ç”¨ï¼Œå®ç°æ•°æ®å†—ä½™å¤‡ä»½</li>
</ul>
</li>
</ul>
<h4 id="1-1-3-å¤šå°æœåŠ¡å™¨è¿æ¥æ–¹æ¡ˆ"><a href="#1-1-3-å¤šå°æœåŠ¡å™¨è¿æ¥æ–¹æ¡ˆ" class="headerlink" title="1.1.3 å¤šå°æœåŠ¡å™¨è¿æ¥æ–¹æ¡ˆ"></a>1.1.3 å¤šå°æœåŠ¡å™¨è¿æ¥æ–¹æ¡ˆ</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_32_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_32_20210327.png" alt="img"></a></p>
<ul>
<li>æä¾›æ•°æ®æ–¹ï¼šmaster<ul>
<li>ä¸»æœåŠ¡å™¨ï¼Œä¸»èŠ‚ç‚¹ï¼Œä¸»åº“</li>
<li>ä¸»å®¢æˆ·ç«¯</li>
</ul>
</li>
<li>æ¥æ”¶æ•°æ®çš„æ–¹ï¼šslave<ul>
<li>ä»æœåŠ¡å™¨ï¼Œä»èŠ‚ç‚¹ï¼Œä»åº“</li>
<li>ä»å®¢æˆ·ç«¯</li>
</ul>
</li>
<li>éœ€è¦è§£å†³çš„é—®é¢˜<ul>
<li><strong>æ•°æ®åŒæ­¥</strong></li>
</ul>
</li>
<li>æ ¸å¿ƒå·¥ä½œ<ul>
<li>masterçš„æ•°æ®<strong>å¤åˆ¶</strong>åˆ°slaveä¸­</li>
</ul>
</li>
</ul>
<h4 id="1-1-4-ä¸»ä»å¤åˆ¶"><a href="#1-1-4-ä¸»ä»å¤åˆ¶" class="headerlink" title="1.1.4 ä¸»ä»å¤åˆ¶"></a>1.1.4 ä¸»ä»å¤åˆ¶</h4><p>ä¸»ä»å¤åˆ¶å³å°†masterä¸­çš„æ•°æ®å³æ—¶ã€æœ‰æ•ˆçš„<strong>å¤åˆ¶</strong>åˆ°slaveä¸­</p>
<p>ç‰¹å¾ï¼šä¸€ä¸ªmasterå¯ä»¥æ‹¥æœ‰å¤šä¸ªslaveï¼Œä¸€ä¸ªslaveåªå¯¹åº”ä¸€ä¸ªmaster</p>
<p>èŒè´£ï¼š</p>
<ul>
<li>master:<ul>
<li>å†™æ•°æ®</li>
<li>æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œå°†å‡ºç°å˜åŒ–çš„æ•°æ®è‡ªåŠ¨<strong>åŒæ­¥</strong>åˆ°slave</li>
<li>è¯»æ•°æ®ï¼ˆå¯å¿½ç•¥ï¼‰</li>
</ul>
</li>
<li>slave:<ul>
<li>è¯»æ•°æ®</li>
<li>å†™æ•°æ®ï¼ˆ<strong>ç¦æ­¢</strong>ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="1-1-5-ä¸»ä»å¤åˆ¶çš„ä½œç”¨"><a href="#1-1-5-ä¸»ä»å¤åˆ¶çš„ä½œç”¨" class="headerlink" title="1.1.5 ä¸»ä»å¤åˆ¶çš„ä½œç”¨"></a>1.1.5 ä¸»ä»å¤åˆ¶çš„ä½œç”¨</h4><ul>
<li>è¯»å†™åˆ†ç¦»ï¼šmasterå†™ã€slaveè¯»ï¼Œæé«˜æœåŠ¡å™¨çš„è¯»å†™è´Ÿè½½èƒ½åŠ›</li>
<li>è´Ÿè½½å‡è¡¡ï¼šåŸºäºä¸»ä»ç»“æ„ï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œç”±slaveåˆ†æ‹…masterè´Ÿè½½ï¼Œå¹¶æ ¹æ®éœ€æ±‚çš„å˜åŒ–ï¼Œæ”¹å˜slaveçš„æ•°é‡ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…æ•°æ®è¯»å–è´Ÿè½½ï¼Œå¤§å¤§æé«˜RedisæœåŠ¡å™¨å¹¶å‘é‡ä¸æ•°æ®ååé‡</li>
<li>æ•…éšœæ¢å¤ï¼šå½“masterå‡ºç°é—®é¢˜æ—¶ï¼Œç”±slaveæä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤</li>
<li>æ•°æ®å†—ä½™ï¼šå®ç°æ•°æ®çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼</li>
<li>é«˜å¯ç”¨åŸºçŸ³ï¼šåŸºäºä¸»ä»å¤åˆ¶ï¼Œæ„å»ºå“¨å…µæ¨¡å¼ä¸é›†ç¾¤ï¼Œå®ç°Redisçš„é«˜å¯ç”¨æ–¹æ¡ˆ</li>
</ul>
<h3 id="1-2-ä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹"><a href="#1-2-ä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹" class="headerlink" title="1.2 ä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹"></a>1.2 ä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹</h3><h4 id="1-2-1-æ€»è¿°"><a href="#1-2-1-æ€»è¿°" class="headerlink" title="1.2.1 æ€»è¿°"></a>1.2.1 æ€»è¿°</h4><ul>
<li>ä¸»ä»å¤åˆ¶è¿‡ç¨‹å¤§ä½“å¯ä»¥åˆ†ä¸º3ä¸ªé˜¶æ®µ<ul>
<li>å»ºç«‹è¿æ¥é˜¶æ®µï¼ˆå³å‡†å¤‡é˜¶æ®µï¼‰</li>
<li>æ•°æ®åŒæ­¥é˜¶æ®µ</li>
<li>å‘½ä»¤ä¼ æ’­é˜¶æ®µ</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_33_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_33_20210327.png" alt="img"></a></p>
<h4 id="1-2-2-ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥"><a href="#1-2-2-ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥" class="headerlink" title="1.2.2 ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥"></a>1.2.2 ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥</h4><p>å»ºç«‹slaveåˆ°masterçš„è¿æ¥ï¼Œä½¿masterèƒ½å¤Ÿè¯†åˆ«slaveï¼Œå¹¶ä¿å­˜slaveç«¯å£å·</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_34_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_34_20210327.png" alt="img"></a></p>
<p>**ä¸»ä»è¿æ¥ï¼ˆslaveè¿æ¥masterï¼‰ **</p>
<ul>
<li><p>æ–¹å¼ä¸€ï¼šå®¢æˆ·ç«¯å‘é€å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æ–¹å¼äºŒï¼šå¯åŠ¨æœåŠ¡å™¨å‚æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server -slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æ–¹å¼ä¸‰ï¼šæœåŠ¡å™¨é…ç½® ï¼ˆå¸¸ç”¨ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>slaveç³»ç»Ÿä¿¡æ¯</p>
<ul>
<li>master_link_down_since_seconds</li>
<li>masterhost</li>
<li>masterport</li>
</ul>
</li>
<li><p>masterç³»ç»Ÿä¿¡æ¯</p>
<ul>
<li>slave_listening_port(å¤šä¸ª)</li>
</ul>
</li>
</ul>
<p><strong>ä¸»ä»æ–­å¼€è¿æ¥</strong></p>
<ul>
<li><p><strong>å®¢æˆ·ç«¯</strong>å‘é€å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slaveof no one</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>è¯´æ˜ï¼š slaveæ–­å¼€è¿æ¥åï¼Œ<strong>ä¸ä¼šåˆ é™¤å·²æœ‰æ•°æ®</strong>ï¼Œåªæ˜¯ä¸å†æ¥å—masterå‘é€çš„æ•°æ®</li>
</ul>
</li>
</ul>
<p><strong>æˆæƒè®¿é—®</strong></p>
<ul>
<li><p>masterå®¢æˆ·ç«¯å‘é€å‘½ä»¤è®¾ç½®å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">requirepass &lt;password&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>masteré…ç½®æ–‡ä»¶è®¾ç½®å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config set requirepass &lt;password&gt; </span><br><span class="line">config get requirepass</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>slaveå®¢æˆ·ç«¯å‘é€å‘½ä»¤è®¾ç½®å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auth &lt;password&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>slaveé…ç½®æ–‡ä»¶è®¾ç½®å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">masterauth &lt;password&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>slaveå¯åŠ¨æœåŠ¡å™¨è®¾ç½®å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server â€“a &lt;password&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-2-3-ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åŒæ­¥"><a href="#1-2-3-ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åŒæ­¥" class="headerlink" title="1.2.3 ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åŒæ­¥"></a>1.2.3 ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åŒæ­¥</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_35_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_35_20210327.png" alt="img"></a></p>
<ul>
<li>å…¨é‡å¤åˆ¶<ul>
<li>å°†masteræ‰§è¡Œbgsaveä¹‹å‰ï¼Œmasterä¸­æ‰€æœ‰çš„æ•°æ®åŒæ­¥åˆ°slaveä¸­</li>
</ul>
</li>
<li>éƒ¨åˆ†å¤åˆ¶ï¼ˆå¢é‡å¤åˆ¶ï¼‰<ul>
<li>å°†masteræ‰§è¡Œbgsaveæ“ä½œä¸­ï¼Œæ–°åŠ å…¥çš„æ•°æ®ï¼ˆå¤åˆ¶ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼‰ä¼ ç»™slaveï¼Œslaveé€šè¿‡bgrewriteaofæŒ‡ä»¤æ¥æ¢å¤æ•°æ®</li>
</ul>
</li>
</ul>
<h5 id="æ•°æ®åŒæ­¥é˜¶æ®µmasterè¯´æ˜"><a href="#æ•°æ®åŒæ­¥é˜¶æ®µmasterè¯´æ˜" class="headerlink" title="æ•°æ®åŒæ­¥é˜¶æ®µmasterè¯´æ˜"></a>æ•°æ®åŒæ­¥é˜¶æ®µmasterè¯´æ˜</h5><ol>
<li>å¦‚æœmasteræ•°æ®é‡å·¨å¤§ï¼Œæ•°æ®åŒæ­¥é˜¶æ®µåº”<strong>é¿å¼€æµé‡é«˜å³°æœŸ</strong>ï¼Œ<strong>é¿å…</strong>é€ æˆmaster<strong>é˜»å¡</strong>ï¼Œå½±å“ä¸šåŠ¡æ­£å¸¸æ‰§è¡Œ</li>
<li>å¤åˆ¶ç¼“å†²åŒºå¤§å°è®¾å®šä¸åˆç†ï¼Œä¼šå¯¼è‡´æ•°æ®æº¢å‡ºã€‚å¦‚è¿›è¡Œå…¨é‡å¤åˆ¶å‘¨æœŸå¤ªé•¿ï¼Œè¿›è¡Œéƒ¨åˆ†å¤åˆ¶æ—¶å‘ç°æ•°æ®å·²ç»å­˜åœ¨ä¸¢å¤±çš„æƒ…å†µï¼Œå¿…é¡»è¿›è¡Œç¬¬äºŒæ¬¡å…¨é‡å¤åˆ¶ï¼Œè‡´ä½¿slaveé™·å…¥<strong>æ­»å¾ªç¯</strong>çŠ¶æ€ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨masterç«¯ä¿®æ”¹</span><br><span class="line">repl-backlog-size 1mb</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ol>
<li>masterå•æœºå†…å­˜å ç”¨ä¸»æœºå†…å­˜çš„æ¯”ä¾‹ä¸åº”è¿‡å¤§ï¼Œå»ºè®®ä½¿ç”¨50%-70%çš„å†…å­˜ï¼Œç•™ä¸‹30%-50%çš„å†…å­˜ç”¨äºæ‰§ è¡Œbgsaveå‘½ä»¤å’Œåˆ›å»ºå¤åˆ¶ç¼“å†²åŒº</li>
</ol>
<h5 id="æ•°æ®åŒæ­¥é˜¶æ®µslaveè¯´æ˜"><a href="#æ•°æ®åŒæ­¥é˜¶æ®µslaveè¯´æ˜" class="headerlink" title="æ•°æ®åŒæ­¥é˜¶æ®µslaveè¯´æ˜"></a>æ•°æ®åŒæ­¥é˜¶æ®µslaveè¯´æ˜</h5><ol>
<li>ä¸ºé¿å…slaveè¿›è¡Œå…¨é‡å¤åˆ¶ã€éƒ¨åˆ†å¤åˆ¶æ—¶æœåŠ¡å™¨å“åº”é˜»å¡æˆ–æ•°æ®ä¸åŒæ­¥ï¼Œ<strong>å»ºè®®å…³é—­</strong>æ­¤æœŸé—´çš„å¯¹å¤–æœåŠ¡</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slave-serve-stale-data yes|no</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ol>
<li>æ•°æ®åŒæ­¥é˜¶æ®µï¼Œmasterå‘é€ç»™slaveä¿¡æ¯å¯ä»¥ç†è§£masteræ˜¯slaveçš„ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä¸»åŠ¨å‘slaveå‘é€å‘½ä»¤</li>
<li>å¤šä¸ªslaveåŒæ—¶å¯¹masterè¯·æ±‚æ•°æ®åŒæ­¥ï¼Œmasterå‘é€çš„RDBæ–‡ä»¶å¢å¤šï¼Œä¼šå¯¹å¸¦å®½é€ æˆå·¨å¤§å†²å‡»ï¼Œå¦‚æœmasterå¸¦å®½ä¸è¶³ï¼Œå› æ­¤æ•°æ®åŒæ­¥éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œé€‚é‡é”™å³°</li>
<li>slaveè¿‡å¤šæ—¶ï¼Œå»ºè®®è°ƒæ•´æ‹“æ‰‘ç»“æ„ï¼Œç”±ä¸€ä¸»å¤šä»ç»“æ„å˜ä¸ºæ ‘çŠ¶ç»“æ„ï¼Œä¸­é—´çš„èŠ‚ç‚¹æ—¢æ˜¯masterï¼Œä¹Ÿæ˜¯ slaveã€‚æ³¨æ„ä½¿ç”¨æ ‘çŠ¶ç»“æ„æ—¶ï¼Œç”±äºå±‚çº§æ·±åº¦ï¼Œå¯¼è‡´æ·±åº¦è¶Šé«˜çš„slaveä¸æœ€é¡¶å±‚masteré—´æ•°æ®åŒæ­¥å»¶è¿Ÿè¾ƒå¤§ï¼Œ<strong>æ•°æ®ä¸€è‡´æ€§å˜å·®ï¼Œåº”è°¨æ…é€‰æ‹©</strong></li>
</ol>
<h4 id="1-2-4-ç¬¬ä¸‰é˜¶æ®µï¼šå‘½ä»¤ä¼ æ’­"><a href="#1-2-4-ç¬¬ä¸‰é˜¶æ®µï¼šå‘½ä»¤ä¼ æ’­" class="headerlink" title="1.2.4 ç¬¬ä¸‰é˜¶æ®µï¼šå‘½ä»¤ä¼ æ’­"></a>1.2.4 ç¬¬ä¸‰é˜¶æ®µï¼šå‘½ä»¤ä¼ æ’­</h4><ul>
<li>å½“masteræ•°æ®åº“çŠ¶æ€è¢«ä¿®æ”¹åï¼Œå¯¼è‡´ä¸»ä»æœåŠ¡å™¨æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´ï¼Œæ­¤æ—¶éœ€è¦è®©ä¸»ä»æ•°æ®åŒæ­¥åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œ<strong>åŒæ­¥</strong>çš„åŠ¨ä½œç§°ä¸º<strong>å‘½ä»¤ä¼ æ’­</strong></li>
<li>masterå°†æ¥æ”¶åˆ°çš„æ•°æ®å˜æ›´å‘½ä»¤å‘é€ç»™slaveï¼Œslaveæ¥æ”¶å‘½ä»¤åæ‰§è¡Œå‘½ä»¤</li>
</ul>
<h5 id="å‘½ä»¤ä¼ æ’­é˜¶æ®µçš„éƒ¨åˆ†å¤åˆ¶"><a href="#å‘½ä»¤ä¼ æ’­é˜¶æ®µçš„éƒ¨åˆ†å¤åˆ¶" class="headerlink" title="å‘½ä»¤ä¼ æ’­é˜¶æ®µçš„éƒ¨åˆ†å¤åˆ¶"></a>å‘½ä»¤ä¼ æ’­é˜¶æ®µçš„éƒ¨åˆ†å¤åˆ¶</h5><ul>
<li>å‘½ä»¤ä¼ æ’­é˜¶æ®µå‡ºç°äº†æ–­ç½‘ç°è±¡<ul>
<li>ç½‘ç»œé—ªæ–­é—ªè¿ï¼ˆå¿½ç•¥ï¼‰</li>
<li>çŸ­æ—¶é—´ç½‘ç»œä¸­æ–­ï¼ˆéƒ¨åˆ†å¤åˆ¶ï¼‰</li>
<li>é•¿æ—¶é—´ç½‘ç»œä¸­æ–­ï¼ˆå…¨é‡å¤åˆ¶ï¼‰</li>
</ul>
</li>
<li>éƒ¨åˆ†å¤åˆ¶çš„<strong>ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ </strong><ul>
<li>æœåŠ¡å™¨çš„è¿è¡Œ idï¼ˆrun idï¼‰</li>
<li>ä¸»æœåŠ¡å™¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</li>
<li>ä¸»ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡</li>
</ul>
</li>
</ul>
<h5 id="æ ¸å¿ƒä¸€ï¼šæœåŠ¡å™¨è¿è¡ŒIDï¼ˆrunidï¼‰"><a href="#æ ¸å¿ƒä¸€ï¼šæœåŠ¡å™¨è¿è¡ŒIDï¼ˆrunidï¼‰" class="headerlink" title="æ ¸å¿ƒä¸€ï¼šæœåŠ¡å™¨è¿è¡ŒIDï¼ˆrunidï¼‰"></a>æ ¸å¿ƒä¸€ï¼šæœåŠ¡å™¨è¿è¡ŒIDï¼ˆrunidï¼‰</h5><ul>
<li>æ¦‚å¿µï¼šæœåŠ¡å™¨è¿è¡ŒIDæ˜¯æ¯ä¸€å°æœåŠ¡å™¨æ¯æ¬¡è¿è¡Œçš„èº«ä»½è¯†åˆ«ç ï¼Œä¸€å°æœåŠ¡å™¨å¤šæ¬¡è¿è¡Œå¯ä»¥ç”Ÿæˆå¤šä¸ªè¿è¡Œid</li>
<li>ç»„æˆï¼šè¿è¡Œidç”±40ä½å­—ç¬¦ç»„æˆï¼Œæ˜¯ä¸€ä¸ªéšæœºçš„åå…­è¿›åˆ¶å­—ç¬¦<ul>
<li>ä¾‹å¦‚ï¼šfdc9ff13b9bbaab28db42b3d50f852bb5e3fcdce</li>
</ul>
</li>
<li>ä½œç”¨ï¼šè¿è¡Œidè¢«ç”¨äºåœ¨æœåŠ¡å™¨é—´è¿›è¡Œä¼ è¾“ï¼Œè¯†åˆ«èº«ä»½<ul>
<li>å¦‚æœæƒ³ä¸¤æ¬¡æ“ä½œå‡å¯¹åŒä¸€å°æœåŠ¡å™¨è¿›è¡Œï¼Œå¿…é¡»æ¯æ¬¡æ“ä½œæºå¸¦å¯¹åº”çš„è¿è¡Œidï¼Œç”¨äºå¯¹æ–¹è¯†åˆ«</li>
</ul>
</li>
<li>å®ç°æ–¹å¼ï¼šè¿è¡Œidåœ¨æ¯å°æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œmasteråœ¨é¦–æ¬¡è¿æ¥slaveæ—¶ï¼Œä¼šå°†è‡ªå·±çš„è¿è¡ŒIDå‘é€ç»™slaveï¼Œslaveä¿å­˜æ­¤IDï¼Œé€šè¿‡<strong>info Server</strong>å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹èŠ‚ç‚¹çš„runid</li>
</ul>
<h5 id="æ ¸å¿ƒäºŒï¼šå¤åˆ¶ç¼“å†²åŒº"><a href="#æ ¸å¿ƒäºŒï¼šå¤åˆ¶ç¼“å†²åŒº" class="headerlink" title="æ ¸å¿ƒäºŒï¼šå¤åˆ¶ç¼“å†²åŒº"></a>æ ¸å¿ƒäºŒï¼šå¤åˆ¶ç¼“å†²åŒº</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_36_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_36_20210327.png" alt="img"></a></p>
<ul>
<li><p>æ¦‚å¿µï¼š</p>
<p>å¤åˆ¶ç¼“å†²åŒºï¼Œåˆåå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œæ˜¯ä¸€ä¸ª<strong>å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é˜Ÿåˆ—</strong>ï¼Œç”¨äºå­˜å‚¨æœåŠ¡å™¨æ‰§è¡Œè¿‡çš„å‘½ ä»¤ï¼Œæ¯æ¬¡ä¼ æ’­å‘½ä»¤ï¼Œmasteréƒ½ä¼šå°†ä¼ æ’­çš„å‘½ä»¤è®°å½•ä¸‹æ¥ï¼Œå¹¶å­˜å‚¨åœ¨å¤åˆ¶ç¼“å†²åŒº</p>
</li>
<li><p>ç”±æ¥ï¼š</p>
<p>æ¯å°æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå¦‚æœå¼€å¯æœ‰AOFæˆ–è¢«è¿æ¥æˆä¸ºmasterèŠ‚ç‚¹ï¼Œå³åˆ›å»ºå¤åˆ¶ç¼“å†²åŒº</p>
</li>
<li><p>ä½œç”¨ï¼š</p>
<p>ç”¨äºä¿å­˜masteræ”¶åˆ°çš„æ‰€æœ‰æŒ‡ä»¤ï¼ˆä»…å½±å“æ•°æ®å˜æ›´çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚setï¼Œselectï¼‰</p>
</li>
<li><p>æ•°æ®æ¥æºï¼š</p>
<p>å½“masteræ¥æ”¶åˆ°ä¸»å®¢æˆ·ç«¯çš„æŒ‡ä»¤æ—¶ï¼Œé™¤äº†å°†æŒ‡ä»¤æ‰§è¡Œï¼Œä¼šå°†è¯¥æŒ‡ä»¤å­˜å‚¨åˆ°ç¼“å†²åŒºä¸­</p>
</li>
<li><p>å¤åˆ¶ç¼“å†²åŒºçš„å·¥ä½œåŸç†ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_37_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_37_20210327.png" alt="img"></a></p>
</li>
</ul>
<h5 id="æ ¸å¿ƒä¸‰ï¼šä¸»ä»æœåŠ¡å™¨å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰"><a href="#æ ¸å¿ƒä¸‰ï¼šä¸»ä»æœåŠ¡å™¨å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰" class="headerlink" title="æ ¸å¿ƒä¸‰ï¼šä¸»ä»æœåŠ¡å™¨å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰"></a>æ ¸å¿ƒä¸‰ï¼šä¸»ä»æœåŠ¡å™¨å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰</h5><ul>
<li>æ¦‚å¿µï¼šä¸€ä¸ªæ•°å­—ï¼Œæè¿°å¤åˆ¶ç¼“å†²åŒºä¸­çš„æŒ‡ä»¤å­—èŠ‚ä½ç½®</li>
<li>åˆ†ç±»ï¼š<ul>
<li>masterå¤åˆ¶åç§»é‡ï¼šè®°å½•å‘é€ç»™æ‰€æœ‰slaveçš„æŒ‡ä»¤å­—èŠ‚å¯¹åº”çš„ä½ç½®ï¼ˆå¤šä¸ªï¼‰</li>
<li>slaveå¤åˆ¶åç§»é‡ï¼šè®°å½•slaveæ¥æ”¶masterå‘é€è¿‡æ¥çš„æŒ‡ä»¤å­—èŠ‚å¯¹åº”çš„ä½ç½®ï¼ˆä¸€ä¸ªï¼‰</li>
</ul>
</li>
<li>æ•°æ®æ¥æºï¼š masterç«¯ï¼šå‘é€ä¸€æ¬¡è®°å½•ä¸€æ¬¡ slaveç«¯ï¼šæ¥æ”¶ä¸€æ¬¡è®°å½•ä¸€æ¬¡</li>
<li>ä½œç”¨ï¼š<strong>åŒæ­¥ä¿¡æ¯</strong>ï¼Œæ¯”å¯¹masterä¸slaveçš„å·®å¼‚ï¼Œå½“slaveæ–­çº¿åï¼Œæ¢å¤æ•°æ®ä½¿ç”¨</li>
</ul>
<h5 id="æ•°æ®åŒæ­¥-å‘½ä»¤ä¼ æ’­é˜¶æ®µå·¥ä½œæµç¨‹"><a href="#æ•°æ®åŒæ­¥-å‘½ä»¤ä¼ æ’­é˜¶æ®µå·¥ä½œæµç¨‹" class="headerlink" title="æ•°æ®åŒæ­¥+å‘½ä»¤ä¼ æ’­é˜¶æ®µå·¥ä½œæµç¨‹"></a>æ•°æ®åŒæ­¥+å‘½ä»¤ä¼ æ’­é˜¶æ®µå·¥ä½œæµç¨‹</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_38_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_38_20210327.png" alt="img"></a></p>
<h4 id="1-2-5-å¿ƒè·³æœºåˆ¶"><a href="#1-2-5-å¿ƒè·³æœºåˆ¶" class="headerlink" title="1.2.5 å¿ƒè·³æœºåˆ¶"></a>1.2.5 å¿ƒè·³æœºåˆ¶</h4><ul>
<li>è¿›å…¥<strong>å‘½ä»¤ä¼ æ’­é˜¶æ®µå€™</strong>ï¼Œmasterä¸slaveé—´éœ€è¦è¿›è¡Œä¿¡æ¯äº¤æ¢ï¼Œä½¿ç”¨å¿ƒè·³æœºåˆ¶è¿›è¡Œç»´æŠ¤ï¼Œå®ç°åŒæ–¹è¿æ¥ä¿æŒåœ¨çº¿</li>
<li>masterå¿ƒè·³ï¼š<ul>
<li>æŒ‡ä»¤ï¼šPING</li>
<li>å‘¨æœŸï¼šç”±repl-ping-slave-periodå†³å®šï¼Œé»˜è®¤10ç§’</li>
<li>ä½œç”¨ï¼šåˆ¤æ–­slaveæ˜¯å¦åœ¨çº¿</li>
<li>æŸ¥è¯¢ï¼šINFO replication è·å–slaveæœ€åä¸€æ¬¡è¿æ¥æ—¶é—´é—´éš”ï¼Œlagé¡¹ç»´æŒåœ¨0æˆ–1è§†ä¸ºæ­£å¸¸</li>
</ul>
</li>
<li>slaveå¿ƒè·³ä»»åŠ¡<ul>
<li>æŒ‡ä»¤ï¼šREPLCONF ACK {offset}</li>
<li>å‘¨æœŸï¼š1ç§’</li>
<li>ä½œç”¨1ï¼šæ±‡æŠ¥slaveè‡ªå·±çš„å¤åˆ¶åç§»é‡ï¼Œè·å–æœ€æ–°çš„æ•°æ®å˜æ›´æŒ‡ä»¤</li>
<li>ä½œç”¨2ï¼šåˆ¤æ–­masteræ˜¯å¦åœ¨çº¿</li>
</ul>
</li>
</ul>
<h5 id="å¿ƒè·³é˜¶æ®µæ³¨æ„äº‹é¡¹"><a href="#å¿ƒè·³é˜¶æ®µæ³¨æ„äº‹é¡¹" class="headerlink" title="å¿ƒè·³é˜¶æ®µæ³¨æ„äº‹é¡¹"></a>å¿ƒè·³é˜¶æ®µæ³¨æ„äº‹é¡¹</h5><ul>
<li><p>å½“slaveå¤šæ•°æ‰çº¿ï¼Œæˆ–å»¶è¿Ÿè¿‡é«˜æ—¶ï¼Œmasterä¸ºä¿éšœæ•°æ®ç¨³å®šæ€§ï¼Œå°†æ‹’ç»æ‰€æœ‰ä¿¡æ¯åŒæ­¥æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">min-slaves-to-write 2 </span><br><span class="line">min-slaves-max-lag 8</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>slaveæ•°é‡å°‘äº2ä¸ªï¼Œæˆ–è€…æ‰€æœ‰slaveçš„å»¶è¿Ÿéƒ½å¤§äºç­‰äº10ç§’æ—¶ï¼Œå¼ºåˆ¶å…³é—­masterå†™åŠŸèƒ½ï¼Œåœæ­¢æ•°æ®åŒæ­¥</li>
</ul>
</li>
<li><p>slaveæ•°é‡ç”±slaveå‘é€<strong>REPLCONF ACK</strong>å‘½ä»¤åšç¡®è®¤</p>
</li>
<li><p>slaveå»¶è¿Ÿç”±slaveå‘é€<strong>REPLCONF ACK</strong>å‘½ä»¤åšç¡®è®¤</p>
</li>
</ul>
<h4 id="1-2-6-ä¸»ä»å¤åˆ¶å®Œæ•´æµç¨‹"><a href="#1-2-6-ä¸»ä»å¤åˆ¶å®Œæ•´æµç¨‹" class="headerlink" title="1.2.6 ä¸»ä»å¤åˆ¶å®Œæ•´æµç¨‹"></a>1.2.6 ä¸»ä»å¤åˆ¶å®Œæ•´æµç¨‹</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_39_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_39_20210327.png" alt="img"></a></p>
<h3 id="1-3-ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜"><a href="#1-3-ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜" class="headerlink" title="1.3 ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜"></a>1.3 ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜</h3><h5 id="é¢‘ç¹çš„å…¨é‡å¤åˆ¶"><a href="#é¢‘ç¹çš„å…¨é‡å¤åˆ¶" class="headerlink" title="é¢‘ç¹çš„å…¨é‡å¤åˆ¶"></a>é¢‘ç¹çš„å…¨é‡å¤åˆ¶</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_40_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_40_20210327.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_41_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_41_20210327.png" alt="img"></a></p>
<h5 id="ç½‘ç»œä¸­æ–­"><a href="#ç½‘ç»œä¸­æ–­" class="headerlink" title="ç½‘ç»œä¸­æ–­"></a>ç½‘ç»œä¸­æ–­</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_42_20210327_.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_42_20210327_.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_43_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_43_20210327.png" alt="img"></a></p>
<h5 id="æ•°æ®ä¸ä¸€è‡´"><a href="#æ•°æ®ä¸ä¸€è‡´" class="headerlink" title="æ•°æ®ä¸ä¸€è‡´"></a>æ•°æ®ä¸ä¸€è‡´</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_44_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_44_20210327.png" alt="img"></a></p>
<h2 id="2-å“¨å…µæ¨¡å¼"><a href="#2-å“¨å…µæ¨¡å¼" class="headerlink" title="2. å“¨å…µæ¨¡å¼"></a>2. å“¨å…µæ¨¡å¼</h2><h3 id="2-1-å“¨å…µç®€ä»‹"><a href="#2-1-å“¨å…µç®€ä»‹" class="headerlink" title="2.1 å“¨å…µç®€ä»‹"></a>2.1 å“¨å…µç®€ä»‹</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_45_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_45_20210327.png" alt="img"></a></p>
<h3 id="2-2-å“¨å…µçš„å®šä¹‰"><a href="#2-2-å“¨å…µçš„å®šä¹‰" class="headerlink" title="2.2 å“¨å…µçš„å®šä¹‰"></a>2.2 å“¨å…µçš„å®šä¹‰</h3><blockquote>
<p>å“¨å…µ(sentinel) æ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>ï¼Œç”¨äºå¯¹ä¸»ä»ç»“æ„ä¸­çš„æ¯å°æœåŠ¡å™¨è¿›è¡Œ<strong>ç›‘æ§</strong>ï¼Œå½“å‡ºç°æ•…éšœæ—¶é€šè¿‡æŠ•ç¥¨æœºåˆ¶<strong>é€‰æ‹©</strong>æ–°çš„masterå¹¶å°†æ‰€æœ‰slaveè¿æ¥åˆ°æ–°çš„masterã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_46_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_46_20210327.png" alt="img"></a></p>
<h3 id="2-3-å“¨å…µçš„ä½œç”¨"><a href="#2-3-å“¨å…µçš„ä½œç”¨" class="headerlink" title="2.3 å“¨å…µçš„ä½œç”¨"></a>2.3 å“¨å…µçš„ä½œç”¨</h3><ul>
<li>ç›‘æ§<ul>
<li>ä¸æ–­çš„æ£€æŸ¥masterå’Œslaveæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ masterå­˜æ´»æ£€æµ‹ã€masterä¸slaveè¿è¡Œæƒ…å†µæ£€æµ‹</li>
</ul>
</li>
<li>é€šçŸ¥ï¼ˆæé†’ï¼‰<ul>
<li>å½“è¢«ç›‘æ§çš„æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œå‘å…¶ä»–ï¼ˆå“¨å…µé—´ï¼Œå®¢æˆ·ç«¯ï¼‰å‘é€é€šçŸ¥ã€‚</li>
</ul>
</li>
<li>è‡ªåŠ¨æ•…éšœè½¬ç§»<ul>
<li>æ–­å¼€masterä¸slaveè¿æ¥ï¼Œé€‰å–ä¸€ä¸ªslaveä½œä¸ºmasterï¼Œå°†å…¶ä»–slaveè¿æ¥åˆ°æ–°çš„masterï¼Œå¹¶å‘ŠçŸ¥å®¢æˆ·ç«¯æ–°çš„æœåŠ¡å™¨åœ°å€</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong><br>å“¨å…µä¹Ÿæ˜¯ä¸€å°<strong>redisæœåŠ¡å™¨</strong>ï¼Œåªæ˜¯ä¸æä¾›æ•°æ®æœåŠ¡ é€šå¸¸å“¨å…µé…ç½®æ•°é‡ä¸º<strong>å•æ•°</strong></p>
<h3 id="2-4-å“¨å…µçš„é…ç½®"><a href="#2-4-å“¨å…µçš„é…ç½®" class="headerlink" title="2.4 å“¨å…µçš„é…ç½®"></a>2.4 å“¨å…µçš„é…ç½®</h3><ul>
<li><p>é…ç½®ä¸€æ‹–äºŒçš„ä¸»ä»ç»“æ„</p>
</li>
<li><p>é…ç½®ä¸‰ä¸ªå“¨å…µï¼ˆé…ç½®ç›¸åŒï¼Œç«¯å£ä¸åŒï¼‰</p>
<ul>
<li>å‚çœ‹sentinel.conf</li>
</ul>
</li>
<li><p>å¯åŠ¨å“¨å…µ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel sentinelç«¯å£å· .conf</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_47_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_47_20210327.png" alt="img"></a></p>
<h3 id="2-5-å“¨å…µå·¥ä½œåŸç†"><a href="#2-5-å“¨å…µå·¥ä½œåŸç†" class="headerlink" title="2.5 å“¨å…µå·¥ä½œåŸç†"></a>2.5 å“¨å…µå·¥ä½œåŸç†</h3><p>ä¸»ä»åˆ‡æ¢</p>
<ul>
<li>å“¨å…µåœ¨è¿›è¡Œä¸»ä»åˆ‡æ¢è¿‡ç¨‹ä¸­ç»å†ä¸‰ä¸ªé˜¶æ®µ<ul>
<li>ç›‘æ§</li>
<li>é€šçŸ¥</li>
<li>æ•…éšœè½¬ç§»</li>
</ul>
</li>
</ul>
<h4 id="2-5-1-ç›‘æ§é˜¶æ®µ"><a href="#2-5-1-ç›‘æ§é˜¶æ®µ" class="headerlink" title="2.5.1 ç›‘æ§é˜¶æ®µ"></a>2.5.1 ç›‘æ§é˜¶æ®µ</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_48_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_48_20210327.png" alt="img"></a></p>
<ul>
<li>ç”¨äºåŒæ­¥å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯<ul>
<li>è·å–å„ä¸ªsentinelçš„çŠ¶æ€ï¼ˆæ˜¯å¦åœ¨çº¿ï¼‰</li>
<li>è·å–masterçš„çŠ¶æ€<ul>
<li>masterå±æ€§<ul>
<li>runid</li>
<li>roleï¼šmaster</li>
</ul>
</li>
<li>å„ä¸ªslaveçš„è¯¦ç»†ä¿¡æ¯</li>
</ul>
</li>
<li>è·å–æ‰€æœ‰slaveçš„çŠ¶æ€ï¼ˆæ ¹æ®masterä¸­çš„slaveä¿¡æ¯ï¼‰<ul>
<li>slaveå±æ€§<ul>
<li>runid</li>
<li>roleï¼šslave</li>
<li>master_hostã€master_port</li>
<li>offset</li>
<li>â€¦</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_49_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_49_20210327.png" alt="img"></a></p>
<h4 id="2-5-2-é€šçŸ¥é˜¶æ®µ"><a href="#2-5-2-é€šçŸ¥é˜¶æ®µ" class="headerlink" title="2.5.2 é€šçŸ¥é˜¶æ®µ"></a>2.5.2 é€šçŸ¥é˜¶æ®µ</h4><ul>
<li>å„ä¸ªå“¨å…µå°†å¾—åˆ°çš„ä¿¡æ¯ç›¸äº’åŒæ­¥ï¼ˆä¿¡æ¯å¯¹ç§°ï¼‰</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_50_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_50_20210327.png" alt="img"></a></p>
<h4 id="2-5-3-æ•…éšœè½¬ç§»é˜¶æ®µ"><a href="#2-5-3-æ•…éšœè½¬ç§»é˜¶æ®µ" class="headerlink" title="2.5.3 æ•…éšœè½¬ç§»é˜¶æ®µ"></a>2.5.3 æ•…éšœè½¬ç§»é˜¶æ®µ</h4><h5 id="ç¡®è®¤masterä¸‹çº¿"><a href="#ç¡®è®¤masterä¸‹çº¿" class="headerlink" title="ç¡®è®¤masterä¸‹çº¿"></a>ç¡®è®¤masterä¸‹çº¿</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_51_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_51_20210327.png" alt="img"></a></p>
<ul>
<li>å½“æŸä¸ªå“¨å…µå‘ç°ä¸»æœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œä¼šå°†masterä¸­çš„SentinelRedistanceä¸­çš„masteræ”¹ä¸º<strong>SRI_S_DOWN</strong>ï¼ˆä¸»è§‚ä¸‹çº¿ï¼‰ï¼Œå¹¶é€šçŸ¥å…¶ä»–å“¨å…µï¼Œå‘Šè¯‰ä»–ä»¬å‘ç°masteræŒ‚æ‰äº†ã€‚</li>
<li>å…¶ä»–å“¨å…µåœ¨æ¥æ”¶åˆ°è¯¥å“¨å…µå‘é€çš„ä¿¡æ¯åï¼Œä¹Ÿä¼šå°è¯•å»è¿æ¥masterï¼Œå¦‚æœè¶…è¿‡åŠæ•°ï¼ˆé…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ï¼‰ç¡®è®¤masteræŒ‚æ‰åï¼Œä¼šå°†masterä¸­çš„SentinelRedistanceä¸­çš„masteræ”¹ä¸º<strong>SRI_O_DOWN</strong>ï¼ˆå®¢è§‚ä¸‹çº¿ï¼‰</li>
</ul>
<h5 id="æ¨é€‰å“¨å…µè¿›è¡Œå¤„ç†"><a href="#æ¨é€‰å“¨å…µè¿›è¡Œå¤„ç†" class="headerlink" title="æ¨é€‰å“¨å…µè¿›è¡Œå¤„ç†"></a>æ¨é€‰å“¨å…µè¿›è¡Œå¤„ç†</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_52_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_52_20210327.png" alt="img"></a></p>
<ul>
<li>åœ¨ç¡®è®¤masteræŒ‚æ‰ä»¥åï¼Œä¼šæ¨é€‰å‡ºä¸€ä¸ªå“¨å…µæ¥è¿›è¡Œæ•…éšœè½¬ç§»å·¥ä½œï¼ˆç”±è¯¥å“¨å…µæ¥æŒ‡å®šå“ªä¸ªslaveæ¥åšæ–°çš„masterï¼‰ã€‚</li>
<li>ç­›é€‰æ–¹å¼æ˜¯å“¨å…µäº’ç›¸å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”å‚ä¸æŠ•ç¥¨ï¼Œç¥¨å¤šè€…å½“é€‰ã€‚</li>
</ul>
<h5 id="æŒ‘é€‰æ–°master"><a href="#æŒ‘é€‰æ–°master" class="headerlink" title="æŒ‘é€‰æ–°master"></a>æŒ‘é€‰æ–°master</h5><ul>
<li>ç”±æ¨é€‰å‡ºæ¥çš„å“¨å…µå¯¹å½“å‰çš„slaveè¿›è¡Œç­›é€‰ï¼Œç­›é€‰æ¡ä»¶æœ‰ï¼š<ul>
<li>æœåŠ¡å™¨åˆ—è¡¨ä¸­æŒ‘é€‰å¤‡é€‰master<ul>
<li>åœ¨çº¿çš„</li>
<li>å“åº”æ…¢çš„</li>
<li>ä¸åŸmasteræ–­å¼€æ—¶é—´ä¹…çš„</li>
<li>ä¼˜å…ˆåŸåˆ™<ul>
<li>ä¼˜å…ˆçº§</li>
<li>offset</li>
<li>runid</li>
</ul>
</li>
</ul>
</li>
<li>å‘é€æŒ‡ä»¤ï¼ˆ sentinel ï¼‰<ul>
<li>å‘æ–°çš„masterå‘é€<strong>slaveof no one</strong>(æ–­å¼€ä¸åŸmasterçš„è¿æ¥)</li>
<li>å‘å…¶ä»–slaveå‘é€slaveof æ–°masterIPç«¯å£ï¼ˆè®©å…¶ä»–slaveä¸æ–°çš„masterç›¸è¿ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-5-4-å„é˜¶æ®µçš„æ€»ç»“"><a href="#2-5-4-å„é˜¶æ®µçš„æ€»ç»“" class="headerlink" title="2.5.4 å„é˜¶æ®µçš„æ€»ç»“"></a>2.5.4 å„é˜¶æ®µçš„æ€»ç»“</h4><ul>
<li>ç›‘æ§<ul>
<li>åŒæ­¥ä¿¡æ¯</li>
</ul>
</li>
<li>é€šçŸ¥<ul>
<li>ä¿æŒè”é€š</li>
</ul>
</li>
<li>æ•…éšœè½¬ç§»<ul>
<li>å‘ç°é—®é¢˜</li>
<li>ç«é€‰è´Ÿè´£äºº</li>
<li>ä¼˜é€‰æ–°master</li>
<li>æ–°masterä¸Šä»»ï¼Œå…¶ä»–slaveåˆ‡æ¢masterï¼ŒåŸmasterä½œä¸ºslaveæ•…éšœæ¢å¤åè¿æ¥</li>
</ul>
</li>
</ul>
<h2 id="3-é›†ç¾¤"><a href="#3-é›†ç¾¤" class="headerlink" title="3. é›†ç¾¤"></a>3. é›†ç¾¤</h2><h3 id="3-1-é›†ç¾¤ç®€ä»‹"><a href="#3-1-é›†ç¾¤ç®€ä»‹" class="headerlink" title="3.1 é›†ç¾¤ç®€ä»‹"></a>3.1 é›†ç¾¤ç®€ä»‹</h3><h4 id="3-1-1-é›†ç¾¤æ¶æ„"><a href="#3-1-1-é›†ç¾¤æ¶æ„" class="headerlink" title="3.1.1 é›†ç¾¤æ¶æ„"></a>3.1.1 é›†ç¾¤æ¶æ„</h4><ul>
<li>é›†ç¾¤å°±æ˜¯ä½¿ç”¨ç½‘ç»œå°†è‹¥å¹²å°è®¡ç®—æœº<strong>è”é€š</strong>èµ·æ¥ï¼Œå¹¶æä¾›<strong>ç»Ÿä¸€çš„ç®¡ç†æ–¹å¼</strong>ï¼Œä½¿å…¶å¯¹å¤–å‘ˆç°å•æœºçš„æœåŠ¡æ•ˆæœ</li>
</ul>
<h4 id="3-1-2-é›†ç¾¤ä½œç”¨"><a href="#3-1-2-é›†ç¾¤ä½œç”¨" class="headerlink" title="3.1.2 é›†ç¾¤ä½œç”¨"></a>3.1.2 é›†ç¾¤ä½œç”¨</h4><ul>
<li>åˆ†æ•£å•å°æœåŠ¡å™¨çš„è®¿é—®å‹åŠ›ï¼Œå®ç°<strong>è´Ÿè½½å‡è¡¡</strong></li>
<li>åˆ†æ•£å•å°æœåŠ¡å™¨çš„å­˜å‚¨å‹åŠ›ï¼Œå®ç°<strong>å¯æ‰©å±•æ€§</strong></li>
<li><strong>é™ä½</strong>å•å°æœåŠ¡å™¨å®•æœºå¸¦æ¥çš„<strong>ä¸šåŠ¡ç¾éš¾</strong></li>
</ul>
<h3 id="3-2-é›†ç¾¤ç»“æ„è®¾è®¡"><a href="#3-2-é›†ç¾¤ç»“æ„è®¾è®¡" class="headerlink" title="3.2 é›†ç¾¤ç»“æ„è®¾è®¡"></a>3.2 é›†ç¾¤ç»“æ„è®¾è®¡</h3><h4 id="3-2-1-æ•°æ®å­˜å‚¨è®¾è®¡"><a href="#3-2-1-æ•°æ®å­˜å‚¨è®¾è®¡" class="headerlink" title="3.2.1 æ•°æ®å­˜å‚¨è®¾è®¡"></a>3.2.1 æ•°æ®å­˜å‚¨è®¾è®¡</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_53_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_53_20210328.png" alt="img"></a></p>
<ul>
<li><p>é€šè¿‡ç®—æ³•è®¾è®¡ï¼Œè®¡ç®—å‡ºkeyåº”è¯¥ä¿å­˜çš„ä½ç½®</p>
</li>
<li><p>å°†æ‰€æœ‰çš„å­˜å‚¨ç©ºé—´è®¡åˆ’åˆ‡å‰²æˆ16384ä»½ï¼Œæ¯å°ä¸»æœºä¿å­˜ä¸€éƒ¨åˆ† æ¯ä»½ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œä¸æ˜¯ä¸€ä¸ªkeyçš„ä¿å­˜ç©ºé—´</p>
</li>
<li><p>å°†keyæŒ‰ç…§è®¡ç®—å‡ºçš„ç»“æœæ”¾åˆ°å¯¹åº”çš„å­˜å‚¨ç©ºé—´</p>
</li>
<li><p>å¢å¼ºå¯æ‰©å±•æ€§ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_54_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_54_20210328.png" alt="img"></a></p>
</li>
</ul>
<h4 id="3-2-2-é›†ç¾¤å†…éƒ¨é€šè®¯è®¾è®¡"><a href="#3-2-2-é›†ç¾¤å†…éƒ¨é€šè®¯è®¾è®¡" class="headerlink" title="3.2.2 é›†ç¾¤å†…éƒ¨é€šè®¯è®¾è®¡"></a>3.2.2 é›†ç¾¤å†…éƒ¨é€šè®¯è®¾è®¡</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_55_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_55_20210328.png" alt="img"></a></p>
<ul>
<li>å„ä¸ªæ•°æ®åº“äº’ç›¸è¿é€šï¼Œä¿å­˜å„ä¸ªåº“ä¸­æ§½çš„ç¼–å·æ•°æ®</li>
<li>ä¸€æ¬¡å‘½ä¸­ï¼Œç›´æ¥è¿”å›</li>
<li>ä¸€æ¬¡æœªå‘½ä¸­ï¼Œå‘ŠçŸ¥å…·ä½“çš„ä½ç½®ï¼Œkeyå†ç›´æ¥å»æ‰¾å¯¹åº”çš„åº“ä¿å­˜æ•°æ®</li>
</ul>
<h4 id="3-2-3-é›†ç¾¤clusteræ­å»º"><a href="#3-2-3-é›†ç¾¤clusteræ­å»º" class="headerlink" title="3.2.3 é›†ç¾¤clusteræ­å»º"></a>3.2.3 é›†ç¾¤clusteræ­å»º</h4><h5 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h5><ul>
<li>ä¿®æ”¹ä¸€ä»½redis-6379.conf</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_56_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_56_20210328.png" alt="img"></a></p>
<ul>
<li><p>å¤åˆ¶5ä»½ï¼Œå¹¶ä¿®æ”¹ç«¯å£å</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed &quot;s&#x2F;6379&#x2F;6380&#x2F;g&quot; redis-6379.conf &gt; redis-6380.conf</span><br><span class="line">sed &quot;s&#x2F;6379&#x2F;6381&#x2F;g&quot; redis-6379.conf &gt; redis-6381.conf</span><br><span class="line">sed &quot;s&#x2F;6379&#x2F;6382&#x2F;g&quot; redis-6379.conf &gt; redis-6382.conf</span><br><span class="line">sed &quot;s&#x2F;6379&#x2F;6383&#x2F;g&quot; redis-6379.conf &gt; redis-6383.conf</span><br><span class="line">sed &quot;s&#x2F;6379&#x2F;6384&#x2F;g&quot; redis-6379.conf &gt; redis-6384.conf</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>åˆ†åˆ«åœ¨6ä¸ªå®¢æˆ·ç«¯å¯åŠ¨æœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œ6æ¬¡</span><br><span class="line">redis-server é…ç½®æ–‡ä»¶è·¯å¾„</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯åŠ¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_57_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_57_20210328.png" alt="img"></a></p>
<p>æœåŠ¡å¼€å¯æ­£å¸¸</p>
</li>
<li><p>æŸ¥æ‰¾redis-trib.rbçš„å‘½ä»¤(è¯¥æŒ‡ä»¤æ‰§è¡ŒåŸºäºrubyï¼Œgemï¼Œéœ€è¦å®‰è£…)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ll | grep redis-</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_58_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_58_20210328.png" alt="img"></a></p>
</li>
<li><p>æ‰§è¡Œredis-tribå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¯¥å‘½ä»¤åªåœ¨å½“å‰ç›®å½•ä¸‹æœ‰æ•ˆ,--replicasä»£è¡¨é›†ç¾¤ç»“æ„ï¼Œ1è¡¨ç¤ºæ¯ä¸ªmasterè¿æ¥1ä¸ªslave</span><br><span class="line">.&#x2F;redis-trib.rb create --replicas 1 127.0.0.1ï¼š6379 127.0.0.1ï¼š6380 127.0.0.1ï¼š6381 127.0.0.1ï¼š6382 127.0.0.1ï¼š6383 127.0.0.1ï¼š6384</span><br><span class="line"># æœ€åè¾“å…¥yes</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_59_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_59_20210328.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_60_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_60_20210328.png" alt="img"></a></p>
</li>
<li><p>å®Œæˆè¿è¡Œåï¼Œæ¯ä¸ªnodeæ–‡ä»¶åŠ å…¥äº†ç³Ÿåˆ†é…ä¿¡æ¯</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_61_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_61_20210328.png" alt="img"></a></p>
</li>
<li><p>é›†ç¾¤æ­å»ºå®Œæ¯•</p>
</li>
</ul>
<h5 id="é›†ç¾¤è®¾ç½®ä¸è·å–æ•°æ®"><a href="#é›†ç¾¤è®¾ç½®ä¸è·å–æ•°æ®" class="headerlink" title="é›†ç¾¤è®¾ç½®ä¸è·å–æ•°æ®"></a>é›†ç¾¤è®¾ç½®ä¸è·å–æ•°æ®</h5><ul>
<li>è®¾ç½®æ•°æ®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># æ“ä½œé›†ç¾¤</span><br><span class="line">redis-cli -c</span><br><span class="line">set name itheima</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>è·å–æ•°æ®</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -p 6382</span><br><span class="line"># å¦‚æœä¸åœ¨6382ç«¯å£ï¼Œä¸‹é¢ä¼šæç¤ºå‘ç”Ÿäº†é‡å®šå‘</span><br><span class="line">get name</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h5 id="ä¸»ä»ä¸‹çº¿ä¸ä¸»ä»åˆ‡æ¢"><a href="#ä¸»ä»ä¸‹çº¿ä¸ä¸»ä»åˆ‡æ¢" class="headerlink" title="ä¸»ä»ä¸‹çº¿ä¸ä¸»ä»åˆ‡æ¢"></a>ä¸»ä»ä¸‹çº¿ä¸ä¸»ä»åˆ‡æ¢</h5><ul>
<li><p>slaveä¸‹çº¿å¯¹åŠŸèƒ½ä¸äº§ç”Ÿå½±å“ï¼Œä¼šæ ‡è®°ä»¥ä¸‹slave</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_62_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_62_20210328.png" alt="img"></a></p>
</li>
<li><p>masterä¸‹çº¿</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_63_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_63_20210328.png" alt="img"></a></p>
<p>ä¹‹åslaveä¼šå˜ä¸ºmaster</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</span><br><span class="line">cluster nodes</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_64_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_64_20210328.png" alt="img"></a><br>masterä¸Šçº¿åï¼Œå˜ä¸ºslaveï¼Œä¹‹å‰çš„slaveå˜ä¸ºmaster<br><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_65_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_65_20210328.png" alt="img"></a></p>
</li>
</ul>
<h5 id="é›†ç¾¤é…ç½®æ€»ç»“"><a href="#é›†ç¾¤é…ç½®æ€»ç»“" class="headerlink" title="é›†ç¾¤é…ç½®æ€»ç»“"></a>é›†ç¾¤é…ç½®æ€»ç»“</h5><ul>
<li><p>è®¾ç½®åŠ å…¥clusterï¼Œæˆä¸ºå…¶ä¸­èŠ‚ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster-enabled yes | no</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>clusteré…ç½®æ–‡ä»¶åï¼Œè¯¥æ–‡ä»¶å±äºè‡ªåŠ¨ç”Ÿæˆï¼Œä»…ç”¨äºå¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶å¹¶æŸ¥è¯¢æ–‡ä»¶å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster-config-file &lt;filename&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>èŠ‚ç‚¹æœåŠ¡å“åº”è¶…æ—¶æ—¶é—´ï¼Œç”¨äºåˆ¤å®šè¯¥èŠ‚ç‚¹æ˜¯å¦ä¸‹çº¿æˆ–è€…åˆ‡æ¢ä¸ºä»èŠ‚ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster-node-timeout &lt;millseconds&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>masterè¿æ¥çš„slaveæœ€å°æ•°é‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster-migration-barrier &lt;count&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="clusterèŠ‚ç‚¹æ“ä½œæŒ‡ä»¤æ€»ç»“"><a href="#clusterèŠ‚ç‚¹æ“ä½œæŒ‡ä»¤æ€»ç»“" class="headerlink" title="clusterèŠ‚ç‚¹æ“ä½œæŒ‡ä»¤æ€»ç»“"></a>clusterèŠ‚ç‚¹æ“ä½œæŒ‡ä»¤æ€»ç»“</h5><ul>
<li><p>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster node</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>è¿›å…¥ä¸€ä¸ªä»èŠ‚ç‚¹redisï¼Œåˆ‡æ¢å…¶ä¸ºä¸»èŠ‚ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster replicate &lt;master-id&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>å‘ç°ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œæ–°å¢ä¸»èŠ‚ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster meet ip:port</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>å¿½ç•¥ä¸€ä¸ªæ²¡æœ‰soltçš„èŠ‚ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster forget &lt;id&gt;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æ‰‹åŠ¨æ•…éšœè½¬ç§»</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cluster failover</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ"><a href="#4-ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4. ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ"></a>4. ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ</h2><h3 id="4-1-ç¼“å­˜é¢„çƒ­"><a href="#4-1-ç¼“å­˜é¢„çƒ­" class="headerlink" title="4.1 ç¼“å­˜é¢„çƒ­"></a>4.1 ç¼“å­˜é¢„çƒ­</h3><h4 id="4-1-1-é—®é¢˜æ’æŸ¥"><a href="#4-1-1-é—®é¢˜æ’æŸ¥" class="headerlink" title="4.1.1 é—®é¢˜æ’æŸ¥"></a>4.1.1 é—®é¢˜æ’æŸ¥</h4><ul>
<li>è¯·æ±‚æ•°é‡è¾ƒé«˜</li>
<li>ä¸»ä»ä¹‹é—´æ•°æ®ååé‡è¾ƒå¤§ï¼Œæ•°æ®åŒæ­¥æ“ä½œé¢‘åº¦è¾ƒé«˜</li>
</ul>
<h4 id="4-1-2-è§£å†³æ–¹æ¡ˆ"><a href="#4-1-2-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4.1.2 è§£å†³æ–¹æ¡ˆ"></a>4.1.2 è§£å†³æ–¹æ¡ˆ</h4><ul>
<li>å‰ç½®å‡†å¤‡å·¥ä½œï¼š<ul>
<li>æ—¥å¸¸ä¾‹è¡Œç»Ÿè®¡æ•°æ®è®¿é—®è®°å½•ï¼Œç»Ÿè®¡è®¿é—®é¢‘åº¦è¾ƒé«˜çš„çƒ­ç‚¹æ•°æ®</li>
<li>åˆ©ç”¨LRUæ•°æ®åˆ é™¤ç­–ç•¥ï¼Œæ„å»ºæ•°æ®ç•™å­˜é˜Ÿåˆ—<ul>
<li>ä¾‹å¦‚ï¼šstormä¸kafkaé…åˆ</li>
</ul>
</li>
</ul>
</li>
<li>å‡†å¤‡å·¥ä½œï¼š<ul>
<li>å°†ç»Ÿè®¡ç»“æœä¸­çš„æ•°æ®åˆ†ç±»ï¼Œæ ¹æ®çº§åˆ«ï¼Œredisä¼˜å…ˆåŠ è½½çº§åˆ«è¾ƒé«˜çš„çƒ­ç‚¹æ•°æ®</li>
<li>åˆ©ç”¨åˆ†å¸ƒå¼å¤šæœåŠ¡å™¨åŒæ—¶è¿›è¡Œæ•°æ®è¯»å–ï¼Œæé€Ÿæ•°æ®åŠ è½½è¿‡ç¨‹</li>
<li>çƒ­ç‚¹æ•°æ®ä¸»ä»åŒæ—¶é¢„çƒ­</li>
</ul>
</li>
<li>å®æ–½ï¼š<ul>
<li>ä½¿ç”¨è„šæœ¬ç¨‹åºå›ºå®šè§¦å‘æ•°æ®é¢„çƒ­è¿‡ç¨‹</li>
<li>å¦‚æœæ¡ä»¶å…è®¸ï¼Œä½¿ç”¨äº†CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰ï¼Œæ•ˆæœä¼šæ›´å¥½</li>
</ul>
</li>
</ul>
<h4 id="4-1-3-æ€»ç»“"><a href="#4-1-3-æ€»ç»“" class="headerlink" title="4.1.3 æ€»ç»“"></a>4.1.3 æ€»ç»“</h4><p>ç¼“å­˜é¢„çƒ­å°±æ˜¯ç³»ç»Ÿå¯åŠ¨å‰ï¼Œæå‰å°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼ç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼</p>
<h3 id="4-2-ç¼“å­˜é›ªå´©"><a href="#4-2-ç¼“å­˜é›ªå´©" class="headerlink" title="4.2 ç¼“å­˜é›ªå´©"></a>4.2 ç¼“å­˜é›ªå´©</h3><h4 id="4-2-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ1ï¼‰"><a href="#4-2-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ1ï¼‰" class="headerlink" title="4.2.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ1ï¼‰"></a>4.2.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ1ï¼‰</h4><ol>
<li>ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¿½ç„¶æ•°æ®åº“è¿æ¥é‡æ¿€å¢</li>
<li>åº”ç”¨æœåŠ¡å™¨æ— æ³•åŠæ—¶å¤„ç†è¯·æ±‚</li>
<li>å¤§é‡408ï¼Œ500é”™è¯¯é¡µé¢å‡ºç°</li>
<li>å®¢æˆ·åå¤åˆ·æ–°é¡µé¢è·å–æ•°æ®</li>
<li>æ•°æ®åº“å´©æºƒ</li>
<li>åº”ç”¨æœåŠ¡å™¨å´©æºƒ</li>
<li>é‡å¯åº”ç”¨æœåŠ¡å™¨æ— æ•ˆ</li>
<li>RedisæœåŠ¡å™¨å´©æºƒ</li>
<li>Redisé›†ç¾¤å´©æºƒ</li>
<li>é‡å¯æ•°æ®åº“åå†æ¬¡è¢«ç¬é—´æµé‡æ”¾å€’</li>
</ol>
<h4 id="4-2-2-é—®é¢˜æ’æŸ¥"><a href="#4-2-2-é—®é¢˜æ’æŸ¥" class="headerlink" title="4.2.2 é—®é¢˜æ’æŸ¥"></a>4.2.2 é—®é¢˜æ’æŸ¥</h4><ol>
<li>åœ¨ä¸€ä¸ª<strong>è¾ƒçŸ­</strong>çš„æ—¶é—´å†…ï¼Œç¼“å­˜ä¸­è¾ƒå¤šçš„key<strong>é›†ä¸­è¿‡æœŸ</strong></li>
<li>æ­¤å‘¨æœŸå†…è¯·æ±‚è®¿é—®è¿‡æœŸçš„æ•°æ®ï¼Œredisæœªå‘½ä¸­ï¼Œrediså‘æ•°æ®åº“è·å–æ•°æ®</li>
<li>æ•°æ®åº“åŒæ—¶æ¥æ”¶åˆ°å¤§é‡çš„è¯·æ±‚æ— æ³•åŠæ—¶å¤„ç†</li>
<li>Rediså¤§é‡è¯·æ±‚è¢«ç§¯å‹ï¼Œå¼€å§‹å‡ºç°è¶…æ—¶ç°è±¡</li>
<li>æ•°æ®åº“æµé‡æ¿€å¢ï¼Œæ•°æ®åº“å´©æºƒ</li>
<li>é‡å¯åä»ç„¶é¢å¯¹ç¼“å­˜ä¸­æ— æ•°æ®å¯ç”¨</li>
<li>RedisæœåŠ¡å™¨èµ„æºè¢«ä¸¥é‡å ç”¨ï¼ŒRedisæœåŠ¡å™¨å´©æºƒ</li>
<li>Redisé›†ç¾¤å‘ˆç°å´©å¡Œï¼Œé›†ç¾¤ç“¦è§£</li>
<li>åº”ç”¨æœåŠ¡å™¨æ— æ³•åŠæ—¶å¾—åˆ°æ•°æ®å“åº”è¯·æ±‚ï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨æœåŠ¡å™¨å´©æºƒ</li>
<li>åº”ç”¨æœåŠ¡å™¨ï¼Œredisï¼Œæ•°æ®åº“å…¨éƒ¨é‡å¯ï¼Œæ•ˆæœä¸ç†æƒ³</li>
</ol>
<h4 id="4-2-3-é—®é¢˜åˆ†æ"><a href="#4-2-3-é—®é¢˜åˆ†æ" class="headerlink" title="4.2.3 é—®é¢˜åˆ†æ"></a>4.2.3 é—®é¢˜åˆ†æ</h4><ul>
<li>çŸ­æ—¶é—´èŒƒå›´å†…</li>
<li>å¤§é‡keyé›†ä¸­è¿‡æœŸ</li>
</ul>
<h4 id="4-2-4-è§£å†³æ–¹æ¡ˆï¼ˆé“ï¼‰"><a href="#4-2-4-è§£å†³æ–¹æ¡ˆï¼ˆé“ï¼‰" class="headerlink" title="4.2.4 è§£å†³æ–¹æ¡ˆï¼ˆé“ï¼‰"></a>4.2.4 è§£å†³æ–¹æ¡ˆï¼ˆé“ï¼‰</h4><ol>
<li><p>æ›´å¤šçš„é¡µé¢é™æ€åŒ–å¤„ç†</p>
</li>
<li><p>æ„å»º<strong>å¤šçº§ç¼“å­˜æ¶æ„</strong></p>
<ul>
<li>Nginxç¼“å­˜+redisç¼“å­˜+ehcacheç¼“å­˜</li>
</ul>
</li>
<li><p>æ£€æµ‹Mysqlä¸¥é‡è€—æ—¶ä¸šåŠ¡è¿›è¡Œä¼˜åŒ–</p>
<ul>
<li>å¯¹æ•°æ®åº“çš„ç“¶é¢ˆæ’æŸ¥ï¼šä¾‹å¦‚è¶…æ—¶æŸ¥è¯¢ã€è€—æ—¶è¾ƒé«˜äº‹åŠ¡ç­‰</li>
</ul>
</li>
<li><p>ç¾éš¾é¢„è­¦æœºåˆ¶</p>
<p>ç›‘æ§redisæœåŠ¡å™¨æ€§èƒ½æŒ‡æ ‡</p>
<ul>
<li>CPUå ç”¨ã€CPUä½¿ç”¨ç‡</li>
<li>å†…å­˜å®¹é‡</li>
<li>æŸ¥è¯¢å¹³å‡å“åº”æ—¶é—´</li>
<li>çº¿ç¨‹æ•°</li>
</ul>
</li>
<li><p>é™æµã€é™çº§</p>
<ul>
<li>çŸ­æ—¶é—´èŒƒå›´å†…ç‰ºç‰²ä¸€äº›å®¢æˆ·ä½“éªŒï¼Œé™åˆ¶ä¸€éƒ¨åˆ†è¯·æ±‚è®¿é—®ï¼Œé™ä½åº”ç”¨æœåŠ¡å™¨å‹åŠ›ï¼Œå¾…ä¸šåŠ¡ä½é€Ÿè¿è½¬åå†é€æ­¥æ”¾å¼€è®¿é—®</li>
</ul>
</li>
</ol>
<h4 id="4-2-5-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"><a href="#4-2-5-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰" class="headerlink" title="4.2.5 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"></a>4.2.5 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰</h4><ol>
<li>LRUä¸LFUåˆ‡æ¢</li>
<li>æ•°æ®æœ‰æ•ˆæœŸç­–ç•¥è°ƒæ•´<ul>
<li>æ ¹æ®ä¸šåŠ¡æ•°æ®æœ‰æ•ˆæœŸè¿›è¡Œ<strong>åˆ†ç±»é”™å³°</strong>ï¼ŒAç±»90åˆ†é’Ÿï¼ŒBç±»80åˆ†é’Ÿï¼ŒCç±»70åˆ†é’Ÿ</li>
<li>è¿‡æœŸæ—¶é—´ä½¿ç”¨å›ºå®šæ—¶é—´+éšæœºå€¼çš„å½¢å¼ï¼Œ<strong>ç¨€é‡Š</strong>é›†ä¸­åˆ°æœŸçš„keyçš„æ•°é‡</li>
</ul>
</li>
<li><strong>è¶…çƒ­</strong>æ•°æ®ä½¿ç”¨æ°¸ä¹…key</li>
<li>å®šæœŸç»´æŠ¤ï¼ˆè‡ªåŠ¨+äººå·¥ï¼‰<ul>
<li>å¯¹å³å°†è¿‡æœŸæ•°æ®åšè®¿é—®é‡åˆ†æï¼Œç¡®è®¤æ˜¯å¦å»¶æ—¶ï¼Œé…åˆè®¿é—®é‡ç»Ÿè®¡ï¼Œåšçƒ­ç‚¹æ•°æ®çš„å»¶æ—¶</li>
</ul>
</li>
<li>åŠ é” <strong>æ…ç”¨ï¼</strong></li>
</ol>
<h4 id="4-2-6-æ€»ç»“"><a href="#4-2-6-æ€»ç»“" class="headerlink" title="4.2.6 æ€»ç»“"></a>4.2.6 æ€»ç»“</h4><p>ç¼“å­˜é›ªå´©å°±æ˜¯<strong>ç¬é—´è¿‡æœŸæ•°æ®é‡å¤ªå¤§</strong>ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚å¦‚èƒ½å¤Ÿ<strong>æœ‰æ•ˆé¿å…è¿‡æœŸæ—¶é—´é›†ä¸­</strong>ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³é›ªå´©ç°è±¡çš„å‡ºç° ï¼ˆçº¦40%ï¼‰ï¼Œé…åˆå…¶ä»–ç­–ç•¥ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ç›‘æ§æœåŠ¡å™¨çš„è¿è¡Œæ•°æ®ï¼Œæ ¹æ®è¿è¡Œè®°å½•åšå¿«é€Ÿè°ƒæ•´ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_66_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_66_20210328.png" alt="img"></a></p>
<h3 id="4-3-ç¼“å­˜å‡»ç©¿"><a href="#4-3-ç¼“å­˜å‡»ç©¿" class="headerlink" title="4.3 ç¼“å­˜å‡»ç©¿"></a>4.3 ç¼“å­˜å‡»ç©¿</h3><h4 id="4-3-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ2ï¼‰"><a href="#4-3-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ2ï¼‰" class="headerlink" title="4.3.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ2ï¼‰"></a>4.3.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ2ï¼‰</h4><ol>
<li>ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­</li>
<li>æ•°æ®åº“è¿æ¥é‡<strong>ç¬é—´æ¿€å¢</strong></li>
<li>RedisæœåŠ¡å™¨æ— å¤§é‡keyè¿‡æœŸ</li>
<li>Rediså†…å­˜å¹³ç¨³ï¼Œæ— æ³¢åŠ¨</li>
<li>RedisæœåŠ¡å™¨CPUæ­£å¸¸</li>
<li><strong>æ•°æ®åº“å´©æºƒ</strong></li>
</ol>
<h4 id="4-3-2-é—®é¢˜æ’æŸ¥"><a href="#4-3-2-é—®é¢˜æ’æŸ¥" class="headerlink" title="4.3.2 é—®é¢˜æ’æŸ¥"></a>4.3.2 é—®é¢˜æ’æŸ¥</h4><ol>
<li>Redisä¸­<strong>æŸä¸ªkeyè¿‡æœŸï¼Œè¯¥keyè®¿é—®é‡å·¨å¤§</strong></li>
<li>å¤šä¸ªæ•°æ®è¯·æ±‚ä»æœåŠ¡å™¨ç›´æ¥å‹åˆ°Redisåï¼Œå‡æœªå‘½ä¸­</li>
<li>Redisåœ¨çŸ­æ—¶é—´å†…å‘èµ·äº†å¤§é‡å¯¹æ•°æ®åº“ä¸­åŒä¸€æ•°æ®çš„è®¿é—®</li>
</ol>
<h4 id="4-3-3-é—®é¢˜åˆ†æ"><a href="#4-3-3-é—®é¢˜åˆ†æ" class="headerlink" title="4.3.3 é—®é¢˜åˆ†æ"></a>4.3.3 é—®é¢˜åˆ†æ</h4><ul>
<li>å•ä¸ªkeyé«˜çƒ­æ•°æ®</li>
<li>keyè¿‡æœŸ</li>
</ul>
<h4 id="4-3-4-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"><a href="#4-3-4-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰" class="headerlink" title="4.3.4 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"></a>4.3.4 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰</h4><ol>
<li><p>é¢„å…ˆè®¾å®š</p>
<p>ä»¥ç”µå•†ä¸ºä¾‹ï¼Œæ¯ä¸ªå•†å®¶æ ¹æ®åº—é“ºç­‰çº§ï¼ŒæŒ‡å®šè‹¥å¹²æ¬¾ä¸»æ‰“å•†å“ï¼Œåœ¨è´­ç‰©èŠ‚æœŸé—´ï¼Œ<strong>åŠ å¤§</strong>æ­¤ç±»ä¿¡æ¯keyçš„<strong>è¿‡æœŸæ—¶é•¿</strong></p>
<p>æ³¨æ„ï¼šè´­ç‰©èŠ‚ä¸ä»…ä»…æŒ‡å½“å¤©ï¼Œä»¥åŠåç»­è‹¥å¹²å¤©ï¼Œè®¿é—®å³°å€¼å‘ˆç°é€æ¸é™ä½çš„è¶‹åŠ¿</p>
</li>
<li><p>ç°åœºè°ƒæ•´</p>
<ul>
<li>ç›‘æ§è®¿é—®é‡ï¼Œå¯¹è‡ªç„¶æµé‡æ¿€å¢çš„æ•°æ®å»¶é•¿è¿‡æœŸæ—¶é—´æˆ–è®¾ç½®ä¸ºæ°¸ä¹…æ€§key</li>
</ul>
</li>
<li><p>åå°åˆ·æ–°æ•°æ®</p>
<ul>
<li>å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œé«˜å³°æœŸæ¥ä¸´ä¹‹å‰ï¼Œåˆ·æ–°æ•°æ®æœ‰æ•ˆæœŸï¼Œç¡®ä¿ä¸ä¸¢å¤±</li>
</ul>
</li>
<li><p>äºŒçº§ç¼“å­˜</p>
<ul>
<li>è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼Œä¿éšœä¸ä¼šè¢«åŒæ—¶æ·˜æ±°å°±è¡Œ</li>
</ul>
</li>
<li><p>åŠ é” åˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢è¢«å‡»ç©¿ï¼Œä½†æ˜¯è¦æ³¨æ„ä¹Ÿæ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œ<strong>æ…é‡ï¼</strong></p>
</li>
</ol>
<h4 id="4-3-5-æ€»ç»“"><a href="#4-3-5-æ€»ç»“" class="headerlink" title="4.3.5 æ€»ç»“"></a>4.3.5 æ€»ç»“</h4><p>ç¼“å­˜å‡»ç©¿å°±æ˜¯<strong>å•ä¸ªé«˜çƒ­æ•°æ®è¿‡æœŸçš„ç¬é—´</strong>ï¼Œæ•°æ®è®¿é—®é‡è¾ƒå¤§ï¼Œæœªå‘½ä¸­redisåï¼Œå‘èµ·äº†å¤§é‡å¯¹åŒä¸€æ•°æ®çš„æ•°æ®åº“é—®ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚åº”å¯¹ç­–ç•¥åº”è¯¥åœ¨ä¸šåŠ¡æ•°æ®åˆ†æä¸é¢„é˜²æ–¹é¢è¿›è¡Œï¼Œé…åˆè¿è¡Œç›‘æ§æµ‹è¯•ä¸å³æ—¶è°ƒæ•´ç­–ç•¥ï¼Œæ¯•ç«Ÿå•ä¸ªkeyçš„è¿‡æœŸç›‘æ§éš¾åº¦è¾ƒé«˜ï¼Œé…åˆé›ªå´©å¤„ç†ç­–ç•¥å³å¯</p>
<h3 id="4-4-ç¼“å­˜ç©¿é€"><a href="#4-4-ç¼“å­˜ç©¿é€" class="headerlink" title="4.4 ç¼“å­˜ç©¿é€"></a>4.4 ç¼“å­˜ç©¿é€</h3><h4 id="4-4-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ3ï¼‰"><a href="#4-4-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ3ï¼‰" class="headerlink" title="4.4.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ3ï¼‰"></a>4.4.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ3ï¼‰</h4><ol>
<li>ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­</li>
<li>åº”ç”¨æœåŠ¡å™¨æµé‡éšæ—¶é—´å¢é‡è¾ƒå¤§</li>
<li>RedisæœåŠ¡å™¨å‘½ä¸­ç‡éšæ—¶é—´é€æ­¥é™ä½</li>
<li>Rediså†…å­˜å¹³ç¨³ï¼Œå†…å­˜æ— å‹åŠ›</li>
<li>RedisæœåŠ¡å™¨CPUå ç”¨æ¿€å¢</li>
<li>æ•°æ®åº“æœåŠ¡å™¨å‹åŠ›æ¿€å¢</li>
<li><strong>æ•°æ®åº“å´©æºƒ</strong></li>
</ol>
<h4 id="4-4-2-é—®é¢˜æ’æŸ¥"><a href="#4-4-2-é—®é¢˜æ’æŸ¥" class="headerlink" title="4.4.2 é—®é¢˜æ’æŸ¥"></a>4.4.2 é—®é¢˜æ’æŸ¥</h4><ol>
<li>Redisä¸­å¤§é¢ç§¯å‡ºé™æœªå‘½ä¸­</li>
<li>å‡ºç°<strong>éæ­£å¸¸URLè®¿é—®</strong></li>
</ol>
<h4 id="4-4-3-é—®é¢˜åˆ†æ"><a href="#4-4-3-é—®é¢˜åˆ†æ" class="headerlink" title="4.4.3 é—®é¢˜åˆ†æ"></a>4.4.3 é—®é¢˜åˆ†æ</h4><ul>
<li>è·å–çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæ•°æ®åº“æŸ¥è¯¢æœªå¾—åˆ°å¯¹äºæ•°æ®</li>
<li>Redisè·å–åˆ°nullæ•°æ®æœªè¿›è¡ŒæŒä¹…åŒ–ï¼Œç›´æ¥è¿”å›</li>
<li>ä¸‹æ¬¡æ­¤ç±»æ•°æ®åˆ°è¾¾é‡å¤ä¸Šè¿°è¿‡ç¨‹</li>
<li>å‡ºé™é»‘å®¢æ”»å‡»æœåŠ¡å™¨</li>
</ul>
<h4 id="4-4-4-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"><a href="#4-4-4-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰" class="headerlink" title="4.4.4 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"></a>4.4.4 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_67_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_67_20210328.png" alt="img"></a></p>
<h4 id="4-4-5-æ€»ç»“"><a href="#4-4-5-æ€»ç»“" class="headerlink" title="4.4.5 æ€»ç»“"></a>4.4.5 æ€»ç»“</h4><p>ç¼“å­˜åŸºç¡€è®¿é—®äº†ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè·³è¿‡äº†åˆæ³•æ•°æ®çš„redisæ•°æ®ç¼“å­˜é˜¶æ®µï¼Œæ¯æ¬¡è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚é€šå¸¸æ­¤ç±»æ•°æ®çš„å‡ºç°é‡æ˜¯ä¸€ä¸ªè¾ƒä½å€¼ï¼Œå½“å‡ºç°æ­¤ç±»æƒ…å†µä»¥æ¯’æ”»æ¯’ï¼Œå¹¶å³ä½¿æŠ¥è­¦ã€‚åº”å¯¹ç­–ç•¥åº”è¯¥åœ¨ä¸´æ—¶é¢„æ¡ˆé˜²èŒƒæ–¹é¢å¤šåšæ–‡ç« ã€‚</p>
<p>ï¼ˆç›®æ ‡å°±æ˜¯æ‹¦åœ¨æœåŠ¡å™¨å¤–é¢ï¼Œç”¨bitmapså°±æ˜¯æ‹¦åˆ°rediså’ŒæœåŠ¡å™¨ä¸­é—´ï¼Œç”¨åŠ å¯†keyå°±æ˜¯æ‹¦åˆ°åº”ç”¨æœåŠ¡å™¨å¤–é¢ï¼‰</p>
<p>æ— è®ºæ˜¯é»‘åå•è¿˜æ˜¯ç™½åå•ï¼Œéƒ½æ˜¯å¯¹æ•´ä½“ç³»ç»Ÿçš„å‹åŠ›ï¼Œè­¦æŠ¥è§£é™¤åå°½å¿«ç§»é™¤ã€‚</p>
<h3 id="4-5-æ€§èƒ½æŒ‡æ ‡ç›‘æ§"><a href="#4-5-æ€§èƒ½æŒ‡æ ‡ç›‘æ§" class="headerlink" title="4.5 æ€§èƒ½æŒ‡æ ‡ç›‘æ§"></a>4.5 æ€§èƒ½æŒ‡æ ‡ç›‘æ§</h3><h4 id="4-5-1-ç›‘æ§æŒ‡æ ‡"><a href="#4-5-1-ç›‘æ§æŒ‡æ ‡" class="headerlink" title="4.5.1 ç›‘æ§æŒ‡æ ‡"></a>4.5.1 ç›‘æ§æŒ‡æ ‡</h4><ul>
<li><p>æ€§èƒ½æŒ‡æ ‡ï¼šPerformance</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_68_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_68_20210328.png" alt="img"></a></p>
</li>
<li><p>å†…å­˜æŒ‡æ ‡ï¼š Memory</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_69_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_69_20210328.png" alt="img"></a></p>
</li>
<li><p>åŸºæœ¬æ´»åŠ¨æŒ‡æ ‡ï¼šBasic acticity</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_70_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_70_20210328.png" alt="img"></a></p>
</li>
<li><p>æŒä¹…æ€§æŒ‡æ ‡ï¼šPersistence</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_71_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_71_20210328.png" alt="img"></a></p>
</li>
<li><p>é”™è¯¯æŒ‡æ ‡ï¼šError</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_72_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_72_20210328.png" alt="img"></a></p>
</li>
</ul>
<h4 id="4-5-2-ç›‘æ§æ–¹å¼"><a href="#4-5-2-ç›‘æ§æ–¹å¼" class="headerlink" title="4.5.2 ç›‘æ§æ–¹å¼"></a>4.5.2 ç›‘æ§æ–¹å¼</h4><ul>
<li>å·¥å…·<ul>
<li>Cloud Insight Redis</li>
<li>Prometheus</li>
<li>Redis-stat</li>
<li>Redis-faina</li>
<li>RedisLive</li>
<li>zabbix</li>
</ul>
</li>
<li>å‘½ä»¤<ul>
<li>benchmark</li>
<li>redis cli<ul>
<li>monitor</li>
<li>showlog</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="benchmark"><a href="#benchmark" class="headerlink" title="benchmark"></a>benchmark</h5><ul>
<li><p>å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark [-h ] [-p ] [-c ] [-n &lt;requests]&gt; [-k ]</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_73_20210328.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_73_20210328.png" alt="img"></a></p>
</li>
</ul>
<h5 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h5><ul>
<li><p>å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">monitor</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ‰“å°æœåŠ¡å™¨è°ƒè¯•ä¿¡æ¯</p>
</li>
</ul>
<h5 id="showlog"><a href="#showlog" class="headerlink" title="showlog"></a>showlog</h5><ul>
<li><p>å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slowlog [operator]</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>getï¼šè·å–æ…¢æŸ¥è¯¢æ—¥å¿—</li>
<li>lenï¼šè·å–æ…¢æŸ¥è¯¢æ—¥å¿—æ¡ç›®æ•°</li>
<li>resetï¼šå……å€¼æ…¢æŸ¥è¯¢æ—¥å¿—</li>
</ul>
</li>
<li><p>ç›¸å…³é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slowlog-log-slower-than 1000 # è®¾ç½®æ…¢æŸ¥è¯¢çš„æ—¶é—´ä¸‹é™ï¼Œå•ä½ms</span><br><span class="line">slowlog-max-len 100          # è®¾ç½®æ…¢æŸ¥è¯¢å‘½ä»¤å¯¹åº”çš„æ—¥å¿—æ˜¾ç¤ºé•¿åº¦ï¼Œå•ä½å‘½ä»¤æ•°</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/06/redis%E9%9B%86%E7%BE%A4%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" data-id="cknyemfch00056oub5bv8fjfm" data-title="redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-redisé«˜çº§" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/06/redis%E9%AB%98%E7%BA%A7/" class="article-date">
  <time class="dt-published" datetime="2021-04-06T11:35:09.000Z" itemprop="datePublished">2021-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/06/redis%E9%AB%98%E7%BA%A7/">redisé«˜çº§</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Redisé«˜çº§"><a href="#Redisé«˜çº§" class="headerlink" title="Redisé«˜çº§"></a>Redisé«˜çº§</h1><p>åŸºäº<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1CJ411m7Gc">é»‘é©¬Redis</a>çš„è§†é¢‘çš„å­¦ä¹ ç¬”è®°</p>
<h2 id="1-Linuxç¯èŠ‚å®‰è£…"><a href="#1-Linuxç¯èŠ‚å®‰è£…" class="headerlink" title="1. Linuxç¯èŠ‚å®‰è£…"></a>1. Linuxç¯èŠ‚å®‰è£…</h2><h3 id="1-1-å®‰è£…"><a href="#1-1-å®‰è£…" class="headerlink" title="1.1 å®‰è£…"></a>1.1 å®‰è£…</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_12_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_12_20210326.png" alt="img"></a></p>
<h3 id="1-2-å¯åŠ¨æ–¹å¼"><a href="#1-2-å¯åŠ¨æ–¹å¼" class="headerlink" title="1.2 å¯åŠ¨æ–¹å¼"></a>1.2 å¯åŠ¨æ–¹å¼</h3><ul>
<li>æ™®é€šé»˜è®¤ç«¯å£å¯åŠ¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># é»˜è®¤ç«¯å£å¼€å¯</span><br><span class="line">redis-serve</span><br><span class="line"># é»˜è®¤ç«¯å£è¿æ¥</span><br><span class="line">redis-cli</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>æŒ‡å®šç«¯å£å¯åŠ¨</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æ¢ç«¯å£å¯åŠ¨</span><br><span class="line">redis-server --port 6380</span><br><span class="line"># è¿æ¥å®¢æˆ·ç«¯æŒ‡å®šç«¯å£è¿æ¥</span><br><span class="line">redis-cli -p 6380</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨ redis-6379.conf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br><span class="line">daemonize yes</span><br><span class="line">logfile &quot;6379.log&quot;</span><br><span class="line">dir &#x2F;redis-4.0.0&#x2F;data</span><br><span class="line">Copy</span><br><span class="line"># å¯åŠ¨</span><br><span class="line">redis-server redis-6379.conf</span><br><span class="line">redis-server conf&#x2F;redis-6379.conf</span><br><span class="line"># è¿æ¥</span><br><span class="line">redis-cli</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="2-æŒä¹…åŒ–"><a href="#2-æŒä¹…åŒ–" class="headerlink" title="2. æŒä¹…åŒ–"></a>2. æŒä¹…åŒ–</h2><h3 id="2-1-åŸºæœ¬ä»‹ç»"><a href="#2-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="2.1 åŸºæœ¬ä»‹ç»"></a>2.1 åŸºæœ¬ä»‹ç»</h3><blockquote>
<p>ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼š</p>
</blockquote>
<p>åˆ©ç”¨æ°¸ä¹…æ€§å­˜å‚¨ä»‹è´¨å°†æ•°æ®è¿›è¡Œä¿å­˜ï¼Œåœ¨ç‰¹å®šçš„æ—¶é—´å°†ä¿å­˜çš„æ•°æ®è¿›è¡Œæ¢å¤çš„å·¥ä½œæœºåˆ¶</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦æŒä¹…åŒ–ï¼š</p>
</blockquote>
<p>é˜²æ­¢æ•°æ®çš„æ„å¤–ä¸¢å¤±ï¼Œç¡®ä¿æ•°æ®å®‰å…¨</p>
<blockquote>
<p>æŒä¹…åŒ–è¿‡ç¨‹ä¿å­˜ä»€ä¹ˆ</p>
</blockquote>
<ul>
<li>å°†å½“å‰<strong>æ•°æ®çŠ¶æ€</strong>è¿›è¡Œä¿å­˜ï¼Œ<strong>å¿«ç…§</strong>å½¢å¼ï¼Œå­˜å‚¨æ•°æ®ç»“æœï¼Œå­˜å‚¨æ ¼å¼ç®€å•ï¼Œå…³æ³¨ç‚¹åœ¨<strong>æ•°æ®</strong></li>
<li>å°†æ•°æ®çš„<strong>æ“ä½œè¿‡ç¨‹</strong>è¿›è¡Œä¿å­˜ï¼Œ<strong>æ—¥å¿—</strong>å½¢å¼ï¼Œå­˜å‚¨æ“ä½œè¿‡ç¨‹ï¼Œå­˜å‚¨æ ¼å¼å¤æ‚ï¼Œå…³æ³¨ç‚¹åœ¨æ•°æ®çš„æ“ä½œ<strong>è¿‡ç¨‹</strong></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_13_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_13_20210326.png" alt="img"></a></p>
<h3 id="2-2-RDB"><a href="#2-2-RDB" class="headerlink" title="2.2 RDB"></a>2.2 RDB</h3><h4 id="2-2-1-RDBå¯åŠ¨æ–¹å¼1â€“saveæŒ‡ä»¤"><a href="#2-2-1-RDBå¯åŠ¨æ–¹å¼1â€“saveæŒ‡ä»¤" class="headerlink" title="2.2.1 RDBå¯åŠ¨æ–¹å¼1â€“saveæŒ‡ä»¤"></a>2.2.1 RDBå¯åŠ¨æ–¹å¼1â€“saveæŒ‡ä»¤</h4><h5 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h5><ul>
<li><p>å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">save</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>ä½œç”¨</p>
<p>æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ä¿å­˜æ“ä½œ</p>
</li>
</ul>
<h5 id="ç›¸å…³é…ç½®"><a href="#ç›¸å…³é…ç½®" class="headerlink" title="ç›¸å…³é…ç½®"></a>ç›¸å…³é…ç½®</h5><ul>
<li>dbfilename dump.rdb<ul>
<li>è¯´æ˜ï¼šè®¾ç½®æœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸º dump.rdb</li>
<li>ç»éªŒï¼šé€šå¸¸è®¾ç½®ä¸º<strong>dump-<strong><strong>ç«¯å£å·</strong></strong>.rdb</strong></li>
</ul>
</li>
<li>dir<ul>
<li>è¯´æ˜ï¼šè®¾ç½®å­˜å‚¨.rdbæ–‡ä»¶çš„è·¯å¾„</li>
<li>ç»éªŒï¼šé€šå¸¸è®¾ç½®æˆå­˜å‚¨ç©ºé—´è¾ƒå¤§çš„ç›®å½•ä¸­ï¼Œç›®å½•åç§°<strong>data</strong></li>
</ul>
</li>
<li>rdbcompression yes<ul>
<li>è¯´æ˜ï¼šè®¾ç½®å­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸º yesï¼Œé‡‡ç”¨ LZF å‹ç¼©</li>
<li>ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦‚æœè®¾ç½®ä¸ºnoï¼Œå¯ä»¥èŠ‚çœ CPU è¿è¡Œæ—¶é—´ï¼Œä½†ä¼šä½¿å­˜å‚¨çš„æ–‡ä»¶å˜å¤§ï¼ˆå·¨å¤§ï¼‰</li>
</ul>
</li>
<li>rdbchecksum yes<ul>
<li>è¯´æ˜ï¼šè®¾ç½®æ˜¯å¦è¿›è¡ŒRDBæ–‡ä»¶æ ¼å¼æ ¡éªŒï¼Œè¯¥æ ¡éªŒè¿‡ç¨‹åœ¨å†™æ–‡ä»¶å’Œè¯»æ–‡ä»¶è¿‡ç¨‹å‡è¿›è¡Œ</li>
<li>ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦‚æœè®¾ç½®ä¸ºnoï¼Œå¯ä»¥èŠ‚çº¦è¯»å†™æ€§è¿‡ç¨‹çº¦10%æ—¶é—´æ¶ˆè€—ï¼Œä½†æ˜¯å­˜å‚¨ä¸€å®šçš„æ•°æ®æŸåé£é™©</li>
</ul>
</li>
</ul>
<p>é…ç½®åï¼Œconfæ–‡ä»¶å†…å®¹ä¸ºï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_14_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_14_20210326.png" alt="img"></a></p>
<h5 id="saveæŒ‡ä»¤å·¥ä½œåŸç†"><a href="#saveæŒ‡ä»¤å·¥ä½œåŸç†" class="headerlink" title="saveæŒ‡ä»¤å·¥ä½œåŸç†"></a>saveæŒ‡ä»¤å·¥ä½œåŸç†</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_15_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_15_20210326.png" alt="img"></a></p>
<h4 id="2-2-2-RDBå¯åŠ¨æ–¹å¼2â€“bgsaveæŒ‡ä»¤"><a href="#2-2-2-RDBå¯åŠ¨æ–¹å¼2â€“bgsaveæŒ‡ä»¤" class="headerlink" title="2.2.2 RDBå¯åŠ¨æ–¹å¼2â€“bgsaveæŒ‡ä»¤"></a>2.2.2 RDBå¯åŠ¨æ–¹å¼2â€“bgsaveæŒ‡ä»¤</h4><h5 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h5><ul>
<li><p>å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bgsave</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>ä½œç”¨</p>
<p>æ‰‹åŠ¨å¯åŠ¨åå°ä¿å­˜æ“ä½œï¼Œä½†<strong>ä¸æ˜¯ç«‹å³æ‰§è¡Œ</strong></p>
</li>
</ul>
<h5 id="ç›¸å…³é…ç½®-1"><a href="#ç›¸å…³é…ç½®-1" class="headerlink" title="ç›¸å…³é…ç½®"></a>ç›¸å…³é…ç½®</h5><ul>
<li>dbfilename dump.rdbï¼ˆåŒsaveï¼‰</li>
<li>dirï¼ˆåŒsaveï¼‰</li>
<li>rdbcompression yesï¼ˆåŒsaveï¼‰</li>
<li>rdbchecksum yesï¼ˆåŒsaveï¼‰</li>
<li>stop-writes-on-bgsave-error yes<ul>
<li>è¯´æ˜ï¼šåå°å­˜å‚¨è¿‡ç¨‹ä¸­å¦‚æœå‡ºç°é”™è¯¯ç°è±¡ï¼Œæ˜¯å¦åœæ­¢ä¿å­˜ç°è±¡</li>
<li>ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€</li>
</ul>
</li>
</ul>
<h5 id="bgsaveæŒ‡ä»¤å·¥ä½œåŸç†"><a href="#bgsaveæŒ‡ä»¤å·¥ä½œåŸç†" class="headerlink" title="bgsaveæŒ‡ä»¤å·¥ä½œåŸç†"></a>bgsaveæŒ‡ä»¤å·¥ä½œåŸç†</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_16_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_16_20210326.png" alt="img"></a></p>
<h4 id="2-2-3-RDBå¯åŠ¨æ–¹å¼3â€“saveé…ç½®"><a href="#2-2-3-RDBå¯åŠ¨æ–¹å¼3â€“saveé…ç½®" class="headerlink" title="2.2.3 RDBå¯åŠ¨æ–¹å¼3â€“saveé…ç½®"></a>2.2.3 RDBå¯åŠ¨æ–¹å¼3â€“saveé…ç½®</h4><h5 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h5><ul>
<li><p>é…ç½®åˆ°.confæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">save second changes</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>é…ç½®åï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_17_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_17_20210326.png" alt="img"></a></p>
</li>
<li><p>ä½œç”¨</p>
<p>æ»¡è¶³<strong>é™å®šæ—¶é—´</strong>èŒƒå›´å†…keyçš„å˜åŒ–æ•°é‡è¾¾åˆ°<strong>æŒ‡å®šæ•°é‡</strong>å³è¿›è¡ŒæŒä¹…åŒ–</p>
</li>
<li><p>å‚æ•°</p>
<ul>
<li>secondï¼šç›‘æ§æ—¶é—´èŒƒå›´</li>
<li>changesï¼šç›‘æ§keyçš„å˜åŒ–é‡</li>
</ul>
</li>
</ul>
<h5 id="saveé…ç½®å·¥ä½œåŸç†"><a href="#saveé…ç½®å·¥ä½œåŸç†" class="headerlink" title="saveé…ç½®å·¥ä½œåŸç†"></a>saveé…ç½®å·¥ä½œåŸç†</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_18_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_18_20210326.png" alt="img"></a></p>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>saveé…ç½®è¦æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µè¿›è¡Œè®¾ç½®ï¼Œé¢‘åº¦è¿‡é«˜æˆ–è¿‡ä½éƒ½ä¼šå‡ºç°æ€§èƒ½é—®é¢˜ï¼Œç»“æœå¯èƒ½æ˜¯ç¾éš¾æ€§çš„</li>
<li>saveé…ç½®ä¸­å¯¹äºsecondä¸changesè®¾ç½®é€šå¸¸å…·æœ‰<strong>äº’è¡¥å¯¹åº”</strong>å…³ç³»ï¼ˆä¸€ä¸ªå¤§ä¸€ä¸ªå°ï¼‰ï¼Œå°½é‡ä¸è¦è®¾ç½®æˆåŒ…å«æ€§å…³ç³»</li>
<li>saveé…ç½®å¯åŠ¨åæ‰§è¡Œçš„æ˜¯<strong>bgsaveæ“ä½œ</strong></li>
</ul>
<h4 id="2-2-4-ä¸‰ç§å¯åŠ¨æ–¹å¼å¯¹æ¯”"><a href="#2-2-4-ä¸‰ç§å¯åŠ¨æ–¹å¼å¯¹æ¯”" class="headerlink" title="2.2.4 ä¸‰ç§å¯åŠ¨æ–¹å¼å¯¹æ¯”"></a>2.2.4 ä¸‰ç§å¯åŠ¨æ–¹å¼å¯¹æ¯”</h4><table>
<thead>
<tr>
<th>æ–¹å¼</th>
<th>saveæŒ‡ä»¤</th>
<th>bgsaveæŒ‡ä»¤</th>
</tr>
</thead>
<tbody><tr>
<td>è¯»å†™</td>
<td>åŒæ­¥</td>
<td>å¼‚æ­¥</td>
</tr>
<tr>
<td>é˜»å¡å®¢æˆ·ç«¯æŒ‡ä»¤</td>
<td>æ˜¯</td>
<td>å¦</td>
</tr>
<tr>
<td>é¢å¤–å†…å­˜æ¶ˆè€—</td>
<td>å¦</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>å¯åŠ¨æ–°çº¿ç¨‹</td>
<td>å¦</td>
<td>æ˜¯</td>
</tr>
</tbody></table>
<h4 id="2-2-5-RDBç‰¹æ®Šå¯åŠ¨å½¢å¼ï¼ˆäº†è§£ï¼‰"><a href="#2-2-5-RDBç‰¹æ®Šå¯åŠ¨å½¢å¼ï¼ˆäº†è§£ï¼‰" class="headerlink" title="2.2.5 RDBç‰¹æ®Šå¯åŠ¨å½¢å¼ï¼ˆäº†è§£ï¼‰"></a>2.2.5 RDBç‰¹æ®Šå¯åŠ¨å½¢å¼ï¼ˆäº†è§£ï¼‰</h4><ul>
<li><p>å…¨é‡å¤åˆ¶</p>
<p>åœ¨ä¸»ä»å¤åˆ¶ä¸­è¯¦ç»†è®²è§£</p>
</li>
<li><p>æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­é‡å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">debug reload</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>å…³é—­æœåŠ¡å™¨æ—¶æŒ‡å®šä¿å­˜æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shutdown save</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-6-RDBä¼˜ç¼ºç‚¹"><a href="#2-2-6-RDBä¼˜ç¼ºç‚¹" class="headerlink" title="2.2.6 RDBä¼˜ç¼ºç‚¹"></a>2.2.6 RDBä¼˜ç¼ºç‚¹</h4><ul>
<li>ä¼˜ç‚¹<ul>
<li>RDBæ˜¯ä¸€ä¸ªç´§å‡‘å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ<strong>å­˜å‚¨æ•ˆç‡è¾ƒé«˜</strong></li>
<li>RDBå†…éƒ¨å­˜å‚¨çš„æ˜¯redisåœ¨æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®å¿«ç…§ï¼Œéå¸¸é€‚åˆç”¨äº<strong>æ•°æ®å¤‡ä»½ï¼Œå…¨é‡å¤åˆ¶</strong>ç­‰åœºæ™¯</li>
<li>RDBæ¢å¤æ•°æ®çš„<strong>é€Ÿåº¦</strong>è¦æ¯”AOF<strong>å¿«</strong>å¾ˆå¤š</li>
<li>åº”ç”¨ï¼šæœåŠ¡å™¨ä¸­æ¯Xå°æ—¶æ‰§è¡Œbgsaveå¤‡ä»½ï¼Œå¹¶å°†RDBæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹æœºå™¨ä¸­ï¼Œ<strong>ç”¨äºç¾éš¾æ¢å¤</strong></li>
</ul>
</li>
<li>ç¼ºç‚¹<ul>
<li>RDBæ–¹å¼æ— è®ºæ˜¯æ‰§è¡ŒæŒ‡ä»¤è¿˜æ˜¯åˆ©ç”¨é…ç½®ï¼Œ<strong>æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–</strong>ï¼Œå…·æœ‰è¾ƒå¤§çš„å¯èƒ½æ€§ä¸¢å¤±æ•°æ®</li>
<li>bgsaveæŒ‡ä»¤æ¯æ¬¡è¿è¡Œè¦æ‰§è¡Œforkæ“ä½œ<strong>åˆ›å»ºå­è¿›ç¨‹</strong>ï¼Œè¦<strong>ç‰ºç‰²</strong>æ‰ä¸€äº›<strong>æ€§èƒ½</strong></li>
<li>Redisçš„ä¼—å¤šç‰ˆæœ¬ä¸­æœªè¿›è¡ŒRDBæ–‡ä»¶æ ¼å¼çš„ç‰ˆæœ¬ç»Ÿä¸€ï¼Œæœ‰å¯èƒ½å‡ºç°å„ç‰ˆæœ¬æœåŠ¡ä¹‹é—´æ•°æ®æ ¼å¼<strong>æ— æ³•å…¼å®¹</strong>ç°è±¡</li>
</ul>
</li>
</ul>
<h3 id="2-3-AOF"><a href="#2-3-AOF" class="headerlink" title="2.3 AOF"></a>2.3 AOF</h3><h4 id="2-3-1-AOFæ¦‚å¿µ"><a href="#2-3-1-AOFæ¦‚å¿µ" class="headerlink" title="2.3.1 AOFæ¦‚å¿µ"></a>2.3.1 AOFæ¦‚å¿µ</h4><ul>
<li>AOF(append only file)æŒä¹…åŒ–ï¼šä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•<strong>æ¯æ¬¡</strong>å†™å‘½ä»¤ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­å‘½ä»¤ï¼Œä»¥è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚ä¸RDBç›¸æ¯”å¯ä»¥ç®€å•æè¿°ä¸ºæ”¹è®°å½•æ•°æ®ä¸ºè®°å½•æ•°æ®äº§ç”Ÿçš„è¿‡ç¨‹</li>
<li>AOFçš„ä¸»è¦ä½œç”¨æ˜¯è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼Œç›®å‰å·²ç»æ˜¯RedisæŒä¹…åŒ–çš„<strong>ä¸»æµ</strong>æ–¹å¼</li>
</ul>
<h4 id="2-3-2-AOFå†™æ•°æ®è¿‡ç¨‹"><a href="#2-3-2-AOFå†™æ•°æ®è¿‡ç¨‹" class="headerlink" title="2.3.2 AOFå†™æ•°æ®è¿‡ç¨‹"></a>2.3.2 AOFå†™æ•°æ®è¿‡ç¨‹</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_20_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_20_20210326.png" alt="img"></a></p>
<h4 id="2-3-3-AOFå†™æ•°æ®ä¸‰ç§ç­–ç•¥-appendfsync"><a href="#2-3-3-AOFå†™æ•°æ®ä¸‰ç§ç­–ç•¥-appendfsync" class="headerlink" title="2.3.3 AOFå†™æ•°æ®ä¸‰ç§ç­–ç•¥(appendfsync)"></a>2.3.3 AOFå†™æ•°æ®ä¸‰ç§ç­–ç•¥(appendfsync)</h4><ul>
<li>alwaysï¼ˆæ¯æ¬¡ï¼‰<ul>
<li>æ¯æ¬¡å†™å…¥æ“ä½œå‡åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œ<strong>æ•°æ®é›¶è¯¯å·®</strong>ï¼Œ<strong>æ€§èƒ½è¾ƒä½</strong>ï¼Œ<strong>ä¸å»ºè®®ä½¿ç”¨</strong></li>
</ul>
</li>
<li>everysecï¼ˆæ¯ç§’ï¼‰<ul>
<li>æ¯ç§’å°†ç¼“å†²åŒºä¸­çš„æŒ‡ä»¤åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œæ•°æ®<strong>å‡†ç¡®æ€§è¾ƒé«˜</strong>ï¼Œ<strong>æ€§èƒ½è¾ƒé«˜</strong> ï¼Œ<strong>å»ºè®®ä½¿ç”¨</strong>ï¼Œä¹Ÿæ˜¯é»˜è®¤é…ç½®</li>
<li>åœ¨ç³»ç»Ÿçªç„¶å®•æœºçš„æƒ…å†µä¸‹ä¸¢å¤±1ç§’å†…çš„æ•°æ®</li>
</ul>
</li>
<li>noï¼ˆç³»ç»Ÿæ§åˆ¶ï¼‰<ul>
<li>ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶æ¯æ¬¡åŒæ­¥åˆ°AOFæ–‡ä»¶çš„å‘¨æœŸï¼Œæ•´ä½“è¿‡ç¨‹<strong>ä¸å¯æ§</strong></li>
</ul>
</li>
</ul>
<h4 id="2-3-4-AOFåŠŸèƒ½å¼€å¯"><a href="#2-3-4-AOFåŠŸèƒ½å¼€å¯" class="headerlink" title="2.3.4 AOFåŠŸèƒ½å¼€å¯"></a>2.3.4 AOFåŠŸèƒ½å¼€å¯</h4><ul>
<li><p>é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes|no</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½œç”¨</li>
</ul>
<p>æ˜¯å¦å¼€å¯AOFæŒä¹…åŒ–åŠŸèƒ½ï¼Œ<strong>é»˜è®¤ä¸ºä¸å¼€å¯çŠ¶æ€</strong></p>
</li>
<li><p>é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appendfsync always|everysec|no</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä½œç”¨</p>
<p>AOFå†™æ•°æ®ç­–ç•¥</p>
</li>
</ul>
</li>
</ul>
<p>é…ç½®åï¼Œconfé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_19_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_19_20210326.png" alt="img"></a></p>
<h4 id="2-3-5-AOFç›¸å…³é…ç½®"><a href="#2-3-5-AOFç›¸å…³é…ç½®" class="headerlink" title="2.3.5 AOFç›¸å…³é…ç½®"></a>2.3.5 AOFç›¸å…³é…ç½®</h4><ul>
<li><p>é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appendfilename filename</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½œç”¨</li>
</ul>
<p>AOFæŒä¹…åŒ–æ–‡ä»¶åï¼Œé»˜è®¤æ–‡ä»¶åä¸ºappendonly.aofï¼Œå»ºè®®é…ç½®ä¸ºappendonly-ç«¯å£å·.aof</p>
</li>
<li><p>é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dir</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä½œç”¨</p>
<p>AOFæŒä¹…åŒ–æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œä¸RDBæŒä¹…åŒ–æ–‡ä»¶ä¿æŒä¸€è‡´å³å¯</p>
</li>
</ul>
</li>
</ul>
<h4 id="2-3-6-AOFé‡å†™"><a href="#2-3-6-AOFé‡å†™" class="headerlink" title="2.3.6 AOFé‡å†™"></a>2.3.6 AOFé‡å†™</h4><h5 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h5><ul>
<li>é™ä½ç£ç›˜å ç”¨é‡ï¼Œæé«˜ç£ç›˜åˆ©ç”¨ç‡</li>
<li>æé«˜æŒä¹…åŒ–æ•ˆç‡ï¼Œé™ä½æŒä¹…åŒ–å†™æ—¶é—´ï¼Œæé«˜IOæ€§èƒ½</li>
<li>é™ä½æ•°æ®æ¢å¤ç”¨æ—¶ï¼Œæé«˜æ•°æ®æ¢å¤æ•ˆç‡</li>
</ul>
<h5 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h5><ul>
<li>è¿›ç¨‹å†…å·²è¶…æ—¶çš„æ•°æ®ä¸å†å†™å…¥æ–‡ä»¶</li>
<li>å¿½ç•¥æ— æ•ˆæŒ‡ä»¤ï¼Œé‡å†™æ—¶ä½¿ç”¨è¿›ç¨‹å†…æ•°æ®ç›´æ¥ç”Ÿæˆï¼Œè¿™æ ·æ–°çš„AOFæ–‡ä»¶åªä¿ç•™æœ€ç»ˆæ•°æ®çš„å†™å…¥å‘½ä»¤<ul>
<li>å¦‚del key1ã€ hdel key2ã€srem key3ã€set key4 111ã€set key4 222ç­‰</li>
</ul>
</li>
<li>å¯¹åŒä¸€æ•°æ®çš„å¤šæ¡å†™å‘½ä»¤åˆå¹¶ä¸ºä¸€æ¡å‘½ä»¤<ul>
<li>å¦‚lpush list1 aã€lpush list1 bã€ lpush list1 c å¯ä»¥è½¬åŒ–ä¸ºï¼šlpush list1 a b c</li>
<li>ä¸ºé˜²æ­¢æ•°æ®é‡è¿‡å¤§é€ æˆå®¢æˆ·ç«¯ç¼“å†²åŒºæº¢å‡ºï¼Œå¯¹listã€setã€hashã€zsetç­‰ç±»å‹ï¼Œæ¯æ¡æŒ‡ä»¤æœ€å¤šå†™å…¥64ä¸ªå…ƒç´ </li>
</ul>
</li>
</ul>
<h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><ul>
<li><p>æ‰‹åŠ¨é‡å†™</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bgrewriteaof</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>è‡ªåŠ¨é‡å†™</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1.è§¦å‘æ¡ä»¶è®¾ç½®</span><br><span class="line"># è§¦å‘é‡å†™çš„æœ€å°å¤§å°</span><br><span class="line">auto-aof-rewrite-min-size size </span><br><span class="line"># è§¦å‘é‡å†™é¡»è¾¾åˆ°çš„æœ€å°ç™¾åˆ†æ¯” </span><br><span class="line">auto-aof-rewrite-percentage percentage</span><br><span class="line"></span><br><span class="line"># 2.è§¦å‘æ¯”å¯¹å‚æ•°ï¼ˆ è¿è¡ŒæŒ‡ä»¤info Persistenceè·å–å…·ä½“ä¿¡æ¯ ï¼‰</span><br><span class="line"># å½“å‰.aofçš„æ–‡ä»¶å¤§å°</span><br><span class="line">aof_current_size </span><br><span class="line"># åŸºç¡€æ–‡ä»¶å¤§å°</span><br><span class="line">aof_base_size</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>è‡ªåŠ¨é‡å†™è§¦å‘æ¡ä»¶</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_22_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_22_20210326.png" alt="img"></a></p>
</li>
</ul>
<h5 id="é‡å†™å·¥ä½œåŸç†"><a href="#é‡å†™å·¥ä½œåŸç†" class="headerlink" title="é‡å†™å·¥ä½œåŸç†"></a>é‡å†™å·¥ä½œåŸç†</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_21_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_21_20210326.png" alt="img"></a></p>
<h5 id="é‡å†™å·¥ä½œæµç¨‹"><a href="#é‡å†™å·¥ä½œæµç¨‹" class="headerlink" title="é‡å†™å·¥ä½œæµç¨‹"></a>é‡å†™å·¥ä½œæµç¨‹</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_23_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_23_20210326.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_24_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_24_20210326.png" alt="img"></a></p>
<h3 id="2-4-RDBä¸AOFçš„åŒºåˆ«"><a href="#2-4-RDBä¸AOFçš„åŒºåˆ«" class="headerlink" title="2.4 RDBä¸AOFçš„åŒºåˆ«"></a>2.4 RDBä¸AOFçš„åŒºåˆ«</h3><table>
<thead>
<tr>
<th>æŒä¹…åŒ–æ–¹å¼</th>
<th>RDB</th>
<th>AOF</th>
</tr>
</thead>
<tbody><tr>
<td>å ç”¨å­˜å‚¨ç©ºé—´</td>
<td>å°ï¼ˆæ•°æ®çº§ï¼šå‹ç¼©ï¼‰</td>
<td>å¤§ï¼ˆæŒ‡ä»¤çº§ï¼šé‡å†™ï¼‰</td>
</tr>
<tr>
<td>å­˜å‚¨é€Ÿåº¦</td>
<td>æ…¢</td>
<td>å¿«</td>
</tr>
<tr>
<td>æ¢å¤é€Ÿåº¦</td>
<td>å¿«</td>
<td>æ…¢</td>
</tr>
<tr>
<td>æ•°æ®å®‰å…¨æ€§</td>
<td>ä¼šä¸¢å¤±æ•°æ®</td>
<td>ä¾æ®ç­–ç•¥å†³å®š</td>
</tr>
<tr>
<td>èµ„æºæ¶ˆè€—</td>
<td>é«˜/é‡é‡çº§</td>
<td>ä½/è½»é‡çº§</td>
</tr>
<tr>
<td>å¯åŠ¨ä¼˜å…ˆçº§</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
</tbody></table>
<h3 id="2-5-RDBä¸AOFçš„é€‰æ‹©"><a href="#2-5-RDBä¸AOFçš„é€‰æ‹©" class="headerlink" title="2.5 RDBä¸AOFçš„é€‰æ‹©"></a>2.5 RDBä¸AOFçš„é€‰æ‹©</h3><ul>
<li>å¯¹æ•°æ®éå¸¸æ•æ„Ÿï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤çš„AOFæŒä¹…åŒ–æ–¹æ¡ˆ<ul>
<li>AOFæŒä¹…åŒ–ç­–ç•¥ä½¿ç”¨<strong>everysecond</strong>ï¼Œæ¯ç§’é’Ÿfsyncä¸€æ¬¡ã€‚è¯¥ç­–ç•¥redisä»å¯ä»¥ä¿æŒå¾ˆå¥½çš„å¤„ç†æ€§èƒ½ï¼Œå½“å‡ºç°é—®é¢˜æ—¶ï¼Œæœ€å¤šä¸¢å¤±0-1ç§’å†…çš„æ•°æ®ã€‚</li>
<li>æ³¨æ„ï¼šç”±äºAOFæ–‡ä»¶<strong>å­˜å‚¨ä½“ç§¯è¾ƒå¤§</strong>ï¼Œä¸”<strong>æ¢å¤é€Ÿåº¦è¾ƒæ…¢</strong></li>
</ul>
</li>
<li>æ•°æ®å‘ˆç°é˜¶æ®µæœ‰æ•ˆæ€§ï¼Œå»ºè®®ä½¿ç”¨RDBæŒä¹…åŒ–æ–¹æ¡ˆ<ul>
<li>æ•°æ®å¯ä»¥è‰¯å¥½çš„åšåˆ°é˜¶æ®µå†…æ— ä¸¢å¤±ï¼ˆè¯¥é˜¶æ®µæ˜¯å¼€å‘è€…æˆ–è¿ç»´äººå‘˜æ‰‹å·¥ç»´æŠ¤çš„ï¼‰ï¼Œä¸”<strong>æ¢å¤é€Ÿåº¦è¾ƒå¿«</strong>ï¼Œé˜¶æ®µ ç‚¹æ•°æ®æ¢å¤é€šå¸¸é‡‡ç”¨RDBæ–¹æ¡ˆ</li>
<li>æ³¨æ„ï¼šåˆ©ç”¨RDBå®ç°ç´§å‡‘çš„æ•°æ®æŒä¹…åŒ–ä¼šä½¿Redisé™çš„å¾ˆä½</li>
</ul>
</li>
<li>ç»¼åˆæ¯”å¯¹<ul>
<li>RDBä¸AOFçš„é€‰æ‹©å®é™…ä¸Šæ˜¯åœ¨åšä¸€ç§æƒè¡¡ï¼Œæ¯ç§éƒ½æœ‰åˆ©æœ‰å¼Š</li>
<li>å¦‚ä¸èƒ½æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œå¯¹ä¸šåŠ¡æ•°æ®éå¸¸<strong>æ•æ„Ÿ</strong>ï¼Œé€‰ç”¨<strong>AOF</strong></li>
<li>å¦‚èƒ½æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œä¸”è¿½æ±‚å¤§æ•°æ®é›†çš„<strong>æ¢å¤é€Ÿåº¦</strong>ï¼Œé€‰ç”¨<strong>RDB</strong></li>
<li><strong>ç¾éš¾æ¢å¤é€‰ç”¨RDB</strong></li>
<li>åŒä¿é™©ç­–ç•¥ï¼ŒåŒæ—¶å¼€å¯ RDB å’Œ AOFï¼Œé‡å¯åï¼ŒRedisä¼˜å…ˆä½¿ç”¨ AOF æ¥æ¢å¤æ•°æ®ï¼Œé™ä½ä¸¢å¤±æ•°æ®</li>
</ul>
</li>
</ul>
<h2 id="3-äº‹åŠ¡"><a href="#3-äº‹åŠ¡" class="headerlink" title="3. äº‹åŠ¡"></a>3. äº‹åŠ¡</h2><h3 id="3-1-äº‹åŠ¡ç®€ä»‹"><a href="#3-1-äº‹åŠ¡ç®€ä»‹" class="headerlink" title="3.1 äº‹åŠ¡ç®€ä»‹"></a>3.1 äº‹åŠ¡ç®€ä»‹</h3><blockquote>
<p>redisäº‹åŠ¡å°±æ˜¯ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„é˜Ÿåˆ—ï¼Œå°†ä¸€ç³»åˆ—é¢„å®šä¹‰å‘½ä»¤<strong>åŒ…è£…æˆä¸€ä¸ªæ•´ä½“</strong>ï¼ˆä¸€ä¸ªé˜Ÿåˆ—ï¼‰ã€‚å½“æ‰§è¡Œæ—¶ï¼Œ<strong>ä¸€æ¬¡æ€§æŒ‰ç…§æ·»åŠ é¡ºåºä¾æ¬¡æ‰§è¡Œ</strong>ï¼Œä¸­é—´ä¸ä¼šè¢«æ‰“æ–­æˆ–è€…å¹²æ‰°</p>
</blockquote>
<h3 id="3-2-äº‹åŠ¡åŸºæœ¬æ“ä½œ"><a href="#3-2-äº‹åŠ¡åŸºæœ¬æ“ä½œ" class="headerlink" title="3.2 äº‹åŠ¡åŸºæœ¬æ“ä½œ"></a>3.2 äº‹åŠ¡åŸºæœ¬æ“ä½œ</h3><ul>
<li><p>å¼€å¯äº‹åŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">multi</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½œç”¨ï¼šä½œè®¾å®šäº‹åŠ¡çš„å¼€å¯ä½ç½®ï¼Œæ­¤æŒ‡ä»¤æ‰§è¡Œåï¼Œåç»­çš„æ‰€æœ‰æŒ‡ä»¤å‡åŠ å…¥åˆ°äº‹åŠ¡ä¸­</li>
</ul>
</li>
<li><p>å–æ¶ˆäº‹åŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">discard</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½œç”¨ç»ˆæ­¢å½“å‰äº‹åŠ¡çš„å®šä¹‰ï¼Œå‘ç”Ÿåœ¨multiä¹‹åï¼Œexecä¹‹å‰</li>
</ul>
</li>
<li><p>æ‰§è¡Œäº‹åŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½œç”¨ï¼šè®¾å®šäº‹åŠ¡çš„ç»“æŸä½ç½®ï¼ŒåŒæ—¶æ‰§è¡Œäº‹åŠ¡ã€‚<strong>ä¸multiæˆå¯¹å‡ºç°</strong>ï¼Œæˆå¯¹ä½¿ç”¨</li>
</ul>
</li>
</ul>
<h3 id="3-3-äº‹åŠ¡å·¥ä½œæµç¨‹"><a href="#3-3-äº‹åŠ¡å·¥ä½œæµç¨‹" class="headerlink" title="3.3 äº‹åŠ¡å·¥ä½œæµç¨‹"></a>3.3 äº‹åŠ¡å·¥ä½œæµç¨‹</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_25_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_25_20210326.png" alt="img"></a></p>
<h3 id="3-4-äº‹åŠ¡æ³¨æ„äº‹é¡¹"><a href="#3-4-äº‹åŠ¡æ³¨æ„äº‹é¡¹" class="headerlink" title="3.4 äº‹åŠ¡æ³¨æ„äº‹é¡¹"></a>3.4 äº‹åŠ¡æ³¨æ„äº‹é¡¹</h3><p><strong>å®šä¹‰äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå‘½ä»¤æ ¼å¼è¾“å…¥é”™è¯¯æ€ä¹ˆåŠï¼Ÿ</strong></p>
<ul>
<li>è¯­æ³•é”™è¯¯<ul>
<li>æŒ‡å‘½ä»¤ä¹¦å†™æ ¼å¼æœ‰è¯¯ ä¾‹å¦‚æ‰§è¡Œäº†ä¸€æ¡ä¸å­˜åœ¨çš„æŒ‡ä»¤</li>
</ul>
</li>
<li>å¤„ç†ç»“æœ<ul>
<li>å¦‚æœå®šä¹‰çš„äº‹åŠ¡ä¸­æ‰€åŒ…å«çš„å‘½ä»¤å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œæ•´ä½“äº‹åŠ¡ä¸­<strong>æ‰€æœ‰å‘½ä»¤å‡ä¸ä¼šæ‰§è¡Œ</strong>ã€‚åŒ…æ‹¬é‚£äº›è¯­æ³•æ­£ç¡®çš„å‘½ä»¤</li>
</ul>
</li>
</ul>
<p><strong>å®šä¹‰äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå‘½ä»¤æ‰§è¡Œå‡ºç°é”™è¯¯æ€ä¹ˆåŠï¼Ÿ</strong></p>
<ul>
<li>è¿è¡Œé”™è¯¯<ul>
<li>æŒ‡å‘½ä»¤<strong>æ ¼å¼æ­£ç¡®</strong>ï¼Œä½†æ˜¯<strong>æ— æ³•æ­£ç¡®çš„æ‰§è¡Œ</strong>ã€‚ä¾‹å¦‚å¯¹listè¿›è¡Œincræ“ä½œ</li>
</ul>
</li>
<li>å¤„ç†ç»“æœ<ul>
<li>èƒ½å¤Ÿæ­£ç¡®è¿è¡Œçš„å‘½ä»¤ä¼šæ‰§è¡Œï¼Œè¿è¡Œé”™è¯¯çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œ</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šå·²ç»æ‰§è¡Œå®Œæ¯•çš„å‘½ä»¤å¯¹åº”çš„æ•°æ®<strong>ä¸ä¼šè‡ªåŠ¨å›æ»š</strong>ï¼Œéœ€è¦ç¨‹åºå‘˜è‡ªå·±åœ¨ä»£ç ä¸­å®ç°å›æ»šã€‚</p>
<h3 id="3-5-é”"><a href="#3-5-é”" class="headerlink" title="3.5 é”"></a>3.5 é”</h3><h4 id="3-5-1-åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“é”"><a href="#3-5-1-åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“é”" class="headerlink" title="3.5.1 åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“é”"></a>3.5.1 åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“é”</h4><p>ç›‘è§†é”ç±»ä¼¼CASçš„æ€æƒ³ï¼Œå¦‚æœç›‘è§†å¯¹è±¡åœ¨äº‹åŠ¡æ‰§è¡Œå‰è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆå°±ä¸æ‰§è¡Œäº†</p>
<ul>
<li><p>å¯¹ key æ·»åŠ ç›‘è§†é”ï¼Œåœ¨æ‰§è¡Œexecå‰å¦‚æœkeyå‘ç”Ÿäº†å˜åŒ–ï¼Œç»ˆæ­¢äº‹åŠ¡æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">watch key1, key2....</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>å–æ¶ˆå¯¹<strong>æ‰€æœ‰</strong>keyçš„ç›‘è§†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unwatch</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-5-2åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“åˆ†å¸ƒå¼é”"><a href="#3-5-2åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“åˆ†å¸ƒå¼é”" class="headerlink" title="3.5.2åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“åˆ†å¸ƒå¼é”"></a>3.5.2åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“åˆ†å¸ƒå¼é”</h4><p>åˆ†å¸ƒå¼é”ç±»ä¼¼æ‚²è§‚é”çš„æ€æƒ³ï¼Œä½†æ˜¯åªæ˜¯ä¸€ä¸ªæ ‡è®°</p>
<ul>
<li><p>ä½¿ç”¨ setnx è®¾ç½®ä¸€ä¸ªå…¬å…±é”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä¸Šé”</span><br><span class="line">setnx lock-key value</span><br><span class="line"># é‡Šæ”¾é”</span><br><span class="line">del lock-key</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ©ç”¨setnxå‘½ä»¤çš„è¿”å›å€¼ç‰¹å¾ï¼Œæœ‰å€¼ï¼ˆè¢«ä¸Šé”äº†ï¼‰åˆ™è¿”å›è®¾ç½®å¤±è´¥ï¼Œæ— å€¼ï¼ˆæ²¡è¢«ä¸Šé”ï¼‰åˆ™è¿”å›è®¾ç½®æˆåŠŸ</li>
<li>æ“ä½œå®Œæ¯•é€šè¿‡delæ“ä½œé‡Šæ”¾é”</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šä¸Šè¿°è§£å†³æ–¹æ¡ˆæ˜¯ä¸€ç§<strong>è®¾è®¡æ¦‚å¿µ</strong>ï¼Œä¾èµ–è§„èŒƒä¿éšœï¼Œå…·æœ‰é£é™©æ€§</p>
<h4 id="3-5-3-åˆ†å¸ƒå¼é”æ”¹è‰¯"><a href="#3-5-3-åˆ†å¸ƒå¼é”æ”¹è‰¯" class="headerlink" title="3.5.3 åˆ†å¸ƒå¼é”æ”¹è‰¯"></a>3.5.3 åˆ†å¸ƒå¼é”æ”¹è‰¯</h4><ul>
<li><p>ä½¿ç”¨ expire ä¸ºé”keyæ·»åŠ <strong>æ—¶é—´é™å®š</strong>ï¼Œåˆ°æ—¶ä¸é‡Šæ”¾ï¼Œæ”¾å¼ƒé”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">expire lock-key seconds</span><br><span class="line">pexpire lock-key millisecondsCopy</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>ç”±äºæ“ä½œé€šå¸¸éƒ½æ˜¯å¾®ç§’æˆ–æ¯«ç§’çº§ï¼Œå› æ­¤è¯¥é”å®šæ—¶é—´<strong>ä¸å®œè®¾ç½®è¿‡å¤§</strong>ã€‚å…·ä½“æ—¶é—´éœ€è¦ä¸šåŠ¡æµ‹è¯•åç¡®è®¤ã€‚</p>
<ul>
<li>ä¾‹å¦‚ï¼šæŒæœ‰é”çš„æ“ä½œæœ€é•¿æ‰§è¡Œæ—¶é—´127msï¼Œæœ€çŸ­æ‰§è¡Œæ—¶é—´7msã€‚</li>
<li>æµ‹è¯•ç™¾ä¸‡æ¬¡æœ€é•¿æ‰§è¡Œæ—¶é—´å¯¹åº”å‘½ä»¤çš„æœ€å¤§è€—æ—¶ï¼Œæµ‹è¯•ç™¾ä¸‡æ¬¡ç½‘ç»œå»¶è¿Ÿå¹³å‡è€—æ—¶</li>
<li>é”æ—¶é—´è®¾å®šæ¨èï¼šæœ€å¤§è€—æ—¶<em>120%+å¹³å‡ç½‘ç»œå»¶è¿Ÿ</em>110%</li>
<li>å¦‚æœä¸šåŠ¡æœ€å¤§è€—æ—¶&lt;&lt;ç½‘ç»œå¹³å‡å»¶è¿Ÿï¼Œé€šå¸¸ä¸º2ä¸ªæ•°é‡çº§ï¼Œå–å…¶ä¸­å•ä¸ªè€—æ—¶è¾ƒé•¿å³å¯</li>
</ul>
</li>
</ul>
<h2 id="4-åˆ é™¤ç­–ç•¥"><a href="#4-åˆ é™¤ç­–ç•¥" class="headerlink" title="4. åˆ é™¤ç­–ç•¥"></a>4. åˆ é™¤ç­–ç•¥</h2><h3 id="4-1-æ•°æ®åˆ é™¤ç­–ç•¥"><a href="#4-1-æ•°æ®åˆ é™¤ç­–ç•¥" class="headerlink" title="4.1 æ•°æ®åˆ é™¤ç­–ç•¥"></a>4.1 æ•°æ®åˆ é™¤ç­–ç•¥</h3><ul>
<li>å®šæ—¶åˆ é™¤</li>
<li>æƒ°æ€§åˆ é™¤</li>
<li>å®šæœŸåˆ é™¤</li>
</ul>
<h4 id="æ—¶æ•ˆæ€§æ•°æ®çš„å­˜å‚¨ç»“æ„"><a href="#æ—¶æ•ˆæ€§æ•°æ®çš„å­˜å‚¨ç»“æ„" class="headerlink" title="æ—¶æ•ˆæ€§æ•°æ®çš„å­˜å‚¨ç»“æ„"></a>æ—¶æ•ˆæ€§æ•°æ®çš„å­˜å‚¨ç»“æ„</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_26_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_26_20210327.png" alt="img"></a></p>
<h4 id="æ•°æ®åˆ é™¤ç­–ç•¥çš„ç›®æ ‡"><a href="#æ•°æ®åˆ é™¤ç­–ç•¥çš„ç›®æ ‡" class="headerlink" title="æ•°æ®åˆ é™¤ç­–ç•¥çš„ç›®æ ‡"></a>æ•°æ®åˆ é™¤ç­–ç•¥çš„ç›®æ ‡</h4><p>åœ¨å†…å­˜å ç”¨ä¸CPUå ç”¨ä¹‹é—´å¯»æ‰¾ä¸€ç§<strong>å¹³è¡¡</strong>ï¼Œé¡¾æ­¤å¤±å½¼éƒ½ä¼šé€ æˆæ•´ä½“redisæ€§èƒ½çš„ä¸‹é™ï¼Œç”šè‡³å¼•å‘æœåŠ¡å™¨å®•æœºæˆ–å†…å­˜æ³„éœ²</p>
<h3 id="4-2-ä¸‰ç§åˆ é™¤ç­–ç•¥"><a href="#4-2-ä¸‰ç§åˆ é™¤ç­–ç•¥" class="headerlink" title="4.2 ä¸‰ç§åˆ é™¤ç­–ç•¥"></a>4.2 ä¸‰ç§åˆ é™¤ç­–ç•¥</h3><h4 id="4-2-1-å®šæ—¶åˆ é™¤"><a href="#4-2-1-å®šæ—¶åˆ é™¤" class="headerlink" title="4.2.1 å®šæ—¶åˆ é™¤"></a>4.2.1 å®šæ—¶åˆ é™¤</h4><ul>
<li>åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“keyè®¾ç½®æœ‰è¿‡æœŸæ—¶é—´ï¼Œä¸”è¿‡æœŸæ—¶é—´åˆ°è¾¾æ—¶ï¼Œç”±å®šæ—¶å™¨ä»»åŠ¡<strong>ç«‹å³æ‰§è¡Œ</strong>å¯¹é”®çš„åˆ é™¤æ“ä½œ</li>
<li>ä¼˜ç‚¹ï¼š<strong>èŠ‚çº¦å†…å­˜</strong>ï¼Œåˆ°æ—¶å°±åˆ é™¤ï¼Œå¿«é€Ÿé‡Šæ”¾æ‰ä¸å¿…è¦çš„å†…å­˜å ç”¨</li>
<li>ç¼ºç‚¹ï¼š<strong>CPUå‹åŠ›å¾ˆå¤§</strong>ï¼Œæ— è®ºCPUæ­¤æ—¶è´Ÿè½½é‡å¤šé«˜ï¼Œå‡å ç”¨CPUï¼Œä¼šå½±å“redisæœåŠ¡å™¨å“åº”æ—¶é—´å’ŒæŒ‡ä»¤ååé‡</li>
<li>æ€»ç»“ï¼šç”¨å¤„ç†å™¨æ€§èƒ½æ¢å–å­˜å‚¨ç©ºé—´ ï¼ˆ<strong>æ‹¿æ—¶é—´æ¢ç©ºé—´</strong>ï¼‰</li>
</ul>
<h4 id="4-2-2-æƒ°æ€§åˆ é™¤"><a href="#4-2-2-æƒ°æ€§åˆ é™¤" class="headerlink" title="4.2.2 æƒ°æ€§åˆ é™¤"></a>4.2.2 æƒ°æ€§åˆ é™¤</h4><ul>
<li>æ•°æ®åˆ°è¾¾è¿‡æœŸæ—¶é—´ï¼Œä¸åšå¤„ç†ã€‚ç­‰ä¸‹æ¬¡è®¿é—®è¯¥æ•°æ®æ—¶<ul>
<li>å¦‚æœæœªè¿‡æœŸï¼Œè¿”å›æ•°æ®</li>
<li>å‘ç°å·²è¿‡æœŸï¼Œåˆ é™¤ï¼Œè¿”å›ä¸å­˜åœ¨</li>
</ul>
</li>
<li>ä¼˜ç‚¹ï¼š<strong>èŠ‚çº¦CPUæ€§èƒ½</strong>ï¼Œå‘ç°å¿…é¡»åˆ é™¤çš„æ—¶å€™æ‰åˆ é™¤</li>
<li>ç¼ºç‚¹ï¼š<strong>å†…å­˜å‹åŠ›å¾ˆå¤§</strong>ï¼Œå‡ºç°é•¿æœŸå ç”¨å†…å­˜çš„æ•°æ®</li>
<li>æ€»ç»“ï¼šç”¨å­˜å‚¨ç©ºé—´æ¢å–å¤„ç†å™¨æ€§èƒ½ ï¼ˆ<strong>æ‹¿ç©ºé—´æ¢æ—¶é—´</strong>ï¼‰</li>
</ul>
<h4 id="4-2-3-å®šæœŸåˆ é™¤ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰"><a href="#4-2-3-å®šæœŸåˆ é™¤ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰" class="headerlink" title="4.2.3 å®šæœŸåˆ é™¤ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰"></a>4.2.3 å®šæœŸåˆ é™¤ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰</h4><ul>
<li>å‘¨æœŸæ€§è½®è¯¢redisåº“ä¸­çš„æ—¶æ•ˆæ€§æ•°æ®ï¼Œé‡‡ç”¨<strong>éšæœºæŠ½å–çš„ç­–ç•¥</strong>ï¼Œåˆ©ç”¨è¿‡æœŸæ•°æ®å æ¯”çš„æ–¹å¼æ§åˆ¶åˆ é™¤é¢‘åº¦</li>
<li>ç‰¹ç‚¹1ï¼šCPUæ€§èƒ½å ç”¨è®¾ç½®æœ‰å³°å€¼ï¼Œæ£€æµ‹é¢‘åº¦å¯è‡ªå®šä¹‰è®¾ç½®</li>
<li>ç‰¹ç‚¹2ï¼šå†…å­˜å‹åŠ›ä¸æ˜¯å¾ˆå¤§ï¼Œé•¿æœŸå ç”¨å†…å­˜çš„å†·æ•°æ®ä¼šè¢«æŒç»­æ¸…ç†</li>
<li>æ€»ç»“ï¼šå‘¨æœŸæ€§æŠ½æŸ¥å­˜å‚¨ç©ºé—´ ï¼ˆéšæœºæŠ½æŸ¥ï¼Œé‡ç‚¹æŠ½æŸ¥ï¼‰</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_27_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_27_20210327.png" alt="img"></a></p>
<h4 id="4-2-4-åˆ é™¤ç­–ç•¥å¯¹æ¯”"><a href="#4-2-4-åˆ é™¤ç­–ç•¥å¯¹æ¯”" class="headerlink" title="4.2.4 åˆ é™¤ç­–ç•¥å¯¹æ¯”"></a>4.2.4 åˆ é™¤ç­–ç•¥å¯¹æ¯”</h4><table>
<thead>
<tr>
<th>åˆ é™¤ç­–ç•¥</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>å®šæ—¶åˆ é™¤</td>
<td>èŠ‚çº¦å†…å­˜ï¼Œæ— å ç”¨</td>
<td>ä¸åˆ†æ—¶æ®µå ç”¨CPUèµ„æºï¼Œé¢‘ç‡é«˜</td>
<td>æ‹¿æ—¶é—´æ¢ç©ºé—´</td>
</tr>
<tr>
<td>æƒ°æ€§åˆ é™¤</td>
<td>å†…å­˜å ç”¨ä¸¥é‡</td>
<td>å»¶æ—¶æ‰§è¡Œï¼ŒCPUåˆ©ç”¨ç‡é«˜</td>
<td>æ‹¿ç©ºé—´æ¢æ—¶é—´</td>
</tr>
<tr>
<td>å®šæœŸåˆ é™¤</td>
<td>å†…å­˜å®šæœŸéšæœºæ¸…ç†</td>
<td>æ¯ç§’èŠ±è´¹å›ºå®šçš„CPUèµ„æºç»´æŠ¤å†…å­˜</td>
<td>éšæœºæŠ½æŸ¥ï¼Œé‡ç‚¹æŠ½æŸ¥</td>
</tr>
</tbody></table>
<p>rediså†…éƒ¨ä¸€èˆ¬ä½¿ç”¨æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤</p>
<h3 id="4-3-é€å‡ºç®—æ³•ï¼ˆæ·˜æ±°ç®—æ³•ï¼‰"><a href="#4-3-é€å‡ºç®—æ³•ï¼ˆæ·˜æ±°ç®—æ³•ï¼‰" class="headerlink" title="4.3 é€å‡ºç®—æ³•ï¼ˆæ·˜æ±°ç®—æ³•ï¼‰"></a>4.3 é€å‡ºç®—æ³•ï¼ˆæ·˜æ±°ç®—æ³•ï¼‰</h3><p>**å½“æ–°æ•°æ®è¿›å…¥redisæ—¶ï¼Œå¦‚æœå†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ **</p>
<ul>
<li>Redisä½¿ç”¨å†…å­˜å­˜å‚¨æ•°æ®ï¼Œåœ¨æ‰§è¡Œæ¯ä¸€ä¸ªå‘½ä»¤å‰ï¼Œä¼šè°ƒç”¨**freeMemoryIfNeeded()*<em>æ£€æµ‹å†…å­˜æ˜¯å¦å……è¶³ã€‚å¦‚æœå†…å­˜ä¸æ»¡è¶³æ–°åŠ å…¥æ•°æ®çš„æœ€ä½å­˜å‚¨è¦æ±‚ï¼Œredisè¦ä¸´æ—¶åˆ é™¤ä¸€äº›æ•°æ®ä¸ºå½“å‰æŒ‡ä»¤æ¸…ç†å­˜å‚¨ç©ºé—´ã€‚æ¸…ç†æ•°æ®çš„ç­–ç•¥ç§°ä¸º*<em>é€å‡ºç®—æ³•</em></em></li>
<li><strong>æ³¨æ„</strong>ï¼šé€å‡ºæ•°æ®çš„è¿‡ç¨‹ä¸æ˜¯100%èƒ½å¤Ÿæ¸…ç†å‡ºè¶³å¤Ÿçš„å¯ä½¿ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœä¸æˆåŠŸåˆ™åå¤æ‰§è¡Œã€‚å½“å¯¹æ‰€æœ‰æ•°æ®å°è¯•å®Œæ¯•åï¼Œå¦‚æœä¸èƒ½è¾¾åˆ°å†…å­˜æ¸…ç†çš„è¦æ±‚ï¼Œå°†å‡ºç°é”™è¯¯ä¿¡æ¯ã€‚</li>
</ul>
<h4 id="4-3-1-å½±å“æ•°æ®é€å‡ºçš„ç›¸å…³é…ç½®"><a href="#4-3-1-å½±å“æ•°æ®é€å‡ºçš„ç›¸å…³é…ç½®" class="headerlink" title="4.3.1 å½±å“æ•°æ®é€å‡ºçš„ç›¸å…³é…ç½®"></a>4.3.1 å½±å“æ•°æ®é€å‡ºçš„ç›¸å…³é…ç½®</h4><ul>
<li><p>æœ€å¤§å¯ä½¿ç”¨å†…å­˜</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maxmemory</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å ç”¨ç‰©ç†å†…å­˜çš„æ¯”ä¾‹ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸é™åˆ¶ã€‚ç”Ÿäº§ç¯å¢ƒä¸­æ ¹æ®éœ€æ±‚è®¾å®šï¼Œé€šå¸¸è®¾ç½®åœ¨50%ä»¥ä¸Šã€‚</p>
</li>
<li><p>æ¯æ¬¡é€‰å–å¾…åˆ é™¤æ•°æ®çš„ä¸ªæ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-samples</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>é€‰å–æ•°æ®æ—¶å¹¶ä¸ä¼šå…¨åº“æ‰«æï¼Œå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½æ¶ˆè€—ï¼Œé™ä½è¯»å†™æ€§èƒ½ã€‚å› æ­¤é‡‡ç”¨éšæœºè·å–æ•°æ®çš„æ–¹å¼ä½œä¸ºå¾…æ£€æµ‹åˆ é™¤æ•°æ®</p>
</li>
<li><p>åˆ é™¤ç­–ç•¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-policy</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è¾¾åˆ°æœ€å¤§å†…å­˜åçš„ï¼Œå¯¹è¢«æŒ‘é€‰å‡ºæ¥çš„æ•°æ®è¿›è¡Œåˆ é™¤çš„ç­–ç•¥</p>
</li>
<li><p>åˆ é™¤ç­–ç•¥åŒ…æ‹¬ä»¥ä¸‹8ç§ä¸åŒè®¾ç½®ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_28_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_28_20210327.png" alt="img"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># é…ç½®æ–¹å¼</span><br><span class="line">maxmemory-policy volatile-lru</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-3-2-æ•°æ®é€å‡ºç­–ç•¥é…ç½®ä¾æ®"><a href="#4-3-2-æ•°æ®é€å‡ºç­–ç•¥é…ç½®ä¾æ®" class="headerlink" title="4.3.2 æ•°æ®é€å‡ºç­–ç•¥é…ç½®ä¾æ®"></a>4.3.2 æ•°æ®é€å‡ºç­–ç•¥é…ç½®ä¾æ®</h4><ul>
<li>ä½¿ç”¨<strong>INFOå‘½ä»¤</strong>è¾“å‡ºç›‘æ§ä¿¡æ¯ï¼ŒæŸ¥è¯¢ç¼“å­˜ <strong>hit å’Œ miss</strong> çš„æ¬¡æ•°ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒä¼˜Redisé…ç½®</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_29_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_29_20210327.png" alt="img"></a></p>
<h2 id="5-æœåŠ¡å™¨åŸºç¡€é…ç½®"><a href="#5-æœåŠ¡å™¨åŸºç¡€é…ç½®" class="headerlink" title="5. æœåŠ¡å™¨åŸºç¡€é…ç½®"></a>5. æœåŠ¡å™¨åŸºç¡€é…ç½®</h2><h3 id="5-1-æœåŠ¡å™¨ç«¯è®¾å®š"><a href="#5-1-æœåŠ¡å™¨ç«¯è®¾å®š" class="headerlink" title="5.1 æœåŠ¡å™¨ç«¯è®¾å®š"></a>5.1 æœåŠ¡å™¨ç«¯è®¾å®š</h3><p>è®¾ç½®åˆ°confæ–‡ä»¶ä¸­</p>
<ul>
<li>è®¾ç½®æœåŠ¡å™¨ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes | no</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>ç»‘å®šä¸»æœºåœ°å€</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>è®¾ç½®æœåŠ¡å™¨ç«¯å£å·</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>è®¾ç½®æ•°æ®åº“æ•°é‡</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">database 16</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_30_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_30_20210327.png" alt="img"></a></p>
<h3 id="5-2-æ—¥å¿—é…ç½®"><a href="#5-2-æ—¥å¿—é…ç½®" class="headerlink" title="5.2 æ—¥å¿—é…ç½®"></a>5.2 æ—¥å¿—é…ç½®</h3><ul>
<li>è®¾ç½®æœåŠ¡å™¨ä»¥æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loglevel debug|verbose|notice|warning</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>æ—¥å¿—è®°å½•æ–‡ä»¶å</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">logfile ç«¯å£å·.log</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šæ—¥å¿—çº§åˆ«å¼€å‘æœŸè®¾ç½®ä¸ºverboseå³å¯ï¼Œç”Ÿäº§ç¯å¢ƒä¸­é…ç½®ä¸ºnoticeï¼Œç®€åŒ–æ—¥å¿—è¾“å‡ºé‡ï¼Œé™ä½å†™æ—¥å¿—IOçš„é¢‘ç‡</p>
<h3 id="5-3-å®¢æˆ·ç«¯é…ç½®"><a href="#5-3-å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="5.3 å®¢æˆ·ç«¯é…ç½®"></a>5.3 å®¢æˆ·ç«¯é…ç½®</h3><ul>
<li>è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥è¾¾åˆ°ä¸Šé™ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿æ¥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maxclients 0</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>å®¢æˆ·ç«¯é—²ç½®ç­‰å¾…æœ€å¤§æ—¶é•¿ï¼Œè¾¾åˆ°æœ€å¤§å€¼åå…³é—­è¿æ¥ã€‚å¦‚éœ€å…³é—­è¯¥åŠŸèƒ½ï¼Œè®¾ç½®ä¸º0</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timeout 300</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="5-4-å¤šæœåŠ¡å™¨å¿«æ·é…ç½®"><a href="#5-4-å¤šæœåŠ¡å™¨å¿«æ·é…ç½®" class="headerlink" title="5.4 å¤šæœåŠ¡å™¨å¿«æ·é…ç½®"></a>5.4 å¤šæœåŠ¡å™¨å¿«æ·é…ç½®</h3><ul>
<li>å¯¼å…¥å¹¶åŠ è½½æŒ‡å®šé…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œç”¨äºå¿«é€Ÿèˆ¹èˆ°rediså…¬å…±é…ç½®è¾ƒå¤šçš„rediså®ä¾‹é…ç½®æ–‡ä»¶ï¼Œä¾¿äºç»´æŠ¤</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include &#x2F;path&#x2F;server-ç«¯å£å·.conf</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="6-é«˜çº§æ•°æ®ç±»å‹"><a href="#6-é«˜çº§æ•°æ®ç±»å‹" class="headerlink" title="6. é«˜çº§æ•°æ®ç±»å‹"></a>6. é«˜çº§æ•°æ®ç±»å‹</h2><h3 id="6-1-Bitmaps"><a href="#6-1-Bitmaps" class="headerlink" title="6.1 Bitmaps"></a>6.1 Bitmaps</h3><h4 id="6-1-1-åŸºç¡€æ“ä½œ"><a href="#6-1-1-åŸºç¡€æ“ä½œ" class="headerlink" title="6.1.1 åŸºç¡€æ“ä½œ"></a>6.1.1 åŸºç¡€æ“ä½œ</h4><ul>
<li><p>è·å–æŒ‡å®škeyå¯¹åº”åç§»é‡ä¸Šçš„bitå€¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getbit key offset</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>è®¾ç½®æŒ‡å®škeyå¯¹åº”åç§»é‡ä¸Šçš„bitå€¼ï¼Œvalueåªèƒ½æ˜¯1æˆ–0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setbit key offset value</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-1-2-æ‰©å±•æ“ä½œ"><a href="#6-1-2-æ‰©å±•æ“ä½œ" class="headerlink" title="6.1.2 æ‰©å±•æ“ä½œ"></a>6.1.2 æ‰©å±•æ“ä½œ</h4><ul>
<li><p>å¯¹æŒ‡å®škeyæŒ‰ä½è¿›è¡Œäº¤ã€å¹¶ã€éã€å¼‚æˆ–æ“ä½œï¼Œå¹¶å°†ç»“æœ<strong>ä¿å­˜åˆ°destKey</strong>ä¸­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bitop op destKey key1 [key2...]</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>andï¼šäº¤</li>
<li>orï¼šå¹¶</li>
<li>notï¼šé</li>
<li>xorï¼šå¼‚æˆ–</li>
</ul>
</li>
<li><p>ç»Ÿè®¡æŒ‡å®škeyä¸­1çš„æ•°é‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bitcount key [start end]</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="6-2-HyperLogLog"><a href="#6-2-HyperLogLog" class="headerlink" title="6.2 HyperLogLog"></a>6.2 HyperLogLog</h3><h4 id="6-2-1-åŸºæ•°"><a href="#6-2-1-åŸºæ•°" class="headerlink" title="6.2.1 åŸºæ•°"></a>6.2.1 åŸºæ•°</h4><ul>
<li>åŸºæ•°æ˜¯æ•°æ®é›†<strong>å»é‡åå…ƒç´ ä¸ªæ•°</strong></li>
<li>HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ï¼Œè¿ç”¨äº†LogLogçš„ç®—æ³•</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_31_20210327.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_31_20210327.png" alt="img"></a></p>
<h4 id="6-2-2-åŸºæœ¬æ“ä½œ"><a href="#6-2-2-åŸºæœ¬æ“ä½œ" class="headerlink" title="6.2.2 åŸºæœ¬æ“ä½œ"></a>6.2.2 åŸºæœ¬æ“ä½œ</h4><ul>
<li><p>æ·»åŠ æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pfadd key element1, element2...</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>ç»Ÿè®¡æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pfcount key1 key2....</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>åˆå¹¶æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pfmerge destkey sourcekey [sourcekey...]</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-2-3-ç›¸å…³è¯´æ˜"><a href="#6-2-3-ç›¸å…³è¯´æ˜" class="headerlink" title="6.2.3 ç›¸å…³è¯´æ˜"></a>6.2.3 ç›¸å…³è¯´æ˜</h4><ul>
<li>ç”¨äºè¿›è¡ŒåŸºæ•°ç»Ÿè®¡ï¼Œ<strong>ä¸æ˜¯é›†åˆï¼Œä¸ä¿å­˜æ•°æ®</strong>ï¼Œåªè®°å½•æ•°é‡è€Œä¸æ˜¯å…·ä½“æ•°æ®</li>
<li>æ ¸å¿ƒæ˜¯åŸºæ•°ä¼°ç®—ç®—æ³•ï¼Œæœ€ç»ˆæ•°å€¼<strong>å­˜åœ¨ä¸€å®šè¯¯å·®</strong></li>
<li>è¯¯å·®èŒƒå›´ï¼šåŸºæ•°ä¼°è®¡çš„ç»“æœæ˜¯ä¸€ä¸ªå¸¦æœ‰ 0.81% æ ‡å‡†é”™è¯¯çš„è¿‘ä¼¼å€¼</li>
<li><strong>è€—ç©ºé—´æå°</strong>ï¼Œæ¯ä¸ªhyperloglog keyå ç”¨äº†12Kçš„å†…å­˜ç”¨äºæ ‡è®°åŸºæ•°</li>
<li>pfaddå‘½ä»¤ä¸æ˜¯ä¸€æ¬¡æ€§åˆ†é…12Kå†…å­˜ä½¿ç”¨ï¼Œä¼šéšç€åŸºæ•°çš„å¢åŠ å†…å­˜<strong>é€æ¸å¢å¤§</strong></li>
<li>Pfmergeå‘½ä»¤<strong>åˆå¹¶åå ç”¨</strong>çš„å­˜å‚¨ç©ºé—´ä¸º<strong>12K</strong>ï¼Œæ— è®ºåˆå¹¶ä¹‹å‰æ•°æ®é‡å¤šå°‘</li>
</ul>
<h3 id="6-3-GEO"><a href="#6-3-GEO" class="headerlink" title="6.3 GEO"></a>6.3 GEO</h3><h4 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h4><ul>
<li><p>æ·»åŠ åæ ‡ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">geoadd key longitude latitude member [longitude latitude member ...] </span><br><span class="line">georadius key longitude latitude radius m|km|ft|mi [withcoord] [withdist] [withhash] [count count]</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>è·å–åæ ‡ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">geopos key member [member ...] </span><br><span class="line">georadiusbymember key member radius m|km|ft|mi [withcoord] [withdist] [withhash] [count count]</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>è®¡ç®—åæ ‡ç‚¹è·ç¦»</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">geodist key member1 member2 [unit] </span><br><span class="line">geohash key member [member ...]</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/06/redis%E9%AB%98%E7%BA%A7/" data-id="cknyemfcg00046oub4a331ig9" data-title="redisé«˜çº§" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-redisåŸºç¡€" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/06/redis%E5%9F%BA%E7%A1%80/" class="article-date">
  <time class="dt-published" datetime="2021-04-06T11:34:19.000Z" itemprop="datePublished">2021-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/06/redis%E5%9F%BA%E7%A1%80/">redisåŸºç¡€</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="RedisåŸºç¡€"><a href="#RedisåŸºç¡€" class="headerlink" title="RedisåŸºç¡€"></a>RedisåŸºç¡€</h1><p>å­¦ä¹ Javawebæ—¶ï¼Œå­¦ä¹ è¿‡Redisçš„åŸºæœ¬ä½¿ç”¨ï¼Œå­¦ä¹ <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1CJ411m7Gc">é»‘é©¬Redis</a>è¿›é˜¶å†…å®¹é¡ºå¸¦å¤ä¹ ä¸€ä¸‹åŸºç¡€ï¼Œæ•´ç†æœ¬å­¦ä¹ ç¬”è®°</p>
<h2 id="1-å…¥é—¨"><a href="#1-å…¥é—¨" class="headerlink" title="1. å…¥é—¨"></a>1. å…¥é—¨</h2><h3 id="1-1-NoSQLç®€ä»‹"><a href="#1-1-NoSQLç®€ä»‹" class="headerlink" title="1.1 NoSQLç®€ä»‹"></a>1.1 NoSQLç®€ä»‹</h3><p>NoSQLï¼šå³Not-OnlySQLï¼ˆæ³›æŒ‡éå…³ç³»æ€§æ•°æ®åº“ï¼‰ï¼Œä½œä¸ºå…³ç³»å‹æ•°æ®åº“çš„è¡¥å……</p>
<p>ä½œç”¨ï¼šåº”å¯¹åŸºäºæµ·é‡æ•°æ®å’Œæµ·é‡ç”¨æˆ·çš„æ•°æ®å¤„ç†ã€‚</p>
<p>ç‰¹å¾ï¼š</p>
<ul>
<li>å¯æ‰©å®¹ï¼Œå¯ä¼¸å±•</li>
<li>å¤§æ•°æ®é‡ä¸‹é«˜æ€§èƒ½</li>
<li>çµæ´»çš„æ•°æ®æ¨¡å‹</li>
<li>é«˜å¯ç”¨</li>
</ul>
<p>å¸¸è§çš„NoSQLæ•°æ®åº“ï¼š</p>
<ul>
<li><strong>Redis</strong></li>
<li>memcache</li>
<li>HBase</li>
<li>MongoDB</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_2_20210325.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_2_20210325.png" alt="img"></a></p>
<h3 id="1-2-Redisç®€ä»‹"><a href="#1-2-Redisç®€ä»‹" class="headerlink" title="1.2 Redisç®€ä»‹"></a>1.2 Redisç®€ä»‹</h3><blockquote>
<p>æ¦‚å¿µï¼šRedisï¼ˆREmote DIctionary Serverï¼‰æ˜¯ç”¨Cè¯­è¨€å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„é«˜æ€§èƒ½é”®å€¼å¯¹ï¼ˆkey-valueï¼‰æ•°æ®åº“ã€‚</p>
</blockquote>
<p>ç‰¹å¾ï¼š</p>
<ul>
<li>æ•°æ®ä¹‹é—´æ²¡æœ‰å¿…ç„¶çš„è”ç³»</li>
<li>å†…éƒ¨é‡‡ç”¨äº†å•çº¿ç¨‹æœºåˆ¶è¿›è¡Œå·¥ä½œ</li>
<li>é«˜æ€§èƒ½</li>
<li>å¤šæ•°æ®ç±»å‹æ”¯æŒ<ul>
<li>String</li>
<li>list</li>
<li>hash</li>
<li>set</li>
<li>sorted_set</li>
</ul>
</li>
<li>æŒä¹…åŒ–æ”¯æŒï¼Œå¯ä»¥è¿›è¡Œæ•°æ®ç¾éš¾æ¢å¤</li>
</ul>
<p>åº”ç”¨ï¼š</p>
<ul>
<li>çƒ­ç‚¹æ•°æ®åŠ é€ŸæŸ¥è¯¢ï¼ˆçƒ­ç‚¹èµ„è®¯ï¼Œçƒ­ç‚¹å•†å“ï¼‰</li>
<li>ä»»åŠ¡é˜Ÿåˆ—ï¼ˆç§’æ€ï¼‰</li>
<li>å³ä½¿ä¿¡æ¯æŸ¥è¯¢ï¼ˆæ’è¡Œæ¦œï¼‰</li>
<li>æ—¶æ•ˆæ€§ä¹ æ€§æ§åˆ¶ï¼ˆéªŒè¯ç ï¼‰</li>
<li>åˆ†å¸ƒå¼æ•°æ®å…±äº«ï¼ˆåˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„sessionåˆ†ç¦»ï¼‰</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>åˆ†å¸ƒå¼é”</li>
</ul>
<h3 id="1-3-Rediså¸¸ç”¨æŒ‡ä»¤"><a href="#1-3-Rediså¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="1.3 Rediså¸¸ç”¨æŒ‡ä»¤"></a>1.3 Rediså¸¸ç”¨æŒ‡ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># å¯åŠ¨å®¹å™¨</span><br><span class="line">docker run -d -p 6379:6379 -it  --name&#x3D;&quot;myredis&quot;  redis</span><br><span class="line"># è¾“å…¥å¯†ç ï¼š</span><br><span class="line">auth å¯†ç </span><br><span class="line"># è¿›å…¥rediså®¹å™¨</span><br><span class="line">docker exec -it myredis  redis-cli</span><br><span class="line"># é€€å‡º</span><br><span class="line">quit</span><br><span class="line">exit</span><br><span class="line"># æ¸…å±</span><br><span class="line">clear</span><br><span class="line"># è·å–å¸®åŠ©, å¯ä»¥ä½¿ç”¨Tabé”®æ¥åˆ‡æ¢</span><br><span class="line">help å‘½ä»¤åç§°</span><br><span class="line">help @ç»„å</span><br><span class="line"># è®¾ç½®&#x2F;è·å–æ•°æ®</span><br><span class="line">set name xlh</span><br><span class="line">get name</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="2-æ•°æ®ç±»å‹"><a href="#2-æ•°æ®ç±»å‹" class="headerlink" title="2. æ•°æ®ç±»å‹"></a>2. æ•°æ®ç±»å‹</h2><p>redisæ•°æ®å­˜å‚¨æ ¼å¼</p>
<ul>
<li>redisè‡ªèº«æ˜¯ä¸€ä¸ªmapï¼Œå…¶ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é‡‡ç”¨çš„keyï¼švalueçš„å½¢å¼å­˜å‚¨[^1]</li>
<li>æ•°æ®ç±»å‹æŒ‡çš„æ˜¯valueéƒ¨åˆ†çš„ç±»å‹ï¼Œkeyéƒ¨åˆ†éƒ½æ˜¯String</li>
</ul>
<h3 id="2-1-String"><a href="#2-1-String" class="headerlink" title="2.1 String"></a>2.1 String</h3><h4 id="2-1-1-åŸºæœ¬æ“ä½œ"><a href="#2-1-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.1.1 åŸºæœ¬æ“ä½œ"></a>2.1.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®String</span><br><span class="line">set key value</span><br><span class="line">mset key1 value1 key2 value2...</span><br><span class="line"></span><br><span class="line"># å¾—åˆ°String</span><br><span class="line">get key </span><br><span class="line">mget key1 key2...</span><br><span class="line"># è·å–å­—ç¬¦ä¸²é•¿åº¦</span><br><span class="line">strlen key</span><br><span class="line"></span><br><span class="line"># åˆ é™¤String</span><br><span class="line">del key</span><br><span class="line"></span><br><span class="line"># å‘å­—ç¬¦ä¸²çš„åé¢è¿½åŠ å­—ç¬¦ï¼Œå¦‚æœæœ‰å°±è¡¥åœ¨åé¢ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»º</span><br><span class="line">append key value</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-å•-å¤šæŒ‡ä»¤å¯¹æ¯”"><a href="#2-1-2-å•-å¤šæŒ‡ä»¤å¯¹æ¯”" class="headerlink" title="2.1.2 å•/å¤šæŒ‡ä»¤å¯¹æ¯”"></a>2.1.2 å•/å¤šæŒ‡ä»¤å¯¹æ¯”</h4><ul>
<li>å•æŒ‡ä»¤å¯¹æ¯”å¤šæŒ‡ä»¤ï¼ˆå¯¹äºå¤šæŒ‡ä»¤ï¼Œå¦‚æœæ‰§è¡Œäº‹é—´è¿‡é•¿å¯¹äºå•çº¿ç¨‹æ“ä½œæ—¶ä¸é€‚ç”¨çš„ï¼Œæ³¨æ„åŠæ—¶åˆ‡å‰²ï¼‰</li>
</ul>
<h4 id="2-1-3-æ‹“å±•æ“ä½œ"><a href="#2-1-3-æ‹“å±•æ“ä½œ" class="headerlink" title="2.1.3 æ‹“å±•æ“ä½œ"></a>2.1.3 æ‹“å±•æ“ä½œ</h4><ul>
<li><p>Stringä½œä¸ºæ•°å€¼çš„æ“ä½œ</p>
<ul>
<li>stringåœ¨rediså†…éƒ¨å­˜å‚¨é»˜è®¤å°±æ˜¯ä¸€ä¸ª<strong>å­—ç¬¦ä¸²</strong>ï¼Œå½“é‡åˆ°å¢å‡ç±»æ“ä½œincrï¼Œdecræ—¶ä¼š<strong>è½¬æˆæ•°å€¼å‹</strong>è¿›è¡Œè®¡ç®—ã€‚</li>
<li>redisæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯<strong>åŸå­æ€§</strong>çš„ï¼Œé‡‡ç”¨<strong>å•çº¿ç¨‹</strong>å¤„ç†æ‰€æœ‰ä¸šåŠ¡ï¼Œå‘½ä»¤æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œçš„ï¼Œå› æ­¤æ— éœ€è€ƒè™‘å¹¶å‘å¸¦æ¥çš„æ•°æ®å½±å“ã€‚</li>
<li>æ³¨æ„ï¼šæŒ‰æ•°å€¼è¿›è¡Œæ“ä½œçš„æ•°æ®ï¼Œå¦‚æœåŸå§‹æ•°æ®ä¸èƒ½è½¬æˆæ•°å€¼ï¼Œæˆ–è¶…è¶Šäº†redis æ•°å€¼ä¸Šé™èŒƒå›´ï¼Œå°†æŠ¥é”™ã€‚ 9223372036854775807ï¼ˆjavaä¸­longå‹æ•°æ®æœ€å¤§å€¼ï¼ŒLong.MAX_VALUEï¼‰</li>
</ul>
<p><strong>tipsï¼š</strong></p>
<ul>
<li>redisç”¨äºæ§åˆ¶æ•°æ®åº“è¡¨ä¸»é”®idï¼Œä¸ºæ•°æ®åº“è¡¨ä¸»é”®<strong>æä¾›ç”Ÿæˆç­–ç•¥</strong>ï¼Œä¿éšœæ•°æ®åº“è¡¨çš„ä¸»é”®<strong>å”¯ä¸€æ€§</strong></li>
<li>æ­¤æ–¹æ¡ˆé€‚ç”¨äºæ‰€æœ‰æ•°æ®åº“ï¼Œä¸”æ”¯æŒæ•°æ®åº“é›†ç¾¤</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å¢é•¿æŒ‡ä»¤ï¼Œåªæœ‰å½“valueä¸ºæ•°å­—æ—¶æ‰èƒ½å¢é•¿</span><br><span class="line">incr key  </span><br><span class="line">incrby key increment  </span><br><span class="line">incrbyfloat key increment </span><br><span class="line"></span><br><span class="line"># å‡å°‘æŒ‡ä»¤ï¼Œæœ‰å½“valueä¸ºæ•°å­—æ—¶æ‰èƒ½å‡å°‘</span><br><span class="line">decr key  </span><br><span class="line">decrby key increment</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>æŒ‡å®šç”Ÿå‘½å‘¨æœŸ<ul>
<li>redis æ§åˆ¶æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œé€šè¿‡æ•°æ®æ˜¯å¦å¤±æ•ˆæ§åˆ¶ä¸šåŠ¡è¡Œä¸ºï¼Œé€‚ç”¨äºæ‰€æœ‰å…·æœ‰æ—¶æ•ˆæ€§é™å®šæ§åˆ¶çš„æ“ä½œ</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œå•ä½ ç§’</span><br><span class="line">setex key seconds value</span><br><span class="line"># è®¾ç½®æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œå•ä½ æ¯«ç§’</span><br><span class="line">psetex key milliseconds value</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-Stringç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"><a href="#2-1-4-Stringç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.1.4 Stringç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"></a>2.1.4 Stringç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_3_20210325.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_3_20210325.png" alt="img"></a></p>
<ul>
<li><p>keyçš„è®¾ç½®çº¦å®š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_4_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_4_20210326.png" alt="img"></a></p>
</li>
</ul>
<h3 id="2-2-Hash"><a href="#2-2-Hash" class="headerlink" title="2.2 Hash"></a>2.2 Hash</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_5_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_5_20210326.png" alt="img"></a></p>
<ul>
<li>æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå¯¹ä¸€ç³»åˆ—å­˜å‚¨çš„æ•°æ®è¿›è¡Œç¼–ç»„ï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œå…¸å‹åº”ç”¨å­˜å‚¨å¯¹è±¡ä¿¡æ¯</li>
<li>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªé”®å€¼å¯¹æ•°æ®</li>
<li>hashç±»å‹ï¼šåº•å±‚ä½¿ç”¨å“ˆå¸Œè¡¨ç»“æ„å®ç°æ•°æ®å­˜å‚¨</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_6_20210325.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_6_20210325.png" alt="img"></a></p>
<h4 id="2-2-1-åŸºæœ¬æ“ä½œ"><a href="#2-2-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.2.1 åŸºæœ¬æ“ä½œ"></a>2.2.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># æ’å…¥ï¼ˆå¦‚æœå·²å­˜åœ¨åŒåçš„fieldï¼Œä¼šè¢«è¦†ç›–ï¼‰</span><br><span class="line">hset key field value</span><br><span class="line">hmset key field1 value1 field2 value2...</span><br><span class="line"></span><br><span class="line"># å–å‡º</span><br><span class="line">hget key field</span><br><span class="line">hgetall key</span><br><span class="line"></span><br><span class="line"># åˆ é™¤</span><br><span class="line">hdel key field1 field2...</span><br><span class="line"></span><br><span class="line"># è·å–fieldæ•°é‡</span><br><span class="line">hlen key</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ˜¯å¦å­˜åœ¨</span><br><span class="line">hexists key field</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-æ‹“å±•æ“ä½œ"><a href="#2-2-2-æ‹“å±•æ“ä½œ" class="headerlink" title="2.2.2 æ‹“å±•æ“ä½œ"></a>2.2.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„å­—æ®µåæˆ–å­—æ®µå€¼ </span><br><span class="line">hkeys key</span><br><span class="line">hvals key</span><br><span class="line"></span><br><span class="line"># è®¾ç½®æŒ‡å®šå­—æ®µçš„æ•°å€¼æ•°æ®å¢åŠ æŒ‡å®šèŒƒå›´çš„å€¼ </span><br><span class="line">hincrby key field increment </span><br><span class="line">hdecrby key field increment</span><br><span class="line"></span><br><span class="line"># æ’å…¥ï¼ˆå¦‚æœå·²å­˜åœ¨åŒåçš„fieldï¼Œä¸ä¼šè¢«è¦†ç›–ï¼‰</span><br><span class="line">hsetnx key field value</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-hashç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"><a href="#2-2-3-hashç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.2.3 hashç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"></a>2.2.3 hashç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹</h4><ul>
<li>hashç±»å‹ä¸‹çš„value<strong>åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²</strong>ï¼Œä¸å…è®¸å­˜å‚¨å…¶ä»–æ•°æ®ç±»å‹ï¼Œ<strong>ä¸å­˜åœ¨åµŒå¥—ç°è±¡</strong>ã€‚å¦‚æœæ•°æ®æœªè·å–åˆ°ï¼Œ å¯¹åº”çš„å€¼ä¸ºï¼ˆnilï¼‰</li>
<li>æ¯ä¸ª hash å¯ä»¥å­˜å‚¨ 2^32 - 1 ä¸ªé”®å€¼</li>
<li>hashç±»å‹ååˆ†è´´è¿‘å¯¹è±¡çš„æ•°æ®å­˜å‚¨å½¢å¼ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»æ·»åŠ åˆ é™¤å¯¹è±¡å±æ€§ã€‚ä½†hashè®¾è®¡åˆè¡·ä¸æ˜¯ä¸ºäº†å­˜å‚¨å¤§é‡å¯¹è±¡è€Œè®¾è®¡çš„ï¼Œ<strong>åˆ‡è®°ä¸å¯æ»¥ç”¨</strong>ï¼Œæ›´<strong>ä¸å¯ä»¥å°†hashä½œä¸ºå¯¹è±¡åˆ—è¡¨ä½¿ç”¨</strong></li>
<li>hgetall æ“ä½œå¯ä»¥è·å–å…¨éƒ¨å±æ€§ï¼Œå¦‚æœå†…éƒ¨fieldè¿‡å¤šï¼Œéå†æ•´ä½“<strong>æ•°æ®æ•ˆç‡å°±å¾ˆä¼šä½</strong>ï¼Œæœ‰å¯èƒ½æˆä¸ºæ•°æ®è®¿é—®ç“¶é¢ˆ</li>
</ul>
<h3 id="2-3-List"><a href="#2-3-List" class="headerlink" title="2.3 List"></a>2.3 List</h3><ul>
<li>æ•°æ®å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤šä¸ªæ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›å…¥å­˜å‚¨ç©ºé—´çš„é¡ºåºè¿›è¡ŒåŒºåˆ†</li>
<li>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªæ•°æ®ï¼Œä¸”é€šè¿‡æ•°æ®å¯ä»¥ä½“ç°è¿›å…¥é¡ºåº</li>
<li>listç±»å‹ï¼šä¿å­˜å¤šä¸ªæ•°æ®ï¼Œåº•å±‚ä½¿ç”¨åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„å®ç°</li>
<li><strong>å…ƒç´ æœ‰åºï¼Œä¸”å¯é‡</strong></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_8_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_8_20210326.png" alt="img"></a></p>
<h4 id="2-3-1-åŸºæœ¬æ“ä½œ"><a href="#2-3-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.3.1 åŸºæœ¬æ“ä½œ"></a>2.3.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ ä¿®æ”¹æ•°æ®,lpushä¸ºä»å·¦è¾¹æ·»åŠ ï¼Œrpushä¸ºä»å³è¾¹æ·»åŠ </span><br><span class="line">lpush key value1 value2 value3...</span><br><span class="line">rpush key value1 value2 value3...</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ•°æ®, ä»å·¦è¾¹å¼€å§‹å‘å³æŸ¥çœ‹. å¦‚æœä¸çŸ¥é“listæœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œendçš„å€¼å¯ä»¥ä¸º-1,ä»£è¡¨å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ </span><br><span class="line"># lpushå…ˆè¿›çš„å…ƒç´ æ”¾åœ¨æœ€å,rpushå…ˆè¿›çš„å…ƒç´ æ”¾åœ¨æœ€å‰é¢</span><br><span class="line">lrange key start end</span><br><span class="line"># å–å‡ºå¯¹åº”ç´¢å¼•çš„å…ƒç´ </span><br><span class="line">lindex key index</span><br><span class="line"># å¾—åˆ°é•¿åº¦</span><br><span class="line">llen key</span><br><span class="line"></span><br><span class="line"># è·å–å¹¶ç§»é™¤å…ƒç´ ï¼ˆä»listå·¦è¾¹æˆ–è€…å³è¾¹ç§»é™¤ï¼‰</span><br><span class="line">lpop key</span><br><span class="line">rpop key</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-æ‹“å±•æ“ä½œ"><a href="#2-3-2-æ‹“å±•æ“ä½œ" class="headerlink" title="2.3.2 æ‹“å±•æ“ä½œ"></a>2.3.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># è§„å®šæ—¶é—´å†…è·å–å¹¶ç§»é™¤æ•°æ®,b&#x3D;block,ç»™å®šä¸€ä¸ªæ—¶é—´ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ”¾å…¥äº†å…ƒç´ ï¼Œå°±ç§»é™¤</span><br><span class="line">blpop key1 key2... timeout</span><br><span class="line">brpop key1 key2... timeout</span><br><span class="line"></span><br><span class="line"># ç§»é™¤æŒ‡å®šå…ƒç´  count:ç§»é™¤çš„ä¸ªæ•° value:ç§»é™¤çš„å€¼ã€‚ ç§»é™¤å¤šä¸ªç›¸åŒå…ƒç´ æ—¶ï¼Œä»å·¦è¾¹å¼€å§‹ç§»é™¤</span><br><span class="line">lrem key count value</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-listç±»å‹æ•°æ®æ“ä½œæ³¨æ„äº‹é¡¹"><a href="#2-3-3-listç±»å‹æ•°æ®æ“ä½œæ³¨æ„äº‹é¡¹" class="headerlink" title="2.3.3 listç±»å‹æ•°æ®æ“ä½œæ³¨æ„äº‹é¡¹"></a>2.3.3 listç±»å‹æ•°æ®æ“ä½œæ³¨æ„äº‹é¡¹</h4><ul>
<li>listä¸­ä¿å­˜çš„æ•°æ®éƒ½æ˜¯stringç±»å‹çš„ï¼Œæ•°æ®æ€»å®¹é‡æ˜¯æœ‰é™çš„ï¼Œæœ€å¤š2^32 - 1 ä¸ªå…ƒç´  (4294967295)ã€‚</li>
<li>listå…·æœ‰ç´¢å¼•çš„æ¦‚å¿µï¼Œä½†æ˜¯æ“ä½œæ•°æ®æ—¶é€šå¸¸ä»¥<strong>é˜Ÿåˆ—</strong>çš„å½¢å¼è¿›è¡Œå…¥é˜Ÿå‡ºé˜Ÿ(rpush, rpop)æ“ä½œï¼Œæˆ–ä»¥<strong>æ ˆ</strong>çš„å½¢å¼è¿›è¡Œå…¥æ ˆå‡ºæ ˆ(lpush, lpop)æ“ä½œ</li>
<li>è·å–å…¨éƒ¨æ•°æ®æ“ä½œç»“æŸç´¢å¼•è®¾ç½®ä¸º-1 (å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ )</li>
<li>listå¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†é¡µæ“ä½œï¼Œé€šå¸¸ç¬¬ä¸€é¡µçš„ä¿¡æ¯æ¥è‡ªäºlistï¼Œç¬¬2é¡µåŠæ›´å¤šçš„ä¿¡æ¯é€šè¿‡æ•°æ®åº“çš„å½¢å¼åŠ è½½</li>
</ul>
<h3 id="2-4-Set"><a href="#2-4-Set" class="headerlink" title="2.4 Set"></a>2.4 Set</h3><ul>
<li>æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤§é‡æ•°æ®ï¼Œåœ¨æŸ¥è¯¢æ–¹é¢æä¾›æ›´é«˜çš„æ•ˆç‡</li>
<li>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šèƒ½å¤Ÿä¿å­˜å¤§é‡çš„æ•°æ®ï¼Œé«˜æ•ˆçš„å†…éƒ¨å­˜å‚¨æœºåˆ¶ï¼Œä¾¿äºæŸ¥è¯¢</li>
<li>setç±»å‹ï¼šä¸hashå­˜å‚¨ç»“æ„å®Œå…¨ç›¸åŒï¼Œä»…å­˜é”®ï¼Œä¸å­˜å€¼ï¼ˆnilï¼‰ï¼Œå¹¶ä¸”å€¼æ—¶ä¸å…è®¸é‡å¤çš„</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_7_20210325.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_7_20210325.png" alt="img"></a></p>
<h4 id="2-4-1-åŸºæœ¬æ“ä½œ"><a href="#2-4-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.4.1 åŸºæœ¬æ“ä½œ"></a>2.4.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ å…ƒç´ </span><br><span class="line">sadd key member1 member2...</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å…ƒç´ </span><br><span class="line">smembers key</span><br><span class="line"></span><br><span class="line"># ç§»é™¤å…ƒç´ </span><br><span class="line">srem key member</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å…ƒç´ ä¸ªæ•°</span><br><span class="line">scard key</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</span><br><span class="line">sismember key member</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-æ‹“å±•æ“ä½œ"><a href="#2-4-2-æ‹“å±•æ“ä½œ" class="headerlink" title="2.4.2 æ‹“å±•æ“ä½œ"></a>2.4.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># ä»setä¸­ä»»æ„é€‰å‡ºcountä¸ªå…ƒç´ </span><br><span class="line">srandmember key count</span><br><span class="line"></span><br><span class="line"># ä»setä¸­ä»»æ„é€‰å‡ºcountä¸ªå…ƒç´ å¹¶ç§»é™¤</span><br><span class="line">spop key count</span><br><span class="line"></span><br><span class="line"># æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤é›†ã€å¹¶é›†ã€å·®é›†</span><br><span class="line">sinter key1 key2...</span><br><span class="line">sunion key1 key2...</span><br><span class="line">sdiff key1 key2...</span><br><span class="line"></span><br><span class="line"># æ±‚ä¸¤ä¸ªsetçš„äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼Œå¹¶æ”¾å…¥å¦ä¸€ä¸ªsetä¸­</span><br><span class="line">sinterstore destination key1 key2...</span><br><span class="line">sunionstore destination key1 key2...</span><br><span class="line">sdiffstore destination key1 key2...</span><br><span class="line"></span><br><span class="line"># æ±‚æŒ‡å®šå…ƒç´ ä»åŸé›†åˆæ”¾å…¥ç›®æ ‡é›†åˆä¸­</span><br><span class="line">smove source destination key</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-4-3-Setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"><a href="#2-4-3-Setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.4.3 Setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"></a>2.4.3 Setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹</h4><ul>
<li>setç±»å‹ä¸å…è®¸æ•°æ®é‡å¤ï¼Œå¦‚æœæ·»åŠ çš„æ•°æ®åœ¨setä¸­å·²ç»å­˜åœ¨ï¼Œå°†åªä¿ç•™ä¸€ä»½</li>
<li>setè™½ç„¶ä¸hashçš„å­˜å‚¨ç»“æ„ç›¸åŒï¼Œä½†æ˜¯æ— æ³•å¯åŠ¨hashä¸­å­˜å‚¨å€¼çš„ç©ºé—´</li>
</ul>
<h3 id="2-5-Sorted-set"><a href="#2-5-Sorted-set" class="headerlink" title="2.5 Sorted_set"></a>2.5 Sorted_set</h3><ul>
<li>æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šæ•°æ®æ’åºæœ‰åˆ©äºæ•°æ®çš„æœ‰æ•ˆå±•ç¤ºï¼Œéœ€è¦æä¾›ä¸€ç§å¯ä»¥æ ¹æ®è‡ªèº«ç‰¹å¾è¿›è¡Œ<strong>æ’åº</strong>çš„æ–¹å¼</li>
<li>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šæ–°çš„å­˜å‚¨æ¨¡å‹ï¼Œå¯ä»¥ä¿å­˜<strong>å¯æ’åº</strong>çš„æ•°æ®</li>
<li>sorted_setç±»å‹ï¼šåœ¨setçš„å­˜å‚¨ç»“æ„åŸºç¡€ä¸Šæ·»åŠ å¯æ’åºå­—æ®µ</li>
<li><strong>ä¸é‡ä½†æœ‰åºï¼ˆscoreï¼‰</strong></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_9_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_9_20210326.png" alt="img"></a></p>
<h4 id="2-5-1-åŸºæœ¬æ“ä½œ"><a href="#2-5-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.5.1 åŸºæœ¬æ“ä½œ"></a>2.5.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># æ’å…¥å…ƒç´ , éœ€è¦æŒ‡å®šscore(ç”¨äºæ’åº)</span><br><span class="line">zadd key score1 member1 score2 member2</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å…ƒç´ (scoreå‡åº), å½“æœ«å°¾æ·»åŠ withscoreæ—¶ï¼Œä¼šå°†å…ƒç´ çš„scoreä¸€èµ·æ‰“å°å‡ºæ¥</span><br><span class="line">zrange key start end [withscore]</span><br><span class="line"># æŸ¥çœ‹å…ƒç´ (scoreé™åº), å½“æœ«å°¾æ·»åŠ withscoreæ—¶ï¼Œä¼šå°†å…ƒç´ çš„scoreä¸€èµ·æ‰“å°å‡ºæ¥</span><br><span class="line">zrevrange key start end [withscore]</span><br><span class="line"></span><br><span class="line"># ç§»é™¤å…ƒç´ </span><br><span class="line">zrem key member1 member2...</span><br><span class="line"></span><br><span class="line"># æŒ‰æ¡ä»¶è·å–æ•°æ®, å…¶ä¸­offsetä¸ºç´¢å¼•å¼€å§‹ä½ç½®ï¼Œcountä¸ºè·å–çš„æ•°ç›®</span><br><span class="line">zrangebyscore key min max [withscore] [limit offset count]</span><br><span class="line">zrevrangebyscore key max min [withscore] [limit offset count]</span><br><span class="line"></span><br><span class="line"># æŒ‰æ¡ä»¶ç§»é™¤å…ƒç´ </span><br><span class="line">zremrangebyrank key start end</span><br><span class="line">zremrangebyscore key min max</span><br><span class="line"># æŒ‰ç…§ä»å¤§åˆ°å°çš„é¡ºåºç§»é™¤countä¸ªå€¼</span><br><span class="line">zpopmax key [count]</span><br><span class="line"># æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºç§»é™¤countä¸ªå€¼</span><br><span class="line">zpopmin key [count]</span><br><span class="line"></span><br><span class="line"># è·å¾—å…ƒç´ ä¸ªæ•°</span><br><span class="line">zcard key</span><br><span class="line"></span><br><span class="line"># è·å¾—å…ƒç´ åœ¨èŒƒå›´å†…çš„ä¸ªæ•°</span><br><span class="line">zcount min max</span><br><span class="line"></span><br><span class="line"># æ±‚äº¤é›†ã€å¹¶é›†å¹¶æ”¾å…¥destinationä¸­, å…¶ä¸­numkey1ä¸ºè¦å»äº¤é›†æˆ–å¹¶é›†é›†åˆçš„æ•°ç›®</span><br><span class="line">zinterstore destination numkeys key1 key2...</span><br><span class="line">zunionstore destination numkeys key1 key2...</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong></p>
<ul>
<li>minä¸maxç”¨äºé™å®šæœç´¢æŸ¥è¯¢çš„<strong>æ¡ä»¶</strong></li>
<li>startä¸stopç”¨äºé™å®š<strong>æŸ¥è¯¢èŒƒå›´</strong>ï¼Œä½œç”¨äºç´¢å¼•ï¼Œè¡¨ç¤ºå¼€å§‹å’Œç»“æŸç´¢å¼•</li>
<li>offsetä¸countç”¨äºé™å®šæŸ¥è¯¢èŒƒå›´ï¼Œä½œç”¨äºæŸ¥è¯¢ç»“æœï¼Œè¡¨ç¤º<strong>å¼€å§‹ä½ç½®</strong>å’Œ<strong>æ•°æ®æ€»é‡</strong></li>
</ul>
<h4 id="2-5-2-æ‹“å±•æ“ä½œ"><a href="#2-5-2-æ‹“å±•æ“ä½œ" class="headerlink" title="2.5.2 æ‹“å±•æ“ä½œ"></a>2.5.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹æŸä¸ªå…ƒç´ çš„ç´¢å¼•(æ’å)</span><br><span class="line">zrank key member</span><br><span class="line">zrevrank key member</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æŸä¸ªå…ƒç´ ç´¢å¼•çš„å€¼</span><br><span class="line">zscore key member</span><br><span class="line"># å¢åŠ æŸä¸ªå…ƒç´ ç´¢å¼•çš„å€¼</span><br><span class="line">zincrby key increment member</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-5-3-sorted-setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"><a href="#2-5-3-sorted-setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.5.3 sorted_setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"></a>2.5.3 sorted_setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹</h4><ul>
<li>scoreä¿å­˜çš„æ•°æ®å­˜å‚¨ç©ºé—´æ˜¯64ä½ï¼Œå¦‚æœæ˜¯æ•´æ•°èŒƒå›´æ˜¯-9007199254740992~9007199254740992</li>
<li>scoreä¿å­˜çš„æ•°æ®ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŒç²¾åº¦çš„doubleå€¼ï¼ŒåŸºäºåŒç²¾åº¦æµ®ç‚¹æ•°çš„ç‰¹å¾ï¼Œ<strong>å¯èƒ½ä¼šä¸¢å¤±ç²¾åº¦</strong>ï¼Œä½¿ç”¨æ—¶å€™è¦<strong>æ…é‡</strong></li>
<li>sorted_set åº•å±‚å­˜å‚¨è¿˜æ˜¯<strong>åŸºäºset</strong>ç»“æ„çš„ï¼Œå› æ­¤æ•°æ®<strong>ä¸èƒ½é‡å¤</strong>ï¼Œå¦‚æœé‡å¤æ·»åŠ ç›¸åŒçš„æ•°æ®ï¼Œscoreå€¼å°†è¢«åå¤è¦†ç›–ï¼Œ<strong>ä¿ç•™æœ€åä¸€æ¬¡</strong>ä¿®æ”¹çš„ç»“æœ</li>
</ul>
<h2 id="3-é€šç”¨æŒ‡ä»¤"><a href="#3-é€šç”¨æŒ‡ä»¤" class="headerlink" title="3. é€šç”¨æŒ‡ä»¤"></a>3. é€šç”¨æŒ‡ä»¤</h2><h3 id="3-1-key-ç‰¹å¾"><a href="#3-1-key-ç‰¹å¾" class="headerlink" title="3.1 key ç‰¹å¾"></a>3.1 key ç‰¹å¾</h3><ul>
<li>keyæ˜¯ä¸€ä¸ª<strong>å­—ç¬¦ä¸²</strong>ï¼Œé€šè¿‡keyè·å–redisä¸­ä¿å­˜çš„æ•°æ®</li>
</ul>
<h3 id="3-2-keyé€šç”¨æ“ä½œ"><a href="#3-2-keyé€šç”¨æ“ä½œ" class="headerlink" title="3.2 keyé€šç”¨æ“ä½œ"></a>3.2 keyé€šç”¨æ“ä½œ</h3><h4 id="3-2-1-åŸºæœ¬æ“ä½œ"><a href="#3-2-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="3.2.1 åŸºæœ¬æ“ä½œ"></a>3.2.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹keyæ˜¯å¦å­˜åœ¨</span><br><span class="line">exists key</span><br><span class="line"></span><br><span class="line"># åˆ é™¤key</span><br><span class="line">del key</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹keyçš„ç±»å‹</span><br><span class="line">type key</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-æ‹“å±•æ“ä½œ"><a href="#3-2-2-æ‹“å±•æ“ä½œ" class="headerlink" title="3.2.2 æ‹“å±•æ“ä½œ"></a>3.2.2 æ‹“å±•æ“ä½œ</h4><ul>
<li>æ—¶æ•ˆæ€§æ“ä½œ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®ç”Ÿå‘½å‘¨æœŸ</span><br><span class="line">expire key seconds</span><br><span class="line">pexpire key milliseconds</span><br><span class="line"># Linuxä¸‹ä½¿ç”¨æ—¶é—´æˆ³è®¾ç½®æœ‰æ•ˆäº‹ä»¶</span><br><span class="line">expireat key timestamp</span><br><span class="line">pexpireat key milliseconds-timestamp</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æœ‰æ•ˆæ—¶é—´, å¦‚æœæœ‰æœ‰æ•ˆæ—¶é—´åˆ™è¿”å›å‰©ä½™æœ‰æ•ˆæ—¶é—´, å¦‚æœä¸ºæ°¸ä¹…æœ‰æ•ˆï¼Œåˆ™è¿”å›-1, å¦‚æœKeyä¸å­˜åœ¨åˆ™è¿”å›-2</span><br><span class="line">ttl key</span><br><span class="line">pttl key</span><br><span class="line"></span><br><span class="line"># å°†æœ‰æ—¶é™çš„æ•°æ®è®¾ç½®ä¸ºæ°¸ä¹…æœ‰æ•ˆ</span><br><span class="line">persist key</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥è¯¢æ“ä½œ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># æ ¹æ®keyæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®</span><br><span class="line">keys pattern</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_10_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_10_20210326.png" alt="img"></a></p>
<ul>
<li>å…¶ä»–æ“ä½œ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># é‡å‘½åkeyï¼Œä¸ºäº†é¿å…è¦†ç›–å·²æœ‰æ•°æ®ï¼Œå°½é‡å°‘å»ä¿®æ”¹å·²æœ‰keyçš„åå­—ï¼Œå¦‚æœè¦ä½¿ç”¨æœ€å¥½ä½¿ç”¨renamenx</span><br><span class="line">rename key newKey</span><br><span class="line">renamenx key newKey</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ‰€æœ‰å…³äºkeyçš„æ“ä½œ, å¯ä»¥ä½¿ç”¨Tabå¿«é€Ÿåˆ‡æ¢</span><br><span class="line">help @generic</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="3-3-æ•°æ®åº“çš„é€šç”¨æŒ‡ä»¤"><a href="#3-3-æ•°æ®åº“çš„é€šç”¨æŒ‡ä»¤" class="headerlink" title="3.3 æ•°æ®åº“çš„é€šç”¨æŒ‡ä»¤"></a>3.3 æ•°æ®åº“çš„é€šç”¨æŒ‡ä»¤</h3><p>keyé‡å¤çš„é—®é¢˜</p>
<ul>
<li>keyæ—¶ç¨‹åºå‘˜å®šä¹‰çš„</li>
<li>redisä½¿ç”¨ä¸­æ•°æ®é‡ä¸æ–­å¢åŠ ï¼Œkeyä¹Ÿä¼šä¸æ–­å¢å¤š</li>
<li>æ•°æ®éƒ¨åˆ†ç§ç±»ï¼Œç±»åˆ«æ··åœ¨åœ¨ä¸€èµ·å®¹æ˜“é‡å¤æˆ–å†²çª</li>
</ul>
<p>è§£å†³ï¼šæ•°æ®åº“</p>
<ul>
<li>Redisä¸ºæ¯ä¸ªæœåŠ¡æä¾›æœ‰16ä¸ªæ•°æ®åº“ï¼Œç¼–å·ä»0åˆ°15</li>
<li>æ¯ä¸ªæ•°æ®åº“ä¹‹é—´çš„æ•°æ®ç›¸äº’ç‹¬ç«‹</li>
</ul>
<h4 id="3-3-1-åŸºæœ¬æ“ä½œ"><a href="#3-3-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="3.3.1 åŸºæœ¬æ“ä½œ"></a>3.3.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># åˆ‡æ¢æ•°æ®åº“ 0~15</span><br><span class="line">select index</span><br><span class="line"></span><br><span class="line"># å…¶ä»–æ“ä½œ</span><br><span class="line">quit</span><br><span class="line">ping</span><br><span class="line">echo massage</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-æ‹“å±•æ“ä½œ"><a href="#3-3-2-æ‹“å±•æ“ä½œ" class="headerlink" title="3.3.2 æ‹“å±•æ“ä½œ"></a>3.3.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ç§»åŠ¨æ•°æ®, å¿…é¡»ä¿è¯ç›®çš„æ•°æ®åº“ä¸­æ²¡æœ‰è¯¥æ•°æ®</span><br><span class="line">mov key db</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è¯¥åº“ä¸­æ•°æ®æ€»é‡</span><br><span class="line">dbsize</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="4-Jedis"><a href="#4-Jedis" class="headerlink" title="4. Jedis"></a>4. Jedis</h2><ul>
<li>Javaè¯­è¨€è¿æ¥redisçš„æœåŠ¡<ul>
<li>Jedis</li>
<li>SpringData Redis</li>
<li>Lettuce</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_11_20210326.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_11_20210326.png" alt="img"></a></p>
<ul>
<li><strong>JAVA</strong>æ“ä½œRediséœ€è¦å¯¼å…¥jaræˆ–å¼•å…¥Mavenä¾èµ–</li>
</ul>
<h3 id="4-1-Javaæ“ä½œredisçš„æ­¥éª¤"><a href="#4-1-Javaæ“ä½œredisçš„æ­¥éª¤" class="headerlink" title="4.1 Javaæ“ä½œredisçš„æ­¥éª¤"></a>4.1 Javaæ“ä½œredisçš„æ­¥éª¤</h3><ul>
<li>è¿æ¥Redis</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å‚æ•°ä¸ºRedisæ‰€åœ¨çš„ipåœ°å€å’Œç«¯å£å·</span><br><span class="line">Jedis jedis &#x3D; new Jedis(String host, int port)</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>æ“ä½œRedis</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; æ“ä½œredisçš„æŒ‡ä»¤å’Œredisæœ¬èº«çš„æŒ‡ä»¤å‡ ä¹ä¸€è‡´</span><br><span class="line">jedis.set(String key, String value);</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>æ–­å¼€è¿æ¥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jedis.close();</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>å¸¸è§„æ¼”ç¤ºTest</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">package cn.itcast.jedis.test;</span><br><span class="line"></span><br><span class="line">import cn.itcast.jedis.util.JedisPoolUtils;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import redis.clients.jedis.Jedis;</span><br><span class="line">import redis.clients.jedis.JedisPool;</span><br><span class="line">import redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * jedisçš„æµ‹è¯•ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class JedisTest &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * å¿«é€Ÿå…¥é—¨</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void test1()&#123;</span><br><span class="line">        &#x2F;&#x2F;1. è·å–è¿æ¥</span><br><span class="line">        Jedis jedis &#x3D; new Jedis(&quot;localhost&quot;,6379);</span><br><span class="line">        &#x2F;&#x2F;2. æ“ä½œ</span><br><span class="line">        jedis.set(&quot;username&quot;,&quot;zhangsan&quot;);</span><br><span class="line">        &#x2F;&#x2F;3. å…³é—­è¿æ¥</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * string æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void test2()&#123;</span><br><span class="line">        &#x2F;&#x2F;1. è·å–è¿æ¥</span><br><span class="line">        Jedis jedis &#x3D; new Jedis();&#x2F;&#x2F;å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br><span class="line">        &#x2F;&#x2F;2. æ“ä½œ</span><br><span class="line">        &#x2F;&#x2F;å­˜å‚¨</span><br><span class="line">        jedis.set(&quot;username&quot;,&quot;zhangsan&quot;);</span><br><span class="line">        &#x2F;&#x2F;è·å–</span><br><span class="line">        String username &#x3D; jedis.get(&quot;username&quot;);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">        &#x2F;&#x2F;å¯ä»¥ä½¿ç”¨setex()æ–¹æ³•å­˜å‚¨å¯ä»¥æŒ‡å®šè¿‡æœŸæ—¶é—´çš„ key value</span><br><span class="line">        jedis.setex(&quot;activecode&quot;,20,&quot;hehe&quot;);&#x2F;&#x2F;å°†activecodeï¼šheheé”®å€¼å¯¹å­˜å…¥redisï¼Œå¹¶ä¸”20ç§’åè‡ªåŠ¨åˆ é™¤è¯¥é”®å€¼å¯¹</span><br><span class="line">        &#x2F;&#x2F;3. å…³é—­è¿æ¥</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * hash æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void test3()&#123;</span><br><span class="line">        &#x2F;&#x2F;1. è·å–è¿æ¥</span><br><span class="line">        Jedis jedis &#x3D; new Jedis();&#x2F;&#x2F;å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br><span class="line">        &#x2F;&#x2F;2. æ“ä½œ</span><br><span class="line">        &#x2F;&#x2F; å­˜å‚¨hash</span><br><span class="line">        jedis.hset(&quot;user&quot;,&quot;name&quot;,&quot;lisi&quot;);</span><br><span class="line">        jedis.hset(&quot;user&quot;,&quot;age&quot;,&quot;23&quot;);</span><br><span class="line">        jedis.hset(&quot;user&quot;,&quot;gender&quot;,&quot;female&quot;);</span><br><span class="line">        &#x2F;&#x2F; è·å–hash</span><br><span class="line">        String name &#x3D; jedis.hget(&quot;user&quot;, &quot;name&quot;);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        &#x2F;&#x2F; è·å–hashçš„æ‰€æœ‰mapä¸­çš„æ•°æ®</span><br><span class="line">        Map&lt;String, String&gt; user &#x3D; jedis.hgetAll(&quot;user&quot;);</span><br><span class="line">        &#x2F;&#x2F; keyset</span><br><span class="line">        Set&lt;String&gt; keySet &#x3D; user.keySet();</span><br><span class="line">        for (String key : keySet) &#123;</span><br><span class="line">            &#x2F;&#x2F;è·å–value</span><br><span class="line">            String value &#x3D; user.get(key);</span><br><span class="line">            System.out.println(key + &quot;:&quot; + value);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;3. å…³é—­è¿æ¥</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * list æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void test4()&#123;</span><br><span class="line">        &#x2F;&#x2F;1. è·å–è¿æ¥</span><br><span class="line">        Jedis jedis &#x3D; new Jedis();&#x2F;&#x2F;å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br><span class="line">        &#x2F;&#x2F;2. æ“ä½œ</span><br><span class="line">        &#x2F;&#x2F; list å­˜å‚¨</span><br><span class="line">        jedis.lpush(&quot;mylist&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;);&#x2F;&#x2F;ä»å·¦è¾¹å­˜</span><br><span class="line">        jedis.rpush(&quot;mylist&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;);&#x2F;&#x2F;ä»å³è¾¹å­˜</span><br><span class="line">        &#x2F;&#x2F; list èŒƒå›´è·å–</span><br><span class="line">        List&lt;String&gt; mylist &#x3D; jedis.lrange(&quot;mylist&quot;, 0, -1);</span><br><span class="line">        System.out.println(mylist);</span><br><span class="line">        &#x2F;&#x2F; list å¼¹å‡º</span><br><span class="line">        String element1 &#x3D; jedis.lpop(&quot;mylist&quot;);&#x2F;&#x2F;c</span><br><span class="line">        System.out.println(element1);</span><br><span class="line">        </span><br><span class="line">        String element2 &#x3D; jedis.rpop(&quot;mylist&quot;);&#x2F;&#x2F;c</span><br><span class="line">        System.out.println(element2);</span><br><span class="line">        &#x2F;&#x2F; list èŒƒå›´è·å–</span><br><span class="line">        List&lt;String&gt; mylist2 &#x3D; jedis.lrange(&quot;mylist&quot;, 0, -1);</span><br><span class="line">        System.out.println(mylist2);</span><br><span class="line">        &#x2F;&#x2F;3. å…³é—­è¿æ¥</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * set æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void test5()&#123;</span><br><span class="line">        &#x2F;&#x2F;1. è·å–è¿æ¥</span><br><span class="line">        Jedis jedis &#x3D; new Jedis();&#x2F;&#x2F;å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br><span class="line">        &#x2F;&#x2F;2. æ“ä½œ</span><br><span class="line">        &#x2F;&#x2F; set å­˜å‚¨</span><br><span class="line">        jedis.sadd(&quot;myset&quot;,&quot;java&quot;,&quot;php&quot;,&quot;c++&quot;);</span><br><span class="line">        &#x2F;&#x2F; set è·å–</span><br><span class="line">        Set&lt;String&gt; myset &#x3D; jedis.smembers(&quot;myset&quot;);</span><br><span class="line">        System.out.println(myset);</span><br><span class="line">        &#x2F;&#x2F;3. å…³é—­è¿æ¥</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * sortedset æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void test6()&#123;</span><br><span class="line">        &#x2F;&#x2F;1. è·å–è¿æ¥</span><br><span class="line">        Jedis jedis &#x3D; new Jedis();&#x2F;&#x2F;å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br><span class="line">        &#x2F;&#x2F;2. æ“ä½œ</span><br><span class="line">        &#x2F;&#x2F; sortedset å­˜å‚¨</span><br><span class="line">        jedis.zadd(&quot;mysortedset&quot;,3,&quot;äºšç‘Ÿ&quot;);</span><br><span class="line">        jedis.zadd(&quot;mysortedset&quot;,30,&quot;åè£”&quot;);</span><br><span class="line">        jedis.zadd(&quot;mysortedset&quot;,55,&quot;å­™æ‚Ÿç©º&quot;);</span><br><span class="line">        &#x2F;&#x2F; sortedset è·å–</span><br><span class="line">        Set&lt;String&gt; mysortedset &#x3D; jedis.zrange(&quot;mysortedset&quot;, 0, -1);</span><br><span class="line">        System.out.println(mysortedset);</span><br><span class="line">        &#x2F;&#x2F;3. å…³é—­è¿æ¥</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * jedisè¿æ¥æ± ä½¿ç”¨</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void test7()&#123;</span><br><span class="line">        &#x2F;&#x2F;0.åˆ›å»ºä¸€ä¸ªé…ç½®å¯¹è±¡</span><br><span class="line">        JedisPoolConfig config &#x3D; new JedisPoolConfig();</span><br><span class="line">        config.setMaxTotal(50);</span><br><span class="line">        config.setMaxIdle(10);</span><br><span class="line">        &#x2F;&#x2F;1.åˆ›å»ºJedisè¿æ¥æ± å¯¹è±¡</span><br><span class="line">        JedisPool jedisPool &#x3D; new JedisPool(config,&quot;localhost&quot;,6379);</span><br><span class="line">        &#x2F;&#x2F;2.è·å–è¿æ¥</span><br><span class="line">        Jedis jedis &#x3D; jedisPool.getResource();</span><br><span class="line">        &#x2F;&#x2F;3. ä½¿ç”¨</span><br><span class="line">        jedis.set(&quot;hehe&quot;,&quot;heihei&quot;);</span><br><span class="line">        &#x2F;&#x2F;4. å…³é—­ å½’è¿˜åˆ°è¿æ¥æ± ä¸­</span><br><span class="line">        jedis.close();;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * jedisè¿æ¥æ± å·¥å…·ç±»ä½¿ç”¨</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void test8()&#123;</span><br><span class="line">        &#x2F;&#x2F;é€šè¿‡è¿æ¥æ± å·¥å…·ç±»è·å–</span><br><span class="line">        Jedis jedis &#x3D; JedisPoolUtils.getJedis();</span><br><span class="line">        &#x2F;&#x2F;3. ä½¿ç”¨</span><br><span class="line">        jedis.set(&quot;hello&quot;,&quot;world&quot;);</span><br><span class="line">        &#x2F;&#x2F;4. å…³é—­ å½’è¿˜åˆ°è¿æ¥æ± ä¸­</span><br><span class="line">        jedis.close();;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h3 id="4-2-Jediså·¥å…·ç±»æŠ½å–"><a href="#4-2-Jediså·¥å…·ç±»æŠ½å–" class="headerlink" title="4.2 Jediså·¥å…·ç±»æŠ½å–"></a>4.2 Jediså·¥å…·ç±»æŠ½å–</h3><ul>
<li>redis.properties(é…ç½®æ–‡ä»¶)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">host&#x3D;127.0.0.1</span><br><span class="line">port&#x3D;6379</span><br><span class="line">maxTotal&#x3D;50</span><br><span class="line">maxIdle&#x3D;10</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>JedisPoolUtilså·¥å…·ç±»</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">package cn.itcast.jedis.util;</span><br><span class="line"></span><br><span class="line">import redis.clients.jedis.Jedis;</span><br><span class="line">import redis.clients.jedis.JedisPool;</span><br><span class="line">import redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.Properties;</span><br><span class="line">&#x2F;**</span><br><span class="line"> JedisPoolå·¥å…·ç±»</span><br><span class="line">    åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé…ç½®è¿æ¥æ± çš„å‚æ•°</span><br><span class="line">    æä¾›è·å–è¿æ¥çš„æ–¹æ³•</span><br><span class="line"></span><br><span class="line"> *&#x2F;</span><br><span class="line">public class JedisPoolUtils &#123;</span><br><span class="line"></span><br><span class="line">    private static JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    static&#123;</span><br><span class="line">        &#x2F;&#x2F;è¯»å–é…ç½®æ–‡ä»¶</span><br><span class="line">        InputStream is &#x3D; JedisPoolUtils.class.getClassLoader().getResourceAsStream(&quot;jedis.properties&quot;);</span><br><span class="line">        &#x2F;&#x2F;åˆ›å»ºPropertieså¯¹è±¡</span><br><span class="line">        Properties pro &#x3D; new Properties();</span><br><span class="line">        &#x2F;&#x2F;å…³è”æ–‡ä»¶</span><br><span class="line">        try &#123;</span><br><span class="line">            pro.load(is);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;è·å–æ•°æ®ï¼Œè®¾ç½®åˆ°JedisPoolConfigä¸­</span><br><span class="line">        JedisPoolConfig config &#x3D; new JedisPoolConfig();</span><br><span class="line">        </span><br><span class="line">		config.setMaxTotal(Integer.parseInt(pro.getProperty(&quot;maxTotal&quot;)));</span><br><span class="line">        config.setMaxIdle(Integer.parseInt(pro.getProperty(&quot;maxIdle&quot;)));</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;åˆå§‹åŒ–JedisPool</span><br><span class="line">        jedisPool &#x3D; new JedisPool(config,pro.getProperty(&quot;host&quot;),Integer.parseInt(pro.getProperty(&quot;port&quot;)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * è·å–è¿æ¥æ–¹æ³•</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Jedis getJedis()&#123;</span><br><span class="line">        return jedisPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/06/redis%E5%9F%BA%E7%A1%80/" data-id="cknyemfcf00036oub8vricr5k" data-title="redisåŸºç¡€" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-è®¡ç®—æœºç½‘ç»œæ€»ç»“" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2021-04-06T11:33:18.000Z" itemprop="datePublished">2021-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%80%BB%E7%BB%93/">è®¡ç®—æœºç½‘ç»œæ€»ç»“</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="è®¡ç®—æœºç½‘ç»œæ€»ç»“"><a href="#è®¡ç®—æœºç½‘ç»œæ€»ç»“" class="headerlink" title="è®¡ç®—æœºç½‘ç»œæ€»ç»“"></a>è®¡ç®—æœºç½‘ç»œæ€»ç»“</h1><p>æœ¬å¤ä¹ æ€»ç»“å®Œå…¨å‚è€ƒæ•™ç ”å®¤å¸ˆå§ï¼ˆæ©˜å­å§ï¼‰çš„ç¬”è®°å’ŒJavaGuideæ€»ç»“[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/23/%E8%AE%A1%E7%BD%91/#fn:1">1]</a>[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/23/%E8%AE%A1%E7%BD%91/#fn:2">2]</a>ä»¥åŠå°‘é‡çš„è¡¥å……</p>
<h2 id="1-OSIä¸TCP-IPå„å±‚çš„ç»“æ„ä¸åŠŸèƒ½-éƒ½æœ‰å“ªäº›åè®®"><a href="#1-OSIä¸TCP-IPå„å±‚çš„ç»“æ„ä¸åŠŸèƒ½-éƒ½æœ‰å“ªäº›åè®®" class="headerlink" title="1. OSIä¸TCP/IPå„å±‚çš„ç»“æ„ä¸åŠŸèƒ½,éƒ½æœ‰å“ªäº›åè®®?"></a>1. OSIä¸TCP/IPå„å±‚çš„ç»“æ„ä¸åŠŸèƒ½,éƒ½æœ‰å“ªäº›åè®®?</h2><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_1_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_1_network.png" alt="img"></a></p>
<h3 id="1-1-åº”ç”¨å±‚"><a href="#1-1-åº”ç”¨å±‚" class="headerlink" title="1.1 åº”ç”¨å±‚"></a>1.1 åº”ç”¨å±‚</h3><h4 id="1-1-1-åº”ç”¨å±‚"><a href="#1-1-1-åº”ç”¨å±‚" class="headerlink" title="1.1.1 åº”ç”¨å±‚"></a>1.1.1 åº”ç”¨å±‚</h4><blockquote>
<p><strong>åº”ç”¨å±‚</strong>ï¼šç›´æ¥ä¸ºç”¨æˆ·çš„åº”ç”¨è¿›ç¨‹æä¾›ç½‘ç»œæœåŠ¡ã€‚</p>
</blockquote>
<p><strong>åº”ç”¨å±‚åè®®</strong>ï¼š å¯¹äºä¸åŒçš„ç½‘ç»œåº”ç”¨éœ€è¦ä¸åŒçš„åº”ç”¨å±‚åè®®ã€‚é€šä¿—çš„æ¥è®²å°±æ˜¯åº”ç”¨å±‚ä¼šå€ŸåŠ©TCPã€UDPåè®®åœ¨å„ç§å„æ ·çš„ç¨‹åºä¹‹é—´ä¼ é€’æ•°æ®ï¼ˆé‚®ä»¶ã€æ–‡ä»¶ç­‰ç­‰ï¼‰è¿™æ—¶å€™åƒåº”ç”¨å±‚åè®®å°±å¯ä»¥è§„å®šè¿™äº›æ•°æ®çš„æ ¼å¼è¦æ»¡è¶³ä»€ä¹ˆå½¢å¼ã€‚</p>
<p>åœ¨äº’è”ç½‘ä¸­åº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå¦‚</p>
<ul>
<li>åŸŸåç³»ç»Ÿ<strong>DNS</strong></li>
</ul>
<blockquote>
<p>åŸŸåç³»ç»ŸDNSï¼š</p>
<p>æ˜¯å› ç‰¹ç½‘çš„ä¸€é¡¹æ ¸å¿ƒæœåŠ¡ï¼Œä»–ä½œä¸ºå¯ä»¥å°†åŸŸåå’ŒIPåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œèƒ½å¤Ÿä½¿äººæ›´æ–¹ä¾¿çš„è®¿é—®äº’è”ç½‘ï¼Œä¸ç”¨å»è®°ä½èƒ½å¤ŸèƒŒæå…¶ç›´æ¥è¯»å–çš„IPæ•°ä¸²ã€‚</p>
</blockquote>
<ul>
<li>æ”¯æŒä¸‡ç»´ç½‘åº”ç”¨çš„ <strong>HTTP</strong>åè®®</li>
</ul>
<blockquote>
<p>HTTPåè®®:</p>
<p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚æ‰€æœ‰çš„ WWWï¼ˆä¸‡ç»´ç½‘ï¼‰ æ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ã€‚è®¾è®¡ HTTP æœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶ HTML é¡µé¢çš„æ–¹æ³•ã€‚</p>
</blockquote>
<ul>
<li>æ”¯æŒç”µå­é‚®ä»¶çš„ <strong>SMTP</strong>åè®®</li>
<li>æ–‡ä»¶ä¼ è¾“ <strong>FTP</strong>ç­‰ç­‰</li>
</ul>
<p>æˆ‘ä»¬æŠŠåº”ç”¨å±‚äº¤äº’çš„æ•°æ®å•å…ƒç§°ä¸ºæŠ¥æ–‡ã€‚</p>
<h4 id="1-1-2-è¡¨ç¤ºå±‚"><a href="#1-1-2-è¡¨ç¤ºå±‚" class="headerlink" title="1.1.2 è¡¨ç¤ºå±‚"></a>1.1.2 è¡¨ç¤ºå±‚</h4><blockquote>
<p><strong>è¡¨ç¤ºå±‚</strong>ï¼šåœ¨æ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„åŸºç¡€ä¸Šï¼Œå°½å¯èƒ½çš„èŠ‚çœä¼ è¾“è´¹ç”¨è€Œè®¾ç½®çš„ï¼Œè¡¨ç¤ºå±‚å¯¹ä¸Šå±‚æ•°æ®æˆ–ä¿¡æ¯è¿›è¡Œå˜æ¢ä»¥ä¿è¯ä¸€ä¸ªä¸»æœºåº”ç”¨å±‚ä¿¡æ¯å¯ä»¥è¢«å¦ä¸€ä¸ªä¸»æœºçš„åº”ç”¨ç¨‹åºç†è§£ã€‚</p>
</blockquote>
<p>è¡¨ç¤ºå±‚çš„<strong>æ•°æ®è½¬æ¢</strong>åŒ…æ‹¬:</p>
<ul>
<li>æ•°æ®åŠ å¯†</li>
<li>æ•°æ®å‹ç¼©</li>
<li>æ•°æ®æ ¼å¼è½¬æ¢ç­‰ã€‚</li>
</ul>
<p>æ¯”å¦‚ä¼ è¾“å‹ç¼©æ–‡ä»¶ï¼Œjpegæˆ–è€…åŠ å¯†æ–‡ä»¶ç­‰æ ¼å¼ã€‚</p>
<h4 id="1-1-3-ä¼šè¯å±‚"><a href="#1-1-3-ä¼šè¯å±‚" class="headerlink" title="1.1.3 ä¼šè¯å±‚"></a>1.1.3 ä¼šè¯å±‚</h4><blockquote>
<p>ä¼šè¯å±‚ï¼š<strong>ç®¡ç†</strong>ä¸»æœºä¹‹é—´çš„<strong>ä¼šè¯è¿›ç¨‹</strong>ï¼Œå³è´Ÿè´£å»ºç«‹ã€ç®¡ç†ã€ç»ˆæ­¢è¿›ç¨‹ä¹‹é—´çš„ä¼šè¯ã€‚</p>
</blockquote>
<h3 id="1-2-è¿è¾“å±‚"><a href="#1-2-è¿è¾“å±‚" class="headerlink" title="1.2 è¿è¾“å±‚"></a>1.2 è¿è¾“å±‚</h3><blockquote>
<p><strong>è¿è¾“å±‚</strong>ï¼šä¸ºåº”ç”¨è¿›ç¨‹ä¹‹é—´æä¾›ç«¯åˆ°ç«¯çš„é€»è¾‘é€šè®¯ã€‚</p>
</blockquote>
<h4 id="1-2-1-è¿è¾“å±‚åè®®â­"><a href="#1-2-1-è¿è¾“å±‚åè®®â­" class="headerlink" title="1.2.1 è¿è¾“å±‚åè®®â­"></a>1.2.1 è¿è¾“å±‚åè®®â­</h4><p><strong>è¿è¾“å±‚åè®®</strong>: IPåè®®æ˜¯<strong>ä¸»æœºä¹‹é—´</strong>çš„é€šä¿¡ï¼ŒTCPå’ŒUDPæ˜¯è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</p>
<ul>
<li><p>ä¼ è¾“æ§åˆ¶åè®® <strong>TCP</strong>ï¼ˆTransmission Control Protocolï¼‰</p>
<p>æä¾›é¢å‘è¿æ¥çš„ï¼Œå¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡</p>
<ul>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¦ä¿æŒä¸€ä¸ªä¼šè¯ç›´åˆ°ä¼ è¾“ç»“æŸ</li>
<li>åˆ†æ®µä¼ è¾“å»ºç«‹ä¼šè¯å¯é ä¼ è¾“æµé‡æ§åˆ¶ï¼ˆå‘é€çª—å£å¤§å°æ ¹æ®æ¥æ”¶çª—å£å¤§å°ç¡®å®šï¼‰</li>
<li>æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ï¼Œå…¨åŒå·¥</li>
<li>æ¯ä¸€æ¡TCPè¿æ¥æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼ˆå¥—æ¥å­—ï¼šIP+ç«¯å£å·ï¼‰</li>
</ul>
</li>
<li><p>ç”¨æˆ·æ•°æ®åè®® <strong>UDP</strong>ï¼ˆUser Datagram Protocolï¼‰</p>
<p>æä¾›æ— è¿æ¥çš„ï¼Œå°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡</p>
<ul>
<li>ä¸ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§</li>
<li>ä¸åˆ†æ®µ</li>
<li>æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€é€šä¿¡</li>
</ul>
</li>
<li><p>TCPå’ŒUDPå¯¹æ¯”[è§é—®é¢˜ä¸‰](<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/23/%E8%AE%A1%E7%BD%91/3.TCP/UDP">http://lihengxu.cn/2021/03/23/è®¡ç½‘/3.TCP/UDP</a> åè®®çš„åŒºåˆ«â­)</p>
</li>
</ul>
<h4 id="1-2-2-æœ¬å±‚åŠ ç«¯å£å·"><a href="#1-2-2-æœ¬å±‚åŠ ç«¯å£å·" class="headerlink" title="1.2.2 æœ¬å±‚åŠ ç«¯å£å·"></a>1.2.2 æœ¬å±‚åŠ ç«¯å£å·</h4><p>å¸¸è§ç«¯å£ï¼š</p>
<ul>
<li>FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰ï¼š20ï¼Œ21â€”â€”å…¶ä¸­20ç«¯å£ç”¨äºä¼ è¾“æ•°æ®ï¼Œ21ç«¯å£ç”¨äºå‘½ä»¤æ§åˆ¶ï¼›</li>
<li>Telnetï¼ˆè¿œç¨‹ç™»å½•åè®®ï¼‰ï¼š23ï¼›</li>
<li>DNSï¼ˆåŸŸåè§£ææœåŠ¡ï¼‰ï¼š53ï¼›</li>
<li>TFTPï¼ˆç®€å•æ–‡ä»¶ä¼ è¾“åè®®ï¼‰ï¼š69ï¼›</li>
<li>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰ï¼š80</li>
</ul>
<h4 id="1-2-3-ä¼ è¾“å±‚è¿›è¡Œå·®é”™æ£€æµ‹"><a href="#1-2-3-ä¼ è¾“å±‚è¿›è¡Œå·®é”™æ£€æµ‹" class="headerlink" title="1.2.3 ä¼ è¾“å±‚è¿›è¡Œå·®é”™æ£€æµ‹"></a>1.2.3 ä¼ è¾“å±‚è¿›è¡Œå·®é”™æ£€æµ‹</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_2_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_2_network.png" alt="img"></a></p>
<h3 id="1-3-ç½‘ç»œå±‚"><a href="#1-3-ç½‘ç»œå±‚" class="headerlink" title="1.3 ç½‘ç»œå±‚"></a>1.3 ç½‘ç»œå±‚</h3><blockquote>
<p><strong>ç½‘ç»œå±‚</strong>ï¼ˆç½‘é™…å±‚/IPå±‚ï¼‰ï¼šåœ¨è®¡ç®—æœºç½‘ç»œä¸­è¿›è¡Œé€šä¿¡çš„ä¸¤ä¸ªè®¡ç®—æœºä¹‹é—´å¯èƒ½ä¼šç»è¿‡å¾ˆå¤šä¸ªæ•°æ®é“¾è·¯ï¼Œä¹Ÿå¯èƒ½è¿˜è¦ç»è¿‡å¾ˆå¤šé€šä¿¡å­ç½‘ã€‚ç½‘ç»œå±‚çš„ä»»åŠ¡å°±æ˜¯é€‰æ‹©åˆé€‚çš„ç½‘é—´è·¯ç”±å’Œäº¤æ¢ç»“ç‚¹ï¼Œ ç¡®ä¿æ•°æ®åŠæ—¶ä¼ é€ã€‚(<strong>è·¯å¾„é€‰æ‹©ã€è·¯ç”±åŠé€»è¾‘å¯»å€</strong>)</p>
</blockquote>
<ul>
<li><p><strong>åè®®</strong>ï¼šARP IP ICMP IGMP(ARPä¸ºIPæä¾›æœåŠ¡ï¼ŒIPä¸ºICMPå’ŒIGMPæä¾›æœåŠ¡ï¼‰</p>
<ul>
<li>ç”±äºç½‘ç»œå±‚ä½¿ç”¨ <strong>IP åè®®</strong>ï¼Œå› æ­¤åˆ†ç»„ä¹Ÿå« IP æ•°æ®æŠ¥ ï¼Œç®€ç§°<strong>æ•°æ®æŠ¥</strong></li>
<li>æ— è®ºæ˜¯å“ªä¸€å±‚çš„æ•°æ®å•å…ƒéƒ½å¯ä»¥ç¬¼ç»Ÿçš„ç”¨â€åˆ†ç»„â€œè¡¨ç¤ºï¼Œä¸»è¦ä¸è¦æ··æ·†â€ç”¨æˆ·æ•°æ®åŒ…UDPâ€œå’Œç½‘ç»œå±‚çš„â€IPæ•°æ®æŠ¥â€œ</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_3_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_3_network.png" alt="img"></a></p>
</li>
<li><p><strong>ç‰¹ç‚¹</strong>ï¼šç½‘ç»œå±‚ä¸ç®¡å‘çš„é¡ºåºä¹Ÿä¸ç®¡ä¸¢æ•°æ®ä¸ï¼ˆå¯¹æ–¹ä¼ è¾“å±‚è´Ÿè´£ï¼‰ï¼Œæ ¹æ®ç›®æ ‡åœ°å€é€‰æ‹©åˆé€‚è·¯å¾„è½¬å‘ã€‚</p>
</li>
<li><p><strong>æœ¬å±‚åŠ æºIPåœ°å€ä¸ç›®æ ‡IPåœ°å€ï¼Œæ„æˆIPæ•°æ®æŠ¥ã€‚</strong> <strong>IPåè®®éå¸¸ç®€å•ï¼Œä»…ä»…æä¾›ä¸å¯é ã€æ— è¿æ¥çš„ä¼ é€æœåŠ¡</strong>ã€‚ IPåè®®åˆ¶å®šäº†ä¸€å¥—ç½‘ç»œåœ°å€ï¼Œä¹Ÿå°±æ˜¯IPåœ°å€ï¼Œæ ¹æ®IPåè®®èƒ½å¤ŸåŒºåˆ†ä¸¤å°ä¸»æœºæ˜¯å¦åŒå±ä¸€ä¸ªç½‘ç»œï¼ˆå­ç½‘ï¼‰ã€‚</p>
</li>
<li><p><strong>è·¯ç”±å™¨å·¥ä½œåœ¨ç½‘ç»œå±‚</strong>ï¼Œåœ¨ä¸åŒç½‘æ®µè½¬å‘æ•°æ®ã€‚</p>
</li>
</ul>
<h3 id="1-4-æ•°æ®é“¾è·¯å±‚"><a href="#1-4-æ•°æ®é“¾è·¯å±‚" class="headerlink" title="1.4 æ•°æ®é“¾è·¯å±‚"></a>1.4 æ•°æ®é“¾è·¯å±‚</h3><blockquote>
<p>æ•°æ®é“¾è·¯å±‚ï¼šæ•°æ®ä¼ è¾“ï¼Œæ€»æ˜¯åœ¨ä¸€æ®µä¸€æ®µçš„é“¾è·¯ä¸Šä¼ é€çš„ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ä¸“é—¨çš„é“¾è·¯å±‚çš„åè®®ã€‚</p>
</blockquote>
<ul>
<li>åœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹ä¹‹é—´ä¼ é€æ•°æ®æ—¶ï¼Œæ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚äº¤ä¸‹æ¥çš„ <strong>IP æ•°æ®æŠ¥ç»„è£…æˆå¸§</strong>ï¼Œè¿›è¡Œä¼ é€ã€‚æ¯ä¸€å¸§åŒ…æ‹¬æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼ˆåŒæ­¥ä¿¡æ¯ï¼Œåœ°å€ä¿¡æ¯ï¼Œå·®é”™æ§åˆ¶ç­‰ï¼‰ã€‚</li>
<li>åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œæ§åˆ¶ä¿¡æ¯ä½¿æ¥æ”¶ç«¯èƒ½å¤ŸçŸ¥é“ä¸€ä¸ªå¸§ä»å“ªä¸ªæ¯”ç‰¹å¼€å§‹å’Œåˆ°å“ªä¸ªæ¯”ç‰¹ç»“æŸã€‚è¿™æ ·ï¼Œæ•°æ®é“¾è·¯å±‚åœ¨æ”¶åˆ°ä¸€ä¸ªå¸§åï¼Œå°±å¯ä»ä¸­æå‡ºæ•°æ®éƒ¨åˆ†ï¼Œä¸Šäº¤ç»™ç½‘ç»œå±‚ã€‚</li>
<li>å°è£…æˆå¸§ï¼ˆå¸§å¤´ã€å¸§å°¾ã€ç‰©ç†åœ°å€ã€æ ¡éªŒå€¼ï¼‰ é€æ˜ä¼ è¾“ï¼ˆå­—èŠ‚å¡«å……æ³•ï¼Œä¼ è¾“æ•°æ®å‡ºç°æ§åˆ¶å­—ç¬¦å‰é¢æ’å…¥ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼‰ å·®é”™æ ¡éªŒï¼ˆå¾ªç¯å†—ä½™æ£€éªŒCRCï¼‰</li>
</ul>
<blockquote>
<p><strong>æ•°æ®é“¾è·¯å±‚åè®®</strong>(äº†è§£)ï¼š</p>
</blockquote>
<ul>
<li>PPPï¼ˆç‚¹åˆ°ç‚¹ä¿¡é“ï¼‰ ï¼ˆæ‹¨å·ç”µè¯çº¿æ¥å…¥å› ç‰¹ç½‘å°±æ˜¯PPPï¼‰</li>
<li>CSMA/CD(å¸¦å†²çªæ£€æµ‹çš„è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®åè®®ï¼‰ï¼ˆä½¿ç”¨å¹¿æ’­ä¿¡é“ï¼‰ï¼ˆå±€åŸŸç½‘ï¼‰</li>
<li>å¤šè·¯è®¿é—®ï¼šå¤šä¸ªè®¾å¤‡å¯ä»¥åŒæ—¶è®¿é—®ä»‹è´¨ï¼ˆå¤šä¸ªè®¾å¤‡åœ¨åŒä¸€ä¿¡é“å‘é€ä¿¡å·åè®®ï¼‰ï¼Œä¸€ä¸ªè®¾å¤‡å‘é€çš„å¸§ä¹Ÿå¯ä»¥è¢«å¤šä¸ªè®¾å¤‡æ¥æ”¶ã€‚</li>
<li>è½½æ³¢ç›‘å¬ï¼šæ¯ä¸€ä¸ªè®¾å¤‡å‘é€æ•°æ®å‰ï¼Œå¯¹ä¿¡é“ä¾¦å¬ï¼Œç©ºé—²æ‰å¯ä»¥å‘é€ï¼Œå¦‚æœæœ‰å…¶ä»–è®¾å¤‡æ­£åœ¨å‘æš‚æ—¶ä¸å‘é¿å…ç¢°æ’ã€‚</li>
<li>ç¢°æ’æ£€æµ‹ï¼šè®¾å¤‡è¾¹å‘æ•°æ®è¾¹æ£€æµ‹ä¿¡é“ä¸Šç”µå‹å¤§å°ï¼Œä¸€æ—¦å‡ºç°ç¢°æ’ï¼Œç«‹å³åœæ­¢å‘é€ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åå†å‘ã€‚ è¿™ä¸ªåè®®åªèƒ½<strong>åŠåŒå·¥</strong>é€šä¿¡ã€‚</li>
</ul>
<blockquote>
<p><strong>ä»¥å¤ªç½‘</strong>ï¼ˆ å…¨çƒä½¿ç”¨æœ€å¹¿æ³›çš„å±€åŸŸç½‘æŠ€æœ¯ï¼‰æ‹“æ‰‘ç»“æ„ä¸ºæ€»çº¿å‹</p>
</blockquote>
<p>ä»¥å¤ªç½‘çš„æ ‡å‡†<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8B%93%E6%89%91">æ‹“æ‰‘</a>ç»“æ„ä¸º<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%80%BB%E7%BA%BF%E5%9E%8B%E6%8B%93%E6%89%91">æ€»çº¿å‹æ‹“æ‰‘</a>ï¼Œä½†ç›®å‰çš„å¿«é€Ÿä»¥å¤ªç½‘ä¸ºäº†å‡å°‘å†²çªï¼Œå°†èƒ½æé«˜çš„ç½‘ç»œé€Ÿåº¦å’Œä½¿ç”¨æ•ˆç‡æœ€å¤§åŒ–ï¼Œä½¿ç”¨äº¤æ¢æœºæ¥è¿›è¡Œç½‘ç»œè¿æ¥å’Œç»„ç»‡ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä»¥å¤ªç½‘çš„æ‹“æ‰‘ç»“æ„å°±æˆäº†<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%98%9F%E5%9E%8B">æ˜Ÿå‹</a>ï¼›ä½†åœ¨é€»è¾‘ä¸Šï¼Œä»¥å¤ªç½‘ä»ç„¶ä½¿ç”¨æ€»çº¿å‹æ‹“æ‰‘å’Œ<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/CSMA%2FCD">CSMA/CD</a>ï¼ˆCarrier Sense Multiple Access/Collision Detectionï¼Œå³è½½æ³¢å¤šé‡è®¿é—®/ç¢°æ’ä¾¦æµ‹ï¼‰çš„æ€»çº¿æŠ€æœ¯ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_4_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_4_network.png" alt="img"></a></p>
<blockquote>
<p>ç½‘æ¡¥äº¤æ¢æœºï¼šç½‘æ¡¥è®¾å¤‡ï¼ˆå¯ä»¥è¿æ¥é›†çº¿å™¨ï¼‰</p>
</blockquote>
<p>ç½‘æ¡¥æ—¢æœ‰è¿‡æ»¤å¸§çš„åŠŸèƒ½ã€‚å½“ç½‘æ¡¥æ”¶åˆ°ä¸€ä¸ªå¸§çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯åƒæ‰€æœ‰æ¥å£å‘æ­¤å¸§ï¼Œè€Œæ˜¯å…ˆæ£€æŸ¥æ­¤å¸§çš„ç›®çš„MACåœ°å€ï¼Œç„¶åå†ç¡®å®šè¯¥å¸§è½¬å‘åˆ°å“ªä¸€ä¸ªæ¥å£ã€‚</p>
<ul>
<li>ç½‘æ¡¥å£è¶Šæ¥è¶Šå¤šäº†å°±å˜æˆäº†äº¤æ¢æœºï¼ˆç›´æ¥è¿è®¡ç®—æœºï¼‰</li>
<li>äº¤æ¢æœºå‰èº«ä¸ºç½‘æ¡¥</li>
<li>äº¤æ¢æœºå£å¯ä»¥å­˜å‚¨è½¬å‘ï¼ŒåŸºäºMACåœ°å€è½¬å‘ï¼Œé€šè¿‡å­¦ä¹ æ„å»ºMACåœ°å€è¡¨</li>
</ul>
<p><strong>æœ¬å±‚åŠ MACåœ°å€</strong></p>
<h3 id="1-5-ç‰©ç†å±‚"><a href="#1-5-ç‰©ç†å±‚" class="headerlink" title="1.5 ç‰©ç†å±‚"></a>1.5 ç‰©ç†å±‚</h3><blockquote>
<p>ç‰©ç†å±‚ï¼šå®ç°ä¸»æœºå’Œç½‘ç»œä¹‹é—´çš„ç‰©ç†è¿æ¥ï¼Œè§„å®šä¸€äº›ä¸ä¼ è¾“åª’ä½“æ¥å£æœ‰å…³çš„ä¸€äº›ç‰¹æ€§ã€‚</p>
</blockquote>
<ul>
<li>åœ¨ç‰©ç†å±‚ä¸Šä¼ é€æ¯”ç‰¹æµ</li>
<li>é¢‘åˆ†å¤ç”¨ï¼Œæ—¶åˆ†å¤ç”¨</li>
</ul>
<blockquote>
<p>é›†çº¿å™¨ï¼šå¤šæ¥å£è½¬å‘å™¨ï¼Œå·¥ä½œåœ¨ç‰©ç†å±‚</p>
</blockquote>
<h3 id="1-6-æ€»ç»“"><a href="#1-6-æ€»ç»“" class="headerlink" title="1.6 æ€»ç»“"></a>1.6 æ€»ç»“</h3><p>å‘é€ç«¯ï¼š</p>
<ul>
<li><p>åº”ç”¨ç¨‹åºå‡†å¤‡ä¼ è¾“çš„æ–‡ä»¶</p>
</li>
<li><p>ä¼ è¾“å±‚ å°†æ–‡ä»¶åˆ†æ®µ å¹¶ç¼–å·</p>
</li>
<li><p>ç½‘ç»œå±‚ æ·»åŠ ç›®æ ‡IPåœ°å€æºIPåœ°å€</p>
</li>
<li><p>æ•°æ®é“¾è·¯å±‚ ä¸¤ç§æƒ…å†µ</p>
<p>ä½¿ç”¨è‡ªå·±çš„å­ç½‘æ©ç  åˆ¤æ–­è‡ªå·±åœ¨é‚£ä¸ªç½‘æ®µ</p>
<p>ä½¿ç”¨è‡ªå·±çš„å­ç½‘æ©ç  åˆ¤æ–­ç›®æ ‡åœ°å€åœ¨å“ªä¸ªç½‘æ®µ</p>
<ul>
<li>å¦‚æœæ˜¯åŒä¸€ä¸ªç½‘æ®µ arpåè®®å¹¿æ’­è§£æç›®æ ‡IPåœ°å€çš„MAC</li>
<li>å¦‚æœä¸æ˜¯åŒä¸€ä¸ªç½‘æ®µ åˆ™macå†™ç½‘å…³åœ°å€</li>
</ul>
</li>
</ul>
<hr>
<p>ä¸€äº›å¸®åŠ©ç†è§£çš„è§£é‡Šï¼š</p>
<ul>
<li><p>ARPå‘é€çš„å¹¿æ’­åŒ…ï¼Œç›®æ ‡MACæ˜¯å…¨1ï¼ˆ48ä½ï¼‰ï¼Œäº¤æ¢æœºä¼šç»™æ‰€æœ‰å‡ºå£è½¬å‘ã€‚å¾—åˆ°MACåœ°å€åä¼šç¼“å­˜ï¼Œè¿‡ä¸€æ®µæ—¶é—´ä¸å’Œç›®æ ‡åœ°å€é€šä¿¡äº†ï¼Œè¿™ä¸ªç¼“å­˜ä¼šåˆ é™¤æ‰ã€‚</p>
</li>
<li><p>äº¤æ¢æœºæ ¹æ®macåœ°å€è½¬å‘æ•°æ®</p>
</li>
<li><p>æ¯ä¸ªè®¡ç®—æœºé…æœ‰ç½‘å…³ï¼ˆçŸ¥é“è‡ªå·±æ‰€åœ¨å­ç½‘çš„è·¯ç”±ç½‘å£åœ°å€ï¼‰</p>
</li>
<li><p>ç‚¹åˆ°ç‚¹ä¿¡é“ï¼Œç‰©ç†å±‚åœ°å€å›ºå®šä¸ºFFï¼ˆå› ä¸ºåªèƒ½è¿™ä¸ªä¼ ç»™å¯¹æ–¹ï¼Œä¸ç”¨çœ‹åœ°å€ï¼‰</p>
</li>
<li><p>IPåœ°å€å†³å®šäº†æ•°æ®çš„èµ·ç‚¹ä¸ç»ˆç‚¹ï¼ŒMACåœ°å€å†³å®šäº†æœ¬ç‚¹å’Œä¸‹ä¸€è·³ç»™è°</p>
</li>
<li><p>é›†çº¿å™¨ï¼š</p>
<p>åªè´Ÿè´£æŠŠæ¯”ç‰¹æµä¼ å‡ºå»ï¼Œå¹¶å¯¹ä¿¡å·è¿›è¡ŒåŠ å¼ºï¼Œå±äºç‰©ç†å±‚è®¾å¤‡ï¼ˆä¸ç½‘çº¿å·®ä¸å¤šï¼Œåªè®¤æ¯”ç‰¹æµï¼‰</p>
</li>
<li><p>äº¤æ¢æœºï¼ˆä¸€ä¸ªç½‘æ®µå†…è½¬ç»™å…¶ä»–è®¡ç®—æœºè¿˜æ˜¯è·¯ç”±å™¨ï¼‰ï¼š</p>
<p>æ”¶å®Œæ¯”ç‰¹æµï¼Œå­˜å‚¨ï¼Œçœ‹ç›®æ ‡macåœ°å€ï¼Œé€‰æ‹©å‡ºå£ï¼Œå·¥ä½œåœ¨ç¬¬äºŒå±‚æ•°æ®é“¾è·¯å±‚è®¾å¤‡ï¼Œå­˜å‚¨è½¬å‘ï¼ˆåªèƒ½çœ‹æ‡‚macåœ°å€çœ‹ä¸æ‡‚IPåœ°å€ï¼‰</p>
</li>
<li><p>è·¯ç”±å™¨ï¼š</p>
<p>æœ‰ç½‘å¡ï¼ˆæ¥å£ï¼‰æ¥æ”¶æ¯”ç‰¹æµï¼Œå¯ä»¥çœ‹æ‡‚macï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯ç»™è‡ªå·±ï¼Œç„¶åä¼šæŠŠmacåœ°å€å»æ‰ï¼Œå‰©ä¸‹IPæ•°æ®æŠ¥ï¼Œæ ¹æ®æ•°æ®æŠ¥çš„ç›®æ ‡åœ°å€æŒ‰ç…§è·¯ç”±è¡¨é€‰æ‹©å‡ºå£ï¼ˆè·¯ç”±å™¨çœ‹ä¸æ‡‚å…·ä½“ä¼ çš„æ•°æ®ï¼‰ï¼Œå‡ºå£å†™ä¸Šæ–°çš„MACåœ°å€ï¼Œä¸ºä¸‰å±‚è®¾å¤‡ç½‘ç»œè®¾å¤‡</p>
<p>è·¯ç”±å™¨â€“ç½‘å…³â€“äº¤æ¢æœºä¸‰å±‚ç»“æ„ï¼š</p>
<p>çŸ¥é“IPåœ°å€ï¼Œæƒ³çŸ¥é“å…·ä½“æ˜¯å“ªä¸ªç‰©ç†PCæœº</p>
<ul>
<li>é¦–å…ˆè¦é€šè¿‡IPåœ°å€çš„ç½‘æ®µæŸ¥æ‰¾åˆ°æ˜¯å“ªä¸ªç½‘å…³çš„</li>
<li>ç„¶ååœ¨ç½‘å…³ARPè¡¨ä¸­æŸ¥æ‰¾macåœ°å€å’Œäº¤æ¢æœºä½ç½®</li>
<li>ç„¶åé€šè¿‡MACè¡¨æŸ¥æ‰¾åˆ°ç‰©ç†PCæœºã€‚</li>
<li>å³IPåœ°å€-ç½‘å…³-MACåœ°å€-äº¤æ¢æœº-port-PCæœº</li>
</ul>
<blockquote>
<p><strong>macè¡¨</strong>ï¼šè®°å½•äº¤æ¢æœºæ¥å£ï¼ˆç«¯å£ï¼‰å’Œç»ˆç«¯MACçš„å¯¹åº”å…³ç³»ï¼Œå³è¯´æ˜äº¤æ¢æœºå“ªä¸ªç«¯å£å’Œç»ˆç«¯çš„å“ªä¸ªMACåœ°å€å¯¹åº”ï¼ŒæŒ‡çš„æ˜¯ç‰©ç†å±‚é¢çš„è¿æ¥å…³ç³»ï¼Œå­˜åœ¨äºäº¤æ¢æœºå½“ä¸­ã€‚</p>
<p><strong>ARPç¼“å­˜è¡¨</strong>ï¼šè®°å½•ä¸»æœºçš„IPåœ°å€å’ŒMACåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œå¯¹äºåŒä¸€å°PCæœºï¼ŒIPåœ°å€æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯MACåœ°å€æ˜¯ç‰©ç†ç½‘å¡çš„åœ°å€ï¼Œæ˜¯ç½‘å¡ç‰¹æœ‰çš„ä¿¡æ¯ï¼Œæ˜¯ä¸å¯å˜çš„ã€‚è¿™ä¸ªç¼“å­˜è¡¨ä¸€èˆ¬ä¸å­˜åœ¨äº¤æ¢æœºé‡Œé¢ï¼Œè€Œæ˜¯åœ¨äº¤æ¢æœºä¸Šä¸€å±‚çš„ä»ªå™¨ä¸­ï¼Œå³ç½‘å…³ä¸­ã€‚è¿™ä¸ªè¡¨é‡Œé¢åªèƒ½çŸ¥é“IPåœ°å€å’ŒMACçš„å¯¹åº”å…³ç³»ï¼Œä»¥åŠåœ¨å“ªä¸ªäº¤æ¢æœºä¸Šè¿æ¥ç€ï¼Œå¹¶ä¸èƒ½çŸ¥é“åœ¨äº¤æ¢æœºçš„å“ªä¸ªç«¯å£ï¼Œéœ€è¦å’Œmacè¡¨ç›¸ç»“åˆæ‰èƒ½çŸ¥é“ã€‚</p>
<p><strong>è·¯ç”±è¡¨</strong>ï¼šè®°å½•è·¯ç”±å™¨æŒæ¡çš„æ‰€æœ‰ç›®çš„åœ°ç½‘æ®µï¼Œä»¥åŠåˆ°è¾¾è¿™äº›ç›®çš„çš„æœ€ä½³è·¯å¾„</p>
</blockquote>
</li>
<li><p>å·¥ä½œåœ¨å“ªä¸€å±‚æŒ‡çš„æœ€é«˜èƒ½çœ‹æ‡‚é‚£ä¸€å±‚çš„å†…å®¹</p>
</li>
<li><p>å¯¹æ–¹ç‰©ç†å±‚æ”¶åˆ°æ¯”ç‰¹æµåï¼Œæ•°æ®é“¾è·¯å±‚çœ‹ç›®æ ‡macåœ°å€æ˜¯ç»™è‡ªå·±çš„ï¼Œç„¶ååˆ°ç½‘ç»œå±‚å»æ‰macåœ°å€å‰©ä¸‹IPæ•°æ®æŠ¥ï¼Œç„¶åæ•°æ®æŠ¥æŠŠIPåœ°å€å»æ‰ï¼ˆIPåœ°å€ï¼‰ç»™ä¼ è¾“å±‚ï¼Œä¼ è¾“å±‚æ’åºæ£€æŸ¥ä¸¢åŒ…åç»™åº”ç”¨å±‚</p>
</li>
</ul>
<hr>
<p>ç—…æ¯’æ˜¯ä¸€ä¸ªä»£ç ï¼Œä¹Ÿä¼šåˆ†æ®µä¼ ï¼Œè·¯ç”±å™¨åªèƒ½çœ‹åˆ°æ¯ä¸€æ®µæ‰€ä»¥ä¸­ä¸äº†ç—…æ¯’ï¼Œäº¤æ¢æœºä»¥åŠé›†çº¿å™¨ä¹Ÿä¸ä¼š</p>
<h3 id="1-7-TCP-IPåè®®æœ‰äº†è§£å—ï¼Ÿ"><a href="#1-7-TCP-IPåè®®æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="1.7 TCP/IPåè®®æœ‰äº†è§£å—ï¼Ÿ"></a>1.7 TCP/IPåè®®æœ‰äº†è§£å—ï¼Ÿ</h3><p>TCP/IP åè®®ä¸æ˜¯TCP å’ŒIP è¿™ä¸¤ä¸ªåè®®çš„åˆç§°ï¼Œè€Œæ˜¯æŒ‡å› ç‰¹ç½‘æ•´ä¸ªTCP/IP åè®®æ—ï¼Œæ˜¯ä¸€ç³»åˆ—ç½‘ç»œåè®®çš„æ€»ç§°ã€‚</p>
<p>TCP/IPåè®®æ¨¡å‹åœ¨OSIä¸ƒå±‚æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡åˆå¹¶çš„æ–¹å¼ï¼Œç®€åŒ–ä¸º<strong>å››å±‚</strong>ï¼Œåˆ†åˆ«ä¸º</p>
<ul>
<li><strong>åº”ç”¨å±‚</strong></li>
<li><strong>ä¼ è¾“å±‚</strong></li>
<li><strong>ç½‘ç»œå±‚</strong></li>
<li><strong>é“¾è·¯å±‚</strong></li>
</ul>
<h2 id="2-TCP-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹â­"><a href="#2-TCP-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹â­" class="headerlink" title="2. TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹â­"></a>2. TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹â­</h2><p>TCPåè®®æ˜¯ä¸€ç§å¯é çš„åè®®ï¼Œåœ¨æ­£å¼ä¼ è¾“æ•°æ®ä¹‹å‰å¿…é¡»é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥å¹¶ä¸”äº’ç›¸äº¤æ¢çª—å£å¤§å°ã€‚åœ¨ä¼ è¾“ç»“æŸä¹‹åï¼Œé€šè¿‡å››æ¬¡æŒ¥æ‰‹æ¥ç¡®è®¤åŒæ–¹éƒ½ç»“æŸæ•°æ®äº¤äº’ã€‚</p>
<h3 id="2-1-ä¸‰æ¬¡æ¡æ‰‹"><a href="#2-1-ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="2.1 ä¸‰æ¬¡æ¡æ‰‹"></a>2.1 ä¸‰æ¬¡æ¡æ‰‹</h3><ul>
<li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šä¸»æœºA å‘é€synï¼1,éšæœºäº§ç”Ÿseq=x(å¦‚1234567) çš„æ•°æ®åŒ…åˆ°æœåŠ¡å™¨ï¼Œä¸»æœºBç”±SYN=1 çŸ¥é“ï¼ŒA è¦æ±‚å»ºç«‹è”æœºï¼›</li>
<li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼š ä¸»æœºB æ”¶åˆ°è¯·æ±‚åè¦ç¡®è®¤è”æœºä¿¡æ¯ï¼Œ å‘A å‘é€ack=( ä¸»æœºA çš„seq+1),syn=1,ack=1,éšæœºäº§ç”Ÿseq=y(å¦‚7654321ï¼‰ çš„åŒ…</li>
<li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šä¸»æœºA æ”¶åˆ°åæ£€æŸ¥ackæ˜¯å¦æ­£ç¡®ï¼Œå³ç¬¬ä¸€æ¬¡å‘é€çš„seq +1,ä»¥åŠä½ç ACKæ˜¯å¦ä¸º1ï¼Œè‹¥æ­£ç¡®ï¼Œä¸»æœºA ä¼šå†å‘é€ack =(ä¸»æœºB çš„seq+1),ACK=1ï¼Œä¸»æœºB æ”¶åˆ°åç¡®è®¤</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_5_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_5_network.png" alt="img"></a></p>
<p><strong>åºåˆ—å·</strong>ï¼šTCPç¼“å­˜ä¸­å­—èŠ‚æµåˆ†æ•°æ®æ®µå‘ï¼Œåºå·æ˜¯è¿™ä¸ªæ•°æ®æ®µçš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯æ•´ä¸ªæ–‡ä»¶çš„ç¬¬å‡ ä¸ªå­—èŠ‚ï¼ˆ å¦‚æœä¼ è¾“çš„æ•°æ®å­—èŠ‚ä¸º0ï¼Œå³åªæœ‰é¦–éƒ¨ï¼Œé‚£åºåˆ—å·è¿˜å¢åŠ å—ï¼Ÿå½“syn æˆ– finè¢«ç½®1ï¼Œè™½ç„¶æŠ¥æ–‡é‡Œé•¿åº¦ä¸º0ï¼ˆåº”ç”¨å±‚çš„æ•°æ®å«æŠ¥æ–‡ï¼‰ï¼Œè®¡ç®—ackæ—¶æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå…¶é•¿åº¦ä¸º1ã€‚å…¶ä»–æƒ…å†µï¼ˆå¦‚åªæœ‰ackï¼‰ä¸å¢åŠ ï¼‰</p>
<p><strong>SYN åŒæ­¥åºåˆ—ç¼–å·</strong>(Synchronize Sequence Numbers) æ˜¯ TCP/IP å»ºç«‹è¿æ¥æ—¶ä½¿ç”¨çš„<strong>æ¡æ‰‹ä¿¡å·</strong>ã€‚</p>
<p><strong>ç¡®è®¤å·ack</strong>ï¼šæ ¹æ®æ”¶åˆ°çš„æ•°æ®åŒ…çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œç»™ä¿¡å·è¯´ä¸‹ä¸€ä¸ªè¯¥å‘å“ªä¸ªå­—èŠ‚äº†ï¼Œè¿™ä¸ªç¡®è®¤å·å°±æ˜¯ä¸‹ä¸€ä¸ªè¯¥å‘å¾—å­—èŠ‚å·</p>
<p><strong>ACK</strong>ï¼š0ç¡®è®¤å·æ— æ•ˆï¼Œ1ç¡®è®¤å·æœ‰æ•ˆ</p>
<blockquote>
<p>çŠ¶æ€å˜åŒ–:</p>
<ul>
<li>å®¢æˆ·ç«¯: Close-&gt;SYN_SENT-&gt;ESTABLISHED</li>
<li>æœåŠ¡ç«¯: Close-&gt;Listen-&gt;SYN_RCVD-&gt;EATABLISHED</li>
</ul>
</blockquote>
<h3 id="2-2-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ"><a href="#2-2-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ" class="headerlink" title="2.2 ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ"></a>2.2 ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</h3><p>ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯å»ºç«‹å¯é çš„é€šä¿¡ä¿¡é“ï¼Œä¸»è¦çš„ç›®çš„å°±æ˜¯åŒæ–¹ç¡®è®¤è‡ªå·±ä¸å¯¹æ–¹çš„å‘é€ä¸æ¥æ”¶æ˜¯æ­£å¸¸çš„ã€‚ <strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š<strong>è®©åŒæ–¹éƒ½è¯å®å¯¹æ–¹èƒ½å‘æ”¶</strong>ã€‚</p>
<ul>
<li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClient ä»€ä¹ˆéƒ½ä¸èƒ½ç¡®è®¤ï¼›Server ç¡®è®¤äº†å¯¹æ–¹å‘é€æ­£å¸¸ï¼Œè‡ªå·±æ¥æ”¶æ­£å¸¸</li>
<li>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šClient ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Server ç¡®è®¤äº†ï¼šå¯¹æ–¹å‘é€æ­£å¸¸ï¼Œè‡ªå·±æ¥æ”¶æ­£å¸¸</li>
<li>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClient ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Server ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸</li>
</ul>
<p>æ‰€ä»¥ä¸‰æ¬¡æ¡æ‰‹å°±èƒ½ç¡®è®¤åŒå‘æ”¶å‘åŠŸèƒ½éƒ½æ­£å¸¸ï¼Œç¼ºä¸€ä¸å¯ã€‚</p>
<h3 id="2-3-ä¸¤æ¬¡æ¡æ‰‹å¯ä»¥ä¹ˆï¼Ÿ"><a href="#2-3-ä¸¤æ¬¡æ¡æ‰‹å¯ä»¥ä¹ˆï¼Ÿ" class="headerlink" title="2.3 ä¸¤æ¬¡æ¡æ‰‹å¯ä»¥ä¹ˆï¼Ÿ"></a>2.3 ä¸¤æ¬¡æ¡æ‰‹å¯ä»¥ä¹ˆï¼Ÿ</h3><p>ä¸å¯ä»¥</p>
<blockquote>
<p>å‡å¦‚åªæœ‰å‰é¢ä¸¤æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°ç¬¬ä¸€æ¬¡æ¡æ‰‹ä¿¡å·ï¼Œå‘å‡ºç¬¬äºŒæ¬¡æ¡æ‰‹ä¿¡å·åå°±ä¼šå¼€å§‹å·¥ä½œã€‚</p>
</blockquote>
<ol>
<li>æœåŠ¡å™¨è§’åº¦ï¼šå¯èƒ½å®¢æˆ·ç«¯å‘é€çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹è¯·æ±‚ä¼ è¾“è¿‡ç¨‹ä¸­é˜»å¡ï¼Œå®¢æˆ·ç«¯ä¼šå†æ¬¡å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡å™¨å…ˆåæ¥æ”¶åˆ°ä¸¤æ¬¡è¯·æ±‚ï¼Œå¹¶æŒç»­ç­‰ä¸¤ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å‘é€æ•°æ®ï¼Œå…¶å®åªæœ‰ä¸€ä¸ªï¼ŒæœåŠ¡ç«¯å´æœ‰ä¸¤ä¸ªå“åº”ï¼Œæç«¯æƒ…å†µå¯èƒ½Nä¸ªï¼Œä¼šé€ æˆèµ„æºæµªè´¹ã€‚</li>
<li>å®¢æˆ·ç«¯è§’åº¦ï¼šå‡å¦‚å‘é€å»ºç«‹è¿æ¥çš„è¯·æ±‚é˜»å¡ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´å‘ç°æ²¡å›å¤ï¼Œç„¶åå†å‘ä¸€ä¸ªï¼ˆè¿™æ¬¡å¾ˆå¿«åˆ°è¾¾ï¼‰ï¼Œç„¶åç»™ç¡®è®¤ä¹Ÿå¾ˆå¿«ï¼Œ å°±å¼€å§‹å‘æ•°æ®ã€‚è¿‡äº†ä¸€ä¼šç¬¬ä¸€ä¸ªé˜»å¡çš„å»ºç«‹è¿æ¥çš„è¯·æ±‚ä¹Ÿåˆ°äº†ï¼Œå†ç»™ä¸€ä¸ªç¡®è®¤ç»™Aï¼Œç»“æœAä¸è®¤äº†ï¼Œåˆšå·²ç»æ”¶åˆ°ç¡®è®¤äº†ï¼Œå°±ä¸ç†äº†ï¼Œç„¶åBå°±å¾—ç­‰ç€ä¼ æ•°æ®ï¼ˆæ²¡æ”¶åˆ°æ•°æ®è¿‡ä¸€æ®µå°±é‡Šæ”¾äº†ï¼‰ï¼Œä¼šé€ æˆèµ„æºæµªè´¹ï¼Œæ‰€ä»¥éœ€è¦ç¬¬ä¸‰ä¸ªæ•°æ®åŒ…çš„ç¡®è®¤</li>
</ol>
<h3 id="2-4-ç¬¬2æ¬¡æ¡æ‰‹ä¼ å›äº†ACKï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼ å›SYNï¼Ÿ"><a href="#2-4-ç¬¬2æ¬¡æ¡æ‰‹ä¼ å›äº†ACKï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼ å›SYNï¼Ÿ" class="headerlink" title="2.4 ç¬¬2æ¬¡æ¡æ‰‹ä¼ å›äº†ACKï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼ å›SYNï¼Ÿ"></a>2.4 ç¬¬2æ¬¡æ¡æ‰‹ä¼ å›äº†ACKï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼ å›SYNï¼Ÿ</h3><p>æ¥æ”¶ç«¯ä¼ å›å‘é€ç«¯æ‰€å‘é€çš„ACKæ˜¯ä¸ºäº†å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œæˆ‘æ¥æ”¶åˆ°çš„ä¿¡æ¯ç¡®å®å°±æ˜¯ä½ æ‰€å‘é€çš„ä¿¡å·äº†ï¼Œè¿™è¡¨æ˜ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„é€šä¿¡æ˜¯æ­£å¸¸çš„ã€‚</p>
<p>è€Œå›ä¼ SYNåˆ™æ˜¯ä¸ºäº†å»ºç«‹å¹¶ç¡®è®¤ä»æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯çš„é€šä¿¡ï¼Œè¿˜è¦å®¢æˆ·ç«¯ç¡®è®¤æˆ‘çš„å‘é€æ˜¯å¦æ­£å¸¸ï¼ˆSYN=1äº†ackæ‰ä¸ºseq+1ï¼‰ã€‚</p>
<h3 id="2-5-å››æ¬¡æŒ¥æ‰‹"><a href="#2-5-å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="2.5 å››æ¬¡æŒ¥æ‰‹"></a>2.5 å››æ¬¡æŒ¥æ‰‹</h3><ul>
<li>ç¬¬ä¸€æ¬¡ï¼šä¸»æœºA è¯·æ±‚æ–­å¼€è¿æ¥ å‘é€FIN=1 seq=uåï¼Œè¿›å…¥ç»ˆæ­¢ç­‰å¾…çŠ¶æ€1ï¼Œ</li>
<li>ç¬¬äºŒæ¬¡ï¼š æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚åº”ç­”ï¼šACK=1,ack=u+1,seq=vï¼Œç„¶åæœåŠ¡å™¨B å°±è¿›å…¥å…³é—­ç­‰å¾…çŠ¶æ€ï¼Œæ­¤æ—¶TCP æœåŠ¡å™¨è¿›ç¨‹å°±é€šçŸ¥é«˜å±‚åº”ç”¨è¿›ç¨‹ï¼Œå› è€Œä»A åˆ°B çš„è¿æ¥å°±é‡Šæ”¾äº†ã€‚æ­¤æ—¶æ˜¯â€œåŠå…³é—­â€çŠ¶æ€ã€‚å³A ä¸å¯ä»¥å‘é€ç»™Bï¼Œä½†æ˜¯B å¯ä»¥å‘é€ç»™Aã€‚</li>
<li>ç¬¬ä¸‰æ¬¡ï¼šæ­¤æ—¶ï¼Œè‹¥B æ²¡æœ‰æ•°æ®æŠ¥è¦å‘é€ç»™A äº†ï¼Œå…¶åº”ç”¨è¿›ç¨‹å°±é€šçŸ¥TCP é‡Šæ”¾è¿æ¥ï¼Œ æœåŠ¡ç«¯è¯·æ±‚æ–­å¼€è¿æ¥ï¼šFIN=1ï¼ŒACK=1,seq=w,ack=u+1ï¼Œå¹¶ç­‰å¾…ç¡®è®¤ã€‚</li>
<li>ç¬¬å››æ¬¡ï¼š å®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯çš„è¯·æ±‚åº”ç­”ï¼š ACK=1ï¼Œseq=u+1ï¼Œack=w+1ï¼ŒA è¿›å…¥æ—¶é—´ç­‰å¾…ï¼Œæ³¨æ„ï¼Œæ­¤æ—¶TCP è¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾æ‰ï¼Œç„¶åç»è¿‡æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨è®¾ç½®çš„2MSL åï¼ŒA æ‰è¿›å…¥åˆ°å…³é—­çŠ¶æ€ã€‚</li>
</ul>
<p>ï¼ˆFINï¼šfinishï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_6_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_6_network.png" alt="img"></a></p>
<blockquote>
<p>çŠ¶æ€å˜åŒ–ï¼š</p>
<p>å®¢æˆ·ç«¯ï¼šESTABLISHED-&gt;FIN_WAIT_1-&gt;FIN_WAIT_2-&gt;TIME_WAIT-&gt;CLOSE</p>
<p>æœåŠ¡ç«¯ï¼šESTABLISHED-&gt;CLOSE_WAIT-&gt; LAST_ACK-&gt;CLOSE</p>
</blockquote>
<h3 id="2-7-ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ"><a href="#2-7-ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ" class="headerlink" title="2.7 ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ"></a>2.7 ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæœåŠ¡ç«¯å“åº”æ–­å¼€è¿æ¥çš„è¯·æ±‚æ—¶ï¼Œå…¶<strong>ACKå’ŒFINåŒ…å¹¶ä¸æ˜¯ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯çš„</strong>ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡ç”±å®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯çš„FINä¿¡å·è¡¨ç¤ºçš„æ˜¯å®¢æˆ·ç«¯æƒ³è¦æ–­å¼€è¿æ¥ã€‚æœåŠ¡ç«¯å…ˆç»™å‡ºACKç¡®è®¤ä¿¡å·ï¼Œè¡¨ç¤ºå·²ç»æ”¶åˆ°FINè¯·æ±‚ï¼Œç„¶åå½“è‡ªå·±ä¹Ÿå¯ä»¥ç»“æŸçš„æ—¶å€™ï¼Œå†æ¬¡å‘é€FINä¿¡å·ï¼Œæ‰€ä»¥éœ€è¦æŒ¥æ‰‹äº¤äº’éœ€è¦å››æ¬¡ã€‚</p>
<p>ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥åœ¨æ•°æ®ä¼ é€ç»“æŸåå‘å‡ºè¿æ¥é‡Šæ”¾çš„é€šçŸ¥ï¼Œå¾…å¯¹æ–¹ç¡®è®¤åè¿›å…¥åŠå…³é—­çŠ¶æ€ã€‚å½“å¦ä¸€æ–¹ä¹Ÿæ²¡æœ‰æ•°æ®å†å‘é€çš„æ—¶å€™ï¼Œåˆ™å‘å‡ºè¿æ¥é‡Šæ”¾é€šçŸ¥ï¼Œå¯¹æ–¹ç¡®è®¤åå°±å®Œå…¨å…³é—­äº†TCPè¿æ¥ã€‚</p>
<h3 id="2-8-å››æ¬¡æŒ¥æ‰‹ä¸»åŠ¨æ–¹ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…2MSL"><a href="#2-8-å››æ¬¡æŒ¥æ‰‹ä¸»åŠ¨æ–¹ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…2MSL" class="headerlink" title="2.8 å››æ¬¡æŒ¥æ‰‹ä¸»åŠ¨æ–¹ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…2MSL?"></a>2.8 å››æ¬¡æŒ¥æ‰‹ä¸»åŠ¨æ–¹ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…2MSL?</h3><p>ä¸»åŠ¨å…³é—­æ–¹åœ¨æ”¶åˆ°è¢«åŠ¨ä¸€æ–¹å‘å‡ºçš„FINä¿¡å·ï¼Œä¼šç«‹é©¬å‘é€ACKç¡®è®¤ä¿¡å·ï¼Œä¹‹åçŠ¶æ€è½¬å˜ä¸ºTIME_WAITï¼Œç­‰å¾…2MSLåæ‰ä¼šè¿›å…¥CLOSEçŠ¶æ€ã€‚</p>
<blockquote>
<p>MSLï¼ˆMaximum Segment Lifetimeï¼‰ï¼š</p>
<p>è¡¨ç¤ºæœ€å¤§æŠ¥æ–‡ç”Ÿå­˜å‘¨æœŸï¼Œä»»ä½•æŠ¥æ–‡åœ¨ç½‘ç»œä¸Šå­˜åœ¨çš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æŠ¥æ–‡å°†è¢«ä¸¢å¼ƒã€‚ï¼ˆ å»å‘ACKæ¶ˆæ¯æœ€å¤§å­˜æ´»æ—¶é—´ï¼ˆMSL) + æ¥å‘FINæ¶ˆæ¯çš„æœ€å¤§å­˜æ´»æ—¶é—´(MSL)=2MSLï¼‰</p>
</blockquote>
<p>Clientç«¯ç­‰å¾…äº†2MSLåä¾ç„¶æ²¡æœ‰æ”¶åˆ°å›å¤ï¼Œåˆ™è¯æ˜Serverç«¯å·²æ­£å¸¸å…³é—­ï¼Œé‚£å¥½ï¼Œæˆ‘Clientç«¯ä¹Ÿå¯ä»¥å…³é—­è¿æ¥äº†ï¼Œ ä¸»åŠ¨å…³é—­æ–¹éœ€è¦ç­‰å¾…2MSLæ˜¯ä¸ºäº†ï¼Œ<strong>é˜²æ­¢æœ€åä¸€æ¬¡ACKæ²¡æœ‰è¢«æ­£ç¡®çš„ä¼ ç»™è¢«åŠ¨æ–¹ï¼Œè¢«åŠ¨å…³é—­æ–¹ä¼šå†æ¬¡å‘é€ç¬¬ä¸‰æ¬¡çš„FINä¿¡å·</strong>ã€‚ï¼ˆè‹¥é‡å‘çš„åˆæ²¡åˆ°ï¼Œå®¢æˆ·ç«¯å°±å…³é—­äº†ï¼Œserveræœ€åå°±ä¼šå¼‚å¸¸å…³é—­è¿æ¥ï¼ŒæŠŠé“¾æ¥é”™è¯¯é—®é¢˜æŠ¥å‘Šç»™é«˜å±‚ï¼‰</p>
<h3 id="2-9-å·²ç»å»ºç«‹è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯æ•…éšœæ€ä¹ˆåŠï¼Ÿ"><a href="#2-9-å·²ç»å»ºç«‹è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯æ•…éšœæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="2.9 å·²ç»å»ºç«‹è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯æ•…éšœæ€ä¹ˆåŠï¼Ÿ"></a>2.9 å·²ç»å»ºç«‹è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯æ•…éšœæ€ä¹ˆåŠï¼Ÿ</h3><p>TCPè¿˜è®¾æœ‰ä¸€ä¸ª<strong>ä¿æ´»è®¡æ—¶å™¨</strong>ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚</p>
<p>æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯<strong>è®¾ç½®ä¸º2å°æ—¶</strong>ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”<strong>75</strong>ç§’å‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€<strong>10ä¸ªæ¢æµ‹æŠ¥æ–‡</strong>ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚</p>
<h2 id="3-TCP-UDP-åè®®çš„åŒºåˆ«â­"><a href="#3-TCP-UDP-åè®®çš„åŒºåˆ«â­" class="headerlink" title="3.TCP/UDP åè®®çš„åŒºåˆ«â­"></a>3.TCP/UDP åè®®çš„åŒºåˆ«â­</h2><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_7_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_7_network.png" alt="img"></a></p>
<ul>
<li>TCPåè®®è¿›è¡Œæ•°æ®é€šä¿¡ä¹‹å‰éœ€è¦<strong>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</strong>ï¼ŒUDPåè®®ä¸éœ€è¦å»ºç«‹è¿æ¥å³å¯å‘é€æ•°æ®ã€‚</li>
<li>TCPæœ‰<strong>ç¡®è®¤</strong>æœºåˆ¶ï¼Œä¸¢åŒ…å¯ä»¥é‡å‘ï¼Œä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ï¼›UDPä¸ä¿è¯æ­£ç¡®æ€§ï¼Œåªæ˜¯å•çº¯çš„è´Ÿè´£å‘é€æ•°æ®åŒ…ã€‚<strong>ä¼ è¾“å¯é æ€§</strong>åŒºåˆ«</li>
<li>TCPåè®®å¯èƒ½ä¼šå¯¹å¤§æ•°æ®åŒ…è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶ä¸”åœ¨æ¥æ”¶æ–¹è¿›è¡Œé‡ç»„æ•°æ®åŒ…æ“ä½œï¼›UDPåè®®æ˜¯é¢å‘æŠ¥æ–‡çš„ï¼Œä¸ä¼šè¿›è¡Œåˆ†ç‰‡å’Œé‡ç»„ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ä¼ è¾“çš„æŠ¥æ–‡å¤§å°ã€‚</li>
<li>ç½‘ç»œåŒ…ä¸­çš„TCPå¤´éƒ¨ä¸º20ä¸ªå­—èŠ‚ï¼›UDPå¤´éƒ¨åªæœ‰8ä¸ªå­—èŠ‚ã€‚</li>
</ul>
<blockquote>
<p>UDPï¼ˆä¸€èˆ¬ç”¨äºå³æ—¶é€šä¿¡ï¼‰ï¼Œæ¯”å¦‚ï¼š QQ è¯­éŸ³ã€ QQ è§†é¢‘ ã€ç›´æ’­ã€å±å¹•å¹¿æ’­ã€DNSã€å¤šæ’­ç­‰ç­‰</p>
<p>TCP æä¾›é¢å‘è¿æ¥çš„æœåŠ¡ã€‚åœ¨ä¼ é€æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ é€ç»“æŸåè¦é‡Šæ”¾è¿æ¥ã€‚ TCP ä¸€èˆ¬ç”¨äºæ–‡ä»¶ä¼ è¾“ã€å‘é€å’Œæ¥æ”¶é‚®ä»¶ã€è¿œç¨‹ç™»å½•ç­‰åœºæ™¯ã€‚</p>
</blockquote>
<h3 id="3-1-ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åŒ…æ‹¬å“ªäº›æœ‰äº†è§£å—ï¼Ÿ"><a href="#3-1-ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åŒ…æ‹¬å“ªäº›æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="3.1 ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åŒ…æ‹¬å“ªäº›æœ‰äº†è§£å—ï¼Ÿ"></a>3.1 ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åŒ…æ‹¬å“ªäº›æœ‰äº†è§£å—ï¼Ÿ</h3><p>ç½‘ç»œæ•°æ®åŒ…ä¸€èˆ¬åŒ…æ‹¬å¤´éƒ¨å’Œæ•°æ®éƒ¨åˆ†ï¼Œåœ¨TCPåè®®ä¸­ï¼Œè¦å‘é€çš„æ•°æ®ç»è¿‡TCPæ¨¡å—æ·»åŠ TCPå¤´éƒ¨ï¼›ç„¶åIPæ¨¡å—æ·»åŠ IPå¤´éƒ¨å’ŒMACå¤´éƒ¨ï¼ˆé“¾è·¯å±‚ï¼‰ï¼›ç„¶ååœ¨æœ€å‰é¢åŠ ä¸ŠæŠ¥å¤´/èµ·å§‹å¸§åˆ†ç•Œç¬¦ä»¥åŠæœ«å°¾å‡å¦‚FCSï¼ˆå¸§æ ¡éªŒåºåˆ—ï¼‰ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªå®Œæˆçš„æ•°æ®åŒ…ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_8_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_8_network.png" alt="img"></a></p>
<h3 id="3-2-æ¯ä¸€å±‚çš„æ•°æ®å«ä»€ä¹ˆåå­—ï¼Ÿ"><a href="#3-2-æ¯ä¸€å±‚çš„æ•°æ®å«ä»€ä¹ˆåå­—ï¼Ÿ" class="headerlink" title="3.2 æ¯ä¸€å±‚çš„æ•°æ®å«ä»€ä¹ˆåå­—ï¼Ÿ"></a>3.2 æ¯ä¸€å±‚çš„æ•°æ®å«ä»€ä¹ˆåå­—ï¼Ÿ</h3><p>æˆ‘ä»¬æŠŠåº”ç”¨å±‚äº¤äº’çš„æ•°æ®å•å…ƒç§°ä¸ºæŠ¥æ–‡</p>
<p>ä¼ è¾“å±‚ï¼šTCPå«æŠ¥æ–‡æ®µï¼ŒUDPå«ç”¨æˆ·æ•°æ®æŠ¥</p>
<p>ç½‘ç»œå±‚ï¼šæŠŠè¿è¾“å±‚çš„æŠ¥æ–‡æ®µæˆ–è€…ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„æˆ–è€…åŒ…ï¼Œä¹Ÿå«IPæ•°æ®æŠ¥ï¼ˆæ•°æ®æŠ¥ï¼‰</p>
<p>é“¾è·¯å±‚ï¼šå¸§</p>
<p>ç‰©ç†å±‚ï¼šæ¯”ç‰¹æµ</p>
<h3 id="3-3-TCPåè®®ä¸­çš„æ•°æ®åŒ…åˆ†ç‰‡ä¸é‡ç»„åŠŸèƒ½æœ‰äº†è§£å—ï¼Ÿ"><a href="#3-3-TCPåè®®ä¸­çš„æ•°æ®åŒ…åˆ†ç‰‡ä¸é‡ç»„åŠŸèƒ½æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="3.3 TCPåè®®ä¸­çš„æ•°æ®åŒ…åˆ†ç‰‡ä¸é‡ç»„åŠŸèƒ½æœ‰äº†è§£å—ï¼Ÿ"></a>3.3 TCPåè®®ä¸­çš„æ•°æ®åŒ…åˆ†ç‰‡ä¸é‡ç»„åŠŸèƒ½æœ‰äº†è§£å—ï¼Ÿ</h3><p>å½“TCPä¼ è¾“çš„æ•°æ®åŒ…æ¯”è¾ƒå¤§æ—¶ï¼Œåœ¨å‘é€æ–¹ä¼šè¿›è¡Œåˆ†ç‰‡ï¼Œåœ¨æ¥æ”¶æ–¹è¿›è¡Œæ•°æ®åŒ…çš„é‡ç»„ã€‚</p>
<ul>
<li><p>å‘é€æ–¹ï¼š</p>
<p>å°†æ•°æ®åŒ…åˆ†ä¸ºå¤šä¸ª<strong>TCPå¤´éƒ¨+æ•°æ®åŒ…</strong>çš„ç»„åˆï¼ŒTCPå¤´éƒ¨ä¸­å­˜ç€ä¸åŒçš„<strong>æ•°æ®åºå·</strong>ï¼›ä¹‹åå°†å¤šä¸ªç»„åˆäº¤ç”±IPæ¨¡å—ï¼Œ<strong>ç»Ÿä¸€æ·»åŠ IPå¤´éƒ¨å’ŒMACå¤´éƒ¨</strong>ï¼ŒIPå¤´éƒ¨çš„<strong>IDå·</strong>è®¾ä¸ºç»Ÿä¸€çš„ã€‚</p>
</li>
<li><p>æ¥æ”¶æ–¹ï¼š</p>
<p>IPæ¨¡å—å…·æœ‰åˆ†ç‰‡é‡ç»„çš„åŠŸèƒ½ï¼Œå¦‚æœæ¥æ”¶åˆ°çš„åŒ…æ˜¯ç»è¿‡åˆ†ç‰‡çš„ï¼Œé‚£ä¹ˆIPæ¨¡å—ä¼šå°†å®ƒä»¬è¿˜åŸæˆåŸå§‹çš„åŒ…ã€‚åˆ†ç‰‡çš„åŒ…ä¼šåœ¨<strong>IPå¤´éƒ¨</strong>çš„æ ‡å¿—å­—æ®µä¸­è¿›è¡Œæ ‡è®°ï¼Œå½“æ”¶åˆ°åˆ†ç‰‡çš„åŒ…æ—¶ï¼ŒIPæ¨¡å—ä¼šå°†å…¶æš‚æ—¶å­˜åœ¨å†…éƒ¨çš„å†…å­˜ç©ºé—´ä¸­ï¼Œç„¶åç­‰å¾…IPå¤´éƒ¨ä¸­<strong>å…·æœ‰ç›¸åŒIDçš„åŒ…</strong>å…¨éƒ¨åˆ°è¾¾ã€‚æ­¤å¤–ï¼ŒIPå¤´éƒ¨è¿˜æœ‰ä¸€ä¸ª<strong>åˆ†ç‰‡åç§»é‡</strong>çš„å­—æ®µï¼Œå®ƒè¡¨ç¤ºå½“å‰åˆ†ç‰‡åœ¨æ•´ä¸ªåŒ…ä¸­æ‰€å¤„çš„ä½ç½®ã€‚æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œåœ¨æ‰€æœ‰çš„åˆ†ç‰‡å…¨éƒ¨æ”¶åˆ°ä¹‹åï¼Œå°±å¯ä»¥å°†å®ƒä»¬è¿˜åŸæˆåŸå§‹çš„åŒ…ã€‚</p>
</li>
</ul>
<blockquote>
<p>é“¾è·¯å±‚MTU(Maximum Transmission Unit)ï¼šæ¯ä¸€ç§ç‰©ç†ç½‘ç»œéƒ½ä¼šè§„å®šé“¾è·¯å±‚æ•°æ®å¸§çš„æœ€å¤§é•¿åº¦ã€‚IPåè®®åœ¨ä¼ è¾“æ•°æ®åŒ…æ—¶ï¼Œè‹¥IPæ•°æ®æŠ¥åŠ ä¸Šæ•°æ®å¸§å¤´éƒ¨åé•¿åº¦å¤§äºMTUï¼Œåˆ™å°†æ•°æ®æŠ¥æ–‡åˆ†ä¸ºè‹¥å¹²åˆ†ç‰‡è¿›è¡Œä¼ è¾“ï¼Œå¹¶åœ¨ç›®æ ‡ç³»ç»Ÿä¸­è¿›è¡Œé‡ç»„ã€‚</p>
</blockquote>
<blockquote>
<p>MSSï¼šæ˜¯TCPæ•°æ®åŒ…æ¯æ¬¡èƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æŠ¥æ–‡åˆ†æ®µã€‚</p>
</blockquote>
<h3 id="3-4-TCPç²˜åŒ…"><a href="#3-4-TCPç²˜åŒ…" class="headerlink" title="3.4 TCPç²˜åŒ…"></a>3.4 TCPç²˜åŒ…</h3><p>TCPç²˜åŒ…æ˜¯æŒ‡ä¸€ç§å‘é€æ–¹å‘é€çš„æ•°æ®åŒ…åœ¨æ¥æ”¶æ–¹çš„ç¼“å†²åŒºä¸­ç²˜æˆäº†ä¸€åŒ…ï¼Œä¹Ÿå°±æ˜¯å‡ºç°äº†æ•°æ®åŒ…é¦–å°¾ç›¸æ¥çš„ç°è±¡ã€‚</p>
<ul>
<li>äº§ç”ŸåŸå› ï¼šä¸»è¦æ˜¯å‘é€æ–¹ä½¿ç”¨äº†Nagleç®—æ³•ï¼Œæˆ–è€…æ¥æ”¶æ–¹çš„å¤„ç†é€Ÿåº¦å°äºæ•°æ®åŒ…çš„æ¥æ”¶é€Ÿåº¦ï¼Œå¯¼è‡´æ¥æ”¶ç¼“å†²åŒºä¸­æ¶ˆæ¯å †ç§¯ã€‚</li>
<li>è§£å†³æ–¹æ³•ï¼šå¯ä»¥é€šè¿‡å…³é—­Nagleç®—æ³•æˆ–è€…è§„å®šæ¯ä¸ªæ•°æ®åŒ…çš„å…·ä½“æ ¼å¼å’Œé•¿åº¦ï¼Œåœ¨æ¥æ”¶æ–¹çš„åº”ç”¨å±‚æ¥è¿›è¡Œåˆ¤æ–­</li>
</ul>
<p>è¿˜æœ‰UDPæ˜¯ä¸ä¼šäº§ç”Ÿç²˜åŒ…ç°è±¡çš„ï¼Œå› ä¸ºæ•°æ®åŒ…ä¹‹é—´å…·æœ‰æ˜ç¡®çš„æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œã€‚</p>
<h2 id="4-TCP-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼ˆå¦‚ä½•ç”¨UDPå®ç°å¯é ä¼ è¾“ï¼‰"><a href="#4-TCP-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼ˆå¦‚ä½•ç”¨UDPå®ç°å¯é ä¼ è¾“ï¼‰" class="headerlink" title="4. TCP åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼ˆå¦‚ä½•ç”¨UDPå®ç°å¯é ä¼ è¾“ï¼‰"></a>4. TCP åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼ˆå¦‚ä½•ç”¨UDPå®ç°å¯é ä¼ è¾“ï¼‰</h2><ul>
<li><p><strong>ç¡®è®¤</strong>ï¼š</p>
<p>TCPé¦–éƒ¨çš„ç¡®è®¤å·æ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚å‘é€æ–¹ç¼“å­˜åŒºä¼šç»§ç»­å­˜å‚¨å“ªäº›å·²å‘é€ä½†æ˜¯æœªæ”¶åˆ°ç¡®è®¤çš„æŠ¥æ–‡æ®µï¼Œä»¥ä¾¿é‡ä¼ ã€‚</p>
<p>TCPé»˜è®¤ä½¿ç”¨<strong>ç´¯è®¡ç¡®è®¤</strong>ï¼Œå³æ¥æ”¶æ–¹ä¸å¿…å¯¹æ”¶åˆ°çš„åˆ†ç»„é€ä¸ªå‘é€ç¡®è®¤ï¼Œè€Œæ˜¯åœ¨æ”¶åˆ°å‡ ä¸ªåˆ†ç»„åï¼Œå¯¹<strong>æŒ‰åº</strong>åˆ°è¾¾çš„æœ€åä¸€ä¸ªåˆ†ç»„å‘é€ç¡®è®¤ï¼ˆä¸­é—´æ²¡åˆ°çš„å¯èƒ½ä¸¢äº†ä¹Ÿå¯èƒ½é˜»å¡è¿˜æ²¡åˆ°ï¼‰ï¼Œè¿™å°±è¡¨ç¤ºåˆ°è¿™ä¸ªåˆ†ç»„ä¸ºæ­¢çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²ç»æ­£ç¡®æ”¶åˆ°äº†ã€‚ï¼ˆä½†æ˜¯ä¸ä¼šç«‹å³å‘é€è¿™ä¸ªç¡®è®¤å·çš„æ•°æ®åŒ…ï¼Œå› ä¸ºå…¶æœ‰å¯èƒ½åªæ˜¯é˜»å¡äº†è¿˜èƒ½åˆ°ï¼Œä¼šç­‰åˆ°è¿™ä¸ªæŠ¥æ–‡æ®µè®¾ç½®çš„é‡ä¼ æ—¶é—´åˆ°äº†è¿˜æ²¡æ”¶åˆ°ç¡®è®¤å°±é‡ä¼ ï¼‰</p>
</li>
<li><p><strong>é‡ä¼ ï¼š</strong>ä¸¤ç§äº‹ä»¶ä¼šå¯¼è‡´TCPå¯¹æŠ¥æ–‡æ®µçš„é‡ä¼ ï¼šè¶…æ—¶å’Œå†—ä½™ACKã€‚</p>
<ul>
<li>è¶…æ—¶ï¼šTCPæ¯å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œå°±å¯¹è¿™ä¸ªæŠ¥æ–‡æ®µè®¾ç½®ä¸€æ¬¡è®¡æ—¶å™¨ï¼Œè®¡æ—¶å™¨è®¾ç½®çš„é‡ä¼ æ—¶é—´åˆ°æœŸä½†è¿˜æœªæ”¶åˆ°ç¡®è®¤ï¼Œå°±é‡ä¼ ã€‚</li>
<li>å†—ä½™ACKï¼šè¶…æ—¶è§¦å‘é‡ä¼ çš„å‘¨æœŸå¾€å¾€å¤ªé•¿ã€‚TCPè§„å®šæ¯å½“æ¯”æœŸæœ›åºå·æ›´å¤§çš„å¤±åºæŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œå°±å‘é€ä¸€ä¸ªå†—ä½™ACKï¼ˆå†æ¬¡ç¡®è®¤æŸä¸ªæŠ¥æ–‡æ®µçš„ACKï¼Œä¹‹å‰å·²ç»æ”¶åˆ°è¿‡ï¼‰ï¼ŒTCPè§„å®šå½“å‘é€æ–¹æ¥æ”¶åˆ°å¯¹åŒä¸€æŠ¥æ–‡æ®µçš„3ä¸ªå†—ä½™ACKæ—¶ï¼Œå¯ä»¥è®¤ä¸ºè¿™ä¸ªæŠ¥æ–‡æ®µå·²ç»ä¸¢å¤±ï¼Œç«‹å³æ‰§è¡Œé‡ä¼ ï¼Œä¹Ÿç§°<strong>å¿«é€Ÿé‡ä¼ </strong>ã€‚</li>
</ul>
</li>
<li><p><strong>åºåˆ—å·</strong>ï¼šTCP ç»™ æ¯ä¸ªå­—èŠ‚çš„æ•°æ®éƒ½è¿›è¡Œäº†ç¼–å·ï¼Œå³åºåˆ—å·ã€‚</p>
<p>TCPä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡æ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åï¼Œéƒ½ä¼šå¯¹ä¼ è¾“æ–¹è¿›è¡Œç¡®è®¤åº”ç­”ï¼Œ ä¹Ÿå°±æ˜¯å‘é€ACKæŠ¥æ–‡ã€‚è¿™ä¸ªACKæŠ¥æ–‡å½“ä¸­å¸¦æœ‰å¯¹åº”çš„ç¡®è®¤åºåˆ—å·ï¼Œå‘Šè¯‰å‘é€æ–¹ï¼Œæ¥æ”¶åˆ°äº†å“ªäº›æ•°æ®ï¼Œä¸‹ä¸€æ¬¡çš„æ•°æ®ä»å“ªé‡Œå‘ï¼ˆå¯¹ä¸¢åŒ…çš„ä¼šé‡ä¼ ï¼‰ã€‚æ¥æ”¶æ–¹æ ¹æ®ç¼–å·ä¼šä¸¢å¼ƒé‡å¤ç¼–å·çš„æ•°æ®ï¼ˆå¦‚è¶…æ—¶é‡ä¼ ä¸­è‹¥æ˜¯å› ä¸ºåº”ç­”ä¿¡å·ä¸¢å¤±ï¼Œåˆ™ä¼šå†ä¼ é‡å¤çš„æ•°æ®ï¼‰ï¼ŒæŠŠæœ‰åºæ•°æ®ä¼ é€ç»™åº”ç”¨å±‚ã€‚</p>
</li>
<li><p><strong>æ ¡éªŒå’Œ</strong>ï¼š ç›®çš„æ˜¯æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ã€‚å¦‚æœæ”¶åˆ°æ®µçš„æ£€éªŒå’Œæœ‰å·®é”™ï¼ŒTCP å°†ä¸¢å¼ƒè¿™ä¸ªæŠ¥æ–‡æ®µå’Œä¸ç¡®è®¤æ”¶åˆ°æ­¤æŠ¥æ–‡æ®µã€‚</p>
</li>
</ul>
<blockquote>
<p>æ ¡éªŒå’Œçš„è®¡ç®—æ–¹å¼ï¼šåœ¨æ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œå°†å‘é€çš„æ•°æ®æ®µéƒ½å½“åšä¸€ä¸ª16ä½çš„æ•´æ•°ã€‚å°†è¿™äº›æ•´æ•°åŠ èµ·æ¥ã€‚å¹¶ä¸”å‰é¢çš„è¿›ä½ä¸èƒ½ä¸¢å¼ƒï¼Œè¡¥åœ¨åé¢ï¼Œæœ€åå–åï¼Œå¾—åˆ°æ ¡éªŒå’Œã€‚</p>
<p>å‘é€æ–¹ï¼šåœ¨å‘é€æ•°æ®ä¹‹å‰è®¡ç®—æ£€éªŒå’Œï¼Œå¹¶è¿›è¡Œæ ¡éªŒå’Œçš„å¡«å……ã€‚</p>
<p>æ¥æ”¶æ–¹ï¼šæ”¶åˆ°æ•°æ®åï¼Œå¯¹æ•°æ®ä»¥åŒæ ·çš„æ–¹å¼è¿›è¡Œè®¡ç®—ï¼Œæ±‚å‡ºæ ¡éªŒå’Œï¼Œä¸å‘é€æ–¹çš„è¿›è¡Œæ¯”å¯¹</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_9_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_9_network.png" alt="img"></a></p>
<blockquote>
<p>å¦‚æœæ¥æ”¶æ–¹æ¯”å¯¹æ ¡éªŒå’Œä¸å‘é€æ–¹ä¸ä¸€è‡´ï¼Œæ•°æ®ä¸€å®šä¼ è¾“æœ‰è¯¯ã€‚</p>
<p>å¦‚æœæ¥æ”¶æ–¹æ¯”å¯¹æ ¡éªŒå’Œä¸å‘é€æ–¹ä¸€è‡´ï¼Œæ•°æ®ä¸ä¸€å®šä¼ è¾“æˆåŠŸã€‚</p>
</blockquote>
<p>æ­¤å¤–ï¼ŒTCPåè®®è¿˜é€šè¿‡</p>
<ul>
<li>æµé‡æ§åˆ¶</li>
<li>æ‹¥å¡æ§åˆ¶</li>
<li>ARQåè®®</li>
</ul>
<p>ä¿è¯ä¼ è¾“çš„å¯é æ€§ã€‚</p>
<h3 id="4-1-TCP-æµé‡æ§åˆ¶"><a href="#4-1-TCP-æµé‡æ§åˆ¶" class="headerlink" title="4.1 TCP æµé‡æ§åˆ¶"></a>4.1 TCP æµé‡æ§åˆ¶</h3><p>TCP è¿æ¥çš„æ¯ä¸€æ–¹éƒ½æœ‰å›ºå®šå¤§å°çš„ç¼“å†²ç©ºé—´ï¼ŒTCPçš„æ¥æ”¶ç«¯åªå…è®¸å‘é€ç«¯å‘é€æ¥æ”¶ç«¯ç¼“å†²åŒºèƒ½æ¥çº³çš„æ•°æ®ã€‚å½“æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†å‘é€æ–¹çš„æ•°æ®ï¼Œèƒ½æç¤ºå‘é€æ–¹é™ä½å‘é€çš„é€Ÿç‡ï¼Œé˜²æ­¢åŒ…ä¸¢å¤±ã€‚</p>
<p>TCP åˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ï¼Œåœ¨ä¸‰æ¬¡æ¡æ‰‹é˜¶æ®µï¼ŒåŒæ–¹äº’ç›¸å°†è‡ªå·±çš„<strong>æ•°æ®æ¥æ”¶ç¼“å†²æ± å¤§å°</strong>å‘Šè¯‰å¯¹æ–¹ã€‚ <strong>æ¥æ”¶æ–¹æœ‰å³æ—¶çª—å£</strong>ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ï¼Œ çª—å£å¤§å°çš„å†…å®¹ å®é™…ä¸Šæ˜¯æ¥æ”¶ç«¯æ¥æ”¶æ•°æ®ç¼“å†²åŒºçš„å‰©ä½™å¤§å°ï¼Œè€Œä¸”æ¥æ”¶ç«¯ä¼šåœ¨ç¡®è®¤åº”ç­”å‘é€ACKæŠ¥æ–‡æ—¶ï¼Œå°†è‡ªå·±çš„å³æ—¶çª—å£å¤§å°å¡«å…¥ï¼Œå¹¶è·ŸéšACKæŠ¥æ–‡ä¸€èµ·å‘é€è¿‡å»ã€‚åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå½“æ¥æ”¶ç¼“å†²æ± çš„å¤§å°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¦ç»™å¯¹æ–¹å‘é€æ›´æ–°çª—å£å¤§å°çš„é€šçŸ¥ã€‚ å‘é€æ–¹æ ¹æ®ACKæŠ¥æ–‡é‡Œçš„çª—å£å¤§å°çš„å€¼çš„æ”¹å˜è¿›è€Œæ”¹å˜è‡ªå·±çš„å‘é€é€Ÿåº¦ï¼Œ å¦‚æœæ¥æ”¶åˆ°çª—å£å¤§å°çš„å€¼ä¸º0ï¼Œé‚£ä¹ˆå‘é€æ–¹å°†åœæ­¢å‘é€æ•°æ®ã€‚å¹¶å®šæœŸçš„å‘æ¥æ”¶ç«¯å‘é€çª—å£æ¢æµ‹æ•°æ®æ®µï¼Œè®©æ¥æ”¶ç«¯æŠŠçª—å£å¤§å°å‘Šè¯‰å‘é€ç«¯ã€‚</p>
<p>é‚£ä¹ˆ<strong>å‘é€æ–¹</strong>å°±å¯ä»¥ç»´æŠ¤ä¸€ä¸ªç§°ä¸º<strong>æ¥æ”¶çª—å£</strong>çš„å˜é‡å®ç°æµé‡æ§åˆ¶ã€‚</p>
<h3 id="4-2-TCP-æ‹¥å¡æ§åˆ¶"><a href="#4-2-TCP-æ‹¥å¡æ§åˆ¶" class="headerlink" title="4.2 TCP æ‹¥å¡æ§åˆ¶"></a>4.2 TCP æ‹¥å¡æ§åˆ¶</h3><p>é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½ã€‚</p>
<p>å‘é€æ–¹ç»´æŒä¸€ä¸ªæ‹¥å¡çª—å£cwndçš„çŠ¶æ€å˜é‡ï¼Œæ‹¥å¡çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ï¼Œåªè¦ç½‘ç»œæ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å†å¢å¤§ä¸€äº›ï¼Œä»¥ä¾¿æŠŠæ›´å¤šçš„åˆ†ç»„å‘é€å‡ºå»ã€‚ä½†åªè¦ç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å‡å°ä¸€äº›ï¼Œä»¥å‡å°‘æ³¨å…¥åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ã€‚</p>
<blockquote>
<p>å‘é€çª—å£çš„ä¸Šé™ä¸ºæ¥æ”¶çª—å£å’Œæ‹¥å¡çª—å£ä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚</p>
</blockquote>
<p><strong>æ‹¥å¡æ§åˆ¶ä¸æµé‡æ§åˆ¶çš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li>æ‹¥å¡æ§åˆ¶æ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„è¿‡ç¨‹ï¼Œæ¶‰åŠåˆ°æ‰€æœ‰çš„ä¸»æœºï¼Œæ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œä»¥åŠä¸é™ä½ç½‘ç»œä¼ è¾“æ€§èƒ½æœ‰å…³çš„æ‰€æœ‰å› ç´ ã€‚</li>
<li>æµé‡æ§åˆ¶å¾€å¾€æ˜¯ç‚¹å¯¹ç‚¹é€šä¿¡é‡çš„æ§åˆ¶ï¼Œæ˜¯ä¸ªç«¯åˆ°ç«¯çš„é—®é¢˜ã€‚æµé‡æ§åˆ¶æ‰€è¦åšåˆ°çš„å°±æ˜¯æŠ‘åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥ä¾¿ä½¿æ¥æ”¶ç«¯æ¥å¾—åŠæ¥æ”¶ã€‚</li>
</ul>
<p>TCPçš„æ‹¥å¡æ§åˆ¶é‡‡ç”¨äº†å››ç§ç®—æ³•ï¼Œå³ <strong>æ…¢å¼€å§‹</strong> ã€ <strong>æ‹¥å¡é¿å…</strong> ã€<strong>å¿«é‡ä¼ </strong> å’Œ <strong>å¿«æ¢å¤</strong></p>
<ul>
<li><strong>æ…¢å¼€å§‹ï¼š</strong> æ…¢å¼€å§‹ç®—æ³•çš„æ€è·¯æ˜¯å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå¦‚æœç«‹å³æŠŠå¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥åˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¼•èµ·ç½‘ç»œé˜»å¡ï¼Œå› ä¸ºç°åœ¨è¿˜ä¸çŸ¥é“ç½‘ç»œçš„è´Ÿè·æƒ…å†µã€‚ç»éªŒè¡¨æ˜ï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯å…ˆæ¢æµ‹ä¸€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯ç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚cwndåˆå§‹å€¼ä¸º1ï¼ˆæœ€å¤§ä¸€ä¸ªæŠ¥æ–‡æ®µçš„é•¿åº¦ï¼‰ï¼Œæ¯ç»è¿‡ä¸€ä¸ªä¼ æ’­è½®æ¬¡ï¼ˆå³å¾€è¿”æ—¶é—´ï¼‰ï¼ŒcwndåŠ å€ï¼ŒæŒ‡æ•°å‹å¢é•¿ï¼Œä¸€ç›´åˆ°è§„å®šçš„æ…¢å¼€å§‹é—¨é™ï¼Œç„¶åæ”¹ç”¨æ‹¥å¡é¿å…ç®—æ³•ã€‚</li>
<li><strong>æ‹¥å¡é¿å…ï¼š</strong> æ‹¥å¡é¿å…ç®—æ³•çš„æ€è·¯æ˜¯è®©æ‹¥å¡çª—å£cwndç¼“æ…¢å¢å¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªå¾€è¿”æ—¶é—´RTTå°±æŠŠå‘é€æ”¾çš„cwndåŠ 1ï¼ŒæŒ‰ç…§çº¿æ€§å¢é•¿ã€‚ï¼ˆå³åŠ æ³•å¢å¤§ï¼‰ã€‚å½“å‡ºç°ä¸€æ¬¡è¶…æ—¶ï¼ˆç½‘ç»œæ‹¥å¡æ—¶ï¼‰ã€‚ä»¤æ…¢å¼€å§‹é—¨é™ä¸ºå½“å‰cwndçš„ä¸€åŠï¼Œcwndé‡ç½®ä¸º1ï¼Œæ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼ˆå³ä¹˜æ³•å‡å°ï¼‰</li>
<li><strong>å¿«é‡ä¼ ä¸å¿«æ¢å¤FRRï¼š</strong><ul>
<li>å¿«é‡ä¼ ï¼šä½¿ç”¨å†—ä½™ACKæ¥æ£€æµ‹ä¸¢åŒ…çš„å‘ç”Ÿã€‚å†—ä½™ACKä¹Ÿç”¨äºç½‘ç»œæ‹¥å¡çš„æ£€æµ‹ï¼ˆä¸¢åŒ…å½“ç„¶æ„å‘³ç€ç½‘ç»œå¯èƒ½å‡ºç°äº†æ‹¥å¡ï¼‰ã€‚</li>
<li>å¿«æ¢å¤ï¼šæ”¶åˆ°ä¸‰ä¸ªå†—ä½™ACKï¼Œæ‰§è¡Œä¹˜æ³•å‡å°ï¼ŒæŠŠæ…¢å¼€å§‹é—¨é™å‡ä¸ºå½“å‰cwndçš„ä¸€åŠï¼Œä½†æ˜¯cwndä¸ç½®ä¸º1ï¼Œç½®ä¸ºæ–°çš„æ…¢å¼€å§‹é—¨é™å€¼ï¼ˆå³å‡åŠï¼‰ï¼Œç„¶åæ‰§è¡ŒåŠ æ³•å¢å¤§ã€‚ç”±äºè·³è¿‡äº†cwndä»1å¼€å§‹çš„æ…¢å¼€å§‹è¿‡ç¨‹æ‰€ä»¥ç§°ä¸ºå¿«æ¢å¤ã€‚</li>
</ul>
</li>
</ul>
<p><strong>å°ç»“</strong>ï¼šå½“å‘é€æ–¹æ£€æµ‹åˆ°è¶…æ—¶çš„æ—¶å€™ï¼Œé‡‡ç”¨æ…¢å¼€å§‹+æ‹¥å¡é¿å…ï¼Œå½“å‘é€æ–¹æ¥æ”¶åˆ°å†—ä½™ACKæ—¶ï¼Œé‡‡ç”¨å¿«é‡ä¼ +å¿«æ¢å¤</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_10_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_10_network.png" alt="img"></a></p>
<h3 id="4-3-ARQåè®®"><a href="#4-3-ARQåè®®" class="headerlink" title="4.3 ARQåè®®"></a>4.3 ARQåè®®</h3><p><strong>è‡ªåŠ¨é‡ä¼ è¯·æ±‚</strong>ï¼ˆAutomatic Repeat-reQuestï¼ŒARQï¼‰æ˜¯OSIæ¨¡å‹ä¸­<strong>æ•°æ®é“¾è·¯å±‚å’Œä¼ è¾“å±‚</strong>çš„é”™è¯¯çº æ­£åè®®ä¹‹ä¸€ã€‚ä½¿ç”¨äº†<strong>ç¡®è®¤å’Œè¶…æ—¶</strong>çš„ä¸¤ä¸ªæœºåˆ¶ã€‚</p>
<p>ARQåŒ…æ‹¬ï¼š</p>
<ul>
<li>åœæ­¢ç­‰å¾…ARQåè®®</li>
<li>è¿ç»­ARQåè®®ã€‚</li>
</ul>
<blockquote>
<p>åœæ­¢ç­‰å¾…ARQåè®®</p>
</blockquote>
<ul>
<li><p>åœæ­¢ç­‰å¾…åè®®ï¼šæ¯å‘å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ï¼ˆå›å¤ACKï¼‰ã€‚å¦‚æœè¿‡äº†ä¸€æ®µæ—¶é—´ï¼ˆè¶…æ—¶æ—¶é—´åï¼‰ï¼Œè¿˜æ˜¯æ²¡æœ‰æ”¶åˆ° ACK ç¡®è®¤ï¼Œè¯´æ˜æ²¡æœ‰å‘é€æˆåŠŸï¼Œéœ€è¦é‡æ–°å‘é€ï¼Œç›´åˆ°æ”¶åˆ°ç¡®è®¤åå†å‘ä¸‹ä¸€ä¸ªåˆ†ç»„ï¼›</p>
</li>
<li><p>åœ¨åœæ­¢ç­‰å¾…åè®®ä¸­ï¼Œè‹¥æ¥æ”¶æ–¹æ”¶åˆ°é‡å¤åˆ†ç»„ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ï¼Œä½†åŒæ—¶è¿˜è¦å‘é€ç¡®è®¤ï¼›</p>
</li>
<li><p>ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼š ç®€å•</li>
<li>ç¼ºç‚¹ï¼š ä¿¡é“åˆ©ç”¨ç‡ä½ï¼Œç­‰å¾…æ—¶é—´é•¿</li>
</ul>
</li>
<li><p>å‡ ç§å…·ä½“æƒ…å†µï¼š</p>
<ul>
<li><p>æ— å·®é”™æƒ…å†µ:</p>
<p>å‘é€æ–¹å‘é€åˆ†ç»„,æ¥æ”¶æ–¹åœ¨è§„å®šæ—¶é—´å†…æ”¶åˆ°,å¹¶ä¸”å›å¤ç¡®è®¤.å‘é€æ–¹å†æ¬¡å‘é€ã€‚</p>
</li>
<li><p>å‡ºç°å·®é”™æƒ…å†µï¼ˆè¶…æ—¶é‡ä¼ ï¼‰:</p>
<p>åœæ­¢ç­‰å¾…åè®®ä¸­è¶…æ—¶é‡ä¼ æ˜¯æŒ‡åªè¦è¶…è¿‡ä¸€æ®µæ—¶é—´ä»ç„¶æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±é‡ä¼ å‰é¢å‘é€è¿‡çš„åˆ†ç»„ï¼ˆè®¤ä¸ºåˆšæ‰å‘é€è¿‡çš„åˆ†ç»„ä¸¢å¤±äº†ï¼‰ã€‚å› æ­¤æ¯å‘é€å®Œä¸€ä¸ªåˆ†ç»„éœ€è¦è®¾ç½®ä¸€ä¸ªè¶…æ—¶è®¡æ—¶å™¨ï¼Œå…¶é‡ä¼ æ—¶é—´åº”æ¯”æ•°æ®åœ¨åˆ†ç»„ä¼ è¾“çš„å¹³å‡å¾€è¿”æ—¶é—´æ›´é•¿ä¸€äº›ã€‚è¿™ç§è‡ªåŠ¨é‡ä¼ æ–¹å¼å¸¸ç§°ä¸º è‡ªåŠ¨é‡ä¼ è¯·æ±‚ ARQ ã€‚å¦å¤–åœ¨åœæ­¢ç­‰å¾…åè®®ä¸­è‹¥æ”¶åˆ°é‡å¤åˆ†ç»„ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ï¼Œä½†åŒæ—¶è¿˜è¦å‘é€ç¡®è®¤ã€‚</p>
</li>
<li><p>ç¡®è®¤ä¸¢å¤±å’Œç¡®è®¤è¿Ÿåˆ°</p>
<ul>
<li>ç¡®è®¤ä¸¢å¤± ï¼šç¡®è®¤æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸¢å¤±ã€‚å½“Aå‘é€M1æ¶ˆæ¯ï¼ŒBæ”¶åˆ°åï¼ŒBå‘Aå‘é€äº†ä¸€ä¸ªM1ç¡®è®¤æ¶ˆæ¯ï¼Œä½†å´åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚è€ŒAå¹¶ä¸çŸ¥é“ï¼Œåœ¨è¶…æ—¶è®¡æ—¶è¿‡åï¼ŒAé‡ä¼ M1æ¶ˆæ¯ï¼ŒBå†æ¬¡æ”¶åˆ°è¯¥æ¶ˆæ¯åé‡‡å–ä»¥ä¸‹ä¸¤ç‚¹æªæ–½ï¼š1. ä¸¢å¼ƒè¿™ä¸ªé‡å¤çš„M1æ¶ˆæ¯ï¼Œä¸å‘ä¸Šå±‚äº¤ä»˜ã€‚ 2. å‘Aå‘é€ç¡®è®¤æ¶ˆæ¯ã€‚ï¼ˆä¸ä¼šè®¤ä¸ºå·²ç»å‘é€è¿‡äº†ï¼Œå°±ä¸å†å‘é€ã€‚Aèƒ½é‡ä¼ ï¼Œå°±è¯æ˜Bçš„ç¡®è®¤æ¶ˆæ¯ä¸¢å¤±ï¼‰ã€‚</li>
<li>ç¡®è®¤è¿Ÿåˆ° ï¼šç¡®è®¤æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¿Ÿåˆ°ã€‚Aå‘é€M1æ¶ˆæ¯ï¼ŒBæ”¶åˆ°å¹¶å‘é€ç¡®è®¤ã€‚åœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ï¼ŒAé‡ä¼ M1æ¶ˆæ¯ï¼ŒBä»ç„¶æ”¶åˆ°å¹¶ç»§ç»­å‘é€ç¡®è®¤æ¶ˆæ¯ï¼ˆBæ”¶åˆ°äº†2ä»½M1ï¼‰ã€‚æ­¤æ—¶Aæ”¶åˆ°äº†Bç¬¬äºŒæ¬¡å‘é€çš„ç¡®è®¤æ¶ˆæ¯ã€‚æ¥ç€å‘é€å…¶ä»–æ•°æ®ã€‚è¿‡äº†ä¸€ä¼šï¼ŒAæ”¶åˆ°äº†Bç¬¬ä¸€æ¬¡å‘é€çš„å¯¹M1çš„ç¡®è®¤æ¶ˆæ¯ï¼ˆAä¹Ÿæ”¶åˆ°äº†2ä»½ç¡®è®¤æ¶ˆæ¯ï¼‰ã€‚å¤„ç†å¦‚ä¸‹ï¼š1. Aæ”¶åˆ°é‡å¤çš„ç¡®è®¤åï¼Œç›´æ¥ä¸¢å¼ƒã€‚2. Bæ”¶åˆ°é‡å¤çš„M1åï¼Œä¹Ÿç›´æ¥ä¸¢å¼ƒé‡å¤çš„M1ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>è¿ç»­ ARQ åè®®</p>
</blockquote>
<p>å¯æé«˜ä¿¡é“åˆ©ç”¨ç‡ã€‚å‘é€æ–¹ç»´æŒä¸€ä¸ªå‘é€çª—å£ï¼Œå‡¡ä½äºå‘é€çª—å£å†…çš„åˆ†ç»„å¯è¿ç»­å‘é€å‡ºå»ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚æ¥æ”¶æ–¹ä¸€èˆ¬é‡‡ç”¨ç´¯ç§¯ç¡®è®¤ï¼Œä¹Ÿå°±æ˜¯è¯´æ¥å—æ–¹ä¸å¿…å¯¹æ¥æ”¶åˆ°çš„æ¯ä¸€ä¸ªåˆ†ç»„éƒ½è¿›è¡Œç¡®è®¤ï¼Œè€Œæ˜¯å¯¹æŒ‰åºåˆ°è¾¾çš„æœ€åä¸€ä¸ªåˆ†ç»„è¿›è¡Œç¡®è®¤ï¼ˆè¿‡ä¸€æ®µæ—¶é—´ç¡®è®¤ä¸€æ¬¡ï¼Œå‘é€æ–¹å…¶å®æ˜¯æŒ‰ç…§é¡ºåºå‘é€çš„ï¼Œå¯èƒ½ç”±äºç½‘ç»œåŸå› ï¼ŒåŒ…åˆ°è¾¾çš„é¡ºåºä¸ä¸€è‡´ï¼‰ï¼Œè€Œå‘é€æ–¹æ¯æ¥æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œçª—å£å°±å‘å‰æ»‘åŠ¨ä¸€å®šè·ç¦»ã€‚</p>
<ul>
<li>ä¼˜ç¼ºç‚¹ï¼š<ul>
<li>ä¼˜ç‚¹ï¼š ä¿¡é“åˆ©ç”¨ç‡é«˜ï¼Œå®¹æ˜“å®ç°ï¼Œå³ä½¿ç¡®è®¤ä¸¢å¤±ï¼Œä¹Ÿä¸å¿…é‡ä¼ ã€‚</li>
<li>ç¼ºç‚¹ï¼š ä¸èƒ½å‘å‘é€æ–¹åæ˜ å‡ºæ¥æ”¶æ–¹å·²ç»æ­£ç¡®æ”¶åˆ°çš„æ‰€æœ‰åˆ†ç»„çš„ä¿¡æ¯ã€‚ æ¯”å¦‚ï¼šå‘é€æ–¹å‘é€äº† 5æ¡ æ¶ˆæ¯ï¼Œä¸­é—´ç¬¬ä¸‰æ¡ä¸¢å¤±ï¼ˆ3å·ï¼‰ï¼Œè¿™æ—¶æ¥æ”¶æ–¹åªèƒ½å¯¹å‰ä¸¤ä¸ªå‘é€ç¡®è®¤ã€‚å‘é€æ–¹æ— æ³•çŸ¥é“åä¸‰ä¸ªåˆ†ç»„çš„ä¸‹è½ï¼Œè€Œåªå¥½æŠŠåä¸‰ä¸ªå…¨éƒ¨é‡ä¼ ä¸€æ¬¡ã€‚è¿™ä¹Ÿå« Go-Back-Nï¼ˆå›é€€ Nï¼‰ï¼Œè¡¨ç¤ºéœ€è¦é€€å›æ¥é‡ä¼ å·²ç»å‘é€è¿‡çš„ N ä¸ªæ¶ˆæ¯ã€‚</li>
</ul>
</li>
</ul>
<h2 id="5-åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€-â€”-gt-æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹"><a href="#5-åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€-â€”-gt-æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹" class="headerlink" title="5. åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€ â€”&gt; æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹"></a>5. åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€ â€”&gt; æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹</h2><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_11_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_11_network.png" alt="img"></a></p>
<blockquote>
<p>ä¸Šå›¾æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œè¯·æ³¨æ„ï¼Œæ˜¯OSPFä¸æ˜¯OPSFã€‚</p>
<p>OSPFï¼ˆOpen Shortest Path Fitstï¼‰å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆåè®®,æ˜¯ç”±Internetå·¥ç¨‹ä»»åŠ¡ç»„å¼€å‘çš„è·¯ç”±é€‰æ‹©åè®®</p>
</blockquote>
<p>æ€»ä½“æ¥è¯´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹:</p>
<ol>
<li><p><strong>DNSè§£æ</strong></p>
<blockquote>
<p>åŸŸåè§£é‡Šï¼š<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a>.</p>
</blockquote>
<ul>
<li>ä»¥æœ€å³è¾¹è‹±æ–‡.å¼€å§‹ï¼Œç§°ä¸ºåŸŸåçš„æ ¹ï¼šæ³¨æ„æœ€åä¸€ä¸ªcomçš„åé¢æœ‰ç‚¹è¿™ä¸ªå°±æ˜¯æ ¹ï¼Œå®é™…ç”¨çš„æ—¶å€™æœ€ååŠ ä¸åŠ ç‚¹éƒ½è¡Œ</li>
<li>.ä¸‹é¢è¿™ä¸ªåç§°å°±ä¸ºé¡¶çº§åŸŸåï¼Œä»£è¡¨æœåŠ¡å™¨/ç½‘ç«™çš„æ€§è´¨ï¼š<ul>
<li>comï¼ˆå•†ä¸šæ€§è´¨ï¼‰</li>
<li>eduï¼ˆæ•™è‚²æ€§è´¨ï¼‰</li>
<li>netï¼ˆæä¾›ä¿¡æ¯ï¼‰</li>
<li>cnï¼ˆä¸­å›½ï¼‰</li>
<li>orgï¼ˆç»„ç»‡ï¼‰</li>
<li>govï¼ˆæ”¿åºœéƒ¨é—¨ï¼‰</li>
</ul>
</li>
<li>äºŒçº§åŸŸåï¼šè‡ªå·±ç”³è¯·ï¼Œæ¯”å¦‚baidu å®Œå…¨é™å®šåŸŸåï¼šFQDNï¼Œæ¯”å¦‚<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a>ï¼ˆåé¢çš„<a target="_blank" rel="noopener" href="http://baidu.com/">baidu.com</a>å·²ç»å…¨çƒå”¯ä¸€ï¼‰</li>
<li>ä¸‰çº§åŸŸåï¼š<a target="_blank" rel="noopener" href="http://kkk.baidu.com/">kkk.baidu.com</a>çš„kkkå°±æ˜¯ç¬¬ä¸‰çº§ï¼Œä¹Ÿå¯ä»¥å››çº§äº”çº§ã€‚ä¸€èˆ¬ç½‘ç«™ä¹ æƒ¯ç”¨wwwï¼Œä¹Ÿæœ‰<a target="_blank" rel="noopener" href="http://mail.baidu.com/">mail.baidu.com</a>,ä¹Ÿå¯ä»¥<a target="_blank" rel="noopener" href="http://wwww.baidu.com/">wwww.baidu.com</a>ä»£è¡¨ä¸€ä¸ªåŸŸåä¸‹çš„ä¸åŒæœåŠ¡å™¨ï¼Œåªè¦å¯¹åº”çš„IPé…æ­£ç¡®å°±å¯ä»¥ è°·æ­Œå…¬å¸çš„DNSæœåŠ¡å™¨0.0.0.0 ç”µä¿¡å…¬å¸çš„DNSæœåŠ¡å™¨222.222.222.222ï¼‰</li>
</ul>
<blockquote>
<p>å®¢æˆ·ç«¯æµè§ˆå™¨é€šè¿‡DNSè§£æåˆ°åŸŸåçš„IPåœ°å€ã€‚</p>
</blockquote>
<p>åŸŸåè§£æçš„è¿‡ç¨‹ï¼š</p>
<ul>
<li><p>è¿­ä»£æŸ¥è¯¢ï¼š</p>
<p>é¦–å…ˆåœ¨æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸­æŸ¥è¯¢IPåœ°å€ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œæœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€è¯·æ±‚, æ ¹DNSæœåŠ¡å™¨ï¼Œä¸è´Ÿè´£å…·ä½“çš„åŸŸåè§£æï¼Œä½†æ˜¯ä»–çŸ¥é“è´Ÿè´£è§£æé¡¶çº§åŸŸåçš„æœåŠ¡å™¨IPï¼ˆçŸ¥é“å“ªä¸ªDNSæœåŠ¡å™¨è´Ÿè´£å“ªä¸€å—çš„åŸŸåè§£æï¼‰ï¼Œä¼šè¿”å›è¿™ä¸ªIPã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªIPåï¼Œè”ç³»è´Ÿè´£è§£æè¯¥é¡¶çº§åŸŸåçš„æœåŠ¡å™¨ï¼Œè¿™ä¸ªé¡¶çº§åŸŸåçš„æœåŠ¡å™¨å¦‚æœè‡ªå·±æ— æ³•è§£æå°±æ‰¾ç®¡ç†è¿™ä¸ªäºŒçº§åŸŸåè§£æçš„æœåŠ¡å™¨IPåœ°å€ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œç„¶åæœ¬åœ°åŸŸåæœåŠ¡å™¨å°±å»è”ç³»è¿™ä¸ªæœåŠ¡å™¨ç›´åˆ°è§£ææˆåŠŸä¸ºæ­¢ï¼Œå¹¶æŠŠè¿™ä¸ªIPç¼“å­˜åˆ°æœ¬åœ°ï¼Œä¾›ä¸‹æ¬¡æŸ¥è¯¢ä½¿ç”¨ã€‚</p>
</li>
<li><p>è½¬å‘æŸ¥è¯¢ï¼šï¼ˆé€’å½’ï¼‰</p>
<p>DNS æœåŠ¡å™¨å¯ä½¿ç”¨å…¶è‡ªèº«çš„èµ„æºè®°å½•ä¿¡æ¯ç¼“å­˜æ¥åº”ç­”æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»£è¡¨è¯·æ±‚å®¢æˆ·æœºæ¥æŸ¥è¯¢æˆ–è”ç³»å…¶ä»– DNS æœåŠ¡å™¨ï¼Œä»¥å®Œå…¨è§£æè¯¥åç§°ï¼Œå¹¶éšåå°†åº”ç­”è¿”å›è‡³å®¢æˆ·æœºã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé€’å½’ã€‚</p>
<p>è‹¥æœ‰å¤šä¸ªåˆé€‚çš„æœåŠ¡å™¨ï¼ŒDNSæœåŠ¡å™¨å¯ä»¥è¿”å›ä¸€ä¸ªè·Ÿç”¨æˆ·æœ€æ¥è¿‘çš„ç‚¹çš„IPåœ°å€ç»™ç”¨æˆ·ã€‚ï¼ˆDNSè´Ÿè½½å‡è¡¡ï¼‰</p>
</li>
</ul>
</li>
<li><p><strong>å»ºç«‹TCPè¿æ¥</strong></p>
<p>åœ¨æ‹¿åˆ°åŸŸåå¯¹åº”çš„IPåœ°å€åï¼Œä¼šä»¥éšæœºç«¯å£ï¼ˆ1024~~65535ï¼‰å‘WEBæœåŠ¡å™¨ç¨‹åº80ç«¯å£å‘èµ·TCPçš„è¿æ¥è¯·æ±‚ï¼Œå¯¹äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„TCPé“¾æ¥ï¼Œå¿…ç„¶è¦è¯´çš„å°±æ˜¯ä¸‰æ¬¡æ¡æ‰‹ã€‚</p>
</li>
<li><p><strong>æµè§ˆå™¨å‘WEBæœåŠ¡å™¨å‘èµ·Httpè¯·æ±‚</strong></p>
<p>å»ºç«‹TCPè¿æ¥ä¹‹åï¼Œå‘èµ·HTTPè¯·æ±‚çš„è¿‡ç¨‹å°±æ˜¯æ„å»ºHTTPè¯·æ±‚æŠ¥æ–‡å¹¶é€šè¿‡TCPåè®®å‘é€åˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆHTTP80ç«¯å£ï¼‰</p>
<ul>
<li><strong>ä¼ è¾“å±‚</strong> æŠŠHTTPä¼šè¯è¯·æ±‚åˆ†æˆæŠ¥æ–‡æ®µï¼Œæ·»åŠ æºå’Œç›®çš„ç«¯å£ï¼Œå¦‚æœåŠ¡å™¨ä½¿ç”¨80ç«¯å£ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ç”±ç³»ç»Ÿéšæœºé€‰æ‹©ä¸€ä¸ªç«¯å£å¦‚5000ï¼Œä¸æœåŠ¡å™¨è¿›è¡Œäº¤æ¢ï¼ŒæœåŠ¡å™¨æŠŠç›¸åº”çš„è¯·æ±‚è¿”å›ç»™å®¢æˆ·ç«¯çš„5000ç«¯å£ã€‚</li>
<li><strong>ç½‘ç»œå±‚ï¼š</strong>æ·»åŠ æºIPå’Œç›®æ ‡IPã€‚</li>
<li><strong>é“¾è·¯å±‚ï¼š</strong>å®¢æˆ·ç«¯çš„é“¾è·¯å±‚ï¼Œå‘é€ARPè¯·æ±‚æŸ¥æ‰¾ä¸‹ä¸€è·³MACï¼Œè·¨ç½‘æ®µæ˜¯ç½‘å…³çš„MAC</li>
<li>HTTPè¯·æ±‚æŠ¥æ–‡ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š<ul>
<li>è¯·æ±‚è¡Œï¼ˆ å¸¸ç”¨çš„æ–¹æ³•æœ‰: GET, POST, PUT, DELETE, OPTIONS, HEADï¼‰</li>
<li>è¯·æ±‚å¤´ï¼ˆ HTTPè¯·æ±‚å¤´ä¸­å¯ä»¥çœ‹åˆ°å½“å‰è¯·æ±‚æ”¯æŒçš„è¯­è¨€ï¼Œå‹ç¼©æ ¼å¼ï¼Œç¼–ç æ ¼å¼ä»¥åŠä½•ç§ç±»å‹çš„è¿”å›æ–‡ä»¶ï¼ŒConnectionä»¥åŠCookieï¼ŒContent-Typeç­‰ä¿¡æ¯ï¼‰</li>
<li>è¯·æ±‚æ­£æ–‡ï¼ˆ å½“ä½¿ç”¨POST, PUTç­‰æ–¹æ³•æ—¶ï¼Œé€šå¸¸éœ€è¦å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€’æ•°æ®ã€‚è¿™äº›æ•°æ®å°±å‚¨å­˜åœ¨è¯·æ±‚æ­£æ–‡ä¸­ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>æœåŠ¡å™¨ç«¯å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡</strong></p>
<ul>
<li>æœåŠ¡å™¨ç«¯æ”¶åˆ°è¯·æ±‚åçš„ç”±webæœåŠ¡å™¨ï¼ˆå¦‚ Tomcatï¼‰å¤„ç†è¯·æ±‚ã€‚webæœåŠ¡å™¨è§£æç”¨æˆ·è¯·æ±‚ï¼ŒçŸ¥é“äº†éœ€è¦è°ƒåº¦å“ªäº›èµ„æºæ–‡ä»¶ï¼Œå†é€šè¿‡ç›¸åº”çš„è¿™äº›èµ„æºæ–‡ä»¶å¤„ç†ç”¨æˆ·è¯·æ±‚å’Œå‚æ•°ï¼Œå¹¶è°ƒç”¨æ•°æ®åº“ä¿¡æ¯ï¼Œæœ€åå°†ç»“æœé€šè¿‡webæœåŠ¡å™¨è¿”å›ç»™æµè§ˆå™¨å®¢æˆ·ç«¯ã€‚</li>
<li>HTTPå“åº”æŠ¥æ–‡ä¹Ÿæ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆ:<ul>
<li>çŠ¶æ€ç ï¼ˆ[å¦‚ä¸‹è¿°é—®é¢˜](<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/23/%E8%AE%A1%E7%BD%91/7">http://lihengxu.cn/2021/03/23/è®¡ç½‘/7</a>. å¸¸è§HTTPçŠ¶æ€ç )ï¼‰</li>
<li>å“åº”æŠ¥å¤´</li>
<li>å“åº”æŠ¥æ–‡ï¼ˆ æœåŠ¡å™¨è¿”å›ç»™æµè§ˆå™¨çš„æ–‡æœ¬ä¿¡æ¯ï¼Œé€šå¸¸HTML, CSS, JS, å›¾ç‰‡ç­‰æ–‡ä»¶å°±æ”¾åœ¨è¿™ä¸€éƒ¨åˆ†ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</strong></p>
<p>æµè§ˆå™¨æ˜¯ä¸€ä¸ªè¾¹è§£æè¾¹æ¸²æŸ“çš„è¿‡ç¨‹ã€‚é¦–å…ˆæµè§ˆå™¨è§£æHTMLæ–‡ä»¶æ„å»ºDOMæ ‘ï¼Œç„¶åè§£æCSSæ–‡ä»¶æ„å»ºæ¸²æŸ“æ ‘ï¼Œç­‰åˆ°æ¸²æŸ“æ ‘æ„å»ºå®Œæˆåï¼Œæµè§ˆå™¨å¼€å§‹å¸ƒå±€æ¸²æŸ“æ ‘å¹¶å°†å…¶ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚</p>
</li>
<li><p><strong>å…³é—­TCPé“¾æ¥</strong></p>
<p>å››æ¬¡æŒ¥æ‰‹</p>
</li>
</ol>
<h2 id="6-Getå’ŒPoståŒºåˆ«"><a href="#6-Getå’ŒPoståŒºåˆ«" class="headerlink" title="6. Getå’ŒPoståŒºåˆ«"></a>6. Getå’ŒPoståŒºåˆ«</h2><ul>
<li>Getä¸€èˆ¬æ˜¯ä»æœåŠ¡å™¨ä¸Šè¯·æ±‚æ•°æ®ï¼ŒPostä¸€èˆ¬æ˜¯å‘æœåŠ¡å™¨ä¼ é€æ•°æ®ã€‚</li>
<li>GETè¯·æ±‚ä¹Ÿå¯ä¼ å‚åˆ°åå°ï¼Œä½†æ˜¯å…¶å‚æ•°åœ¨æµè§ˆå™¨çš„åœ°å€æ çš„urlä¸­å¯è§ï¼Œæ‰€ä»¥éšç§æ€§å®‰å…¨æ€§è¾ƒå·®ï¼Œä¸”å‚æ•°é•¿åº¦ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ã€‚ POSTè¯·æ±‚ä¼ é€’å‚æ•°æ”¾åœ¨Request bodyä¸­ï¼Œä¸ä¼šåœ¨urlä¸­æ˜¾ç¤ºï¼Œæ¯”GETè¦å®‰å…¨ï¼Œä¸”å‚æ•°é•¿åº¦æ— é™åˆ¶ã€‚</li>
<li>GETè¯·æ±‚åˆ·æ–°æµè§ˆå™¨æˆ–å›é€€æ—¶æ²¡æœ‰å½±å“ï¼ŒPOSTå›é€€æ—¶ä¼šé‡æ–°æäº¤æ•°æ®è¯·æ±‚ã€‚</li>
<li>GET è¯·æ±‚å¯è¢«æµè§ˆå™¨ä¸»åŠ¨ç¼“å­˜ï¼Œ POST è¯·æ±‚ä¸ä¼šé™¤éæ‰‹åŠ¨è®¾ç½® GET è¯·æ±‚ä¿ç•™åœ¨æµè§ˆå™¨å†å²è®°å½•ä¸­ï¼Œ å¯è¢«æ”¶è—ä¸ºä¹¦ç­¾ï¼› POST è¯·æ±‚ä¸ä¼šä¿ç•™åœ¨æµè§ˆå™¨å†å²è®°å½•ä¸­ï¼Œ POST ä¸èƒ½è¢«æ”¶è—ä¸ºä¹¦ç­¾</li>
<li>GET åªæ¥å—ASCIIå­—ç¬¦ï¼Œ POSTæ”¯æŒå¤šç§ç¼–ç æ–¹å¼</li>
<li>GETäº§ç”Ÿä¸€ä¸ªTCPæ•°æ®åŒ…ï¼Œ æµè§ˆå™¨ä¼šæŠŠhttp headerå’Œdataä¸€å¹¶å‘é€å‡ºå»ï¼ŒæœåŠ¡å™¨å“åº”200ï¼ˆè¿”å›æ•°æ®ï¼‰ï¼›POSTäº§ç”Ÿä¸¤ä¸ªTCPæ•°æ®åŒ…ï¼Œ æµè§ˆå™¨å…ˆå‘é€headerï¼ŒæœåŠ¡å™¨å“åº”100 continueï¼Œæµè§ˆå™¨å†å‘é€dataï¼ŒæœåŠ¡å™¨å“åº”200 okï¼ˆè¿”å›æ•°æ®ï¼‰ï¼ˆ å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½ä¼šåœ¨POSTä¸­å‘é€ä¸¤æ¬¡åŒ…ï¼ŒFirefoxå°±åªå‘é€ä¸€æ¬¡ï¼‰ã€‚</li>
</ul>
<blockquote>
<p>HTTPæ˜¯åŸºäºTCP/IPçš„å…³äºæ•°æ®å¦‚ä½•åœ¨ä¸‡ç»´ç½‘ä¸­å¦‚ä½•é€šä¿¡çš„åè®®ï¼Œ HTTPçš„åº•å±‚æ˜¯TCP/IPã€‚æ‰€ä»¥GETå’ŒPOSTçš„åº•å±‚ä¹Ÿæ˜¯TCP/IPï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGET/POSTéƒ½æ˜¯TCPé“¾æ¥ã€‚</p>
</blockquote>
<h2 id="7-å¸¸è§HTTPçŠ¶æ€ç "><a href="#7-å¸¸è§HTTPçŠ¶æ€ç " class="headerlink" title="7. å¸¸è§HTTPçŠ¶æ€ç "></a>7. å¸¸è§HTTPçŠ¶æ€ç </h2><p>1xxï¼šè¡¨ç¤ºé€šçŸ¥ä¿¡æ¯ï¼Œä¾‹å¦‚è¡¨ç¤ºæ”¶åˆ°æˆ–è€…æ˜¯æ­£åœ¨å¤„ç†ï¼ˆä¸´æ—¶å“åº”ï¼‰</p>
<p>2xxï¼šè¡¨ç¤ºæˆåŠŸï¼Œä¾‹å¦‚è¡¨ç¤ºæ¥å—æˆ–çŸ¥é“äº†</p>
<p>3xxï¼šè¡¨ç¤ºé‡å®šå‘ï¼Œä¾‹å¦‚è¡¨ç¤ºå®Œæˆè¯·æ±‚è¿˜éœ€è¦é‡‡å–è¿›ä¸€æ­¥çš„è¡ŒåŠ¨</p>
<p>4xxï¼šè¡¨ç¤ºå®¢æˆ·ç«¯çš„å·®é”™ï¼Œä¾‹å¦‚è¡¨ç¤ºè¯·æ±‚ä¸­æœ‰è¯­æ³•é”™è¯¯æˆ–ä¸èƒ½å®Œæˆ</p>
<p>5xxï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯çš„å·®é”™ï¼šä¾‹å¦‚è¡¨ç¤ºæœåŠ¡å™¨å¤±æ•ˆæ— æ³•å®Œæˆè¯·æ±‚</p>
<h2 id="8-HTTPåè®®å’Œå„ç§åè®®çš„å…³ç³»"><a href="#8-HTTPåè®®å’Œå„ç§åè®®çš„å…³ç³»" class="headerlink" title="8. HTTPåè®®å’Œå„ç§åè®®çš„å…³ç³»"></a>8. HTTPåè®®å’Œå„ç§åè®®çš„å…³ç³»</h2><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_12_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_12_network.png" alt="img"></a></p>
<h2 id="9-HTTPé•¿è¿æ¥-çŸ­è¿æ¥"><a href="#9-HTTPé•¿è¿æ¥-çŸ­è¿æ¥" class="headerlink" title="9. HTTPé•¿è¿æ¥,çŸ­è¿æ¥"></a>9. HTTPé•¿è¿æ¥,çŸ­è¿æ¥</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gotodsp/p/6366163.html">ã€ŠHTTPé•¿è¿æ¥ã€çŸ­è¿æ¥ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿã€‹</a>[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/23/%E8%AE%A1%E7%BD%91/#fn:3">3]</a></p>
<p>åœ¨HTTP/1.0ä¸­é»˜è®¤ä½¿ç”¨çŸ­è¿æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¯è¿›è¡Œä¸€æ¬¡HTTPæ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä»»åŠ¡ç»“æŸå°±ä¸­æ–­è¿æ¥ã€‚å½“å®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®çš„æŸä¸ªHTMLæˆ–å…¶ä»–ç±»å‹çš„Webé¡µä¸­åŒ…å«æœ‰å…¶ä»–çš„Webèµ„æºï¼ˆå¦‚JavaScriptæ–‡ä»¶ã€å›¾åƒæ–‡ä»¶ã€CSSæ–‡ä»¶ç­‰ï¼‰ï¼Œæ¯é‡åˆ°è¿™æ ·ä¸€ä¸ªWebèµ„æºï¼Œæµè§ˆå™¨å°±ä¼šé‡æ–°å»ºç«‹ä¸€ä¸ªHTTPä¼šè¯ã€‚</p>
<p>è€Œä»HTTP/1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œç”¨ä»¥ä¿æŒè¿æ¥ç‰¹æ€§ã€‚ä½¿ç”¨é•¿è¿æ¥çš„HTTPåè®®ï¼Œä¼šåœ¨å“åº”å¤´åŠ å…¥è¿™è¡Œä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Connection:keep-alive</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>åœ¨ä½¿ç”¨é•¿è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç”¨äºä¼ è¾“HTTPæ•°æ®çš„TCPè¿æ¥ä¸ä¼šå…³é—­ï¼Œå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ã€‚Keep-Aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚</p>
<blockquote>
<p>HTTPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå®è´¨ä¸Šæ˜¯TCPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚</p>
</blockquote>
<p>é•¿è¿æ¥å¯ä»¥çœå»è¾ƒå¤šçš„TCPå»ºç«‹å’Œå…³é—­çš„æ“ä½œï¼Œå‡å°‘æµªè´¹ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚ åœ¨é•¿è¿æ¥çš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œclientç«¯ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å…³é—­å®ƒä»¬ä¹‹é—´çš„è¿æ¥ï¼ŒClientä¸serverä¹‹é—´çš„è¿æ¥å¦‚æœä¸€ç›´ä¸å…³é—­çš„è¯ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œéšç€å®¢æˆ·ç«¯è¿æ¥è¶Šæ¥è¶Šå¤šï¼Œserveræ—©æ™šæœ‰æ‰›ä¸ä½çš„æ—¶å€™ï¼Œè¿™æ—¶å€™serverç«¯éœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥ï¼Œå¦‚å…³é—­ä¸€äº›é•¿æ—¶é—´æ²¡æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿçš„è¿æ¥ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›æ¶æ„è¿æ¥å¯¼è‡´serverç«¯æœåŠ¡å—æŸã€‚</p>
<p>çŸ­è¿æ¥å¯¹äºæœåŠ¡å™¨æ¥è¯´ç®¡ç†è¾ƒä¸ºç®€å•ï¼Œå­˜åœ¨çš„è¿æ¥éƒ½æ˜¯æœ‰ç”¨çš„è¿æ¥ï¼Œä¸éœ€è¦é¢å¤–çš„æ§åˆ¶æ‰‹æ®µã€‚ä½†å¦‚æœå®¢æˆ·è¯·æ±‚é¢‘ç¹ï¼Œå°†åœ¨TCPçš„å»ºç«‹å’Œå…³é—­æ“ä½œä¸Šæµªè´¹æ—¶é—´å’Œå¸¦å®½ã€‚</p>
<ul>
<li><p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li><strong>çŸ­é“¾æ¥</strong>ï¼šåƒWEBç½‘ç«™çš„httpæœåŠ¡ä¸€èˆ¬éƒ½ç”¨çŸ­é“¾æ¥</li>
</ul>
<p>åŸå› ï¼šé•¿è¿æ¥å¯¹äºæœåŠ¡ç«¯æ¥è¯´ä¼šè€—è´¹ä¸€å®šçš„èµ„æºï¼Œè€ŒåƒWEBç½‘ç«™è¿™ä¹ˆé¢‘ç¹çš„æˆåƒä¸Šä¸‡ç”šè‡³ä¸Šäº¿å®¢æˆ·ç«¯çš„è¿æ¥ç”¨çŸ­è¿æ¥ä¼šæ›´çœä¸€äº›èµ„æºï¼Œå¦‚æœç”¨é•¿è¿æ¥ï¼Œè€Œä¸”åŒæ—¶æœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ï¼Œå¦‚æœæ¯ä¸ªç”¨æˆ·éƒ½å ç”¨ä¸€ä¸ªè¿æ¥çš„è¯ï¼Œé‚£å¯æƒ³è€ŒçŸ¥å§ã€‚æ‰€ä»¥å¹¶å‘é‡å¤§ï¼Œä½†æ¯ä¸ªç”¨æˆ·æ— éœ€é¢‘ç¹æ“ä½œæƒ…å†µä¸‹éœ€ç”¨çŸ­è¿å¥½ã€‚</p>
<ul>
<li><strong>é•¿è¿æ¥</strong>ï¼šå¤šç”¨äºæ“ä½œé¢‘ç¹ï¼Œç‚¹å¯¹ç‚¹çš„é€šè®¯ï¼Œè€Œä¸”è¿æ¥æ•°ä¸èƒ½å¤ªå¤šæƒ…å†µ</li>
</ul>
</li>
</ul>
<h2 id="10-HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®-å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€-ï¼ˆCookieå’ŒSessionï¼‰"><a href="#10-HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®-å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€-ï¼ˆCookieå’ŒSessionï¼‰" class="headerlink" title="10. HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®,å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€?ï¼ˆCookieå’ŒSessionï¼‰"></a>10. HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®,å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€?ï¼ˆCookieå’ŒSessionï¼‰</h2><p>HTTP æ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€ï¼Œå³æ— çŠ¶æ€åè®®ã€‚ä¹Ÿå°±æ˜¯è¯´ HTTP åè®®è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨cookieå’Œsessionæ¥ä¿æŒä¼šè¯çŠ¶æ€ï¼Œ</p>
<ul>
<li>ä¼šè¯ï¼šä¸€æ¬¡ä¼šè¯ä¸­åŒ…å«å¤šæ¬¡è¯·æ±‚å’Œå“åº”</li>
<li>ä¸€æ¬¡ä¼šè¯ï¼šæµè§ˆå™¨ç¬¬ä¸€æ¬¡ç»™æœåŠ¡å™¨èµ„æºå‘é€è¯·æ±‚ï¼Œä¼šè¯å»ºç«‹ï¼Œç›´åˆ°æœ‰ä¸€æ–¹æ–­å¼€ä¸ºæ­¢ã€‚</li>
</ul>
<blockquote>
<p>cookieå’ŒsessionåŠŸèƒ½å°±æ˜¯åœ¨ä¸€æ¬¡ä¼šè¯çš„èŒƒå›´å†…çš„å¤šæ¬¡è¯·æ±‚é—´ï¼Œå…±äº«æ•°æ®ã€‚</p>
</blockquote>
<ul>
<li>å®¢æˆ·ç«¯ä¼šè¯æŠ€æœ¯ï¼šCookieï¼Œå°†æ•°æ®ä¿å­˜åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ï¼ˆcookieä¸€èˆ¬ç”¨äºå­˜å‡ºå°‘é‡çš„ä¸å¤ªæ•æ„Ÿçš„æ•°æ®æˆ–æ˜¯åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹ï¼Œå®ŒæˆæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„èº«ä»½è¯†åˆ«ï¼‰ï¼›</li>
<li>æœåŠ¡å™¨ç«¯ä¼šè¯æŠ€æœ¯ï¼šSessionï¼Œå°†æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯çš„å¯¹è±¡ä¸­ï¼ŒSessionçš„å®ç°æ˜¯ä¾èµ–äºCookieçš„ã€‚ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚å¤„ç†åå¯ä»¥ç”Ÿæˆä¸€ä¸ªsessionIdï¼Œå¹¶ä¸”å°†sessionIdå­˜å…¥cookieä¸­è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå°†sessionçš„å†…å®¹å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šã€‚åœ¨ä¸‹ä¸€æ¬¡çš„è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯å¸¦ç€cookieæ¥è¯·æ±‚æœåŠ¡å™¨ï¼ŒæœåŠ¡ç«¯ä»cookieä¸­å–å‡ºsessionIdï¼Œå®ç°äº†ç”¨æˆ·ä¼šè¯çŠ¶æ€çš„ä¿æŒã€‚è¿™æ ·åšæœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯å°†ä¸€äº›ä¸œè¥¿å­˜åœ¨äº†æœåŠ¡å™¨ä¸Šï¼Œåœ¨ç”¨æˆ·é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å®¹é‡ä¼šä¸è¶³ã€‚</li>
</ul>
<p>å®é™…æƒ…å†µä¸­ï¼Œç»å¸¸æ˜¯å°†æ‰€éœ€è¦çš„ä¼šè¯çŠ¶æ€ï¼Œæ¯”å¦‚è¯´ç™»å½•æ€ç›´æ¥å­˜å…¥cookieå¹¶ä¸”è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯ç›´æ¥å–å‡ºcookieä¸­çš„ä¿¡æ¯å’Œå‚æ•°ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œä¿æŒHTTPä¼šè¯çŠ¶æ€ã€‚</p>
<p>åœ¨æœåŠ¡ç«¯ä¿å­˜ Session çš„æ–¹æ³•å¾ˆå¤šï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯å†…å­˜å’Œæ•°æ®åº“(æ¯”å¦‚æ˜¯ä½¿ç”¨å†…å­˜æ•°æ®åº“redisä¿å­˜)ã€‚</p>
<blockquote>
<p>Cookie è¢«ç¦ç”¨æ€ä¹ˆåŠ?</p>
</blockquote>
<p>æœ€å¸¸ç”¨çš„å°±æ˜¯åˆ©ç”¨ URL é‡å†™æŠŠ Session ID ç›´æ¥é™„åŠ åœ¨URLè·¯å¾„çš„åé¢ã€‚</p>
<p>å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒCookieæˆ–ç”¨æˆ·é˜»æ­¢äº†æ‰€æœ‰Cookieï¼Œå¯ä»¥æŠŠä¼šè¯IDé™„åŠ åœ¨HTMLé¡µé¢ä¸­æ‰€æœ‰çš„URLä¸Šï¼Œè¿™äº›é¡µé¢ä½œä¸ºå“åº”å‘é€ç»™å®¢æˆ·ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·å•å‡»URLæ—¶ï¼Œä¼šè¯IDè¢«è‡ªåŠ¨ä½œä¸ºè¯·æ±‚è¡Œçš„ä¸€éƒ¨åˆ†è€Œä¸æ˜¯ä½œä¸ºå¤´è¡Œå‘é€å›æœåŠ¡å™¨ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºURLé‡å†™(URL rewriting)ã€‚</p>
<p>å‚è€ƒå›ç­”ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_13_network.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_13_network.png" alt="img"></a></p>
<h2 id="11-Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ-å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#11-Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ-å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="11. Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>11. Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>Cookie æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨ç«¯)ï¼ŒSession æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚</p>
<p>Sessionæ²¡æœ‰æ•°æ®å¤§å°é™åˆ¶ï¼ŒCookieæœ‰ã€‚</p>
<p>ç›¸å¯¹ Cookie æ¥è¯´ Session å®‰å…¨æ€§æ›´é«˜ã€‚å¦‚æœè¦åœ¨ Cookie ä¸­å­˜å‚¨ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦ç›´æ¥å†™å…¥ Cookie ä¸­ï¼Œæœ€å¥½èƒ½å°† Cookie ä¿¡æ¯åŠ å¯†ç„¶åä½¿ç”¨åˆ°çš„æ—¶å€™å†å»æœåŠ¡å™¨ç«¯è§£å¯†ã€‚</p>
<h2 id="12-HTTP-1-0å’ŒHTTP-1-1çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#12-HTTP-1-0å’ŒHTTP-1-1çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="12. HTTP 1.0å’ŒHTTP 1.1çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆ?"></a>12. HTTP 1.0å’ŒHTTP 1.1çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h2><ol>
<li>åœ¨HTTP/1.0ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯çŸ­è¿æ¥ï¼ŒHTTP 1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ã€‚</li>
<li><strong>é”™è¯¯çŠ¶æ€å“åº”ç </strong> :åœ¨HTTP1.1ä¸­æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œå¦‚409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚</li>
<li><strong>ç¼“å­˜å¤„ç†</strong> :åœ¨HTTP1.0ä¸­ä¸»è¦ä½¿ç”¨headeré‡Œçš„If-Modified-Since,Expiresæ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼ŒHTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ä¾‹å¦‚Entity tagï¼ŒIf-Unmodified-Since, If-Match, If-None-Matchç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</li>
<li><strong>å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥çš„ä½¿ç”¨</strong> :HTTP1.0ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼ŒHTTP1.1åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº†rangeå¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚</li>
</ol>
<h2 id="13-URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#13-URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="13. URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?"></a>13. URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h2><ul>
<li>URI(Uniform Resource Identifier) æ˜¯ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦ï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªèµ„æºã€‚ URIå°±æ˜¯åœ¨æŸä¸€è§„åˆ™ä¸‹èƒ½æŠŠä¸€ä¸ªèµ„æºç‹¬ä¸€æ— äºŒåœ°æ ‡è¯†å‡ºæ¥ã€‚å¦‚ï¼šèº«ä»½è¯</li>
<li>URL(Uniform Resource Location) æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œå¯ä»¥æä¾›è¯¥èµ„æºçš„è·¯å¾„ã€‚å®ƒæ˜¯ä¸€ç§å…·ä½“çš„ URIï¼Œå³ URLå°±æ˜¯ç”¨å®šä½çš„æ–¹å¼å®ç°çš„URIã€‚ å¯è®¤ä¸ºç”±4éƒ¨åˆ†ç»„æˆï¼šåè®®ã€ä¸»æœºã€ç«¯å£ã€è·¯å¾„ http:localhost:8080/index.jsp ( å¯¹äºç°åœ¨ç½‘å€æˆ‘æ›´å€¾å‘äºå«å®ƒURLï¼Œæ¯•ç«Ÿå®ƒæä¾›äº†èµ„æºçš„ä½ç½®ä¿¡æ¯) å¦‚ï¼šå…·ä½“ä½å€</li>
</ul>
<p> URLæ˜¯ä¸€ç§å…·ä½“çš„URIï¼Œå®ƒä¸ä»…å”¯ä¸€æ ‡è¯†èµ„æºï¼Œè€Œä¸”è¿˜æä¾›äº†å®šä½è¯¥èµ„æºçš„ä¿¡æ¯ã€‚</p>
<h2 id="14-HTTP-å’Œ-HTTPS-çš„åŒºåˆ«ï¼Ÿ"><a href="#14-HTTP-å’Œ-HTTPS-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="14. HTTP å’Œ HTTPS çš„åŒºåˆ«ï¼Ÿ"></a>14. HTTP å’Œ HTTPS çš„åŒºåˆ«ï¼Ÿ</h2><ol>
<li>ç«¯å£ ï¼šHTTPçš„URLç”±â€œhttp://â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£80ï¼Œè€ŒHTTPSçš„URLç”±â€œhttps://â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£443ã€‚</li>
<li>å®‰å…¨æ€§å’Œèµ„æºæ¶ˆè€—ï¼š<ul>
<li>HTTPåè®®è¿è¡Œåœ¨TCPä¹‹ä¸Šï¼Œæ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡ã€‚</li>
<li>HTTPSæ˜¯è¿è¡Œåœ¨SSL/TLSä¹‹ä¸Šçš„HTTPåè®®ï¼ŒSSL/TLS è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚ï¼ˆ HTTPSåè®®åœ¨HTTPçš„åŸºç¡€ä¸ŠåŠ å…¥äº†SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰åè®®ï¼ŒSSLé€æ¸æ¼”å˜ä¸ºäº†TLSåè®®ï¼Œä½†æ˜¯ä¸šç•Œä¹ æƒ¯ä»ç„¶ç§°å…¶ä¸ºSSLåè®®ã€‚ï¼‰æ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½ç»è¿‡åŠ å¯†ï¼ŒåŠ å¯†é‡‡ç”¨å¯¹ç§°åŠ å¯†ï¼Œä½†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”¨æœåŠ¡å™¨æ–¹çš„è¯ä¹¦è¿›è¡Œäº†éå¯¹ç§°åŠ å¯†ã€‚æ‰€ä»¥è¯´ï¼ŒHTTP å®‰å…¨æ€§æ²¡æœ‰ HTTPSé«˜ï¼Œä½†æ˜¯ HTTPS æ¯”HTTPè€—è´¹æ›´å¤šæœåŠ¡å™¨èµ„æºã€‚</li>
</ul>
</li>
</ol>
<ul>
<li>å¯¹ç§°åŠ å¯†ï¼šå¯†é’¥åªæœ‰ä¸€ä¸ªï¼ŒåŠ å¯†è§£å¯†ä¸ºåŒä¸€ä¸ªå¯†ç ï¼Œä¸”åŠ è§£å¯†é€Ÿåº¦å¿«ï¼›</li>
<li>éå¯¹ç§°åŠ å¯†ï¼šå¯†é’¥æˆå¯¹å‡ºç°ï¼ˆä¸”æ ¹æ®å…¬é’¥æ— æ³•æ¨çŸ¥ç§é’¥ï¼Œæ ¹æ®ç§é’¥ä¹Ÿæ— æ³•æ¨çŸ¥å…¬é’¥ï¼‰ï¼ŒåŠ å¯†è§£å¯†ä½¿ç”¨ä¸åŒå¯†é’¥ï¼ˆå…¬é’¥åŠ å¯†éœ€è¦ç§é’¥è§£å¯†ï¼Œç§é’¥åŠ å¯†éœ€è¦å…¬é’¥è§£å¯†ï¼‰ï¼Œç›¸å¯¹å¯¹ç§°åŠ å¯†é€Ÿåº¦è¾ƒæ…¢ã€‚</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol>
<li><a target="_blank" rel="noopener" href="https://app.yinxiang.com/fx/4ed295dd-ff19-4200-b401-47bdd265d0f8">https://app.yinxiang.com/fx/4ed295dd-ff19-4200-b401-47bdd265d0f8</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/23/%E8%AE%A1%E7%BD%91/#fnref:1">â†©</a></li>
<li>JavaGuideé¢è¯•çªè¢­v4.0ï¼Œè®¡ç®—æœºç½‘ç»œ <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/23/%E8%AE%A1%E7%BD%91/#fnref:2">â†©</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gotodsp/p/6366163.html">https://www.cnblogs.com/gotodsp/p/6366163.html</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/23/%E8%AE%A1%E7%BD%91/#fnref:3">â†©</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%80%BB%E7%BB%93/" data-id="cknyemfcp00076oubb6jmbl4z" data-title="è®¡ç®—æœºç½‘ç»œæ€»ç»“" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-BIO-AIO-NIOåŒºåˆ«" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/06/BIO-AIO-NIO%E5%8C%BA%E5%88%AB/" class="article-date">
  <time class="dt-published" datetime="2021-04-06T11:32:28.000Z" itemprop="datePublished">2021-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/06/BIO-AIO-NIO%E5%8C%BA%E5%88%AB/">BIO_AIO_NIOåŒºåˆ«</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="BIO-AIO-NIOåŒºåˆ«"><a href="#BIO-AIO-NIOåŒºåˆ«" class="headerlink" title="BIO_AIO_NIOåŒºåˆ«"></a>BIO_AIO_NIOåŒºåˆ«</h1><blockquote>
<p>ç®€å•å¯¹æ¯”ï¼š</p>
<ul>
<li>BIO å°±æ˜¯ä¼ ç»Ÿçš„ <a href="https://link.zhihu.com/?target=http://java.io/">java.io</a> åŒ…ï¼Œå®ƒæ˜¯åŸºäºæµæ¨¡å‹å®ç°çš„ï¼Œäº¤äº’çš„æ–¹å¼æ˜¯<strong>åŒæ­¥ã€é˜»å¡</strong>æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¯»å…¥è¾“å…¥æµæˆ–è€…è¾“å‡ºæµæ—¶ï¼Œåœ¨è¯»å†™åŠ¨ä½œå®Œæˆä¹‹å‰ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œå®ƒä»¬ä¹‹é—´çš„è°ƒç”¨æ—¶å¯é çš„çº¿æ€§é¡ºåºã€‚å®ƒçš„æœ‰ç‚¹å°±æ˜¯ä»£ç æ¯”è¾ƒç®€å•ã€ç›´è§‚ï¼›ç¼ºç‚¹å°±æ˜¯ IO çš„æ•ˆç‡å’Œæ‰©å±•æ€§å¾ˆä½ï¼Œå®¹æ˜“æˆä¸ºåº”ç”¨æ€§èƒ½ç“¶é¢ˆã€‚</li>
<li>NIO æ˜¯ Java 1.4 å¼•å…¥çš„ java.nio åŒ…ï¼Œæä¾›äº† Channelã€Selectorã€Buffer ç­‰æ–°çš„æŠ½è±¡ï¼Œå¯ä»¥æ„å»ºå¤šè·¯å¤ç”¨çš„ã€<strong>åŒæ­¥éé˜»å¡</strong> IO ç¨‹åºï¼ŒåŒæ—¶æä¾›äº†æ›´æ¥è¿‘æ“ä½œç³»ç»Ÿåº•å±‚é«˜æ€§èƒ½çš„æ•°æ®æ“ä½œæ–¹å¼ã€‚</li>
<li>AIO æ˜¯ Java 1.7 ä¹‹åå¼•å…¥çš„åŒ…ï¼Œæ˜¯ NIO çš„å‡çº§ç‰ˆæœ¬ï¼Œæä¾›äº†<strong>å¼‚æ­¥éå µå¡çš„ IO</strong> æ“ä½œæ–¹å¼ï¼Œæ‰€ä»¥äººä»¬å«å®ƒ AIOï¼ˆAsynchronous IOï¼‰ï¼Œå¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚</li>
</ul>
</blockquote>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é—®é¢˜çš„å…³é”®å…¶å®å°±æ˜¯ç†è§£åŒæ­¥/å¼‚æ­¥ã€é˜»å¡/éé˜»å¡çš„å«ä¹‰ã€‚</p>
<p>æœ€åˆæˆ‘çœ‹äº†å¾ˆå¤šblogä»¥åŠä¸€äº›æ‰€è°“çš„é¢è¯•è€ƒé¢˜è®²è§£è§†é¢‘ï¼Œä»¥ä¸ºç†è§£äº†åŒæ­¥/å¼‚æ­¥ã€é˜»å¡/éé˜»å¡çš„å«ä¹‰ï¼Œä½†å…¶å®è¶Šæƒ³è¶Šç»ä¸èµ·æ¨æ•²</p>
<p>æ¯”å¦‚ä¸‹é¢çš„ä¸€äº›ç†è§£ï¼ˆæˆ‘è®¤ä¸ºæ˜¯ä¸å¯¹çš„ï¼‰ï¼š</p>
<blockquote>
<p><del>åŒæ­¥å’Œå¼‚æ­¥ï¼ˆé’ˆå¯¹è¯·æ±‚ï¼‰ï¼Œé˜»å¡å’Œéé˜»å¡ï¼ˆé’ˆå¯¹å®¢æˆ·ç«¯ï¼‰</del></p>
<p><del>åœ¨ç½‘ç»œè¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šå‘å‡ºä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡ç«¯</del></p>
<ol>
<li><del>å®¢æˆ·ç«¯å‘äº†è¯·æ±‚åï¼Œå°±ä¸€ç›´ç­‰ç€æœåŠ¡ç«¯çš„è¿”å›ç›¸åº”ã€‚ å®¢æˆ·ç«¯ï¼šé˜»å¡ã€‚ è¯·æ±‚ï¼šåŒæ­¥</del></li>
<li><del>å®¢æˆ·ç«¯å‘äº†è¯·æ±‚åï¼Œå°±å»å¹²åˆ«çš„äº‹æƒ…äº†ï¼Œæ—¶ä¸æ—¶æ¥æ£€æŸ¥æœåŠ¡ç«¯æ˜¯å¦ç»™å‡ºäº†å“åº”ã€‚ å®¢æˆ·ç«¯ï¼šéé˜»å¡ã€‚ è¯·æ±‚ï¼š åŒæ­¥ã€‚</del></li>
<li><del>æ¢æˆå¼‚æ­¥è¯·æ±‚åï¼Œå®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚åï¼Œå°±ååœ¨æ¤…å­ä¸Šï¼Œç­‰ç€æœåŠ¡ç«¯çš„è¿”å›ç›¸åº”ã€‚ å®¢æˆ·ç«¯ï¼šé˜»å¡ã€‚ è¯·æ±‚ï¼šå¼‚æ­¥ã€‚</del></li>
<li><del>å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚åï¼Œå°±å»å¹²åˆ«çš„äº‹æƒ…äº†ï¼Œç­‰åˆ°æœåŠ¡ç«¯ç»™å‡ºå“åº”åï¼Œå†æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚ å®¢æˆ·ç«¯ï¼šé˜»å¡ã€‚ è¯·æ±‚ï¼šå¼‚æ­¥ã€‚</del></li>
</ol>
</blockquote>
<p>åƒè¿™æ ·ä¸¾é€šä¿—çš„ä¾‹å­æ¥è¯´æ˜è¿™å‡ ä¸ªæ¦‚å¿µï¼Œé€šå¸¸éƒ½ç»ä¸èµ·æ¨æ•²ï¼ŒåŸå› åœ¨äºï¼Œä¾‹å­ä¸­ç¼ºå°‘äº†ä¸€ä¸ªâ€œæ“ä½œç³»ç»Ÿâ€çº§åˆ«çš„è°ƒåº¦è€…ã€‚</p>
<ul>
<li>é˜»å¡éé˜»å¡æ˜¯è·Ÿè¿›ç¨‹/çº¿ç¨‹ä¸¥å¯†ç›¸å…³çš„ï¼Œè€Œè¿›ç¨‹/çº¿ç¨‹åˆæ˜¯ä¾èµ–äºæ“ä½œç³»ç»Ÿå­˜åœ¨çš„ï¼Œæ‰€ä»¥è‡ªç„¶ä¸èƒ½è„±ç¦»æ“ä½œç³»ç»Ÿæ¥è®¨è®ºé˜»å¡éé˜»å¡ã€‚</li>
<li>åŒæ­¥/å¼‚æ­¥ä¹Ÿæ˜¯è·Ÿä»»åŠ¡æµç›¸å…³çš„ï¼Œæ‰€ä»¥ä¸¾ä¾‹å­å¿…é¡»è€ƒè™‘åˆ°å¹¶å‘çš„ä»»åŠ¡æµï¼Œä¸ç„¶ï¼Œè‚¯å®šå¾ˆéš¾ä¸¾å‡ºæ°å½“çš„ä¾‹å­çš„ã€‚</li>
</ul>
<p>æœ¬æ–‡çš„è®¨è®ºï¼š</p>
<ul>
<li>é™å®šLinuxç¯å¢ƒä¸‹çš„network IOä½œä¸ºèƒŒæ™¯æ¥è®¨è®ºåŒæ­¥/å¼‚æ­¥ã€é˜»å¡/éé˜»å¡çš„ç†è§£ã€‚[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/#fn:1">1]</a>[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/#fn:2">2]</a>[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/#fn:4">4]</a></li>
<li>è®¨è®ºJavaä¸­å¯¹åº”çš„ç¼–ç¨‹æ¨¡å‹</li>
<li>å¯¹æ¯”BIO/NIOçš„åŒºåˆ«[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/#fn:3">3]</a></li>
</ul>
<h2 id="1-Linuxä¸‹çš„äº”ç§I-Oæ¨¡å‹"><a href="#1-Linuxä¸‹çš„äº”ç§I-Oæ¨¡å‹" class="headerlink" title="1. Linuxä¸‹çš„äº”ç§I/Oæ¨¡å‹"></a>1. Linuxä¸‹çš„äº”ç§I/Oæ¨¡å‹</h2><p>Stevensåœ¨æ–‡ç« ä¸­ä¸€å…±æ¯”è¾ƒäº†äº”ç§IO Modelï¼š</p>
<ul>
<li>blocking IO</li>
<li>nonblocking IO</li>
<li>IO multiplexing</li>
<li>signal driven IO</li>
<li>asynchronous IO</li>
</ul>
<p>ç”±äºsignal driven IOåœ¨å®é™…ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥åªæåŠå‰©ä¸‹çš„å››ç§IO Modelã€‚</p>
<blockquote>
<p>IOå‘ç”Ÿæ—¶æ¶‰åŠçš„å¯¹è±¡å’Œæ­¥éª¤:</p>
<ul>
<li>å¯¹äºä¸€ä¸ªnetwork IO (è¿™é‡Œæˆ‘ä»¬ä»¥readä¸¾ä¾‹)ï¼Œå®ƒä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªç³»ç»Ÿå¯¹è±¡:<ul>
<li>ä¸€ä¸ªæ˜¯è°ƒç”¨è¿™ä¸ªIOçš„process (or thread)</li>
<li>å¦ä¸€ä¸ªå°±æ˜¯ç³»ç»Ÿå†…æ ¸(kernel)</li>
</ul>
</li>
<li>å½“ä¸€ä¸ªreadæ“ä½œå‘ç”Ÿæ—¶ï¼Œå®ƒä¼šç»å†ä¸¤ä¸ªé˜¶æ®µï¼š<br>1 ç­‰å¾…æ•°æ®å‡†å¤‡ (Waiting for the data to be ready)<br>2 å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°è¿›ç¨‹ä¸­ (Copying the data from the kernel to the process)</li>
<li>è®°ä½è¿™ä¸¤ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºè¿™äº›IO Modelçš„åŒºåˆ«å°±æ˜¯åœ¨ä¸¤ä¸ªé˜¶æ®µä¸Šå„æœ‰ä¸åŒçš„æƒ…å†µã€‚</li>
</ul>
</blockquote>
<h3 id="1-1-é˜»å¡I-Oï¼ˆblocking-I-Oï¼‰"><a href="#1-1-é˜»å¡I-Oï¼ˆblocking-I-Oï¼‰" class="headerlink" title="1.1 é˜»å¡I/Oï¼ˆblocking I/Oï¼‰"></a>1.1 é˜»å¡I/Oï¼ˆblocking I/Oï¼‰</h3><p>åœ¨linuxä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„socketéƒ½æ˜¯blockingï¼Œä¸€ä¸ªå…¸å‹çš„è¯»æ“ä½œæµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·:</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/1_blockingIO.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/1_blockingIO.png" alt="img"></a></p>
<ul>
<li><p>ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡æ•°æ®</p>
<p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†recvfromè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œkernelå°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ã€‚å¯¹äºnetwork ioæ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æ•°æ®åœ¨ä¸€å¼€å§‹è¿˜æ²¡æœ‰åˆ°è¾¾ï¼ˆæ¯”å¦‚ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„UDPåŒ…ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™kernelå°±è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®åˆ°æ¥ã€‚è€Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿™è¾¹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«é˜»å¡ã€‚</p>
</li>
<li><p>ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®æ‹·è´</p>
<p>å½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»kernelä¸­æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œç„¶åkernelè¿”å›ç»“æœï¼Œç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œèµ·æ¥ã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œblocking IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½è¢«blockäº†ã€‚ä»¥ä¸‹æ˜¯javaå®ç°çš„æœåŠ¡å™¨bioä»£ç ï¼ˆéœ€è¦æŒæ¡ï¼‰ï¼Œæ³¨æ„é˜»å¡æ–¹æ³•é˜»å¡çš„ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; BIOé˜»å¡ä»£ç </span><br><span class="line">public class ServerTcpSocket &#123;</span><br><span class="line">    static byte[] bytes &#x3D; new byte[1024];</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ExecutorService executorService &#x3D; Executors.newCachedThreadPool();</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F; 1.åˆ›å»ºä¸€ä¸ªServerSocketè¿æ¥</span><br><span class="line">            final ServerSocket serverSocket &#x3D; new ServerSocket();</span><br><span class="line">            &#x2F;&#x2F; 2.ç»‘å®šç«¯å£å·</span><br><span class="line">            serverSocket.bind(new InetSocketAddress(8080));</span><br><span class="line">            &#x2F;&#x2F; 3.å½“å‰çº¿ç¨‹æ”¾å¼ƒcpuèµ„æºç­‰å¾…è·å–æ•°æ®</span><br><span class="line">            System.out.println(&quot;ç­‰å¾…è·å–æ•°æ®...&quot;);</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                final Socket socket &#x3D; serverSocket.accept(); &#x2F;&#x2F; é˜»å¡æ–¹æ³•</span><br><span class="line">                executorService.execute(new Runnable() &#123;</span><br><span class="line">                    public void run() &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                            System.out.println(&quot;è·å–åˆ°æ•°æ®...&quot;);</span><br><span class="line">                            &#x2F;&#x2F; 4.è¯»å–æ•°æ®</span><br><span class="line">                            int read &#x3D; socket.getInputStream().read(bytes); &#x2F;&#x2F; ä¼šé˜»å¡</span><br><span class="line">                            String result &#x3D; new String(bytes);</span><br><span class="line">                            System.out.println(result);</span><br><span class="line">                        &#125; catch (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><strong>åº”ç”¨ç¨‹åº</strong>æƒ³è¦è¯»å–æ•°æ®å°±ä¼šè°ƒç”¨<code>recvfrom</code>,è€Œ<code>recvfrom</code>ä¼šé€šçŸ¥OSæ¥æ‰§è¡Œï¼ŒOSå°±ä¼šåˆ¤æ–­<strong>æ•°æ®æŠ¥æ˜¯å¦å‡†å¤‡å¥½</strong>(æ¯”å¦‚åˆ¤æ–­æ˜¯å¦æ”¶åˆ°äº†ä¸€ä¸ªå®Œæ•´çš„UDPæŠ¥æ–‡ï¼Œå¦‚æœæ”¶åˆ°UDPæŠ¥æ–‡ä¸å®Œæ•´ï¼Œé‚£ä¹ˆå°±ç»§ç»­ç­‰å¾…)ã€‚å½“æ•°æ®åŒ…å‡†å¤‡å¥½äº†ä¹‹åï¼ŒOSå°±ä¼š<strong>å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</strong>(å› ä¸ºæˆ‘ä»¬çš„ç”¨æˆ·ç¨‹åºåªèƒ½è·å–ç”¨æˆ·ç©ºé—´çš„å†…å­˜ï¼Œæ— æ³•ç›´æ¥è·å–å†…æ ¸ç©ºé—´çš„å†…å­˜)ã€‚æ‹·è´å®Œæˆä¹‹å<code>socket.read()</code>å°±ä¼šè§£é™¤é˜»å¡ï¼Œå¹¶å¾—åˆ°readçš„ç»“æœã€‚</p>
<h3 id="1-2-éé˜»å¡ï¼ˆNon-Blocking-IOï¼‰"><a href="#1-2-éé˜»å¡ï¼ˆNon-Blocking-IOï¼‰" class="headerlink" title="1.2 éé˜»å¡ï¼ˆNon-Blocking IOï¼‰"></a>1.2 éé˜»å¡ï¼ˆNon-Blocking IOï¼‰</h3><p>linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®socketä½¿å…¶å˜ä¸ºnon-blockingã€‚å½“å¯¹ä¸€ä¸ªnon-blocking socketæ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œæµç¨‹æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/2_nonblockingIO.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/2_nonblockingIO.png" alt="img"></a></p>
<ul>
<li><p>ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡æ•°æ®</p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“ç”¨æˆ·è¿›ç¨‹å‘å‡ºreadæ“ä½œæ—¶ï¼Œå¦‚æœkernelä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸ä¼šblockç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹åˆ»è¿”å›ä¸€ä¸ªerrorã€‚ä»ç”¨æˆ·è¿›ç¨‹è§’åº¦è®² ï¼Œå®ƒå‘èµ·ä¸€ä¸ªreadæ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœã€‚ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­ç»“æœæ˜¯ä¸€ä¸ªerroræ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€readæ“ä½œã€‚</p>
</li>
<li><p>ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®æ‹·è´</p>
<p>ä¸€æ—¦kernelä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·è¿›ç¨‹çš„system callï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·å†…å­˜ï¼Œç„¶åè¿”å›ã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œç”¨æˆ·è¿›ç¨‹å…¶å®æ˜¯éœ€è¦ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®kernelæ•°æ®å¥½äº†æ²¡æœ‰ã€‚ä¸€å®šè¦æ³¨æ„è¿™ä¸ªåœ°æ–¹ï¼Œ<strong>Non-Blockingè¿˜æ˜¯ä¼šé˜»å¡çš„</strong>ã€‚</p>
<p>ä»¥ä¸‹æ˜¯javaå®ç°çš„æœåŠ¡å™¨bioä»£ç ï¼ˆéœ€è¦æŒæ¡ï¼‰ï¼Œæ³¨æ„æ•°æ®å‡†å¤‡é˜¶æ®µæ˜¯éé˜»å¡æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; NIOéé˜»å¡å¼ä»£ç </span><br><span class="line">public class ServerNioTcpSocket &#123;</span><br><span class="line">    static ByteBuffer byteBuffer &#x3D; ByteBuffer.allocate(512);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F; 1.åˆ›å»ºä¸€ä¸ªServerSocketChannelè¿æ¥</span><br><span class="line">            final ServerSocketChannel serverSocketChannel &#x3D; ServerSocketChannel.open();</span><br><span class="line">            &#x2F;&#x2F; 2.ç»‘å®šç«¯å£å·</span><br><span class="line">            serverSocketChannel.bind(new InetSocketAddress(8080));</span><br><span class="line">            &#x2F;&#x2F; è®¾ç½®ä¸ºéé˜»å¡å¼</span><br><span class="line">            serverSocketChannel.configureBlocking(false);</span><br><span class="line">            &#x2F;&#x2F; éé˜»å¡å¼</span><br><span class="line">            SocketChannel socketChannel &#x3D; serverSocketChannel.accept(); </span><br><span class="line">            if (socketChannel !&#x3D; null) &#123;</span><br><span class="line">                int j &#x3D; socketChannel.read(byteBuffer);  &#x2F;&#x2F; æ­¤å¤„ä¸ä¼šé˜»å¡</span><br><span class="line">                if (j &gt; 0) &#123;</span><br><span class="line">                    byte[] bytes &#x3D; Arrays.copyOf(byteBuffer.array(), byteBuffer.limit());</span><br><span class="line">                    System.out.println(&quot;è·å–åˆ°æ•°æ®&quot; + new String(bytes));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;ç¨‹åºæ‰§è¡Œå®Œæ¯•..&quot;);</span><br><span class="line"></span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>NIOä¸­æä¾›äº†é›†ä¸­Channelï¼š<code>ServerSocketChannelï¼›SocketChannelï¼›FileChannelï¼›</code> <code>DatagramChannel</code>åªæœ‰<code>FileChannel</code>æ— æ³•è®¾ç½®æˆéé˜»å¡æ¨¡å¼ï¼Œå…¶ä»–Channeléƒ½å¯ä»¥è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚</p>
<p>å½“è®¾ç½®ä¸ºéé˜»å¡åï¼Œæˆ‘ä»¬çš„<code>socket.read()</code>æ–¹æ³•å°±ä¼šç«‹å³å¾—åˆ°ä¸€ä¸ªè¿”å›ç»“æœ(æˆåŠŸ or å¤±è´¥)ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿”å›ç»“æœæ‰§è¡Œä¸åŒçš„é€»è¾‘ï¼Œæ¯”å¦‚åœ¨å¤±è´¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›å…¶ä»–çš„äº‹æƒ…ã€‚ä½†äº‹å®ä¸Šè¿™ç§æ–¹å¼ä¹Ÿæ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨è½®è¯¢æ–¹æ³•åŒºä¸€ç›´é—®OSï¼šâ€œæˆ‘çš„æ•°æ®å¥½äº†æ²¡å•Šâ€ã€‚ç¬¬ä¸€ä¸ªä»£ç æ˜¯è¯¥çº¿ç¨‹ä¸æ–­çš„è½®è¯¢ï¼Œç¬¬äºŒä¸ªä»£ç æ˜¯ä½¿ç”¨selectorå®ç°è½®è¯¢ç­‰å¾…æœ‰æ•ˆè¯·æ±‚ã€‚</p>
<p>NIO ä¸ä¼šåœ¨<code>recvfrom</code>ä¹Ÿå°±æ˜¯<code>socket.read()</code>æ—¶å€™é˜»å¡ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šåœ¨<strong>å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</strong>é˜»å¡ã€‚</p>
<h3 id="1-3-I-Oå¤ç”¨-IO-multiplexing"><a href="#1-3-I-Oå¤ç”¨-IO-multiplexing" class="headerlink" title="1.3 I/Oå¤ç”¨ IO multiplexing"></a>1.3 I/Oå¤ç”¨ IO multiplexing</h3><p>IO multiplexingè¿™ä¸ªè¯å¯èƒ½æœ‰ç‚¹é™Œç”Ÿï¼Œä½†æ˜¯å¦‚æœæˆ‘è¯´selectï¼Œepollï¼Œå¤§æ¦‚å°±éƒ½èƒ½æ˜ç™½äº†ã€‚</p>
<p>æœ‰äº›åœ°æ–¹ä¹Ÿç§°è¿™ç§IOæ–¹å¼ä¸ºevent driven IOã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œselect/epollçš„å¥½å¤„å°±åœ¨äºå•ä¸ªprocesså°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥çš„IOã€‚</p>
<p>å®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯select/epollè¿™ä¸ªfunctionä¼šä¸æ–­çš„è½®è¯¢æ‰€è´Ÿè´£çš„æ‰€æœ‰socketï¼Œå½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚å®ƒçš„æµç¨‹å¦‚å›¾ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/2_IOmultiplexing.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/2_IOmultiplexing.png" alt="img"></a></p>
<p>è¿™é‡Œç”¨javaçš„NIOç¤ºæ„select</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; æœåŠ¡ç«¯ä»£ç </span><br><span class="line">public class NIOServer&#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç«¯å£è¿›è¡Œç›‘å¬çš„æœåŠ¡Socketé€šé“ï¼Œå¹¶è®¾ç½®ä¸ºéé˜»å¡æ–¹å¼</span><br><span class="line">        ServerSocketChannel ssc &#x3D; ServerSocketChannel.open();</span><br><span class="line">        &#x2F;&#x2F; å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ‰èƒ½å¾€selectorä¸Šæ³¨å†Œï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œselectoræ¨¡å¼ç”­è¯´å°±æ˜¯éé˜»å¡æ¨¡å¼</span><br><span class="line">        ssc.configureBlocking(false); </span><br><span class="line">        ssc.bind(new InetSocketAddress(8888));</span><br><span class="line">        &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªé€‰æ‹©å™¨selector</span><br><span class="line">        Selector selector &#x3D; selector.open();</span><br><span class="line">        &#x2F;&#x2F; æŠŠServerSocketChannelæ³¨å†Œåˆ°selectorä¸Šï¼Œå¹¶ä¸”selectorå¯¹å®¢æˆ·ç«¯acceptè¿æ¥æ“ä½œæ„Ÿå…´è¶£</span><br><span class="line">        ssc.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        while(true)&#123;</span><br><span class="line">            System.out.println(&quot;ç­‰å¾…äº‹ä»¶å‘ç”Ÿ...&quot;);</span><br><span class="line">            &#x2F;&#x2F; è½®è¯¢ç›‘å¬channelé‡Œé¢çš„keyï¼Œselectæ˜¯é˜»å¡çš„ï¼Œacceptä¹Ÿæ˜¯é˜»å¡çš„</span><br><span class="line">            int select &#x3D; selector.select(); </span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;äº‹ä»¶å‘ç”Ÿäº†...&quot;);</span><br><span class="line">            &#x2F;&#x2F; æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¢«è½®è¯¢ç›‘å¬åˆ°</span><br><span class="line">            Iterator&lt;SelectionKey&gt; it &#x3D; selector.selectionKeys().iterator();</span><br><span class="line">            while(it.hasNext())&#123;</span><br><span class="line">                SelectionKey key &#x3D; it.next();</span><br><span class="line">                &#x2F;&#x2F; åˆ é™¤æœ¬æ¬¡å·²å¤„ç†çš„keyï¼Œ é˜²æ­¢ä¸‹æ¬¡selecté‡å¤å¤„ç†</span><br><span class="line">                it.remove();</span><br><span class="line">                handle(key);</span><br><span class="line">            &#125;      </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void handle(SelectionKey key) throws IOException&#123;</span><br><span class="line">        if(key.isAcceptable())&#123;</span><br><span class="line">            System.out.println(&quot;æœ‰å®¢æˆ·ç«¯è¿æ¥äº‹ä»¶å‘ç”Ÿäº†...&quot;);</span><br><span class="line">            ServerSocketChannel ssc &#x3D; (ServerSocketChannel) key.channel();</span><br><span class="line">            &#x2F;&#x2F; NIOéé˜»å¡ä½“ç°:æ­¤å¤„acceptæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œä½†æ˜¯è¿™é‡Œå› ä¸ºå‘ç”Ÿäº†è¿æ¥äº‹ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¼šé©¬ä¸Šæ‰§è¡Œå®Œï¼Œä¸ä¼šé˜»å¡</span><br><span class="line">            &#x2F;&#x2F; å¤„ç†å®Œè¿æ¥è¯·æ±‚ä¸ä¼šç»§ç»­ç­‰å¾…å®¢æˆ·ç«¯çš„æ•°æ®å‘é€</span><br><span class="line">            SocketChannel sc &#x3D; ssc.accept();</span><br><span class="line">            sc.configureBlocking(false);</span><br><span class="line">            &#x2F;&#x2F; é€šè¿‡Selectorç›‘å¬Channelæ—¶å¯¹è¯»äº‹ä»¶æ„Ÿå…´è¶£</span><br><span class="line">            sc.register(selector, SelectionKey.OP_READ); </span><br><span class="line">        &#125; else if (key.isReadable())&#123;</span><br><span class="line">            System.out.println(&quot;æœ‰å®¢æˆ·ç«¯æ•°æ®å¯è¯»äº‹ä»¶å‘ç”Ÿäº†...&quot;);</span><br><span class="line">            SocketChannel sc &#x3D; (SocketChannel) key.channel();</span><br><span class="line">            ByteBuffer buffer &#x3D; ByteBuffer.allocate(1024);</span><br><span class="line">            &#x2F;&#x2F; NIOéé˜»å¡ä½“ç°ï¼šé¦–å…ˆreadæ–¹æ³•ä¸ä¼šé˜»å¡ï¼Œå…¶æ¬¡è¿™ç§äº‹ä»¶å“åº”æ¨¡å‹ï¼Œå½“è°ƒç”¨åˆ°readæ–¹æ³•æ—¶è‚¯å®šæ—¶å‘ç”Ÿäº†å®¢æˆ·ç«¯å‘é€æ•°æ®çš„äº‹ä»¶</span><br><span class="line">            int len &#x3D; sc.read(buffer);</span><br><span class="line">            if(len !&#x3D; -1)&#123;</span><br><span class="line">                System.out.println(&quot;è¯»å–åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®:&quot; + new String(buffer.array(), 0, len));</span><br><span class="line">            &#125;</span><br><span class="line">            ByteBuffer bufferToWrite &#x3D; ByteBuffer.wrap(&quot;HelloClient&quot;.getBytes());</span><br><span class="line">            sc.write(bufferToWrite);</span><br><span class="line">            key.interestOps(SelectionKey.OP_READ | SelectionKey.OP_WRITE);</span><br><span class="line">        &#125; else if(key.isWritable) &#123;</span><br><span class="line">            SocketChannel sc &#x3D; (SocketChannel) key.channel();</span><br><span class="line">            System.out.println(&quot;writeäº‹ä»¶...&quot;);</span><br><span class="line">            &#x2F;&#x2F; NIOäº‹ä»¶è§¦å‘æ˜¯æ°´å¹³è§¦å‘</span><br><span class="line">            &#x2F;&#x2F; ä½¿ç”¨Javaçš„NIOç¼–ç¨‹æ—¶ï¼Œåœ¨æ²¡æœ‰æ•°æ®å¯ä»¥å¾€å¤–å†™çš„æ—¶å€™è¦å–æ¶ˆå†™äº‹ä»¶</span><br><span class="line">            &#x2F;&#x2F; åœ¨æœ‰æ•°æ®å¾€å¤–å†™çš„æ—¶å€™åœ¨æ³¨å†Œå†™äº‹ä»¶</span><br><span class="line">            key.interestOps(SelectionKey.OP_READ);</span><br><span class="line">            &#x2F;&#x2F; sc.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šè¢«blockï¼Œè€ŒåŒæ—¶ï¼Œkernelä¼šâ€œç›‘è§†â€æ‰€æœ‰selectè´Ÿè´£çš„socketï¼Œå½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›ã€‚è¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿›ç¨‹å†è°ƒç”¨readæ“ä½œï¼Œå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚</p>
<p>è¿™ä¸ªå›¾å’Œblocking IOçš„å›¾å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œäº‹å®ä¸Šï¼Œè¿˜æ›´å·®ä¸€äº›ã€‚å› ä¸ºè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªsystem call (select å’Œ recvfrom)ï¼Œè€Œblocking IOåªè°ƒç”¨äº†ä¸€ä¸ªsystem call (recvfrom)ã€‚ä½†æ˜¯ï¼Œç”¨selectçš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªconnectionã€‚</p>
<blockquote>
<p>å¤šè¯´ä¸€å¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¤„ç†çš„è¿æ¥æ•°ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½¿ç”¨select/epollçš„web serverä¸ä¸€å®šæ¯”ä½¿ç”¨multi-threading + blocking IOçš„web serveræ€§èƒ½æ›´å¥½ï¼Œå¯èƒ½å»¶è¿Ÿè¿˜æ›´å¤§ã€‚select/epollçš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºå•ä¸ªè¿æ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚</p>
</blockquote>
<p>åœ¨IO multiplexing Modelä¸­ï¼Œå®é™…ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªsocketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingï¼Œä½†æ˜¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªç”¨æˆ·çš„processå…¶å®æ˜¯ä¸€ç›´è¢«blockçš„ã€‚åªä¸è¿‡processæ˜¯è¢«selectè¿™ä¸ªå‡½æ•°blockï¼Œè€Œä¸æ˜¯è¢«socket IOç»™blockã€‚</p>
<h3 id="1-4-å¼‚æ­¥I-O-Asynchronous-IO"><a href="#1-4-å¼‚æ­¥I-O-Asynchronous-IO" class="headerlink" title="1.4 å¼‚æ­¥I/O(Asynchronous IO)"></a>1.4 å¼‚æ­¥I/O(Asynchronous IO)</h3><p>linuxä¸‹çš„asynchronous IOå…¶å®ç”¨å¾—å¾ˆå°‘(æ‰€ä»¥è¿™é‡Œå°±ä¸è´´AIOçš„javaä»£ç äº†ï¼Œä¸€èˆ¬ä¸è¦æ±‚æŒæ¡ï¼‰ã€‚å…ˆçœ‹ä¸€ä¸‹å®ƒçš„æµç¨‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/3_AsynchronousIO.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/3_AsynchronousIO.png" alt="img"></a></p>
<p>ç”¨æˆ·è¿›ç¨‹å‘èµ·readæ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚</p>
<p>è€Œå¦ä¸€æ–¹é¢ï¼Œä»kernelçš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ªasynchronous readä¹‹åï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½•blockã€‚ç„¶åï¼Œkernelä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œkernelä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ªsignalï¼Œå‘Šè¯‰å®ƒreadæ“ä½œå®Œæˆäº†ã€‚</p>
<p>Asynchronous IOè°ƒç”¨ä¸­æ˜¯çœŸæ­£çš„æ— é˜»å¡ï¼Œå…¶ä»–IO modelä¸­å¤šå°‘ä¼šæœ‰ç‚¹é˜»å¡ã€‚</p>
<h3 id="1-5-åŸºäºå››ä¸ªæ¨¡å‹ï¼Œå¯¹blockingå’Œnon-blockingï¼Œsynchronous-IOå’Œasynchronous-IOçš„ç†è§£"><a href="#1-5-åŸºäºå››ä¸ªæ¨¡å‹ï¼Œå¯¹blockingå’Œnon-blockingï¼Œsynchronous-IOå’Œasynchronous-IOçš„ç†è§£" class="headerlink" title="1.5 åŸºäºå››ä¸ªæ¨¡å‹ï¼Œå¯¹blockingå’Œnon-blockingï¼Œsynchronous IOå’Œasynchronous IOçš„ç†è§£"></a>1.5 åŸºäºå››ä¸ªæ¨¡å‹ï¼Œå¯¹blockingå’Œnon-blockingï¼Œsynchronous IOå’Œasynchronous IOçš„ç†è§£</h3><p>å…¶å®æ˜¯POSIXçš„å®šä¹‰æ˜¯è¿™æ ·å­çš„ï¼š</p>
<ul>
<li>A synchronous I/O operation causes the requesting process to be blocked until that I/O operation completes;</li>
<li>An asynchronous I/O operation does not cause the requesting process to be blocked;</li>
</ul>
<p>æ ¸å¿ƒåŒºåˆ«æ˜¯ï¼šsynchronous IOåšâ€IO operationâ€çš„æ—¶å€™ä¼šå°†processé˜»å¡</p>
<ol>
<li>blocking IOï¼Œnon-blocking IOï¼ŒIO multiplexingéƒ½å±äºsynchronous IOã€‚</li>
<li>è€Œasynchronous IO,å½“è¿›ç¨‹å‘èµ·IO æ“ä½œä¹‹åï¼Œå°±ç›´æ¥è¿”å›å†ä¹Ÿä¸ç†ç¬äº†ï¼Œç›´åˆ°kernelå‘é€ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰è¿›ç¨‹è¯´IOå®Œæˆã€‚åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹å®Œå…¨æ²¡æœ‰è¢«blockã€‚</li>
</ol>
<blockquote>
<p>æœ‰äººå¯èƒ½ä¼šè¯´ï¼Œnon-blocking IOå¹¶æ²¡æœ‰è¢«blockå•Šã€‚è¿™é‡Œæœ‰ä¸ªéå¸¸â€œç‹¡çŒ¾â€çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸­æ‰€æŒ‡çš„â€IO operationâ€æ˜¯æŒ‡çœŸå®çš„IOæ“ä½œï¼Œå°±æ˜¯ä¾‹å­ä¸­çš„recvfromè¿™ä¸ªsystem callã€‚non-blocking IOåœ¨æ‰§è¡Œrecvfromè¿™ä¸ªsystem callçš„æ—¶å€™ï¼Œå¦‚æœkernelçš„æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¿™æ—¶å€™ä¸ä¼šblockè¿›ç¨‹ã€‚ä½†æ˜¯ï¼Œå½“kernelä¸­æ•°æ®å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œrecvfromä¼šå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·å†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™è¿›ç¨‹æ˜¯è¢«blockäº†ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹æ˜¯è¢«blockçš„ã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/4_ComparisonOfTheFiveIO.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/4_ComparisonOfTheFiveIO.png" alt="img"></a></p>
<p>ç»è¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œä¼šå‘ç°non-blocking IOå’Œasynchronous IOçš„åŒºåˆ«è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚åœ¨non-blocking IOä¸­ï¼Œè™½ç„¶è¿›ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸ä¼šè¢«blockï¼Œä½†æ˜¯å®ƒä»ç„¶è¦æ±‚è¿›ç¨‹å»ä¸»åŠ¨çš„checkï¼Œå¹¶ä¸”å½“æ•°æ®å‡†å¤‡å®Œæˆä»¥åï¼Œä¹Ÿéœ€è¦è¿›ç¨‹ä¸»åŠ¨çš„å†æ¬¡è°ƒç”¨recvfromæ¥å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ã€‚è€Œasynchronous IOåˆ™å®Œå…¨ä¸åŒã€‚å®ƒå°±åƒæ˜¯ç”¨æˆ·è¿›ç¨‹å°†æ•´ä¸ªIOæ“ä½œäº¤ç»™äº†ä»–äººï¼ˆkernelï¼‰å®Œæˆï¼Œç„¶åä»–äººåšå®Œåå‘ä¿¡å·é€šçŸ¥ã€‚åœ¨æ­¤æœŸé—´ï¼Œç”¨æˆ·è¿›ç¨‹ä¸éœ€è¦å»æ£€æŸ¥IOæ“ä½œçš„çŠ¶æ€ï¼Œä¹Ÿä¸éœ€è¦ä¸»åŠ¨çš„å»æ‹·è´æ•°æ®ã€‚</p>
<h3 id="1-6-selectï¼Œpollï¼ŒepollåŒºåˆ«"><a href="#1-6-selectï¼Œpollï¼ŒepollåŒºåˆ«" class="headerlink" title="1.6 selectï¼Œpollï¼ŒepollåŒºåˆ«"></a>1.6 selectï¼Œpollï¼ŒepollåŒºåˆ«</h3><p>ä»–ä»¬æ˜¯NIOä¸­å¤šè·¯å¤ç”¨çš„ä¸‰ç§å®ç”¨æœºåˆ¶ï¼ˆåº•å±‚æ˜¯ä¸‰ä¸ªC++çš„APIï¼‰ï¼Œæ˜¯ç”±Linuxæ“ä½œç³»ç»Ÿæä¾›çš„ã€‚</p>
<p>Unixï¼ŒLinuxæ“ä½œç³»ç»Ÿçš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ï¼š</p>
<ul>
<li>ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ï¼šæ“ä½œç³»ç»Ÿä¸ºäº†ä¿æŠ¤ç³»ç»Ÿå®‰å…¨ï¼Œå°†å†…æ ¸åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·ç©ºé—´ï¼Œä¸€ä¸ªæ˜¯å†…æ ¸ç©ºé—´ã€‚ç”¨æˆ·ç©ºé—´ä¸èƒ½ç›´æ¥è®¿é—®åº•å±‚çš„ç¡¬ä»¶è®¾å¤‡ï¼Œå¿…é¡»é€šè¿‡å†…æ ¸ç©ºé—´</li>
<li>æ–‡ä»¶æè¿°ç¬¦File Descriptorï¼ˆFDï¼‰ï¼šæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå½¢å¼ä¸Šæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ã€‚æŒ‡å‘å†…æ ¸ä¸­ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹ç»´æŠ¤è¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå†…æ ¸å°±ä¼šå‘è¿›ç¨‹è¿”å›ä¸€ä¸ªFDã€‚</li>
</ul>
<blockquote>
<p>selectæœºåˆ¶ï¼šä¼šç»´æŠ¤ä¸€ä¸ªFDçš„é›†åˆfd_setã€‚å°†fd_setä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œæ¿€æ´»socketã€‚ï¼ˆfd_setæ˜¯ä¸€ä¸ªæ•°ç»„ç»“æ„ï¼Œæ‹·è´å¤§å°å—é™åˆ¶ x64æœ€å¤§2048ï¼‰</p>
<p>pollæœºåˆ¶ï¼šå’Œselectæœºåˆ¶å·®ä¸å¤šçš„ã€‚å°†fd_setç»“æ„è¿›è¡Œäº†ä¼˜åŒ–ï¼ŒFDé›†åˆå¤§å°çªç ´äº†æ“ä½œç³»ç»Ÿé™åˆ¶ã€‚ï¼ˆpollfdç»“æ„æ¥ä»£æ›¿fd_setï¼Œé€šè¿‡é“¾è¡¨å®ç°çš„ï¼‰</p>
<p>Epollæœºåˆ¶ï¼šEvent Pollä¸åœ¨æ‰«ææ‰€æœ‰çš„FDï¼Œåªå°†ç”¨æˆ·å…³å¿ƒçš„FDçš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨å½“ä¸­ã€‚å¯ä»¥å‡å°‘ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ä¹‹é—´éœ€è¦æ‹·è´çš„æ•°æ®ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th>æ“ä½œæ–¹å¼</th>
<th>åº•å±‚å®ç°</th>
<th>æœ€å¤§è¿æ¥æ•°</th>
<th>IOæ•ˆç‡</th>
</tr>
</thead>
<tbody><tr>
<td>selectï¼ˆ1984ï¼‰</td>
<td>éå†</td>
<td>æ•°ç»„</td>
<td>å—é™äºå†…æ ¸</td>
<td>ä¸€èˆ¬</td>
</tr>
<tr>
<td>pollï¼ˆ1997ï¼‰</td>
<td>éå†</td>
<td>é“¾è¡¨</td>
<td>æ— ä¸Šé™</td>
<td>ä¸€èˆ¬</td>
</tr>
<tr>
<td>epollï¼ˆ2002ï¼‰</td>
<td>äº‹ä»¶å›è°ƒ</td>
<td>çº¢é»‘æ ‘</td>
<td>æ— ä¸Šé™</td>
<td>é«˜</td>
</tr>
</tbody></table>
<p>Java NIOå½“ä¸­æ˜¯ä½¿ç”¨å“ªä¸€ç§æœºåˆ¶ï¼Ÿ</p>
<p>åŸºäºå†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥æŸ¥çœ‹DefaultSelectorProvideræºç ï¼š</p>
<ul>
<li>windowsä¸‹ï¼ŒWindowsSelectorProviderã€‚</li>
<li>Linuxä¸‹ï¼Œå†…æ ¸2.6ç‰ˆæœ¬ä»¥ä¸Šï¼Œå°±æ˜¯EpollSelectorProviderï¼Œå¦åˆ™å°±æ˜¯é»˜è®¤çš„PollSelectorProviderã€‚</li>
</ul>
<h2 id="2-Javaçš„IOç¼–ç¨‹æ¨¡å‹"><a href="#2-Javaçš„IOç¼–ç¨‹æ¨¡å‹" class="headerlink" title="2. Javaçš„IOç¼–ç¨‹æ¨¡å‹"></a>2. Javaçš„IOç¼–ç¨‹æ¨¡å‹</h2><blockquote>
<p>BIO åŒæ­¥é˜»å¡IOã€‚ å¯é æ€§å·®ï¼Œååé‡ä½ï¼Œé€‚ç”¨äºè¿æ¥æ¯”è¾ƒå°‘ä¸”æ¯”è¾ƒå›ºå®šçš„åœºæ™¯ã€‚JDK1.4ä¹‹å‰å”¯ä¸€çš„é€‰æ‹©ã€‚</p>
<p>ç¼–ç¨‹æ¨¡å‹æœ€ç®€å•ã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_BIO%E7%BB%93%E6%9E%841.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_BIO%E7%BB%93%E6%9E%841.png" alt="img"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å¤ä¹ é»‘é©¬æ–‡ä»¶ä¸Šä¼ çš„æœåŠ¡ç«¯BIOä»£ç </span><br><span class="line">public class FileUpload_Server &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        System.out.println(&quot;æœåŠ¡å™¨ å¯åŠ¨..... &quot;);</span><br><span class="line">        &#x2F;&#x2F; 1. åˆ›å»ºæœåŠ¡ç«¯ServerSocket</span><br><span class="line">        ServerSocket serverSocket &#x3D; new ServerSocket(6666);</span><br><span class="line">        &#x2F;&#x2F; 2. å¾ªç¯æ¥æ”¶,å»ºç«‹è¿æ¥</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            Socket accept &#x3D; serverSocket.accept(); &#x2F;&#x2F; é˜»å¡æ–¹æ³•</span><br><span class="line">            &#x2F;*</span><br><span class="line">            3. socketå¯¹è±¡äº¤ç»™å­çº¿ç¨‹å¤„ç†,è¿›è¡Œè¯»å†™æ“ä½œ</span><br><span class="line">            Runnableæ¥å£ä¸­,åªæœ‰ä¸€ä¸ªrunæ–¹æ³•,ä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ ¼å¼</span><br><span class="line">            *&#x2F;</span><br><span class="line">            new Thread(() â€&gt; &#123;</span><br><span class="line">                try (</span><br><span class="line">                    &#x2F;&#x2F;3.1 è·å–è¾“å…¥æµå¯¹è±¡</span><br><span class="line">                    BufferedInputStream bis &#x3D; new BufferedInputStream(accept.getInputStream());</span><br><span class="line">                    &#x2F;&#x2F;3.2 åˆ›å»ºè¾“å‡ºæµå¯¹è±¡, ä¿å­˜åˆ°æœ¬åœ° .</span><br><span class="line">                    FileOutputStream fis &#x3D; new FileOutputStream(System.currentTimeMillis() +</span><br><span class="line">                    &quot;.jpg&quot;);</span><br><span class="line">                    BufferedOutputStream bos &#x3D; new BufferedOutputStream(fis);) &#123;</span><br><span class="line">                    &#x2F;&#x2F; 3.3 è¯»å†™æ•°æ®</span><br><span class="line">                    byte[] b &#x3D; new byte[1024 * 8];</span><br><span class="line">                    int len;</span><br><span class="line">                    while ((len &#x3D; bis.read(b)) !&#x3D; â€1) &#123;</span><br><span class="line">                        bos.write(b, 0, len);</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F;4. å…³é—­ èµ„æº</span><br><span class="line">                    bos.close();</span><br><span class="line">                    bis.close();</span><br><span class="line">                    accept.close();</span><br><span class="line">                    System.out.println(&quot;æ–‡ä»¶ä¸Šä¼ å·²ä¿å­˜&quot;);</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¦‚æœä¸æ´»è·ƒçš„è¿æ¥é€æ¸å¢å¤šï¼Œçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ…¢æ…¢çš„ä¹Ÿéƒ½å¼€å§‹é˜»å¡ç­‰å¾…IOï¼Œçº¿ç¨‹æ± é‡ŒçœŸæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°ä¼šè¶Šæ¥è¶Šå°‘ï¼Œå½“çº¿ç¨‹æ± å¤„ç†ä¸è¿‡æ¥æ—¶ï¼Œä¼šæ”¾ç½®åˆ°çº¿ç¨‹æ± é…ç½®çš„BlockingQueueä¸­ï¼Œé˜Ÿåˆ—å¡æ»¡åï¼Œæ…¢æ…¢çš„çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°ç›®ä¼šé€æ¸è¾¾åˆ°çº¿ç¨‹æ± é…ç½®çš„maximumPoolSizeï¼Œå¦‚æœå†å¤„ç†ä¸è¿‡æ¥ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>æœ€ç»ˆä¼šå¯¼è‡´è¯·æ±‚æ— æ³•åŠæ—¶å¤„ç†ã€‚</code></p>
<p>è¿™æ ·å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œå‡è®¾æœ‰çº¿ç¨‹æ± corePoolSizeè®¾ç½®ä¸º100ï¼Œåªè¦æœ‰100ä¸ªä¸æ´»è·ƒçš„è¿æ¥æ­£åœ¨é˜»å¡è¯»å†™IOï¼Œå°±ä¼šæŠŠå‰corePoolSizeçº¿ç¨‹éƒ½é˜»å¡ä½ï¼Œåç»­çš„è¯·æ±‚å°±æ— æ³•åŠæ—¶å¤„ç†ã€‚</p>
<blockquote>
<p>NIO åŒæ­¥éé˜»å¡IOã€‚ å¯é æ€§æ¯”è¾ƒå¥½ï¼Œååé‡ä¹Ÿæ¯”è¾ƒé«˜ï¼Œé€‚ç”¨äºè¿æ¥æ¯”è¾ƒå¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰ã€‚ä¾‹å¦‚èŠå¤©å®¤ã€‚JDK1.4å¼€å§‹æ”¯æŒã€‚ï¼ˆåº”ç”¨æœ€å¹¿ï¼‰</p>
<p>ç¼–ç¨‹æ¨¡å‹æœ€å¤æ‚ã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_NIO%E7%BB%93%E6%9E%84.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_NIO%E7%BB%93%E6%9E%84.png" alt="img"></a></p>
<p>NIOéé˜»å¡ä½“ç°:</p>
<ul>
<li>acceptæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œä½†æ˜¯è¿™é‡Œå› ä¸ºå‘ç”Ÿäº†è¿æ¥äº‹ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¼šé©¬ä¸Šæ‰§è¡Œå®Œï¼Œä¸ä¼šé˜»å¡</li>
<li>é¦–å…ˆreadæ–¹æ³•ä¸ä¼šé˜»å¡ï¼Œå…¶æ¬¡è¿™ç§äº‹ä»¶å“åº”æ¨¡å‹ï¼Œå½“è°ƒç”¨åˆ°readæ–¹æ³•æ—¶è‚¯å®šæ—¶å‘ç”Ÿäº†å®¢æˆ·ç«¯å‘é€æ•°æ®çš„äº‹ä»¶</li>
</ul>
<p>(æˆ‘çš„ä¸€äº›çœ‹æ³•ï¼Œjavaçš„NIOå°±æ˜¯Linuxä¸­IOå¤ç”¨å’ŒNIOä¸¤ä¸ªæ¨¡å‹çš„ç»“åˆ)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; æœåŠ¡ç«¯ä»£ç </span><br><span class="line">public class NIOServer&#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç«¯å£è¿›è¡Œç›‘å¬çš„æœåŠ¡Socketé€šé“ï¼Œå¹¶è®¾ç½®ä¸ºéé˜»å¡æ–¹å¼</span><br><span class="line">        ServerSocketChannel ssc &#x3D; ServerSocketChannel.open();</span><br><span class="line">        &#x2F;&#x2F; å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ‰èƒ½å¾€selectorä¸Šæ³¨å†Œï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œselectoræ¨¡å¼ç”­è¯´å°±æ˜¯éé˜»å¡æ¨¡å¼</span><br><span class="line">        ssc.configureBlocking(false); </span><br><span class="line">        ssc.bind(new InetSocketAddress(8888));</span><br><span class="line">        &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ªé€‰æ‹©å™¨selector</span><br><span class="line">        Selector selector &#x3D; selector.open();</span><br><span class="line">        &#x2F;&#x2F; æŠŠServerSocketChannelæ³¨å†Œåˆ°selectorä¸Šï¼Œå¹¶ä¸”selectorå¯¹å®¢æˆ·ç«¯acceptè¿æ¥æ“ä½œæ„Ÿå…´è¶£</span><br><span class="line">        ssc.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        while(true)&#123;</span><br><span class="line">            System.out.println(&quot;ç­‰å¾…äº‹ä»¶å‘ç”Ÿ...&quot;);</span><br><span class="line">            &#x2F;&#x2F; è½®è¯¢ç›‘å¬channelé‡Œé¢çš„keyï¼Œselectæ˜¯é˜»å¡çš„ï¼Œacceptä¹Ÿæ˜¯é˜»å¡çš„</span><br><span class="line">            int select &#x3D; selector.select(); </span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;äº‹ä»¶å‘ç”Ÿäº†...&quot;);</span><br><span class="line">            &#x2F;&#x2F; æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¢«è½®è¯¢ç›‘å¬åˆ°</span><br><span class="line">            Iterator&lt;SelectionKey&gt; it &#x3D; selector.selectionKeys().iterator();</span><br><span class="line">            while(it.hasNext())&#123;</span><br><span class="line">                SelectionKey key &#x3D; it.next();</span><br><span class="line">                &#x2F;&#x2F; åˆ é™¤æœ¬æ¬¡å·²å¤„ç†çš„keyï¼Œ é˜²æ­¢ä¸‹æ¬¡selecté‡å¤å¤„ç†</span><br><span class="line">                it.remove();</span><br><span class="line">                handle(key);</span><br><span class="line">            &#125;      </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void handle(SelectionKey key) throws IOException&#123;</span><br><span class="line">        if(key.isAcceptable())&#123;</span><br><span class="line">            System.out.println(&quot;æœ‰å®¢æˆ·ç«¯è¿æ¥äº‹ä»¶å‘ç”Ÿäº†...&quot;);</span><br><span class="line">            ServerSocketChannel ssc &#x3D; (ServerSocketChannel) key.channel();</span><br><span class="line">            &#x2F;&#x2F; NIOéé˜»å¡ä½“ç°:æ­¤å¤„acceptæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œä½†æ˜¯è¿™é‡Œå› ä¸ºå‘ç”Ÿäº†è¿æ¥äº‹ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¼šé©¬ä¸Šæ‰§è¡Œå®Œï¼Œä¸ä¼šé˜»å¡</span><br><span class="line">            &#x2F;&#x2F; å¤„ç†å®Œè¿æ¥è¯·æ±‚ä¸ä¼šç»§ç»­ç­‰å¾…å®¢æˆ·ç«¯çš„æ•°æ®å‘é€</span><br><span class="line">            SocketChannel sc &#x3D; ssc.accept();</span><br><span class="line">            sc.configureBlocking(false);</span><br><span class="line">            &#x2F;&#x2F; é€šè¿‡Selectorç›‘å¬Channelæ—¶å¯¹è¯»äº‹ä»¶æ„Ÿå…´è¶£</span><br><span class="line">            sc.register(selector, SelectionKey.OP_READ); </span><br><span class="line">        &#125; else if (key.isReadable())&#123;</span><br><span class="line">            System.out.println(&quot;æœ‰å®¢æˆ·ç«¯æ•°æ®å¯è¯»äº‹ä»¶å‘ç”Ÿäº†...&quot;);</span><br><span class="line">            SocketChannel sc &#x3D; (SocketChannel) key.channel();</span><br><span class="line">            ByteBuffer buffer &#x3D; ByteBuffer.allocate(1024);</span><br><span class="line">            &#x2F;&#x2F; NIOéé˜»å¡ä½“ç°ï¼šé¦–å…ˆreadæ–¹æ³•ä¸ä¼šé˜»å¡ï¼Œå…¶æ¬¡è¿™ç§äº‹ä»¶å“åº”æ¨¡å‹ï¼Œå½“è°ƒç”¨åˆ°readæ–¹æ³•æ—¶è‚¯å®šæ—¶å‘ç”Ÿäº†å®¢æˆ·ç«¯å‘é€æ•°æ®çš„äº‹ä»¶</span><br><span class="line">            int len &#x3D; sc.read(buffer);</span><br><span class="line">            if(len !&#x3D; -1)&#123;</span><br><span class="line">                System.out.println(&quot;è¯»å–åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®:&quot; + new String(buffer.array(), 0, len));</span><br><span class="line">            &#125;</span><br><span class="line">            ByteBuffer bufferToWrite &#x3D; ByteBuffer.wrap(&quot;HelloClient&quot;.getBytes());</span><br><span class="line">            sc.write(bufferToWrite);</span><br><span class="line">            key.interestOps(SelectionKey.OP_READ | SelectionKey.OP_WRITE);</span><br><span class="line">        &#125; else if(key.isWritable) &#123;</span><br><span class="line">            SocketChannel sc &#x3D; (SocketChannel) key.channel();</span><br><span class="line">            System.out.println(&quot;writeäº‹ä»¶...&quot;);</span><br><span class="line">            &#x2F;&#x2F; NIOäº‹ä»¶è§¦å‘æ˜¯æ°´å¹³è§¦å‘</span><br><span class="line">            &#x2F;&#x2F; ä½¿ç”¨Javaçš„NIOç¼–ç¨‹æ—¶ï¼Œåœ¨æ²¡æœ‰æ•°æ®å¯ä»¥å¾€å¤–å†™çš„æ—¶å€™è¦å–æ¶ˆå†™äº‹ä»¶</span><br><span class="line">            &#x2F;&#x2F; åœ¨æœ‰æ•°æ®å¾€å¤–å†™çš„æ—¶å€™åœ¨æ³¨å†Œå†™äº‹ä»¶</span><br><span class="line">            key.interestOps(SelectionKey.OP_READ);</span><br><span class="line">            &#x2F;&#x2F; sc.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<blockquote>
<p>AIO å¼‚æ­¥éé˜»å¡IOã€‚è§£å†³äº†æœåŠ¡ç«¯éœ€è¦ä¸€ç›´å®ˆç€çº¿ç¨‹çš„é—®é¢˜ï¼Œå¯é æ€§æ˜¯æœ€å¥½çš„ï¼Œååé‡ä¹Ÿæ˜¯éå¸¸é«˜çš„ï¼Œé€‚ç”¨äºè¿æ¥æ¯”è¾ƒå¤šä¸”æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰ã€‚ ä¾‹å¦‚ç›¸å†ŒæœåŠ¡å™¨ã€‚ JDK7å¼€å§‹æ”¯æŒã€‚</p>
<p>ç¼–ç¨‹æ¨¡å‹æ¯”è¾ƒç®€å•ï¼Œä½†éœ€è¦æ“ä½œç³»ç»Ÿæ¥æ”¯æŒå¼‚æ­¥æœåŠ¡ã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_AIO%E7%BB%93%E6%9E%84.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_AIO%E7%BB%93%E6%9E%84.png" alt="img"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; æœåŠ¡ç«¯ä»£ç (äº†è§£)</span><br><span class="line">public class AIOServer&#123;</span><br><span class="line">    public static void main(String[] args) throws Exception&#123;</span><br><span class="line">        final AsynchronousServerSocketChannel serverChannel &#x3D; AsynchronousServerSocketChannel.open().bind(new InewSocketAddress(9000));</span><br><span class="line">        </span><br><span class="line">        serverChannel.accept(null, new CompletionHander&lt;AsynchronousServerSocketChannel, Object&gt;())&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void completed(AsynchronousServerSocketChannel socketChannel, Object attachment)&#123;</span><br><span class="line">                try&#123;</span><br><span class="line">                    &#x2F;&#x2F; å†æ¬¡æ¥å—å®¢æˆ·ç«¯è¿æ¥ï¼Œå¦‚æœä¸å†™è¿™ä¸€è¡Œä»£ç åé¢çš„å®¢æˆ·ç«¯è¿æ¥ä¸ä¸ŠæœåŠ¡å™¨ç«¯</span><br><span class="line">                    serverChannel.accept(attachment, this);</span><br><span class="line">                    System.out.println(socketChannel.getRemoteAddress());</span><br><span class="line">                    ByteBuffer buffer &#x3D; ByteBuffer.allocate(1024);</span><br><span class="line">                    socketChannel.read(buffer, buffer, new CompletionHandler&lt;Integer, ByteBuffer&gt;()&#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public void completed(Integer result, ByteBuffer buffer)&#123;</span><br><span class="line">                            buffer.flip();</span><br><span class="line">                            System.out.println(new String(buffer.array(), 0, result));</span><br><span class="line">                            socketChannel.write(ByteBuffer.wrap(&quot;HelloClient&quot;.getBytes()));</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                        @Override</span><br><span class="line">                        public void failed(Throwable exc, ByteBuffer buffer) &#123;exc.printStackTrace();&#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            @Override</span><br><span class="line">            public void failed(Throwable exc, ByteBuffer buffer) &#123;exc.printStackTrace();&#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        Thread.sleep(Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h2 id="3-BIO-NIOåŒºåˆ«"><a href="#3-BIO-NIOåŒºåˆ«" class="headerlink" title="3. BIO/NIOåŒºåˆ«"></a>3. BIO/NIOåŒºåˆ«</h2><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/4_%E5%AF%B9%E6%AF%94.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/4_%E5%AF%B9%E6%AF%94.png" alt="img"></a></p>
<h2 id="4-BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯"><a href="#4-BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯" class="headerlink" title="4. BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯"></a>4. BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯</h2><ul>
<li>BIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼ŒJDK1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ã€‚</li>
<li>NIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ã€‚</li>
<li>AIOæ–¹å¼ä½¿ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨OSå‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7å¼€å§‹æ”¯æŒã€‚</li>
</ul>
<h2 id="5-Java-NIOçš„3ä¸ªæ ¸å¿ƒç»„ä»¶"><a href="#5-Java-NIOçš„3ä¸ªæ ¸å¿ƒç»„ä»¶" class="headerlink" title="5. Java NIOçš„3ä¸ªæ ¸å¿ƒç»„ä»¶"></a>5. Java NIOçš„3ä¸ªæ ¸å¿ƒç»„ä»¶</h2><blockquote>
<p>NIOé‡ç‚¹:</p>
<p>Channelï¼ˆé€šé“ï¼‰ï¼ŒBufferï¼ˆç¼“å†²åŒºï¼‰ï¼ŒSelectorï¼ˆé€‰æ‹©å™¨ï¼‰ä¸‰ä¸ªç±»ä¹‹é—´çš„å…³ç³»</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/7_NIO%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/7_NIO%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8.png" alt="img"></a></p>
<blockquote>
<p>ç®€å•è§£é‡Šï¼š</p>
</blockquote>
<ul>
<li>æ¯ä¸€ä¸ªchannelå¯¹åº”ä¸€ä¸ªbufferç¼“å†²åŒºã€‚</li>
<li>channelä¼šæ³¨å†Œåˆ°selectorã€‚</li>
<li>selectorä¼šæ ¹æ®channelä¸Šå‘ç”Ÿçš„è¯»å†™äº‹ä»¶ï¼Œå°†è¯·æ±‚äº¤ç”±æŸä¸€ä¸ªç©ºé—²çº¿ç¨‹å¤„ç†ã€‚</li>
<li>selectorå¯¹åº”ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ã€‚</li>
<li>bufferå’Œchanneléƒ½æ˜¯å¯è¯»å¯å†™çš„ã€‚</li>
</ul>
<h3 id="5-1-ç¼“å†²åŒºBuffer"><a href="#5-1-ç¼“å†²åŒºBuffer" class="headerlink" title="5.1 ç¼“å†²åŒºBuffer"></a>5.1 ç¼“å†²åŒºBuffer</h3><p>Bufferæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚å®ƒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…è¯»å‡ºçš„æ•°æ®ã€‚åœ¨é¢å‘æµçš„I/Oä¸­ï¼Œå¯ä»¥å°†æ•°æ®å†™å…¥æˆ–è€…å°†æ•°æ®ç›´æ¥è¯»åˆ°Streamå¯¹è±¡ä¸­ã€‚</p>
<p>åœ¨NIOä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†ã€‚è¿™ä¹Ÿå°±æœ¬æ–‡ä¸Šé¢è°ˆåˆ°çš„IOæ˜¯é¢å‘æµçš„ï¼ŒNIOæ˜¯é¢å‘ç¼“å†²åŒºçš„ã€‚</p>
<p>ç¼“å†²åŒºå®è´¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€šå¸¸å®ƒæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼ˆByteBufferï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç±»çš„æ•°ç»„ã€‚ä½†æ˜¯ä¸€ä¸ªç¼“å†²åŒºä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ä»¥åŠç»´æŠ¤è¯»å†™ä½ç½®ï¼ˆlimitï¼‰ç­‰ä¿¡æ¯ã€‚</p>
<p>æœ€å¸¸ç”¨çš„ç¼“å†²åŒºæ˜¯ByteBufferï¼Œä¸€ä¸ªByteBufferæä¾›äº†ä¸€ç»„åŠŸèƒ½äºæ“ä½œbyteæ•°ç»„ã€‚é™¤äº†ByteBufferï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›ç¼“å†²åŒºï¼Œäº‹å®ä¸Šï¼Œæ¯ä¸€ç§JavaåŸºæœ¬ç±»å‹ï¼ˆé™¤äº†Booleanï¼‰éƒ½å¯¹åº”ä¸€ç§ç¼“å†²åŒºï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<ul>
<li>ByteBufferï¼šå­—èŠ‚ç¼“å†²åŒº</li>
<li>CharBuffer:å­—ç¬¦ç¼“å†²åŒº</li>
<li>ShortBufferï¼šçŸ­æ•´å‹ç¼“å†²åŒº</li>
<li>IntBufferï¼šæ•´å‹ç¼“å†²åŒº</li>
<li>LongBuffer:é•¿æ•´å‹ç¼“å†²åŒº</li>
<li>FloatBufferï¼šæµ®ç‚¹å‹ç¼“å†²åŒº</li>
<li>DoubleBufferï¼šåŒç²¾åº¦æµ®ç‚¹å‹ç¼“å†²åŒº</li>
</ul>
<h3 id="5-2-é€šé“Channel"><a href="#5-2-é€šé“Channel" class="headerlink" title="5.2 é€šé“Channel"></a>5.2 é€šé“Channel</h3><p>Channelæ˜¯ä¸€ä¸ªé€šé“ï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ï¼Œä»–å°±åƒè‡ªæ¥æ°´ç®¡ä¸€æ ·ï¼Œç½‘ç»œæ•°æ®é€šè¿‡Channelè¯»å–å’Œå†™å…¥ã€‚</p>
<p>é€šé“å’Œæµä¸åŒä¹‹å¤„åœ¨äºé€šé“æ˜¯åŒå‘çš„ï¼Œæµåªæ˜¯åœ¨ä¸€ä¸ªæ–¹å‘ç§»åŠ¨ï¼Œè€Œä¸”é€šé“å¯ä»¥ç”¨äºè¯»ï¼Œå†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™ã€‚</p>
<p>å› ä¸ºChannelæ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥å®ƒæ¯”æµæ›´å¥½åœ°æ˜ å°„åº•å±‚æ“ä½œç³»ç»Ÿçš„APIï¼Œç‰¹åˆ«æ˜¯åœ¨UNIXç½‘ç»œç¼–ç¨‹ä¸­ï¼Œåº•å±‚æ“ä½œç³»ç»Ÿçš„é€šé“éƒ½æ˜¯å…¨åŒå·¥çš„ï¼ŒåŒæ—¶æ”¯æŒè¯»å’Œå†™ã€‚</p>
<p>Channelæœ‰å››ç§å®ç°ï¼š</p>
<ul>
<li>FileChannel:æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚</li>
<li>DatagramChannel:ä»UDPç½‘ç»œä¸­è¯»å–æˆ–è€…å†™å…¥æ•°æ®ã€‚</li>
<li>SocketChannel:ä»TCPç½‘ç»œä¸­è¯»å–æˆ–è€…å†™å…¥æ•°æ®ã€‚</li>
<li>ServerSocketChannel:å…è®¸ä½ ç›‘å¬æ¥è‡ªTCPçš„è¿æ¥ï¼Œå°±åƒæœåŠ¡å™¨ä¸€æ ·ã€‚æ¯ä¸€ä¸ªè¿æ¥éƒ½ä¼šæœ‰ä¸€ä¸ªSocketChanneläº§ç”Ÿã€‚</li>
</ul>
<h3 id="5-3-å¤šè·¯å¤ç”¨å™¨Selector"><a href="#5-3-å¤šè·¯å¤ç”¨å™¨Selector" class="headerlink" title="5.3 å¤šè·¯å¤ç”¨å™¨Selector"></a>5.3 å¤šè·¯å¤ç”¨å™¨Selector</h3><p>Selectoré€‰æ‹©å™¨å¯ä»¥ç›‘å¬å¤šä¸ªChannelé€šé“æ„Ÿå…´è¶£çš„äº‹æƒ…(readã€writeã€accept(æœåŠ¡ç«¯æ¥æ”¶)ã€connectï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªChannelï¼ŒèŠ‚çœçº¿ç¨‹åˆ‡æ¢ä¸Šä¸‹æ–‡çš„èµ„æºæ¶ˆè€—ã€‚Selectoråªèƒ½ç®¡ç†éé˜»å¡çš„é€šé“ï¼ŒFileChannelæ˜¯é˜»å¡çš„ï¼Œæ— æ³•ç®¡ç†ã€‚</p>
<p><strong>å…³é”®å¯¹è±¡</strong></p>
<ul>
<li>Selectorï¼šé€‰æ‹©å™¨å¯¹è±¡ï¼Œé€šé“æ³¨å†Œã€é€šé“ç›‘å¬å¯¹è±¡å’ŒSelectorç›¸å…³ã€‚</li>
<li>SelectorKeyï¼šé€šé“ç›‘å¬å…³é”®å­—ï¼Œé€šè¿‡å®ƒæ¥ç›‘å¬é€šé“çŠ¶æ€ã€‚</li>
</ul>
<p><strong>ç›‘å¬æ³¨å†Œ</strong></p>
<p>ç›‘å¬æ³¨å†Œåœ¨Selector</p>
<blockquote>
<p>socketChannel.register(selector, SelectionKey.OP_READ);</p>
</blockquote>
<p><strong>ç›‘å¬çš„äº‹ä»¶æœ‰</strong></p>
<ul>
<li>OP_ACCEPT: æ¥æ”¶å°±ç»ªï¼ŒserviceSocketChannelä½¿ç”¨çš„</li>
<li>OP_READ: è¯»å–å°±ç»ªï¼ŒsocketChannelä½¿ç”¨</li>
<li>OP_WRITE: å†™å…¥å°±ç»ªï¼ŒsocketChannelä½¿ç”¨</li>
<li>OP_CONNECT: è¿æ¥å°±ç»ªï¼ŒsocketChannelä½¿ç”¨</li>
</ul>
<h3 id="5-4-NIOçš„ä¸€äº›åº”ç”¨å’Œæ¡†æ¶"><a href="#5-4-NIOçš„ä¸€äº›åº”ç”¨å’Œæ¡†æ¶" class="headerlink" title="5.4 NIOçš„ä¸€äº›åº”ç”¨å’Œæ¡†æ¶"></a>5.4 NIOçš„ä¸€äº›åº”ç”¨å’Œæ¡†æ¶</h3><p>ä¾‹å¦‚ï¼šDubbo(æœåŠ¡æ¡†æ¶)ï¼Œå°±é»˜è®¤ä½¿ç”¨Nettyä½œä¸ºåŸºç¡€é€šä¿¡ç»„ä»¶ï¼Œç”¨äºå®ç°å„è¿›ç¨‹èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡ã€‚</p>
<p>Jettyã€Minaã€Nettyã€Dubboã€ZooKeeperç­‰éƒ½æ˜¯åŸºäºNIOæ–¹å¼å®ç°</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol>
<li>UNIXÂ® Network Programming Volume 1, Third Edition: The Sockets Networkingï¼ŒRichard Stevensï¼Œ6.2èŠ‚ I/O Models <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/#fnref:1">â†©</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/historyasamirror/article/details/5778378">https://blog.csdn.net/historyasamirror/article/details/5778378</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/#fnref:2">â†©</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/83597838">https://zhuanlan.zhihu.com/p/83597838</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/#fnref:3">â†©</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/112810033">https://zhuanlan.zhihu.com/p/112810033</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/#fnref:4">â†©</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/06/BIO-AIO-NIO%E5%8C%BA%E5%88%AB/" data-id="cknyemfci00066oubdr1igf9q" data-title="BIO_AIO_NIOåŒºåˆ«" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-MySQLé«˜çº§" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/06/MySQL%E9%AB%98%E7%BA%A7/" class="article-date">
  <time class="dt-published" datetime="2021-04-06T11:30:54.000Z" itemprop="datePublished">2021-04-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/06/MySQL%E9%AB%98%E7%BA%A7/">MySQLé«˜çº§</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="MySQLé«˜çº§"><a href="#MySQLé«˜çº§" class="headerlink" title="MySQLé«˜çº§"></a>MySQLé«˜çº§</h1><p>åŸºäº<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12b411K7Zu?p=179">MySQLé«˜çº§</a>çš„å­¦ä¹ ç¬”è®°ï¼Œç”±äºæœ‰äº›è®²å¾—ä¸å¤Ÿå…¨ï¼Œåšäº†éƒ¨åˆ†è¡¥å……[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:2">2]</a></p>
<blockquote>
<p>å†…å®¹è¯´æ˜ï¼š</p>
<p>MySQL æ˜¯ç›®å‰æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œåœ¨ WEB åº”ç”¨æ–¹é¢ MySQL ä¹Ÿæ˜¯ç›®å‰æœ€å¥½çš„ RDBMS åº”ç”¨è½¯ä»¶ä¹‹ä¸€ã€‚éšç€æ·˜å®å»IOE(å»é™¤IBMå°å‹æœºã€Oracleæ•°æ®åº“åŠEMCå­˜å‚¨è®¾å¤‡)åŒ–çš„æ¨è¿›ï¼ŒMySQL æ•°æ®åº“åœ¨å½“å‰çš„äº’è”ç½‘åº”ç”¨ä¸­å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚</p>
<p>åŒ…æ‹¬çš„MySQL é«˜çº§çŸ¥è¯†ï¼šç´¢å¼•ï¼Œå¦‚ä½•é¿å…ç´¢å¼•å¤±æ•ˆï¼Œç´¢å¼•ä¼˜åŒ–ç­–ç•¥ï¼Œinnodbå’Œmyisamå­˜å‚¨å¼•æ“ï¼ŒMySQLé”æœºåˆ¶ï¼Œé…ç½®MySQLä¸»ä»å¤åˆ¶ï¼Œexplainã€show profileã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰æ—¥å¸¸SQLè¯Šæ–­å’Œæ€§èƒ½åˆ†æç­–ç•¥ã€‚</p>
</blockquote>
<h2 id="1-MySQLçš„æ¶æ„ä»‹ç»"><a href="#1-MySQLçš„æ¶æ„ä»‹ç»" class="headerlink" title="1.MySQLçš„æ¶æ„ä»‹ç»"></a>1.MySQLçš„æ¶æ„ä»‹ç»</h2><h3 id="1-1-MySQLç®€ä»‹"><a href="#1-1-MySQLç®€ä»‹" class="headerlink" title="1.1 MySQLç®€ä»‹"></a>1.1 MySQLç®€ä»‹</h3><ul>
<li>æ¦‚è¿°ï¼šå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»ŸRDBMS</li>
<li>é«˜çº§MySQLï¼šå®Œæ•´çš„mysqlä¼˜åŒ–éœ€è¦å¾ˆæ·±çš„åŠŸåº•ï¼Œå¤§å…¬å¸æœ‰ä¸“é—¨çš„DBA<ul>
<li>æ•°æ®åº“å†…éƒ¨ç»“æ„å’ŒåŸç†</li>
<li>æ•°æ®åº“å»ºæ¨¡ä¼˜åŒ–</li>
<li>æ•°æ®åº“ç´¢å¼•å»ºç«‹</li>
<li>SQLè¯­å¥ä¼˜åŒ–</li>
<li>SQLç¼–ç¨‹</li>
<li>mysqlæœåŠ¡å™¨å®‰è£…é…ç½®</li>
<li>æ•°æ®åº“çš„æ€§èƒ½ç›‘æ§åˆ†æä¸ç³»ç»Ÿä¼˜åŒ–</li>
<li>å„ç§å‚æ•°å¸¸é‡è®¾å®š</li>
<li>ä¸»ä»å¤åˆ¶</li>
<li>åˆ†å¸ƒå¼æ¶æ„æ­å»ºã€å‚ç›´åˆ‡å‰²å’Œæ°´å¹³åˆ‡å‰²</li>
<li>æ•°æ®è¿ç§»</li>
<li>å®¹ç¾å¤‡ä»½å’Œæ¢å¤</li>
<li>shellæˆ–pythonç­‰è„šæœ¬è¯­è¨€å¼€å‘</li>
<li>å¯¹å¼€æºæ•°æ®åº“è¿›è¡ŒäºŒæ¬¡å¼€å‘</li>
</ul>
</li>
</ul>
<h3 id="1-2-MysqlLinuxç‰ˆçš„å®‰è£…ï¼ˆmysql5-5ï¼‰"><a href="#1-2-MysqlLinuxç‰ˆçš„å®‰è£…ï¼ˆmysql5-5ï¼‰" class="headerlink" title="1.2 MysqlLinuxç‰ˆçš„å®‰è£…ï¼ˆmysql5.5ï¼‰"></a>1.2 MysqlLinuxç‰ˆçš„å®‰è£…ï¼ˆmysql5.5ï¼‰</h3><ul>
<li>ä¸‹è½½åœ°å€ï¼š</li>
</ul>
<p>å®˜ç½‘ä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://dev.mysql.com/downloads/mysql/">http://dev.mysql.com/downloads/mysql/</a></p>
<ul>
<li><p>æ‹·è´&amp;è§£å‹ç¼©</p>
</li>
<li><p>æ£€æŸ¥å·¥ä½œ</p>
<ul>
<li><p>æ£€æŸ¥æ˜¯å¦å®‰è£…è¿‡mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œå®‰è£…å‘½ä»¤å‰ï¼Œå…ˆæ‰§è¡ŒæŸ¥è¯¢å‘½ä»¤</span><br><span class="line">rpm -qa|grep mysql</span><br><span class="line"># å¦‚æœå­˜åœ¨mysql-libsçš„æ—§ç‰ˆæœ¬åŒ…å¦‚ä¸‹ï¼šè¯·å…ˆæ‰§è¡Œå¸è½½å‘½ä»¤</span><br><span class="line">rpm -e --nodeps  mysql-libs  </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>ç”±äºmysqlå®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡mysqlç”¨æˆ·åœ¨/tmpç›®å½•ä¸‹æ–°å»ºtmp_dbæ–‡ä»¶ï¼Œæ‰€ä»¥è¯·ç»™/tmpè¾ƒå¤§çš„æƒé™æ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777 &#x2F;tmp</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>å®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨mysqlçš„å®‰è£…æ–‡ä»¶ç›®å½•ä¸‹æ‰§è¡Œï¼š</span><br><span class="line">rpm -ivh MySQL-server-5.5.54-1.linux2.6.x86_64.rpmrpm -ivh MySQL-client-5.5.54-1.linux2.6.x86_64.rpm </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æŸ¥çœ‹MySQLå®‰è£…ç‰ˆæœ¬</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin --version</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>mysqlæœåŠ¡çš„å¯+åœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service mysql start</span><br><span class="line">ps -ef|grep mysql # æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¼€å¯</span><br><span class="line">service mysql stop</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>é¦–æ¬¡ç™»é™†</p>
<p>å®‰è£…å®Œæˆåä¼šæç¤ºå‡ºå¦‚ä¸‹çš„æç¤ºï¼šåœ¨mysqlé¦–æ¬¡ç™»å½•å‰è¦ç»™ root è´¦å·è®¾ç½®å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># å¯åŠ¨æœåŠ¡åï¼Œæ‰§è¡Œå‘½ä»¤ </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;mysqladmin -u root  password &#39;123123&#39;</span><br><span class="line"># ç™»å½• </span><br><span class="line">mysql -uroot -p123123  </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>è‡ªå¯åŠ¨æœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chkconfig mysql on # è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</span><br><span class="line">chkconfig --list | grep mysql</span><br><span class="line">ntsysv # çœ‹åˆ°[*]mysqlè¿™ä¸€è¡Œï¼Œè¡¨ç¤ºå¼€æœºåä¼šè‡ªå¯åŠ¨mysql</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>mysqlçš„å®‰è£…ä½ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep mysql # åœ¨linuxä¸‹æŸ¥çœ‹å®‰è£…ç›®å½•</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è·¯å¾„è§£é‡Šå¤‡æ³¨</p>
<ul>
<li>basedir: /usr/bin ç›¸å…³å‘½ä»¤ç›®å½•mysqladmin mysqldumpç­‰å‘½ä»¤</li>
<li>datadir: /var/lib/mysql/ mysqlæ•°æ®åº“æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„</li>
<li>plugin-dir: /usr/lib64/mysql/pluginmysqlæ’ä»¶å­˜æ”¾è·¯å¾„</li>
<li>log-error: /var/lib/mysql/jack.atguigu.errmysqlé”™è¯¯æ—¥å¿—è·¯å¾„</li>
<li>pid-file: /var/lib/mysql/jack.atguigu.pidè¿›ç¨‹pidæ–‡ä»¶</li>
<li>socket:/var/lib/mysql/mysql.sockæœ¬åœ°è¿æ¥æ—¶ç”¨çš„unixå¥—æ¥å­—æ–‡ä»¶</li>
<li>/usr/share/mysql é…ç½®æ–‡ä»¶ç›®å½•mysqlè„šæœ¬åŠé…ç½®æ–‡ä»¶</li>
<li>/etc/init.d/mysqlæœåŠ¡å¯åœç›¸å…³è„šæœ¬</li>
</ul>
</li>
<li><p>mysqlä¿®æ”¹å­—ç¬¦é›†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 1. æŸ¥çœ‹å­—ç¬¦é›†è®¾ç½®</span><br><span class="line">show variables like &#39;character%&#39;;</span><br><span class="line">show variables like &#39;%char%&#39;;</span><br><span class="line"># é»˜è®¤çš„æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½ç”¨äº†latin1ï¼Œæ‰€ä»¥ä¼šä¹±ç </span><br><span class="line"></span><br><span class="line"># 2. ä¿®æ”¹my.cnf</span><br><span class="line"># åœ¨&#x2F;usr&#x2F;share&#x2F;mysql&#x2F; ä¸­æ‰¾åˆ°my.cnfçš„é…ç½®æ–‡ä»¶ï¼Œæ‹·è´å…¶ä¸­çš„my-huge.cnf åˆ°&#x2F;etc&#x2F;, å¹¶å‘½åä¸ºmy.cnf mysql</span><br><span class="line"># ä¼˜å…ˆé€‰ä¸­&#x2F;etc&#x2F;ä¸‹çš„é…ç½®æ–‡ä»¶ç„¶åä¿®æ”¹my.cnf:</span><br><span class="line">[client]</span><br><span class="line">default-character-set&#x3D;utf8</span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server&#x3D;utf8character_set_client&#x3D;utf8collation-server&#x3D;utf8_general_ci</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set&#x3D;utf8</span><br><span class="line"></span><br><span class="line"># 3. é‡æ–°å¯åŠ¨mysql</span><br><span class="line"># ä½†æ˜¯åŸåº“çš„è®¾å®šä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå‚æ•°ä¿®æ”¹ä¹‹å¯¹æ–°å»ºçš„æ•°æ®åº“ç”Ÿæ•ˆ </span><br><span class="line"></span><br><span class="line"># 4. å·²ç”Ÿæˆçš„åº“è¡¨å­—ç¬¦é›†å¦‚ä½•å˜æ›´ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦é›†</span><br><span class="line">alter database mytest character set &#39;utf8&#39;;</span><br><span class="line"># ä¿®æ”¹æ•°æ®è¡¨çš„å­—ç¬¦é›†</span><br><span class="line">alter table user convert to  character set &#39;utf8&#39;; </span><br><span class="line">ä½†æ˜¯åŸæœ‰çš„æ•°æ®å¦‚æœæ˜¯ç”¨é&#39;utf8&#39;ç¼–ç çš„è¯ï¼Œæ•°æ®æœ¬èº«ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚     </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-3-mysqlé…ç½®æ–‡ä»¶"><a href="#1-3-mysqlé…ç½®æ–‡ä»¶" class="headerlink" title="1.3 mysqlé…ç½®æ–‡ä»¶"></a>1.3 mysqlé…ç½®æ–‡ä»¶</h3><p>ï¼ˆå…ˆå¤§è‡´äº†è§£ï¼Œæ··ä¸ªçœ¼ç†Ÿï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_1_mysql%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_1_mysql%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="img"></a></p>
<h3 id="1-4-mysqlé€»è¾‘æ¡†æ¶ç®€ä»‹"><a href="#1-4-mysqlé€»è¾‘æ¡†æ¶ç®€ä»‹" class="headerlink" title="1.4 mysqlé€»è¾‘æ¡†æ¶ç®€ä»‹"></a>1.4 mysqlé€»è¾‘æ¡†æ¶ç®€ä»‹</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_2_mysql%E9%80%BB%E8%BE%91%E6%A1%86%E6%9E%B6.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_2_mysql%E9%80%BB%E8%BE%91%E6%A1%86%E6%9E%B6.png" alt="img"></a></p>
<blockquote>
<p>å’Œå…¶å®ƒæ•°æ®åº“ç›¸æ¯”ï¼ŒMySQLæœ‰ç‚¹ä¸ä¼—ä¸åŒï¼Œ<strong>å®ƒçš„æ¶æ„å¯ä»¥åœ¨å¤šç§ä¸åŒåœºæ™¯ä¸­åº”ç”¨å¹¶å‘æŒ¥è‰¯å¥½ä½œç”¨</strong>ã€‚</p>
<p>ä¸»è¦ä½“ç°åœ¨å­˜å‚¨å¼•æ“çš„æ¶æ„ä¸Šï¼Œ<strong>æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„</strong>å°†æŸ¥è¯¢å¤„ç†å’Œå…¶å®ƒçš„ç³»ç»Ÿä»»åŠ¡ä»¥åŠæ•°æ®çš„å­˜å‚¨æå–ç›¸åˆ†ç¦»ã€‚</p>
<p>è¿™ç§æ¶æ„å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚å’Œå®é™…éœ€è¦é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“</p>
</blockquote>
<ul>
<li><p>è¿æ¥å±‚</p>
<p>æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œè¿æ¥æœåŠ¡ï¼ŒåŒ…å«æœ¬åœ°socké€šä¿¡å’Œå¤§å¤šæ•°åŸºäºå®¢æˆ·ç«¯/æœåŠ¡ç«¯å·¥å…·å®ç°çš„ç±»ä¼¼äºtcp/ipçš„é€šä¿¡ã€‚ä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆã€‚åœ¨è¯¥å±‚ä¸Šå¼•å…¥äº†çº¿ç¨‹æ± çš„æ¦‚å¿µï¼Œä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ã€‚åŒæ ·åœ¨è¯¥å±‚ä¸Šå¯ä»¥å®ç°åŸºäºSSLçš„å®‰å…¨é“¾æ¥ã€‚æœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚</p>
</li>
<li><p>æœåŠ¡å±‚</p>
<ol>
<li>Management Serveices &amp; Utilitiesï¼š ç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·</li>
<li>SQL Interface: SQLæ¥å£ æ¥å—ç”¨æˆ·çš„SQLå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœã€‚æ¯”å¦‚select fromå°±æ˜¯è°ƒç”¨SQL Interface</li>
<li>Parser: è§£æå™¨ SQLå‘½ä»¤ä¼ é€’åˆ°è§£æå™¨çš„æ—¶å€™ä¼šè¢«è§£æå™¨éªŒè¯å’Œè§£æã€‚</li>
<li>Optimizer: æŸ¥è¯¢ä¼˜åŒ–å™¨ã€‚ SQLè¯­å¥åœ¨æŸ¥è¯¢ä¹‹å‰ä¼šä½¿ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚ ç”¨ä¸€ä¸ªä¾‹å­å°±å¯ä»¥ç†è§£ï¼š select uid,name from user where gender= 1; ä¼˜åŒ–å™¨æ¥å†³å®šå…ˆæŠ•å½±è¿˜æ˜¯å…ˆè¿‡æ»¤ã€‚</li>
<li>Cacheå’ŒBufferï¼š æŸ¥è¯¢ç¼“å­˜ã€‚ å¦‚æœæŸ¥è¯¢ç¼“å­˜æœ‰å‘½ä¸­çš„æŸ¥è¯¢ç»“æœï¼ŒæŸ¥è¯¢è¯­å¥å°±å¯ä»¥ç›´æ¥å»æŸ¥è¯¢ç¼“å­˜ä¸­å–æ•°æ®ã€‚ è¿™ä¸ªç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ï¼Œè®°å½•ç¼“å­˜ï¼Œkeyç¼“å­˜ï¼Œæƒé™ç¼“å­˜ç­‰ ç¼“å­˜æ˜¯è´Ÿè´£è¯»ï¼Œç¼“å†²è´Ÿè´£å†™ã€‚</li>
</ol>
</li>
<li><p>å¼•æ“å±‚</p>
<p>å­˜å‚¨å¼•æ“å±‚ï¼Œå­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰çš„åŠŸèƒ½ä¸åŒï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€è¦è¿›è¡Œé€‰å–ã€‚åé¢ä»‹ç»MyISAMå’ŒInnoDB</p>
</li>
<li><p>å­˜å‚¨å±‚</p>
<p>æ•°æ®å­˜å‚¨å±‚ï¼Œä¸»è¦æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨è¿è¡Œäºè£¸è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚</p>
</li>
</ul>
<h3 id="1-5-mysqlå­˜å‚¨å¼•æ“"><a href="#1-5-mysqlå­˜å‚¨å¼•æ“" class="headerlink" title="1.5 mysqlå­˜å‚¨å¼•æ“"></a>1.5 mysqlå­˜å‚¨å¼•æ“</h3><h4 id="1-5-1-æŸ¥çœ‹å‘½ä»¤"><a href="#1-5-1-æŸ¥çœ‹å‘½ä»¤" class="headerlink" title="1.5.1 æŸ¥çœ‹å‘½ä»¤"></a>1.5.1 æŸ¥çœ‹å‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># çœ‹ä½ çš„mysqlç°åœ¨å·²æä¾›ä»€ä¹ˆå­˜å‚¨å¼•æ“</span><br><span class="line">show engines; </span><br><span class="line"># çœ‹ä½ çš„mysqlå½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“:  </span><br><span class="line">show variables like &#39;%storage_engine%&#39;; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="1-5-2-MyISAMå’ŒInnoDB"><a href="#1-5-2-MyISAMå’ŒInnoDB" class="headerlink" title="1.5.2 MyISAMå’ŒInnoDB"></a>1.5.2 <strong>MyISAMå’ŒInnoDB</strong></h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_3_InnoDB%E5%92%8CMyISAM.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_3_InnoDB%E5%92%8CMyISAM.png" alt="img"></a></p>
<h4 id="1-5-3-å„ä¸ªå­˜å‚¨å¼•æ“ä»‹ç»"><a href="#1-5-3-å„ä¸ªå­˜å‚¨å¼•æ“ä»‹ç»" class="headerlink" title="1.5.3 å„ä¸ªå­˜å‚¨å¼•æ“ä»‹ç»"></a>1.5.3 å„ä¸ªå­˜å‚¨å¼•æ“ä»‹ç»</h4><ol>
<li><strong>InnoDB</strong>å­˜å‚¨å¼•æ“ï¼šInnoDBæ˜¯MySQLçš„é»˜è®¤äº‹åŠ¡å‹å¼•æ“ï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥å¤„ç†å¤§é‡çš„çŸ­æœŸ(short-lived)äº‹åŠ¡ã€‚é™¤éæœ‰éå¸¸ç‰¹åˆ«çš„åŸå› éœ€è¦ä½¿ç”¨å…¶ä»–çš„å­˜å‚¨å¼•æ“ï¼Œå¦åˆ™åº”è¯¥ä¼˜å…ˆè€ƒè™‘InnoDBå¼•æ“ã€‚è¡Œçº§é”ï¼Œé€‚åˆé«˜å¹¶å‘æƒ…å†µ</li>
<li><strong>MyISAM</strong>å­˜å‚¨å¼•æ“ï¼šMyISAMæä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ï¼Œä½†MyISAMä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”(myisamæ”¹è¡¨æ—¶ä¼šå°†æ•´ä¸ªè¡¨å…¨é”ä½)ï¼Œæœ‰ä¸€ä¸ªæ¯«æ— ç–‘é—®çš„ç¼ºé™·å°±æ˜¯å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ã€‚</li>
<li>Archiveå¼•æ“ï¼šArchiveå­˜å‚¨å¼•æ“åªæ”¯æŒINSERTå’ŒSELECTæ“ä½œï¼Œåœ¨MySQL5.1ä¹‹å‰ä¸æ”¯æŒç´¢å¼•ã€‚Archiveè¡¨é€‚åˆæ—¥å¿—å’Œæ•°æ®é‡‡é›†ç±»åº”ç”¨ã€‚é€‚åˆä½è®¿é—®é‡å¤§æ•°æ®ç­‰æƒ…å†µã€‚æ ¹æ®è‹±æ–‡çš„æµ‹è¯•ç»“è®ºæ¥çœ‹ï¼ŒArchiveè¡¨æ¯”MyISAMè¡¨è¦å°å¤§çº¦75%ï¼Œæ¯”æ”¯æŒäº‹åŠ¡å¤„ç†çš„InnoDBè¡¨å°å¤§çº¦83%ã€‚</li>
<li>Blackholeå¼•æ“ï¼šBlackholeå¼•æ“æ²¡æœ‰å®ç°ä»»ä½•å­˜å‚¨æœºåˆ¶ï¼Œå®ƒä¼šä¸¢å¼ƒæ‰€æœ‰æ’å…¥çš„æ•°æ®ï¼Œä¸åšä»»ä½•ä¿å­˜ã€‚ä½†æœåŠ¡å™¨ä¼šè®°å½•Blackholeè¡¨çš„æ—¥å¿—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºå¤åˆ¶æ•°æ®åˆ°å¤‡åº“ï¼Œæˆ–è€…ç®€å•åœ°è®°å½•åˆ°æ—¥å¿—ã€‚ä½†è¿™ç§åº”ç”¨æ–¹å¼ä¼šç¢°åˆ°å¾ˆå¤šé—®é¢˜ï¼Œå› æ­¤å¹¶ä¸æ¨èã€‚</li>
<li>CSVå¼•æ“ï¼šCSVå¼•æ“å¯ä»¥å°†æ™®é€šçš„CSVæ–‡ä»¶ä½œä¸ºMySQLçš„è¡¨æ¥å¤„ç†ï¼Œä½†ä¸æ”¯æŒç´¢å¼•ã€‚CSVå¼•æ“å¯ä»¥ä½œä¸ºä¸€ç§æ•°æ®äº¤æ¢çš„æœºåˆ¶ï¼Œéå¸¸æœ‰ç”¨ã€‚CSVå­˜å‚¨çš„æ•°æ®ç›´æ¥å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿé‡Œï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæˆ–è€…excelè¯»å–ã€‚</li>
<li>Memoryå¼•æ“ï¼šå¦‚æœéœ€è¦å¿«é€Ÿåœ°è®¿é—®æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®ä¸ä¼šè¢«ä¿®æ”¹ï¼Œé‡å¯ä»¥åä¸¢å¤±ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œé‚£ä¹ˆä½¿ç”¨Memoryè¡¨æ˜¯éå¸¸æœ‰ç”¨ã€‚Memoryè¡¨è‡³å°‘æ¯”MyISAMè¡¨è¦å¿«ä¸€ä¸ªæ•°é‡çº§ã€‚(ä½¿ç”¨ä¸“ä¸šçš„å†…å­˜æ•°æ®åº“æ›´å¿«ï¼Œå¦‚redis)</li>
<li>Federatedå¼•æ“ï¼šFederatedå¼•æ“æ˜¯è®¿é—®å…¶ä»–MySQLæœåŠ¡å™¨çš„ä¸€ä¸ªä»£ç†ï¼Œå°½ç®¡è¯¥å¼•æ“çœ‹èµ·æ¥æä¾›äº†ä¸€ç§å¾ˆå¥½çš„è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿç»å¸¸å¸¦æ¥é—®é¢˜ï¼Œå› æ­¤é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚</li>
</ol>
<h4 id="1-5-4-é˜¿é‡Œå·´å·´ã€æ·˜å®ç”¨å“ªä¸ª"><a href="#1-5-4-é˜¿é‡Œå·´å·´ã€æ·˜å®ç”¨å“ªä¸ª" class="headerlink" title="1.5.4 é˜¿é‡Œå·´å·´ã€æ·˜å®ç”¨å“ªä¸ª"></a>1.5.4 é˜¿é‡Œå·´å·´ã€æ·˜å®ç”¨å“ªä¸ª</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_4_%E9%98%BF%E9%87%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E5%93%AA%E4%B8%AA.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_4_%E9%98%BF%E9%87%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E5%93%AA%E4%B8%AA.png" alt="img"></a></p>
<h2 id="2-ç´¢å¼•ä¼˜åŒ–åˆ†æ"><a href="#2-ç´¢å¼•ä¼˜åŒ–åˆ†æ" class="headerlink" title="2. ç´¢å¼•ä¼˜åŒ–åˆ†æ"></a>2. ç´¢å¼•ä¼˜åŒ–åˆ†æ</h2><h3 id="2-1-æ€§èƒ½ä¸‹é™SQLæ…¢-æ‰§è¡Œæ—¶é—´é•¿-ç­‰å¾…æ—¶é—´é•¿"><a href="#2-1-æ€§èƒ½ä¸‹é™SQLæ…¢-æ‰§è¡Œæ—¶é—´é•¿-ç­‰å¾…æ—¶é—´é•¿" class="headerlink" title="2.1 æ€§èƒ½ä¸‹é™SQLæ…¢ æ‰§è¡Œæ—¶é—´é•¿ ç­‰å¾…æ—¶é—´é•¿"></a>2.1 æ€§èƒ½ä¸‹é™SQLæ…¢ æ‰§è¡Œæ—¶é—´é•¿ ç­‰å¾…æ—¶é—´é•¿</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_5_%E6%80%A7%E8%83%BD%E4%B8%8B%E9%99%8Dsql%E6%85%A2%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E9%95%BF%E7%AD%89%E5%BE%85%E6%97%B6%E9%97%B4%E9%95%BF.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_5_%E6%80%A7%E8%83%BD%E4%B8%8B%E9%99%8Dsql%E6%85%A2%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E9%95%BF%E7%AD%89%E5%BE%85%E6%97%B6%E9%97%B4%E9%95%BF.png" alt="img"></a></p>
<h3 id="2-2-å¸¸è§é€šç”¨çš„joinæŸ¥è¯¢"><a href="#2-2-å¸¸è§é€šç”¨çš„joinæŸ¥è¯¢" class="headerlink" title="2.2 å¸¸è§é€šç”¨çš„joinæŸ¥è¯¢"></a>2.2 å¸¸è§é€šç”¨çš„joinæŸ¥è¯¢</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_6_%E5%B8%B8%E8%A7%81%E7%9A%84join%E6%9F%A5%E8%AF%A2.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_6_%E5%B8%B8%E8%A7%81%E7%9A%84join%E6%9F%A5%E8%AF%A2.png" alt="img"></a></p>
<ul>
<li><p>SQLè§£æï¼šæœºè¯»é¡ºåºï¼ˆå…ˆfromï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_7_SQL%E8%A7%A3%E6%9E%90.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_7_SQL%E8%A7%A3%E6%9E%90.png" alt="img"></a></p>
</li>
<li><p>Joinå›¾ï¼ˆé‡ç‚¹ï¼ŒåŸºæœ¬åŠŸä¸€å®šè¦è®°ä½ï¼‰ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_8_join%E5%9B%BE.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_8_join%E5%9B%BE.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_9_join%E5%9B%BE.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_9_join%E5%9B%BE.png" alt="img"></a></p>
</li>
</ul>
<h3 id="2-3-ç´¢å¼•ç®€ä»‹"><a href="#2-3-ç´¢å¼•ç®€ä»‹" class="headerlink" title="2.3 ç´¢å¼•ç®€ä»‹"></a>2.3 ç´¢å¼•ç®€ä»‹</h3><h4 id="2-3-1-ç´¢å¼•æ˜¯ä»€ä¹ˆï¼ˆé‡ç‚¹ï¼‰"><a href="#2-3-1-ç´¢å¼•æ˜¯ä»€ä¹ˆï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="2.3.1 ç´¢å¼•æ˜¯ä»€ä¹ˆï¼ˆé‡ç‚¹ï¼‰"></a>2.3.1 ç´¢å¼•æ˜¯ä»€ä¹ˆï¼ˆé‡ç‚¹ï¼‰</h4><blockquote>
<p>MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚</p>
</blockquote>
<ul>
<li><p><strong>ç´¢å¼•çš„æœ¬è´¨</strong>ï¼šç´¢å¼•æ˜¯æ•°æ®ç»“æ„</p>
</li>
<li><p>ç´¢å¼•çš„ç›®çš„ï¼šåœ¨äºæé«˜æŸ¥è¯¢æ•ˆç‡</p>
<p>å¯ä»¥ç±»æ¯”å­—å…¸ï¼Œå¦‚æœè¦æŸ¥â€œmysqlâ€è¿™ä¸ªå•è¯ï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦å®šä½åˆ°må­—æ¯ï¼Œç„¶åä»ä¸‹å¾€ä¸‹æ‰¾åˆ°yå­—æ¯ï¼Œå†æ‰¾åˆ°å‰©ä¸‹çš„sqlã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦aâ€”-zï¼Œå¦‚æœæˆ‘æƒ³æ‰¾åˆ°Javaå¼€å¤´çš„å•è¯å‘¢ï¼Ÿæˆ–è€…Oracleå¼€å¤´çš„å•è¯å‘¢ï¼Ÿæ˜¯ä¸æ˜¯è§‰å¾—å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œè¿™ä¸ªäº‹æƒ…æ ¹æœ¬æ— æ³•å®Œæˆï¼Ÿ</p>
</li>
<li><p>ç®€å•ç†è§£ï¼š <strong>ç´¢å¼•æ˜¯æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„</strong></p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_10_%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A32.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_10_%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A32.png" alt="img"></a></p>
<ul>
<li>äºŒå‰æ ‘å¼Šç«¯ä¹‹ä¸€ï¼šäºŒå‰æ ‘å¾ˆå¯èƒ½ä¼šå‘ç”Ÿä¸¤è¾¹ä¸å¹³è¡¡çš„æƒ…å†µã€‚</li>
<li>B-TREEï¼š(B:balance) ä¼šè‡ªåŠ¨æ ¹æ®ä¸¤è¾¹çš„æƒ…å†µè‡ªåŠ¨è°ƒèŠ‚ï¼Œä½¿ä¸¤ç«¯æ— é™è¶‹è¿‘äºå¹³è¡¡çŠ¶æ€ã€‚å¯ä»¥ä½¿æ€§èƒ½æœ€ç¨³å®šã€‚(myisamä½¿ç”¨çš„æ–¹å¼)</li>
<li>B-TREEå¼Šç«¯ï¼š(æ’å…¥/ä¿®æ”¹æ“ä½œå¤šæ—¶ï¼ŒB-TREEä¼šä¸æ–­è°ƒæ•´å¹³è¡¡ï¼Œæ¶ˆè€—æ€§èƒ½)ä»ä¾§é¢è¯´æ˜äº†ç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚</li>
<li>B+TREEï¼šInnodb æ‰€ä½¿ç”¨çš„ç´¢å¼•</li>
</ul>
</li>
<li><p><strong>æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜ï¼Œéƒ½æ˜¯æŒ‡Bæ ‘(å¤šè·¯æœç´¢æ ‘ï¼Œå¹¶ä¸ä¸€å®šæ˜¯äºŒå‰çš„)ç»“æ„ç»„ç»‡çš„ç´¢å¼•</strong>ã€‚å…¶ä¸­èšé›†ç´¢å¼•ï¼Œæ¬¡è¦ç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•ï¼Œå¤åˆç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•é»˜è®¤éƒ½æ˜¯ä½¿ç”¨B+æ ‘ç´¢å¼•ï¼Œç»Ÿç§°ç´¢å¼•ã€‚å½“ç„¶ï¼Œé™¤äº†B+æ ‘è¿™ç§ç±»å‹çš„ç´¢å¼•ä¹‹å¤–ï¼Œè¿˜æœ‰å“ˆç¨€ç´¢å¼•(hash index)ç­‰ã€‚</p>
</li>
</ul>
<h4 id="2-3-2-ç´¢å¼•çš„ä¼˜åŠ¿"><a href="#2-3-2-ç´¢å¼•çš„ä¼˜åŠ¿" class="headerlink" title="2.3.2 ç´¢å¼•çš„ä¼˜åŠ¿"></a>2.3.2 ç´¢å¼•çš„ä¼˜åŠ¿</h4><ul>
<li>ç±»ä¼¼å¤§å­¦å›¾ä¹¦é¦†å»ºä¹¦ç›®ç´¢å¼•ï¼Œæé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬</li>
<li>é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½äº†CPUçš„æ¶ˆè€—</li>
</ul>
<h4 id="2-3-3-ç´¢å¼•çš„åŠ£åŠ¿"><a href="#2-3-3-ç´¢å¼•çš„åŠ£åŠ¿" class="headerlink" title="2.3.3 ç´¢å¼•çš„åŠ£åŠ¿"></a>2.3.3 ç´¢å¼•çš„åŠ£åŠ¿</h4><ul>
<li>å®é™…ä¸Šç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ï¼Œæ‰€ä»¥ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦<strong>å ç”¨ç©ºé—´</strong>çš„</li>
<li>è™½ç„¶ç´¢å¼•å¤§å¤§<strong>æé«˜äº†æŸ¥è¯¢é€Ÿåº¦</strong>ï¼ŒåŒæ—¶å´ä¼š<strong>é™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦</strong>ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEå’ŒDELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQLä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µï¼Œéƒ½ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯</li>
<li><strong>ç´¢å¼•åªæ˜¯æé«˜æ•ˆç‡çš„ä¸€ä¸ªå› ç´ ï¼Œå¦‚æœä½ çš„MySQLæœ‰å¤§æ•°æ®é‡çš„è¡¨ï¼Œå°±éœ€è¦èŠ±æ—¶é—´ç ”ç©¶å»ºç«‹æœ€ä¼˜ç§€çš„ç´¢å¼•ï¼Œæˆ–ä¼˜åŒ–æŸ¥è¯¢è¯­å¥</strong></li>
</ul>
<h4 id="2-3-4-ç´¢å¼•çš„åˆ†ç±»"><a href="#2-3-4-ç´¢å¼•çš„åˆ†ç±»" class="headerlink" title="2.3.4 ç´¢å¼•çš„åˆ†ç±»"></a>2.3.4 ç´¢å¼•çš„åˆ†ç±»</h4><h5 id="2-3-4-1-å•å€¼ç´¢å¼•"><a href="#2-3-4-1-å•å€¼ç´¢å¼•" class="headerlink" title="2.3.4.1 å•å€¼ç´¢å¼•"></a>2.3.4.1 å•å€¼ç´¢å¼•</h5><blockquote>
<p>å³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•</p>
</blockquote>
<h5 id="2-3-4-2-å”¯ä¸€ç´¢å¼•"><a href="#2-3-4-2-å”¯ä¸€ç´¢å¼•" class="headerlink" title="2.3.4.2 å”¯ä¸€ç´¢å¼•"></a>2.3.4.2 å”¯ä¸€ç´¢å¼•</h5><blockquote>
<p>ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼</p>
</blockquote>
<h5 id="2-3-4-3-å¤åˆç´¢å¼•"><a href="#2-3-4-3-å¤åˆç´¢å¼•" class="headerlink" title="2.3.4.3 å¤åˆç´¢å¼•"></a>2.3.4.3 å¤åˆç´¢å¼•</h5><blockquote>
<p>å³ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—</p>
</blockquote>
<h5 id="2-3-4-4-ä¸»é”®ç´¢å¼•"><a href="#2-3-4-4-ä¸»é”®ç´¢å¼•" class="headerlink" title="2.3.4.4 ä¸»é”®ç´¢å¼•"></a>2.3.4.4 ä¸»é”®ç´¢å¼•</h5><blockquote>
<p>è®¾å®šä¸ºä¸»é”®åæ•°æ®åº“ä¼šè‡ªåŠ¨å»ºç«‹ç´¢å¼•ï¼Œinnodbä¸ºèšç°‡ï¼ˆèšé›†ï¼‰ç´¢å¼•</p>
<p>å› ä¸ºInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«è¦æŒ‰ä¸»é”®èšé›†ï¼Œæ‰€ä»¥InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆMyISAMå¯ä»¥æ²¡æœ‰ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å½¢ã€‚</p>
</blockquote>
<h5 id="2-3-4-5-åŸºæœ¬è¯­æ³•"><a href="#2-3-4-5-åŸºæœ¬è¯­æ³•" class="headerlink" title="2.3.4.5 åŸºæœ¬è¯­æ³•"></a>2.3.4.5 åŸºæœ¬è¯­æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 1. åˆ›å»º</span><br><span class="line">CREATE [UNIQUE] INDEX indexName ON mytable(columnname(length))</span><br><span class="line">ALTER mytable ADD  [UNIQUE ]  INDEX [indexName] ON (columnname(length)) </span><br><span class="line"></span><br><span class="line"># 2. åˆ é™¤</span><br><span class="line">DROP INDEX [indexName] ON mytable</span><br><span class="line"></span><br><span class="line"># 3. æŸ¥çœ‹</span><br><span class="line">SHOW INDEX FROM table_name\G</span><br><span class="line"></span><br><span class="line"># 4. ä½¿ç”¨ALTERå‘½ä»¤</span><br><span class="line"># æœ‰å››ç§æ–¹å¼æ¥æ·»åŠ æ•°æ®è¡¨çš„ç´¢å¼•ï¼š</span><br><span class="line">ALTER TABLE tbl_name ADD PRIMARY KEY (column_list) # è¯¥è¯­å¥æ·»åŠ ä¸€ä¸ªä¸»é”®ï¼Œè¿™æ„å‘³ç€ç´¢å¼•å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸”ä¸èƒ½ä¸ºNULLã€‚</span><br><span class="line">ALTER TABLE tbl_name ADD UNIQUE index_name (column_list) # è¿™æ¡è¯­å¥åˆ›å»ºç´¢å¼•çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼ˆé™¤äº†NULLå¤–ï¼ŒNULLå¯èƒ½ä¼šå‡ºç°å¤šæ¬¡</span><br><span class="line">ALTER TABLE tbl_name ADD INDEX index_name (column_list) # æ·»åŠ æ™®é€šç´¢å¼•ï¼Œç´¢å¼•å€¼å¯å‡ºç°å¤šæ¬¡ã€‚</span><br><span class="line">ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list) #è¯¥è¯­å¥æŒ‡å®šäº†ç´¢å¼•ä¸º FULLTEXT ï¼Œç”¨äºå…¨æ–‡ç´¢å¼•ã€‚ </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="2-3-5-mysqlç´¢å¼•ç»“æ„â­"><a href="#2-3-5-mysqlç´¢å¼•ç»“æ„â­" class="headerlink" title="2.3.5 mysqlç´¢å¼•ç»“æ„â­"></a>2.3.5 mysqlç´¢å¼•ç»“æ„â­</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_11_%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_11_%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84.png" alt="img"></a></p>
<ul>
<li><p>B-Tree[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:1">1]</a></p>
<p>ä¸ºäº†æè¿°B-Treeï¼Œé¦–å…ˆå®šä¹‰ä¸€æ¡æ•°æ®è®°å½•ä¸ºä¸€ä¸ªäºŒå…ƒç»„[key, data]ï¼Œkeyä¸ºè®°å½•çš„é”®å€¼ï¼Œå¯¹äºä¸åŒæ•°æ®è®°å½•ï¼Œkeyæ˜¯äº’ä¸ç›¸åŒçš„ï¼›dataä¸ºæ•°æ®è®°å½•é™¤keyå¤–çš„æ•°æ®ã€‚é‚£ä¹ˆB-Treeæ˜¯æ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li>dä¸ºå¤§äº1çš„ä¸€ä¸ªæ­£æ•´æ•°ï¼Œç§°ä¸ºB-Treeçš„åº¦ã€‚</li>
<li>hä¸ºä¸€ä¸ªæ­£æ•´æ•°ï¼Œç§°ä¸ºB-Treeçš„é«˜åº¦ã€‚</li>
<li>æ¯ä¸ªéå¶å­èŠ‚ç‚¹ç”±n-1ä¸ªkeyå’Œnä¸ªæŒ‡é’ˆç»„æˆï¼Œå…¶ä¸­d&lt;=n&lt;=2dã€‚</li>
<li>æ¯ä¸ªå¶å­èŠ‚ç‚¹æœ€å°‘åŒ…å«ä¸€ä¸ªkeyå’Œä¸¤ä¸ªæŒ‡é’ˆï¼Œæœ€å¤šåŒ…å«2d-1ä¸ªkeyå’Œ2dä¸ªæŒ‡é’ˆï¼Œå¶èŠ‚ç‚¹çš„æŒ‡é’ˆå‡ä¸ºnull ã€‚</li>
<li>æ‰€æœ‰å¶èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦ï¼Œç­‰äºæ ‘é«˜hã€‚</li>
<li>keyå’ŒæŒ‡é’ˆäº’ç›¸é—´éš”ï¼ŒèŠ‚ç‚¹ä¸¤ç«¯æ˜¯æŒ‡é’ˆã€‚</li>
<li>ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„keyä»å·¦åˆ°å³éé€’å‡æ’åˆ—ã€‚</li>
<li>æ‰€æœ‰èŠ‚ç‚¹ç»„æˆæ ‘ç»“æ„ã€‚</li>
<li>æ¯ä¸ªæŒ‡é’ˆè¦ä¹ˆä¸ºnullï¼Œè¦ä¹ˆæŒ‡å‘å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
<li>å¦‚æœæŸä¸ªæŒ‡é’ˆåœ¨èŠ‚ç‚¹nodeæœ€å·¦è¾¹ä¸”ä¸ä¸ºnullï¼Œåˆ™å…¶æŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰keyå°äºv(key_1)ï¼Œå…¶ä¸­v(key_1)ä¸ºnodeçš„ç¬¬ä¸€ä¸ªkeyçš„å€¼ã€‚</li>
<li>å¦‚æœæŸä¸ªæŒ‡é’ˆåœ¨èŠ‚ç‚¹nodeæœ€å³è¾¹ä¸”ä¸ä¸ºnullï¼Œåˆ™å…¶æŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰keyå¤§äºv(key_m)ï¼Œå…¶ä¸­v(key_m)ä¸ºnodeçš„æœ€åä¸€ä¸ªkeyçš„å€¼ã€‚</li>
<li>å¦‚æœæŸä¸ªæŒ‡é’ˆåœ¨èŠ‚ç‚¹nodeçš„å·¦å³ç›¸é‚»keyåˆ†åˆ«æ˜¯key_iå’Œkey{i+1}ä¸”ä¸ä¸ºnullï¼Œåˆ™å…¶æŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰keyå°äºv(key{i+1})ä¸”å¤§äºv(key_i)</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_12_B-Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%86.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_12_B-Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%86.png" alt="img"></a></p>
<p>ç”±äºB-Treeçš„ç‰¹æ€§ï¼Œåœ¨B-Treeä¸­æŒ‰keyæ£€ç´¢æ•°æ®çš„ç®—æ³•éå¸¸ç›´è§‚ï¼šé¦–å…ˆä»æ ¹èŠ‚ç‚¹è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å›å¯¹åº”èŠ‚ç‚¹çš„dataï¼Œå¦åˆ™å¯¹ç›¸åº”åŒºé—´çš„æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹é€’å½’è¿›è¡ŒæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°èŠ‚ç‚¹æˆ–æ‰¾åˆ°nullæŒ‡é’ˆï¼Œå‰è€…æŸ¥æ‰¾æˆåŠŸï¼Œåè€…æŸ¥æ‰¾å¤±è´¥ã€‚B-Treeä¸ŠæŸ¥æ‰¾ç®—æ³•çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">BTree_Search(node, key) &#123;</span><br><span class="line">    if(node &#x3D;&#x3D; null) return null;</span><br><span class="line">    foreach(node.key)</span><br><span class="line">    &#123;</span><br><span class="line">        if(node.key[i] &#x3D;&#x3D; key) return node.data[i];</span><br><span class="line">            if(node.key[i] &gt; key) return BTree_Search(point[i]-&gt;node);</span><br><span class="line">    &#125;</span><br><span class="line">    return BTree_Search(point[i+1]-&gt;node);</span><br><span class="line">&#125;</span><br><span class="line">data &#x3D; BTree_Search(root, my_key);</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>å…³äºB-Treeæœ‰ä¸€ç³»åˆ—æœ‰è¶£çš„æ€§è´¨ï¼Œä¾‹å¦‚ä¸€ä¸ªåº¦ä¸ºdçš„B-Treeï¼Œè®¾å…¶ç´¢å¼•Nä¸ªkeyï¼Œåˆ™å…¶æ ‘é«˜hçš„ä¸Šé™ä¸ºlogd((N+1)/2)logd((N+1)/2)ï¼Œæ£€ç´¢ä¸€ä¸ªkeyï¼Œå…¶æŸ¥æ‰¾èŠ‚ç‚¹ä¸ªæ•°çš„æ¸è¿›å¤æ‚åº¦ä¸ºO(logdN)O(logdN)ã€‚ä»è¿™ç‚¹å¯ä»¥çœ‹å‡ºï¼ŒB-Treeæ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆç‡çš„ç´¢å¼•æ•°æ®ç»“æ„ã€‚</p>
<p>å¦å¤–ï¼Œç”±äºæ’å…¥åˆ é™¤æ–°çš„æ•°æ®è®°å½•ä¼šç ´åB-Treeçš„æ€§è´¨ï¼Œå› æ­¤åœ¨æ’å…¥åˆ é™¤æ—¶ï¼Œéœ€è¦å¯¹æ ‘è¿›è¡Œä¸€ä¸ªåˆ†è£‚ã€åˆå¹¶ã€è½¬ç§»ç­‰æ“ä½œä»¥ä¿æŒB-Treeæ€§è´¨ï¼Œæœ¬æ–‡ä¸æ‰“ç®—å®Œæ•´è®¨è®ºB-Treeè¿™äº›å†…å®¹ï¼Œå› ä¸ºå·²ç»æœ‰è®¸å¤šèµ„æ–™è¯¦ç»†è¯´æ˜äº†B-Treeçš„æ•°å­¦æ€§è´¨åŠæ’å…¥åˆ é™¤ç®—æ³•ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥åœ¨æœ¬æ–‡æœ«çš„å‚è€ƒæ–‡çŒ®ä¸€æ æ‰¾åˆ°ç›¸åº”çš„èµ„æ–™è¿›è¡Œé˜…è¯»ã€‚</p>
</li>
<li><p>B+Tree[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:1">1]</a></p>
<p>B-Treeæœ‰è®¸å¤šå˜ç§ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯B+Treeï¼Œä¾‹å¦‚MySQLå°±æ™®éä½¿ç”¨B+Treeå®ç°å…¶ç´¢å¼•ç»“æ„ã€‚</p>
<p>ä¸B-Treeç›¸æ¯”ï¼ŒB+Treeæœ‰ä»¥ä¸‹ä¸åŒç‚¹ï¼š</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆä¸Šé™ä¸º2dè€Œä¸æ˜¯2d+1ã€‚</li>
<li>å†…èŠ‚ç‚¹ä¸å­˜å‚¨dataï¼Œåªå­˜å‚¨keyï¼›å¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æŒ‡é’ˆã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%863.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%863.png" alt="img"></a></p>
<p>ç”±äºå¹¶ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½å…·æœ‰ç›¸åŒçš„åŸŸï¼Œå› æ­¤B+Treeä¸­å¶èŠ‚ç‚¹å’Œå†…èŠ‚ç‚¹ä¸€èˆ¬å¤§å°ä¸åŒã€‚è¿™ç‚¹ä¸B-Treeä¸åŒï¼Œè™½ç„¶B-Treeä¸­ä¸åŒèŠ‚ç‚¹å­˜æ”¾çš„keyå’ŒæŒ‡é’ˆå¯èƒ½æ•°é‡ä¸ä¸€è‡´ï¼Œä½†æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„åŸŸå’Œä¸Šé™æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥åœ¨å®ç°ä¸­B-Treeå¾€å¾€å¯¹æ¯ä¸ªèŠ‚ç‚¹ç”³è¯·åŒç­‰å¤§å°çš„ç©ºé—´ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒB+Treeæ¯”B-Treeæ›´é€‚åˆå®ç°å¤–å­˜å‚¨ç´¢å¼•ç»“æ„ï¼Œå…·ä½“åŸå› ä¸å¤–å­˜å‚¨å™¨åŸç†åŠè®¡ç®—æœºå­˜å–åŸç†æœ‰å…³ã€‚</p>
</li>
<li><p>å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B+Tree[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:1">1]</a></p>
<p>ä¸€èˆ¬åœ¨æ•°æ®åº“ç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨çš„B+Treeç»“æ„éƒ½åœ¨ç»å…¸B+Treeçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¢åŠ äº†é¡ºåºè®¿é—®æŒ‡é’ˆ</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%862.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%862.png" alt="img"></a></p>
<p>åœ¨B+Treeçš„æ¯ä¸ªå¶å­èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B+Treeã€‚åšè¿™ä¸ªä¼˜åŒ–çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œä¾‹å¦‚å›¾4ä¸­å¦‚æœè¦æŸ¥è¯¢keyä¸ºä»18åˆ°49çš„æ‰€æœ‰æ•°æ®è®°å½•ï¼Œå½“æ‰¾åˆ°18åï¼Œåªéœ€é¡ºç€èŠ‚ç‚¹å’ŒæŒ‡é’ˆé¡ºåºéå†å°±å¯ä»¥ä¸€æ¬¡æ€§è®¿é—®åˆ°æ‰€æœ‰æ•°æ®èŠ‚ç‚¹ï¼Œæå¤§æé«˜äº†åŒºé—´æŸ¥è¯¢æ•ˆç‡ã€‚</p>
</li>
<li><p>ä¸ºä»€ä¹ˆä½¿ç”¨B-Treeï¼ˆB+Treeï¼‰[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:1">1]</a></p>
<p>çº¢é»‘æ ‘ç­‰æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ç´¢å¼•ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ç³»ç»Ÿæ™®éé‡‡ç”¨B-/+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œç»“åˆè®¡ç®—æœºç»„æˆåŸç†ç›¸å…³çŸ¥è¯†è®¨è®ºB-/+Treeä½œä¸ºç´¢å¼•çš„ç†è®ºåŸºç¡€</p>
<p>è€ƒè™‘åˆ°<strong>ä¸»å­˜å­˜å–åŸç†</strong>ï¼Œ<strong>ç£ç›˜å­˜å–åŸç†</strong>ï¼Œ<strong>å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»</strong>è¯¦ç»†è§[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:1">1]</a></p>
<ul>
<li><p>ä¸€èˆ¬ä½¿ç”¨ç£ç›˜I/Oæ¬¡æ•°è¯„ä»·ç´¢å¼•ç»“æ„çš„ä¼˜åŠ£ã€‚</p>
</li>
<li><p>å…ˆä»B-Treeåˆ†æï¼Œæ ¹æ®B-Treeçš„å®šä¹‰ï¼Œå¯çŸ¥æ£€ç´¢ä¸€æ¬¡æœ€å¤šéœ€è¦è®¿é—®hä¸ªèŠ‚ç‚¹ã€‚æ•°æ®åº“ç³»ç»Ÿçš„è®¾è®¡è€…å·§å¦™åˆ©ç”¨äº†ç£ç›˜é¢„è¯»åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºç­‰äºä¸€ä¸ªé¡µï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I/Oå°±å¯ä»¥å®Œå…¨è½½å…¥ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œåœ¨å®é™…å®ç°B-Treeè¿˜éœ€è¦ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼š</p>
<blockquote>
<p>æ¯æ¬¡æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç”³è¯·ä¸€ä¸ªé¡µçš„ç©ºé—´ï¼Œè¿™æ ·å°±ä¿è¯ä¸€ä¸ªèŠ‚ç‚¹ç‰©ç†ä¸Šä¹Ÿå­˜å‚¨åœ¨ä¸€ä¸ªé¡µé‡Œï¼ŒåŠ ä¹‹è®¡ç®—æœºå­˜å‚¨åˆ†é…éƒ½æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œå°±å®ç°äº†ä¸€ä¸ªnodeåªéœ€ä¸€æ¬¡I/Oã€‚</p>
</blockquote>
</li>
<li><p><strong>B-Treeä¸­ä¸€æ¬¡æ£€ç´¢æœ€å¤šéœ€è¦h-1æ¬¡I/Oï¼ˆæ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜ï¼‰ï¼Œæ¸è¿›å¤æ‚åº¦ä¸º$O(h)=O(logdN)$ã€‚ä¸€èˆ¬å®é™…åº”ç”¨ä¸­ï¼Œå‡ºåº¦dæ˜¯éå¸¸å¤§çš„æ•°å­—ï¼Œé€šå¸¸è¶…è¿‡100ï¼Œå› æ­¤héå¸¸å°ï¼ˆé€šå¸¸ä¸è¶…è¿‡3ï¼‰</strong></p>
</li>
<li><p>ç»¼ä¸Šæ‰€è¿°ï¼Œç”¨B-Treeä½œä¸ºç´¢å¼•ç»“æ„æ•ˆç‡æ˜¯éå¸¸é«˜çš„</p>
</li>
<li><p>çº¢é»‘æ ‘è¿™ç§ç»“æ„ï¼Œhæ˜æ˜¾è¦æ·±çš„å¤šã€‚ç”±äºé€»è¾‘ä¸Šå¾ˆè¿‘çš„èŠ‚ç‚¹ï¼ˆçˆ¶å­ï¼‰ç‰©ç†ä¸Šå¯èƒ½å¾ˆè¿œï¼Œæ— æ³•åˆ©ç”¨å±€éƒ¨æ€§ï¼Œæ‰€ä»¥çº¢é»‘æ ‘çš„I/Oæ¸è¿›å¤æ‚åº¦ä¹Ÿä¸ºO(h)ï¼Œæ•ˆç‡æ˜æ˜¾æ¯”B-Treeå·®å¾ˆå¤š</p>
</li>
</ul>
</li>
<li><p>B+Treeé€‚åˆå¤–å­˜ç´¢å¼•çš„åŸå› [<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:1">1]</a>ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%864.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%864.png" alt="img"></a></p>
</li>
<li><p>B+Treeçš„ç´¢å¼•idä¸ºä»€ä¹ˆè®¾ç½®ä¸ºè‡ªå¢æœ‰ç›Šäºç´¢å¼•ç»´æŠ¤</p>
<ul>
<li>å¯ä»¥é¿å…<strong>é¡µåˆ†è£‚</strong>å’Œ<strong>é¡µåˆå¹¶</strong></li>
</ul>
</li>
<li><p>MyISAMç´¢å¼•å®ç°[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:1">1]</a></p>
<ul>
<li>MyISAMå¼•æ“ä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ã€‚ä¸‹å›¾æ˜¯MyISAMç´¢å¼•çš„åŸç†å›¾ï¼š</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeMyISAM%E5%8E%9F%E7%90%861.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeMyISAM%E5%8E%9F%E7%90%861.png" alt="img"></a></p>
<blockquote>
<p>è¿™é‡Œè®¾è¡¨ä¸€å…±æœ‰ä¸‰åˆ—ï¼Œå‡è®¾æˆ‘ä»¬ä»¥Col1ä¸ºä¸»é”®ï¼Œåˆ™å›¾8æ˜¯ä¸€ä¸ªMyISAMè¡¨çš„ä¸»ç´¢å¼•ï¼ˆPrimary keyï¼‰ç¤ºæ„ã€‚å¯ä»¥çœ‹å‡ºMyISAMçš„ç´¢å¼•æ–‡ä»¶ä»…ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚åœ¨MyISAMä¸­ï¼Œä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„keyå¯ä»¥é‡å¤ã€‚å¦‚æœæˆ‘ä»¬åœ¨Col2ä¸Šå»ºç«‹ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼Œåˆ™æ­¤ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeMyISAM%E5%8E%9F%E7%90%862.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeMyISAM%E5%8E%9F%E7%90%862.png" alt="img"></a></p>
<p>åŒæ ·ä¹Ÿæ˜¯ä¸€é¢—B+Treeï¼ŒdataåŸŸä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚å› æ­¤ï¼ŒMyISAMä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚</p>
<blockquote>
<p>MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸InnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚</p>
</blockquote>
</li>
<li><p>InnoDBç´¢å¼•å®ç°[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:1">1]</a></p>
<ul>
<li>è™½ç„¶InnoDBä¹Ÿä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†å…·ä½“å®ç°æ–¹å¼å´ä¸MyISAMæˆªç„¶ä¸åŒã€‚</li>
<li>ç¬¬ä¸€ä¸ªé‡å¤§åŒºåˆ«æ˜¯InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚ä»ä¸Šæ–‡çŸ¥é“ï¼ŒMyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚è€Œåœ¨InnoDBä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeInnoDB%E5%8E%9F%E7%90%861.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeInnoDB%E5%8E%9F%E7%90%861.png" alt="img"></a></p>
<blockquote>
<p>ä¸Šå›¾æ˜¯InnoDBä¸»ç´¢å¼•ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æ•°æ®æ–‡ä»¶ï¼‰çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°å¶èŠ‚ç‚¹åŒ…å«äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ç§ç´¢å¼•å«åšèšé›†ç´¢å¼•ã€‚å› ä¸ºInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«è¦æŒ‰ä¸»é”®èšé›†ï¼Œæ‰€ä»¥InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆMyISAMå¯ä»¥æ²¡æœ‰ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å½¢ã€‚</p>
</blockquote>
<ul>
<li><p>ç¬¬äºŒä¸ªä¸MyISAMç´¢å¼•çš„ä¸åŒæ˜¯InnoDBçš„è¾…åŠ©ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚æ¢å¥è¯è¯´ï¼ŒInnoDBçš„æ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚ä¾‹å¦‚ä¸‹å›¾ä¸ºå®šä¹‰åœ¨Col3ä¸Šçš„ä¸€ä¸ªè¾…åŠ©ç´¢å¼•</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeInnoDB%E5%8E%9F%E7%90%862.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeInnoDB%E5%8E%9F%E7%90%862.png" alt="img"></a></p>
<p>è¿™é‡Œä»¥è‹±æ–‡å­—ç¬¦çš„ASCIIç ä½œä¸ºæ¯”è¾ƒå‡†åˆ™ã€‚èšé›†ç´¢å¼•è¿™ç§å®ç°æ–¹å¼ä½¿å¾—æŒ‰ä¸»é”®çš„æœç´¢ååˆ†é«˜æ•ˆï¼Œä½†æ˜¯è¾…åŠ©ç´¢å¼•æœç´¢éœ€è¦æ£€ç´¢ä¸¤éç´¢å¼•ï¼šé¦–å…ˆæ£€ç´¢è¾…åŠ©ç´¢å¼•è·å¾—ä¸»é”®ï¼Œç„¶åç”¨ä¸»é”®åˆ°ä¸»ç´¢å¼•ä¸­æ£€ç´¢è·å¾—è®°å½•ã€‚</p>
<p>äº†è§£ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•å®ç°æ–¹å¼å¯¹äºæ­£ç¡®ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•éƒ½éå¸¸æœ‰å¸®åŠ©ï¼Œä¾‹å¦‚çŸ¥é“äº†InnoDBçš„ç´¢å¼•å®ç°åï¼Œå°±å¾ˆå®¹æ˜“æ˜ç™½ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸ºæ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚å†ä¾‹å¦‚ï¼Œç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œéå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶æ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½æ•ˆï¼Œè€Œä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>INNODBçš„äºŒçº§ç´¢å¼•ä¸ä¸»é”®ç´¢å¼•æœ‰å¾ˆå¤§çš„ä¸åŒã€‚InnoDBçš„äºŒçº§ç´¢å¼•çš„å¶å­åŒ…å«ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯è¡ŒæŒ‡é’ˆ(row pointers)ï¼Œè¿™å‡å°äº†ç§»åŠ¨æ•°æ®æˆ–è€…æ•°æ®é¡µé¢åˆ†è£‚æ—¶ç»´æŠ¤äºŒçº§ç´¢å¼•çš„å¼€é”€ï¼Œå› ä¸ºInnoDBä¸éœ€è¦æ›´æ–°ç´¢å¼•çš„è¡ŒæŒ‡é’ˆã€‚</p>
</blockquote>
<ul>
<li><p>èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:10">10]</a></p>
<p>èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å°±æ˜¯æ•°æ®èŠ‚ç‚¹ï¼Œè€Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä»ç„¶æ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Œåªä¸è¿‡æœ‰æŒ‡å‘å¯¹åº”æ•°æ®å—çš„æŒ‡é’ˆã€‚è¯¦ç»†è§è¿™ç¯‡<a target="_blank" rel="noopener" href="https://blog.csdn.net/alexdamiao/article/details/51934917">åšå®¢</a></p>
<ul>
<li>InnoDBæŒ‰èšç°‡ç´¢å¼•çš„å½¢å¼å­˜å‚¨æ•°æ®</li>
<li>MyISAMæŒ‰ç…§éèšç°‡ç´¢å¼•çš„å½¢å¼å­˜å‚¨æ•°æ®</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_50_%E8%81%9A%E7%B0%87%E5%92%8C%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_50_%E8%81%9A%E7%B0%87%E5%92%8C%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95.png" alt="img"></a></p>
</li>
<li><p>å›è¡¨</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_51_%E8%81%9A%E7%B0%87%E5%92%8C%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_51_%E8%81%9A%E7%B0%87%E5%92%8C%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95.png" alt="img"></a></p>
<h4 id="2-3-6-å“ªäº›æƒ…å†µéœ€è¦åˆ›å»ºç´¢å¼•"><a href="#2-3-6-å“ªäº›æƒ…å†µéœ€è¦åˆ›å»ºç´¢å¼•" class="headerlink" title="2.3.6 å“ªäº›æƒ…å†µéœ€è¦åˆ›å»ºç´¢å¼•"></a>2.3.6 å“ªäº›æƒ…å†µéœ€è¦åˆ›å»ºç´¢å¼•</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_14_%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_14_%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5.png" alt="img"></a></p>
<h4 id="2-3-7-å“ªäº›æƒ…å†µä¸éœ€è¦åˆ›å»ºç´¢å¼•"><a href="#2-3-7-å“ªäº›æƒ…å†µä¸éœ€è¦åˆ›å»ºç´¢å¼•" class="headerlink" title="2.3.7 å“ªäº›æƒ…å†µä¸éœ€è¦åˆ›å»ºç´¢å¼•"></a>2.3.7 å“ªäº›æƒ…å†µä¸éœ€è¦åˆ›å»ºç´¢å¼•</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_15_%E4%B8%8D%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_15_%E4%B8%8D%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5.png" alt="img"></a></p>
<p>å…³äº<strong>2.3.7.4</strong>çš„åˆ¤æ–­å…¬å¼ï¼š<a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_16_%E4%B8%8D%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_16_%E4%B8%8D%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5.png" alt="img"></a></p>
<h3 id="2-4-ç´¢å¼•æ€§èƒ½åˆ†æ"><a href="#2-4-ç´¢å¼•æ€§èƒ½åˆ†æ" class="headerlink" title="2.4 ç´¢å¼•æ€§èƒ½åˆ†æ"></a>2.4 ç´¢å¼•æ€§èƒ½åˆ†æ</h3><h4 id="2-4-1-MySQL-Query-Optimizer"><a href="#2-4-1-MySQL-Query-Optimizer" class="headerlink" title="2.4.1 MySQL Query Optimizer"></a>2.4.1 MySQL Query Optimizer</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_17_mysqlQueryOptimizer.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_17_mysqlQueryOptimizer.png" alt="img"></a></p>
<h4 id="2-4-2-MySQLå¸¸è§ç“¶é¢ˆ"><a href="#2-4-2-MySQLå¸¸è§ç“¶é¢ˆ" class="headerlink" title="2.4.2 MySQLå¸¸è§ç“¶é¢ˆ"></a>2.4.2 MySQLå¸¸è§ç“¶é¢ˆ</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_18_mysql%E5%B8%B8%E8%A7%81%E7%93%B6%E9%A2%88.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_18_mysql%E5%B8%B8%E8%A7%81%E7%93%B6%E9%A2%88.png" alt="img"></a></p>
<h4 id="2-4-3-Explain"><a href="#2-4-3-Explain" class="headerlink" title="2.4.3 Explain"></a>2.4.3 <strong>Explain</strong></h4><h5 id="2-4-3-1-Explainæ˜¯ä»€ä¹ˆ"><a href="#2-4-3-1-Explainæ˜¯ä»€ä¹ˆ" class="headerlink" title="2.4.3.1 Explainæ˜¯ä»€ä¹ˆ"></a>2.4.3.1 Explainæ˜¯ä»€ä¹ˆ</h5><blockquote>
<p>ä½¿ç”¨EXPLAINå…³é”®å­—å¯ä»¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒSQLæŸ¥è¯¢è¯­å¥ï¼Œä»è€ŒçŸ¥é“MySQLæ˜¯å¦‚ä½•å¤„ç†ä½ çš„SQLè¯­å¥çš„ã€‚åˆ†æä½ çš„æŸ¥è¯¢è¯­å¥æˆ–æ˜¯è¡¨ç»“æ„çš„æ€§èƒ½ç“¶é¢ˆ</p>
</blockquote>
<p>å®˜ç½‘ä»‹ç»: <a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/refman/5.5/en/explain-output.html">http://dev.mysql.com/doc/refman/5.5/en/explain-output.html</a></p>
<h5 id="2-4-3-2-Explainèƒ½å¹²å˜›"><a href="#2-4-3-2-Explainèƒ½å¹²å˜›" class="headerlink" title="2.4.3.2 Explainèƒ½å¹²å˜›"></a>2.4.3.2 Explainèƒ½å¹²å˜›</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_19_explain%E8%83%BD%E5%B9%B2%E5%98%9B.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_19_explain%E8%83%BD%E5%B9%B2%E5%98%9B.png" alt="img"></a></p>
<h5 id="2-4-3-3-Explainæ€ä¹ˆç”¨"><a href="#2-4-3-3-Explainæ€ä¹ˆç”¨" class="headerlink" title="2.4.3.3 Explainæ€ä¹ˆç”¨"></a>2.4.3.3 Explainæ€ä¹ˆç”¨</h5><blockquote>
<p>Explain + SQLè¯­å¥</p>
</blockquote>
<ul>
<li><p>æ‰§è¡Œè®¡åˆ’åŒ…å«çš„ä¿¡æ¯</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_20_explain%E6%80%8E%E4%B9%88%E7%94%A8.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_20_explain%E6%80%8E%E4%B9%88%E7%94%A8.png" alt="img"></a></p>
</li>
</ul>
<h5 id="2-4-3-4-Explainæ‰§è¡Œè®¡åˆ’å„å­—æ®µè§£é‡Š"><a href="#2-4-3-4-Explainæ‰§è¡Œè®¡åˆ’å„å­—æ®µè§£é‡Š" class="headerlink" title="2.4.3.4 Explainæ‰§è¡Œè®¡åˆ’å„å­—æ®µè§£é‡Š"></a>2.4.3.4 Explainæ‰§è¡Œè®¡åˆ’å„å­—æ®µè§£é‡Š</h5><ul>
<li><p>id â­ï¼š</p>
<ul>
<li><p>å«ä¹‰ï¼šselectæŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–æ“ä½œè¡¨çš„<strong>é¡ºåº</strong></p>
</li>
<li><p>ä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li><p>idç›¸åŒï¼šæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹</p>
</li>
<li><p>idä¸åŒï¼šå¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œidçš„åºå·ä¼šé€’å¢ï¼Œ<strong>idå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜</strong>ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ</p>
</li>
<li><p>idç›¸åŒ/ä¸åŒï¼ŒåŒæ—¶å­˜åœ¨ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_21_id3.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_21_id3.png" alt="img"></a></p>
<p>è¡ç”Ÿè¡¨ = derived2 â€“&gt; derived + 2</p>
<p>ï¼ˆ2 è¡¨ç¤ºç”± id =2 çš„æŸ¥è¯¢è¡ç”Ÿå‡ºæ¥çš„è¡¨ã€‚type è‚¯å®šæ˜¯ all ï¼Œå› ä¸ºè¡ç”Ÿçš„è¡¨æ²¡æœ‰å»ºç«‹ç´¢å¼•ï¼‰</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>select_typeï¼š</p>
<ul>
<li><p>åŒ…å«ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_22_select_type.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_22_select_type.png" alt="img"></a></p>
</li>
<li><p>æŸ¥è¯¢çš„ç±»å‹ï¼š</p>
<p>ä¸»è¦æ˜¯ç”¨äºåŒºåˆ«ï¼šæ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰çš„å¤æ‚æŸ¥è¯¢</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_23_select_type.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_23_select_type.png" alt="img"></a></p>
</li>
</ul>
</li>
<li><p>tableï¼šæ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„</p>
</li>
<li><p>typeâ­ï¼š</p>
<ul>
<li><p>åŒ…å«ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_24_type.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_24_type.png" alt="img"></a></p>
</li>
<li><p>typeæ˜¾ç¤ºçš„æ˜¯è®¿é—®ç±»å‹ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡</p>
</li>
<li><p><strong>ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯</strong>ï¼š</p>
<p>(system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range(å°½é‡ä¿è¯) &gt; index &gt; ALL )</p>
<p><strong>ç®€åŒ–ç‰ˆï¼ˆè®°ä½ï¼‰</strong>ï¼š<strong>system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</strong> ä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ°refã€‚</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_25_type.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_25_type.png" alt="img"></a></p>
</li>
</ul>
</li>
<li><p>possible_keysï¼š</p>
<ul>
<li>æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚</li>
<li>æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œ<strong>ä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨</strong></li>
</ul>
</li>
<li><p>keyâ­ï¼š</p>
<ul>
<li>å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€ç´¢å¼•å¤±æ•ˆ</li>
<li><strong>æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å’ŒæŸ¥è¯¢çš„selectå­—æ®µé‡å </strong></li>
</ul>
</li>
<li><p>key_lenï¼š</p>
<ul>
<li>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚ä¸æŸå¤±ç²¾åº¦æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½</li>
<li>key_lenå­—æ®µèƒ½å¤Ÿå¸®ä½ æ£€æŸ¥æ˜¯å¦å……åˆ†çš„åˆ©ç”¨ä¸Šäº†ç´¢å¼•</li>
</ul>
</li>
<li><p>refï¼š</p>
<ul>
<li>æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼</li>
</ul>
</li>
<li><p>rowsâ­ï¼š</p>
<ul>
<li>rowsåˆ—æ˜¾ç¤ºMySQLè®¤ä¸ºå®ƒæ‰§è¡ŒæŸ¥è¯¢æ—¶å¿…é¡»æ£€æŸ¥çš„è¡Œæ•°ã€‚</li>
<li>è¶Šå°‘è¶Šå¥½</li>
</ul>
</li>
<li><p>Extraâ­ï¼š</p>
<ul>
<li><p>åŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_26_Extra.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_26_Extra.png" alt="img"></a></p>
</li>
<li><p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼šç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬æ•°æ®åº“ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ªåˆ—çš„æ•°æ®ï¼Œå› æ­¤å®ƒä¸å¿…è¯»å–æ•´ä¸ªè¡Œã€‚æ¯•ç«Ÿç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®ƒä»¬ç´¢å¼•çš„æ•°æ®; å½“èƒ½é€šè¿‡è¯»å–ç´¢å¼•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦è¯»å–è¡Œäº†ã€‚</p>
<p>â‘ ä¸€ä¸ªç´¢å¼•</p>
<p>â‘¡åŒ…å«äº†(æˆ–è¦†ç›–äº†)[selectå­å¥]ä¸æŸ¥è¯¢æ¡ä»¶[Whereå­å¥]ä¸­</p>
<p>â‘¢æ‰€æœ‰éœ€è¦çš„å­—æ®µå°±å«åš<strong>è¦†ç›–ç´¢å¼•</strong>ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_27_%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_27_%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95.png" alt="img"></a></p>
<p><strong>ç†è§£</strong>ï¼š</p>
<blockquote>
<p>select id , name from t_xxx where age=18;</p>
<p>æœ‰ä¸€ä¸ªç»„åˆç´¢å¼• idx_id_name_age_xxx åŒ…å«äº†(è¦†ç›–äº†) id,name,ageä¸‰ä¸ªå­—æ®µã€‚æŸ¥è¯¢æ—¶ç›´æ¥å°†å»ºç«‹äº†ç´¢å¼•çš„åˆ—è¯»å–å‡ºæ¥äº†ï¼Œè€Œä¸éœ€è¦å»æŸ¥æ‰¾æ‰€åœ¨è¡Œçš„å…¶ä»–æ•°æ®, æ‰€ä»¥å¾ˆé«˜æ•ˆã€‚</p>
</blockquote>
<p>(ä¸ªäººè®¤ä¸ºï¼šåœ¨æ•°æ®é‡è¾ƒå¤§ï¼Œå›ºå®šå­—æ®µæŸ¥è¯¢æƒ…å†µå¤šæ—¶å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚)</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-5-æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5 æŸ¥è¯¢ä¼˜åŒ–"></a>2.5 æŸ¥è¯¢ä¼˜åŒ–</h3><h4 id="2-5-1-ç´¢å¼•ä¼˜åŒ–"><a href="#2-5-1-ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="2.5.1 ç´¢å¼•ä¼˜åŒ–"></a>2.5.1 ç´¢å¼•ä¼˜åŒ–</h4><h5 id="2-5-1-1-ç´¢å¼•åˆ†æ"><a href="#2-5-1-1-ç´¢å¼•åˆ†æ" class="headerlink" title="2.5.1.1 ç´¢å¼•åˆ†æ"></a>2.5.1.1 ç´¢å¼•åˆ†æ</h5><ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12b411K7Zu?p=209">å•è¡¨åˆ†ææ¡ˆä¾‹</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12b411K7Zu?p=210">å¤šè¡¨åˆ†ææ¡ˆä¾‹</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12b411K7Zu?p=211">ä¸‰è¡¨åˆ†ææ¡ˆä¾‹</a><ul>
<li>å°½å¯èƒ½å‡å°‘Joinè¯­å¥çš„NextedLoopçš„å¾ªç¯æ€»æ¬¡æ•°ï¼šæ°¸è¿œç”¨å°ç»“æœé›†é©±åŠ¨å¤§ç»“æœé›†</li>
<li>ä¼˜å…ˆä¼˜åŒ–NestedLoopçš„å†…å±‚å¾ªç¯</li>
<li><strong>ä¿è¯Joinè¯­å¥ä¸­è¢«é©±åŠ¨è¡¨ä¸ŠJoinæ¡ä»¶çš„å­—æ®µå·²ç»è¢«ç´¢å¼•</strong></li>
<li>å½“æ— æ³•ä¿è¯è¢«é©±åŠ¨è¡¨çš„Joinæ¡ä»¶å­—æ®µè¢«ç´¢å¼•ä¸”å†…å­˜å……è¶³çš„å‰æä¸‹ï¼Œä¸è¦å¤ªåå•¬JoinBufferçš„è®¾ç½®</li>
</ul>
</li>
</ul>
<h5 id="2-5-1-2-ç´¢å¼•å¤±æ•ˆ"><a href="#2-5-1-2-ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="2.5.1.2 ç´¢å¼•å¤±æ•ˆ"></a>2.5.1.2 <strong>ç´¢å¼•å¤±æ•ˆ</strong></h5><ul>
<li><p><strong>è”åˆç´¢å¼•åœ¨B+Treeä¸Šçš„å­˜å‚¨ç»“æ„åŠæ•°æ®æŸ¥æ‰¾æ–¹å¼.</strong></p>
<p>â­ï¼Œå…·ä½“å‚è€ƒ</p>
<p>[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:3">3]</a></p>
<p>ï¼ˆåŸºäºåº•å±‚å»ç†è§£ç´¢å¼•å¤±æ•ˆï¼‰</p>
<ul>
<li>è¿™é‡Œè´´ä¸€ä¸ªç®€å•çš„è”åˆç´¢å¼•çš„ç»“æ„å›¾ï¼Œå…·ä½“çœ‹ä¸Šé¢çš„å¸–å­</li>
<li><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_30_%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%92%8C%E6%9F%A5%E6%89%BE%E6%96%B9%E5%BC%8F.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_30_%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%92%8C%E6%9F%A5%E6%89%BE%E6%96%B9%E5%BC%8F.png" alt="img"></a></li>
</ul>
</li>
<li><p>ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_28_%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_28_%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88.png" alt="img"></a></p>
<ul>
<li><p>å°æ€»ç»“ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_29_%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%B0%8F%E6%80%BB%E7%BB%93.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_29_%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%B0%8F%E6%80%BB%E7%BB%93.png" alt="img"></a></p>
</li>
<li><p>ï¼ˆè¡¥å……ï¼‰è¦†ç›–ç´¢å¼•ã€æœ€å·¦åŒ¹é…ã€ç´¢å¼•ä¸‹æ¨çš„ç†è§£â­</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#%E5%9B%9E%E8%A1%A8">å›è¡¨</a>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from table where name&#x3D;zhansan;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¬¡æŸ¥è¯¢nameçš„B+Treeï¼Œæ ¹æ®é‚£ä¹ˆè·å–åˆ°ä¸»é”®idï¼Œç„¶åå†æ ¹æ®idå»idçš„B+Treeæ‰¾åˆ°è¡Œè®°å½•ï¼Œè¿™ä¸ªå›è¡¨è¿‡ç¨‹ä¼šå¯¼è‡´IOæ¬¡æ•°å˜å¤šã€‚</p>
</li>
<li><p>è¦†ç›–ç´¢å¼•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select id,name from table where name&#x3D;zhansan;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿›è¡Œæ£€ç´¢æ˜¯ï¼Œç›´æ¥æ›´å…·é‚£ä¹ˆå»nameçš„B+Treeè·å–åˆ°idï¼Œnameä¸¤åˆ—çš„å€¼ï¼Œä¸éœ€è¦å›è¡¨ï¼Œæ•ˆç‡é«˜ï¼Œåº”è¯¥å°½å¯èƒ½å¤šçš„ä½¿ç”¨ç´¢å¼•è¦†ç›–æ¥ä»£æ›¿å›è¡¨ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ï¼Œåœ¨å¤æ‚çš„sqlä¸­ï¼Œå¯ä»¥è€ƒè™‘å°†ä¸ç›¸å…³çš„åˆ—éƒ½è®¾ç½®ä¸ºç´¢å¼•åˆ—</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select id,name,age from table where name&#x3D;zhangsan;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œnameï¼Œageä½œä¸ºä¸€ä¸ªè”åˆç´¢å¼•</p>
</li>
<li><p>æœ€å·¦åŒ¹é…ï¼š</p>
<p>æœ‰ä¸€ä¸ªè¡¨ï¼šidï¼Œnameï¼Œageï¼Œgenderï¼ˆidæ˜¯ä¸»é”®ï¼Œnameï¼Œageæ˜¯è”åˆç´¢å¼•ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from table where name&#x3D;?           # ç¬¦åˆ</span><br><span class="line">select * from table where name&#x3D;? and age&#x3D;? # ç¬¦åˆ</span><br><span class="line">select * from table where age&#x3D;? &#x3D; name&#x3D;?   # ä¼˜åŒ–å™¨ä¼šä¼˜åŒ–,ä½¿å…¶ç¬¦åˆæœ€å·¦åŒ¹é…</span><br><span class="line">select * from table where age&#x3D;?            # ä¸ç¬¦åˆ</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>ç´¢å¼•ä¸‹æ¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from table where name&#x3D;? and age&#x3D;?</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨æ²¡æœ‰ç´¢å¼•ä¸‹æ¨ä¹‹å‰ï¼Œå…ˆæ ¹æ®nameå»å­˜å‚¨å¼•æ“ä¸­æ‹‰å–ç¬¦åˆç»“æ„çš„æ•°æ®ï¼Œè¿”å›åˆ°serverå±‚ï¼Œåœ¨serverå±‚ä¸­å¯¹ageçš„æ¡ä»¶è¿›è¡Œè¿‡æ»¤</li>
<li>æœ‰äº†ç´¢å¼•ä¸‹æ¨ä¹‹åï¼Œæ ¹æ®nameï¼Œageä¸¤ä¸ªæ¡ä»¶ç›´æ¥ä»å­˜å‚¨å¼•æ“ä¸­æ‹‰å»ç»“æœï¼Œä¸éœ€è¦å†serverå±‚åšæ¡ä»¶è¿‡æ»¤</li>
<li>mysql5.7ç‰ˆæœ¬ä¹‹åé»˜è®¤å¼€å¯</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-5-1-3-ä¸€èˆ¬æ€§å»ºè®®"><a href="#2-5-1-3-ä¸€èˆ¬æ€§å»ºè®®" class="headerlink" title="2.5.1.3 ä¸€èˆ¬æ€§å»ºè®®"></a>2.5.1.3 ä¸€èˆ¬æ€§å»ºè®®</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_31_%E7%B4%A2%E5%BC%95%E4%B8%80%E8%88%AC%E6%80%A7%E5%BB%BA%E8%AE%AE2.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_31_%E7%B4%A2%E5%BC%95%E4%B8%80%E8%88%AC%E6%80%A7%E5%BB%BA%E8%AE%AE2.png" alt="img"></a></p>
<h5 id="2-5-1-4-ä¼˜åŒ–å£è¯€"><a href="#2-5-1-4-ä¼˜åŒ–å£è¯€" class="headerlink" title="2.5.1.4 ä¼˜åŒ–å£è¯€"></a>2.5.1.4 ä¼˜åŒ–å£è¯€</h5><p>å»ºè®®ç†è§£ï¼Œä¸ç”¨èƒŒ</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_32_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%8F%A3%E8%AF%80.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_32_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%8F%A3%E8%AF%80.png" alt="img"></a></p>
<h4 id="2-5-2-æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-2-æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5.2 æŸ¥è¯¢ä¼˜åŒ–"></a>2.5.2 æŸ¥è¯¢ä¼˜åŒ–</h4><blockquote>
<p>å¯¹äºæ•°æ®åº“åˆ†æ</p>
<ol>
<li>è§‚å¯Ÿï¼Œè‡³å°‘è·‘ä¸€å¤©ï¼Œçœ‹çœ‹ç”Ÿäº§çš„æ…¢SQLæƒ…å†µã€‚</li>
<li>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®¾ç½®é˜ˆå€¼ï¼Œæ¯”å¦‚è¶…è¿‡5ç§’é’Ÿçš„å°±æ˜¯æ…¢SQLï¼Œå¹¶å°†å®ƒæŠ“å–å‡ºæ¥ã€‚</li>
<li>explain+æ…¢SQLåˆ†æ</li>
<li>show profile</li>
<li>è¿ç»´ç»ç† or DBAæ¥è¿›è¡ŒSQLæ•°æ®åº“æœåŠ¡å™¨çš„å‚æ•°è°ƒä¼˜</li>
</ol>
</blockquote>
<p><strong>æ€»ç»“</strong>ï¼š</p>
<ul>
<li>æ…¢æŸ¥è¯¢å¼€å¯å¹¶æ•è·</li>
<li>explain+æ…¢SQLåˆ†æ</li>
<li>show profileæŸ¥è¯¢SQLå†MySQLæœåŠ¡å™¨é‡Œé¢çš„æ‰§è¡Œç»†èŠ‚å’Œç”Ÿå‘½å‘¨æœŸæƒ…å†µ</li>
<li>SQLæ•°æ®åº“æœåŠ¡å™¨å‚æ•°è°ƒä¼˜</li>
</ul>
<p>å…³äºä¸‹é¢2.5.2.1å’Œ2.5.2.3çš„ä¼˜åŒ–åŸç†è§æˆ‘åé¢å†™çš„<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/04/01/MySQL_Join%E4%BC%98%E5%8C%96/">Joinä¼˜åŒ–</a></p>
<h5 id="2-5-2-1-å°è¡¨é©±åŠ¨å¤§è¡¨"><a href="#2-5-2-1-å°è¡¨é©±åŠ¨å¤§è¡¨" class="headerlink" title="2.5.2.1 å°è¡¨é©±åŠ¨å¤§è¡¨"></a>2.5.2.1 å°è¡¨é©±åŠ¨å¤§è¡¨</h5><ul>
<li><p>ç±»ä¼¼åµŒå¥—å¾ªç¯Nested Loop</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_33_%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_33_%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96.png" alt="img"></a></p>
</li>
<li><p>in/exists</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_33_%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%962.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_33_%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%962.png" alt="img"></a></p>
</li>
</ul>
<h5 id="2-5-2-2-order-byå…³é”®å­—ä¼˜åŒ–"><a href="#2-5-2-2-order-byå…³é”®å­—ä¼˜åŒ–" class="headerlink" title="2.5.2.2 order byå…³é”®å­—ä¼˜åŒ–"></a>2.5.2.2 order byå…³é”®å­—ä¼˜åŒ–</h5><blockquote>
<p>å°½é‡ä½¿ç”¨Indexæ–¹å¼æ’åº,é¿å…ä½¿ç”¨FileSortæ–¹å¼æ’åº</p>
</blockquote>
<ul>
<li>MySQLæ”¯æŒäºŒç§æ–¹å¼çš„æ’åºï¼ŒFileSortå’ŒIndex<ul>
<li>Indexæ•ˆç‡é«˜.å®ƒæŒ‡MySQLæ‰«æç´¢å¼•æœ¬èº«å®Œæˆæ’åºã€‚</li>
</ul>
</li>
<li>FileSortæ–¹å¼æ•ˆç‡è¾ƒä½ã€‚</li>
</ul>
<blockquote>
<p>å°½å¯èƒ½åœ¨ç´¢å¼•åˆ—ä¸Šå®Œæˆæ’åºæ“ä½œï¼Œéµç…§ç´¢å¼•å»ºçš„æœ€ä½³å·¦å‰ç¼€</p>
</blockquote>
<ul>
<li><p>ORDER BYæ»¡è¶³ä¸¤æƒ…å†µï¼Œä¼šä½¿ç”¨Indexæ–¹å¼æ’åº</p>
<ul>
<li>ORDER BY è¯­å¥ä½¿ç”¨ç´¢å¼•æœ€å·¦å‰åˆ—</li>
<li>ä½¿ç”¨Whereå­å¥ä¸Order BYå­å¥æ¡ä»¶åˆ—ç»„åˆæ»¡è¶³ç´¢å¼•æœ€å·¦å‰åˆ—</li>
<li>whereå­å¥ä¸­å¦‚æœå‡ºç°ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢(å³explainä¸­å‡ºç°range)ä¼šå¯¼è‡´order by ç´¢å¼•å¤±æ•ˆã€‚</li>
</ul>
</li>
<li><p>å°æ€»ç»“ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_35_orderby%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_35_orderby%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93.png" alt="img"></a></p>
</li>
</ul>
<blockquote>
<p>å¦‚æœä¸åœ¨ç´¢å¼•åˆ—ä¸Šï¼Œfilesortæœ‰ä¸¤ç§ç®—æ³•ï¼š</p>
<p>mysqlå°±è¦å¯åŠ¨<strong>åŒè·¯æ’åº</strong>å’Œ<strong>å•è·¯æ’åº</strong></p>
</blockquote>
<ul>
<li><p>åŒè·¯æ’åº</p>
<ul>
<li>MySQL 4.1ä¹‹å‰æ˜¯ä½¿ç”¨åŒè·¯æ’åº,å­—é¢æ„æ€å°±æ˜¯ä¸¤æ¬¡æ‰«æç£ç›˜ï¼Œæœ€ç»ˆå¾—åˆ°æ•°æ®ï¼Œ<br>è¯»å–è¡ŒæŒ‡é’ˆå’Œorderbyåˆ—ï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«æå·²ç»æ’åºå¥½çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§åˆ—è¡¨ä¸­çš„å€¼é‡æ–°ä»åˆ—è¡¨ä¸­è¯»å–å¯¹åº”çš„æ•°æ®è¾“å‡º</li>
<li>ä»ç£ç›˜å–æ’åºå­—æ®µï¼Œåœ¨bufferè¿›è¡Œæ’åºï¼Œå†ä»ç£ç›˜å–å…¶ä»–å­—æ®µã€‚ï¼ˆä¸¤æ¬¡ï¼‰</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå–ä¸€æ‰¹æ•°æ®ï¼Œè¦å¯¹ç£ç›˜è¿›è¡Œäº†ä¸¤æ¬¡æ‰«æï¼Œä¼—æ‰€å‘¨çŸ¥ï¼ŒI\Oæ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥åœ¨mysql4.1ä¹‹åï¼Œå‡ºç°äº†ç¬¬äºŒç§æ”¹è¿›çš„ç®—æ³•ï¼Œå°±æ˜¯å•è·¯æ’åºã€‚</li>
</ul>
</li>
<li><p>å•è·¯æ’åº</p>
<ul>
<li>ä»ç£ç›˜è¯»å–æŸ¥è¯¢éœ€è¦çš„æ‰€æœ‰åˆ—ï¼ŒæŒ‰ç…§order byåˆ—åœ¨bufferå¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡ºï¼Œ</li>
<li>å®ƒçš„æ•ˆç‡æ›´å¿«ä¸€äº›ï¼Œé¿å…äº†ç¬¬äºŒæ¬¡è¯»å–æ•°æ®ã€‚å¹¶ä¸”æŠŠéšæœºIOå˜æˆäº†é¡ºåºIO,ä½†æ˜¯å®ƒä¼šä½¿ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œå› ä¸ºå®ƒæŠŠæ¯ä¸€è¡Œéƒ½ä¿å­˜åœ¨å†…å­˜ä¸­äº†ã€‚</li>
<li>ç»“è®ºåŠå¼•ç”³å‡ºçš„é—®é¢˜ï¼š<ul>
<li>ç»“è®ºï¼šç”±äºå•è·¯æ˜¯åå‡ºçš„ï¼Œæ€»ä½“è€Œè¨€å¥½è¿‡åŒè·¯</li>
<li>é—®é¢˜ï¼šåœ¨sort_bufferä¸­ï¼Œæ–¹æ³•Bæ¯”æ–¹æ³•Aè¦å¤šå ç”¨å¾ˆå¤šç©ºé—´ï¼Œå› ä¸ºæ–¹æ³•Bæ˜¯æŠŠæ‰€æœ‰å­—æ®µéƒ½å–å‡º, æ‰€ä»¥æœ‰å¯èƒ½å–å‡ºçš„æ•°æ®çš„æ€»å¤§å°è¶…å‡ºäº†sort_bufferçš„å®¹é‡ï¼Œå¯¼è‡´æ¯æ¬¡åªèƒ½å–sort_bufferå®¹é‡å¤§å°çš„æ•°æ®ï¼Œè¿›è¡Œæ’åºï¼ˆåˆ›å»ºtmpæ–‡ä»¶ï¼Œå¤šè·¯åˆå¹¶ï¼‰ï¼Œæ’å®Œå†å–å–sort_bufferå®¹é‡å¤§å°ï¼Œå†æ’â€¦â€¦ä»è€Œå¤šæ¬¡I/Oã€‚æœ¬æ¥æƒ³çœä¸€æ¬¡I/Oæ“ä½œï¼Œåè€Œå¯¼è‡´äº†å¤§é‡çš„I/Oæ“ä½œï¼Œåè€Œå¾—ä¸å¿å¤±ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p>ä¼˜åŒ–ç­–ç•¥</p>
<ul>
<li><p>å¢å¤§sort_buffer_sizeå‚æ•°çš„è®¾ç½®</p>
</li>
<li><p>å¢å¤§max_length_for_sort_dataå‚æ•°çš„è®¾ç½®</p>
</li>
<li><p>å»æ‰select åé¢ä¸éœ€è¦çš„å­—æ®µ</p>
</li>
<li><p>ä»¥ä¸Šç­–ç•¥å¯¹åº”çš„åŸå› ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_34_orderby%E4%BC%98%E5%8C%96.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_34_orderby%E4%BC%98%E5%8C%96.png" alt="img"></a></p>
</li>
</ul>
</li>
</ul>
<h5 id="2-5-2-3-group-byå…³é”®å­—ä¼˜åŒ–"><a href="#2-5-2-3-group-byå…³é”®å­—ä¼˜åŒ–" class="headerlink" title="2.5.2.3 group byå…³é”®å­—ä¼˜åŒ–"></a>2.5.2.3 group byå…³é”®å­—ä¼˜åŒ–</h5><ul>
<li>group byå®è´¨æ˜¯å…ˆæ’åºåè¿›è¡Œåˆ†ç»„ï¼Œéµç…§ç´¢å¼•å»ºçš„æœ€ä½³å·¦å‰ç¼€</li>
<li>å½“æ— æ³•ä½¿ç”¨ç´¢å¼•åˆ—ï¼Œå¢å¤§max_length_for_sort_dataå‚æ•°çš„è®¾ç½®+å¢å¤§sort_buffer_sizeå‚æ•°çš„è®¾ç½®</li>
<li>whereé«˜äºhavingï¼Œèƒ½å†™åœ¨whereé™å®šçš„æ¡ä»¶å°±ä¸è¦å»havingé™å®šäº†ã€‚</li>
</ul>
<h5 id="2-5-2-4-å…³è”æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-2-4-å…³è”æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5.2.4 å…³è”æŸ¥è¯¢ä¼˜åŒ–"></a>2.5.2.4 å…³è”æŸ¥è¯¢ä¼˜åŒ–</h5><ul>
<li>ä¿è¯è¢«é©±åŠ¨è¡¨çš„joinå­—æ®µå·²ç»è¢«ç´¢å¼•</li>
<li>left join æ—¶ï¼Œé€‰æ‹©å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨</li>
<li>inner join æ—¶ï¼Œmysqlä¼šè‡ªå·±å¸®ä½ æŠŠå°ç»“æœé›†çš„è¡¨é€‰ä¸ºé©±åŠ¨è¡¨</li>
<li>å­æŸ¥è¯¢å°½é‡ä¸è¦æ”¾åœ¨è¢«é©±åŠ¨è¡¨ï¼Œæœ‰å¯èƒ½ä½¿ç”¨ä¸åˆ°ç´¢å¼•</li>
</ul>
<h5 id="2-5-2-5-å­æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-2-5-å­æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5.2.5 å­æŸ¥è¯¢ä¼˜åŒ–"></a>2.5.2.5 å­æŸ¥è¯¢ä¼˜åŒ–</h5><ul>
<li>æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ ç”¨ inner join æ˜¯æœ€å¥½çš„ å…¶æ¬¡æ˜¯ in ï¼Œexistsæœ€ç³Ÿç³•</li>
<li>æ— ç´¢å¼•çš„æƒ…å†µä¸‹ç”¨ å°è¡¨é©±åŠ¨å¤§è¡¨ å› ä¸ºjoin æ–¹å¼éœ€è¦distinct ï¼Œæ²¡æœ‰ç´¢å¼•distinctæ¶ˆè€—æ€§èƒ½è¾ƒå¤§ æ‰€ä»¥ existsæ€§èƒ½æœ€ä½³ inå…¶æ¬¡ joinæ€§èƒ½æœ€å·®</li>
<li>æ— ç´¢å¼•çš„æƒ…å†µä¸‹å¤§è¡¨é©±åŠ¨å°è¡¨in å’Œ exists çš„æ€§èƒ½åº”è¯¥æ˜¯æ¥è¿‘çš„ éƒ½æ¯”è¾ƒç³Ÿç³• existsç¨å¾®å¥½ä¸€ç‚¹ è¶…ä¸è¿‡5% ä½†æ˜¯inner join ç”±äºä½¿ç”¨äº† join buffer æ‰€ä»¥å¿«å¾ˆå¤šå¦‚æœleft join åˆ™æœ€æ…¢</li>
</ul>
<h5 id="2-5-2-6-åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-2-6-åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5.2.6 åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–"></a>2.5.2.6 åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä¼˜åŒ–å‰</span><br><span class="line">EXPLAIN SELECT SQL_NO_CACHE * FROM emp ORDER BY deptno  LIMIT 10000,40</span><br><span class="line"># ä¼˜åŒ–å</span><br><span class="line">EXPLAIN SELECT SQL_NO_CACHE * FROM emp INNER JOIN (SELECT id FROM emp e ORDER BY deptno LIMIT 10000,40) a ON a.id&#x3D;emp.id</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å…ˆåˆ©ç”¨è¦†ç›–ç´¢å¼•æŠŠè¦å–çš„æ•°æ®è¡Œçš„ä¸»é”®å–åˆ°ï¼Œç„¶åå†ç”¨è¿™ä¸ªä¸»é”®åˆ—ä¸æ•°æ®è¡¨åšå…³è”ï¼ˆæŸ¥è¯¢çš„æ•°æ®é‡å°äº†ï¼‰</p>
</li>
<li><p>å®è·µè¯æ˜ï¼š</p>
<p>â‘ ã€order by åçš„å­—æ®µï¼ˆXXXï¼‰æœ‰ç´¢å¼•</p>
<p>â‘¡ã€sql ä¸­æœ‰ limit æ—¶ï¼Œ å½“ select id æˆ– XXXå­—æ®µç´¢å¼•åŒ…å«å­—æ®µæ—¶ ï¼Œæ˜¾ç¤º using index å½“ select åçš„å­—æ®µå«æœ‰ bouder by å­—æ®µç´¢å¼•ä¸åŒ…å«çš„å­—æ®µæ—¶ï¼Œå°†æ˜¾ç¤º using filesort</p>
</li>
</ul>
<h5 id="2-5-2-7-å»é‡ä¼˜åŒ–"><a href="#2-5-2-7-å»é‡ä¼˜åŒ–" class="headerlink" title="2.5.2.7 å»é‡ä¼˜åŒ–"></a>2.5.2.7 å»é‡ä¼˜åŒ–</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å°†äº§ç”Ÿé‡å¤æ•°æ®</span><br><span class="line">select kcdz from t_mall_sku where id in( 3,4,5,6,8 )</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ distinct å…³é”®å­—å»é‡æ¶ˆè€—æ€§èƒ½ä¼˜åŒ–</span><br><span class="line">select distinct kcdz from t_mall_sku where id in( 3,4,5,6,8 )</span><br><span class="line"></span><br><span class="line"># èƒ½å¤Ÿåˆ©ç”¨åˆ°ç´¢å¼•</span><br><span class="line">select  kcdz from t_mall_sku where id in( 3,4,5,6,8 )  group by kcdz </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<ul>
<li>å°½é‡ä¸è¦ä½¿ç”¨ distinct å…³é”®å­—å»é‡</li>
<li>group byèƒ½å»é‡ä¸”åˆ©ç”¨ç´¢å¼•</li>
</ul>
<h2 id="3-æŸ¥è¯¢æˆªå–åˆ†æ"><a href="#3-æŸ¥è¯¢æˆªå–åˆ†æ" class="headerlink" title="3. æŸ¥è¯¢æˆªå–åˆ†æ"></a>3. æŸ¥è¯¢æˆªå–åˆ†æ</h2><h3 id="3-1-æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#3-1-æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="3.1 æ…¢æŸ¥è¯¢æ—¥å¿—"></a>3.1 æ…¢æŸ¥è¯¢æ—¥å¿—</h3><h4 id="3-1-1-æ…¢æŸ¥è¯¢æ—¥å¿—ä»‹ç»"><a href="#3-1-1-æ…¢æŸ¥è¯¢æ—¥å¿—ä»‹ç»" class="headerlink" title="3.1.1 æ…¢æŸ¥è¯¢æ—¥å¿—ä»‹ç»"></a>3.1.1 æ…¢æŸ¥è¯¢æ—¥å¿—ä»‹ç»</h4><ul>
<li>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯MySQLæä¾›çš„ä¸€ç§æ—¥å¿—è®°å½•ï¼Œå®ƒç”¨æ¥è®°å½•åœ¨MySQLä¸­å“åº”æ—¶é—´è¶…è¿‡é˜€å€¼çš„è¯­å¥ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡long_query_timeå€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</li>
<li>å…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡long_query_timeå€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚long_query_timeçš„é»˜è®¤å€¼ä¸º10ï¼Œæ„æ€æ˜¯è¿è¡Œ10ç§’ä»¥ä¸Šçš„è¯­å¥ã€‚</li>
<li>ç”±ä»–æ¥æŸ¥çœ‹å“ªäº›SQLè¶…å‡ºäº†æˆ‘ä»¬çš„æœ€å¤§å¿è€æ—¶é—´å€¼ï¼Œæ¯”å¦‚ä¸€æ¡sqlæ‰§è¡Œè¶…è¿‡5ç§’é’Ÿï¼Œæˆ‘ä»¬å°±ç®—æ…¢SQLï¼Œå¸Œæœ›èƒ½æ”¶é›†è¶…è¿‡5ç§’çš„sqlï¼Œç»“åˆä¹‹å‰explainè¿›è¡Œå…¨é¢åˆ†æã€‚</li>
</ul>
<h4 id="3-1-2-æ…¢æŸ¥è¯¢æ—¥å¿—ä½¿ç”¨"><a href="#3-1-2-æ…¢æŸ¥è¯¢æ—¥å¿—ä½¿ç”¨" class="headerlink" title="3.1.2 æ…¢æŸ¥è¯¢æ—¥å¿—ä½¿ç”¨"></a>3.1.2 æ…¢æŸ¥è¯¢æ—¥å¿—ä½¿ç”¨</h4><blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQLæ•°æ®åº“æ²¡æœ‰å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚å½“ç„¶ï¼Œå¦‚æœä¸æ˜¯è°ƒä¼˜éœ€è¦çš„è¯ï¼Œä¸€èˆ¬ä¸å»ºè®®å¯åŠ¨è¯¥å‚æ•°ï¼Œå› ä¸ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šæˆ–å¤šæˆ–å°‘å¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ã€‚æ…¢æŸ¥è¯¢æ—¥å¿—æ”¯æŒå°†æ—¥å¿—è®°å½•å†™å…¥æ–‡ä»¶</p>
</blockquote>
<ul>
<li><p>æŸ¥çœ‹æ˜¯å¦å¼€å¯åŠå¦‚ä½•å¼€å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹</span><br><span class="line">SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;</span><br><span class="line"># è®¾ç½®å¼€å¯ï¼Œåªå¯¹å½“å‰æ•°æ®åº“ç”Ÿæ•ˆ</span><br><span class="line">set global slow_query_log&#x3D;1;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>é‚£ä¹ˆå¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—åï¼Œä»€ä¹ˆæ ·çš„SQLæ‰ä¼šè®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—é‡Œé¢å‘¢ï¼Ÿ</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_36_%E6%85%A2%E6%9F%A5%E8%AF%A2%E8%AE%B0%E5%BD%95%E5%88%B0%E7%9A%84sql.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_36_%E6%85%A2%E6%9F%A5%E8%AF%A2%E8%AE%B0%E5%BD%95%E5%88%B0%E7%9A%84sql.png" alt="img"></a></p>
</li>
<li><p>æŸ¥çœ‹å½“å‰å¤šå°‘ç§’ç®—æ…¢, ä»¥åŠä¿®æ”¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹</span><br><span class="line">SHOW VARIABLES LIKE &#39;long_query_time%&#39;;</span><br><span class="line"># è®¾ç½®</span><br><span class="line">set global long_query_time&#x3D;1;</span><br><span class="line"># éœ€è¦é‡æ–°è¿æ¥æˆ–æ–°å¼€ä¸€ä¸ªä¼šè¯æ‰èƒ½çœ‹åˆ°ä¿®æ”¹å€¼</span><br><span class="line">SHOW VARIABLES LIKE &#39;long_query_time%&#39;;</span><br><span class="line"></span><br><span class="line"># æ”¹å˜å½“å‰sessionå˜é‡</span><br><span class="line">set session long_query_time&#x3D;1;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æŸ¥è¯¢å½“å‰ç³»ç»Ÿä¸­æœ‰å¤šå°‘æ¡æ…¢æŸ¥è¯¢è®°å½•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show global status like &#39;%Slow_queries%&#39;;  </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-1-3-æ—¥å¿—åˆ†æå·¥å…·mysqldumpslow"><a href="#3-1-3-æ—¥å¿—åˆ†æå·¥å…·mysqldumpslow" class="headerlink" title="3.1.3 æ—¥å¿—åˆ†æå·¥å…·mysqldumpslow"></a>3.1.3 æ—¥å¿—åˆ†æå·¥å…·mysqldumpslow</h4><ul>
<li><p>å·¥ä½œå¸¸ç”¨å‚è€ƒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQL</span><br><span class="line">mysqldumpslow -s r -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;atguigu-slow.log</span><br><span class="line"># å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªSQL</span><br><span class="line">mysqldumpslow -s c -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;atguigu-slow.log</span><br><span class="line"># å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥</span><br><span class="line">mysqldumpslow -s t -t 10 -g &quot;left join&quot; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;atguigu-slow.log</span><br><span class="line"># å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œmore ä½¿ç”¨ ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µ</span><br><span class="line">mysqldumpslow -s r -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;atguigu-slow.log | more</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_37_mysqldumpslow.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_37_mysqldumpslow.png" alt="img"></a></p>
</li>
</ul>
<h3 id="3-2-æ‰¹é‡æ•°æ®è„šæœ¬"><a href="#3-2-æ‰¹é‡æ•°æ®è„šæœ¬" class="headerlink" title="3.2 æ‰¹é‡æ•°æ®è„šæœ¬"></a>3.2 æ‰¹é‡æ•°æ®è„šæœ¬</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_38_%E6%89%B9%E9%87%8F%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_38_%E6%89%B9%E9%87%8F%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC.png" alt="img"></a></p>
<ul>
<li><p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™ï¼šThis function has none of DETERMINISTICâ€¦â€¦</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ç”±äºå¼€å¯è¿‡æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå› ä¸ºæˆ‘ä»¬å¼€å¯äº† bin-log, æˆ‘ä»¬å°±å¿…é¡»ä¸ºæˆ‘ä»¬çš„functionæŒ‡å®šä¸€ä¸ªå‚æ•°ã€‚</span><br><span class="line">show variables like &#39;log_bin_trust_function_creators&#39;;</span><br><span class="line">set global log_bin_trust_function_creators&#x3D;1;</span><br><span class="line"></span><br><span class="line"># è¿™æ ·æ·»åŠ äº†å‚æ•°ä»¥åï¼Œå¦‚æœmysqldé‡å¯ï¼Œä¸Šè¿°å‚æ•°åˆä¼šæ¶ˆå¤±ï¼Œæ°¸ä¹…æ–¹æ³•ï¼š</span><br><span class="line"># windowsä¸‹: my.ini[mysqld]åŠ ä¸Šlog_bin_trust_function_creators&#x3D;1</span><br><span class="line"># linuxä¸‹: &#x2F;etc&#x2F;my.cnfä¸‹my.cnf[mysqld]åŠ ä¸Šlog_bin_trust_function_creators&#x3D;1</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>åˆ›å»ºå‡½æ•°,ä¿è¯æ¯æ¡æ•°æ®éƒ½ä¸åŒ</p>
<ul>
<li><p>éšæœºäº§ç”Ÿå­—ç¬¦ä¸²</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE FUNCTION rand_string(n INT) RETURNS VARCHAR(255)</span><br><span class="line">BEGIN    ##æ–¹æ³•å¼€å§‹ </span><br><span class="line">DECLARE chars_str VARCHAR(100) DEFAULT   &#39;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#39;;  ##å£°æ˜ä¸€ä¸ª å­—ç¬¦çªœé•¿åº¦ä¸º 100 çš„å˜é‡ chars_str ,é»˜è®¤å€¼  </span><br><span class="line">DECLARE return_str VARCHAR(255) DEFAULT &#39;&#39;; DECLARE i INT DEFAULT 0;  ##å¾ªç¯å¼€å§‹</span><br><span class="line">WHILE i &lt; n DO   </span><br><span class="line">SET return_str &#x3D;CONCAT(return_str,SUBSTRING(chars_str,FLOOR(1+RAND()*52),1));##concat è¿æ¥å‡½æ•°  ï¼Œsubstring(a,index,length) ä»indexå¤„å¼€å§‹æˆªå–</span><br><span class="line">SET i &#x3D; i + 1;</span><br><span class="line">END WHILE;</span><br><span class="line">RETURN return_str;</span><br><span class="line">END $$ </span><br><span class="line"># å‡å¦‚è¦åˆ é™¤</span><br><span class="line"># drop function rand_string;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>éšæœºäº§ç”Ÿéƒ¨é—¨ç¼–å·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    DELIMITER $$</span><br><span class="line">    CREATE FUNCTION rand_num( ) RETURNS INT(5)</span><br><span class="line">BEGIN    </span><br><span class="line">    DECLARE i INT DEFAULT 0;</span><br><span class="line">    SET i &#x3D; FLOOR(100+RAND()*10);</span><br><span class="line">    RETURN i;</span><br><span class="line">    END $$  </span><br><span class="line">    # å‡å¦‚è¦åˆ é™¤</span><br><span class="line">    # drop function rand_num;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p>
<ul>
<li><p>æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹(å¾€empè¡¨æ·»åŠ éšæœºæ•°æ®)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE insert_emp10000(IN START INT(10),IN max_num INT(10))</span><br><span class="line">BEGIN  </span><br><span class="line">DECLARE i INT DEFAULT 0;   #set autocommit &#x3D;0 æŠŠautocommitè®¾ç½®æˆ0  ï¼›æé«˜æ‰§è¡Œæ•ˆç‡ </span><br><span class="line">SET autocommit &#x3D; 0;     </span><br><span class="line">REPEAT  ##é‡å¤ </span><br><span class="line">SET i &#x3D; i + 1;   </span><br><span class="line">INSERT INTO emp10000 (empno, ename ,job ,mgr ,hiredate ,sal ,comm ,deptno ) VALUES ((START+i) ,rand_string(6),&#39;SALESMAN&#39;,0001,CURDATE(),FLOOR(1+RAND()*20000),FLOOR(1+RAND()*1000),rand_num());   </span><br><span class="line">UNTIL i &#x3D; max_num   ##ç›´åˆ°  ä¸Šé¢ä¹Ÿæ˜¯ä¸€ä¸ªå¾ªç¯</span><br><span class="line">END REPEAT;  ##æ»¡è¶³æ¡ä»¶åç»“æŸå¾ªç¯ </span><br><span class="line">COMMIT;   ##æ‰§è¡Œå®Œæˆåä¸€èµ·æäº¤ </span><br><span class="line">END $$ </span><br><span class="line"># åˆ é™¤</span><br><span class="line"># DELIMITER ;</span><br><span class="line"># drop PROCEDURE insert_emp; </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹(å¾€deptè¡¨æ·»åŠ éšæœºæ•°æ®)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€deptè¡¨æ·»åŠ éšæœºæ•°æ®</span><br><span class="line">DELIMITER $$</span><br><span class="line">CREATE PROCEDURE insert_dept(IN START INT(10),IN max_num INT(10))</span><br><span class="line">BEGIN  </span><br><span class="line">DECLARE i INT DEFAULT 0;</span><br><span class="line">SET autocommit &#x3D; 0;     </span><br><span class="line">REPEAT   </span><br><span class="line">SET i &#x3D; i + 1;   </span><br><span class="line">INSERT INTO dept (deptno ,dname,loc ) VALUES (START +i ,rand_string(10),rand_string(8));   </span><br><span class="line">UNTIL i &#x3D; max_num   </span><br><span class="line">END REPEAT;   </span><br><span class="line">COMMIT;   </span><br><span class="line">END $$  </span><br><span class="line">#åˆ é™¤</span><br><span class="line"># DELIMITER ; #å°† ç»“æŸæ ‡å¿—æ¢å› ;</span><br><span class="line"># drop PROCEDURE insert_dept;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</p>
<ul>
<li><p>dept</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER ; #å°† ç»“æŸæ ‡å¿—æ¢å› ;</span><br><span class="line">CALL insert_dept(100,10); </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>emp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€empè¡¨æ·»åŠ 50ä¸‡æ¡æ•°æ®</span><br><span class="line">DELIMITER ;    #å°† ç»“æŸæ ‡å¿—æ¢å› ;</span><br><span class="line">CALL insert_emp(100001,500000);  </span><br><span class="line">CALL insert_emp10000(100001,10000);    </span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="3-3-Show-Profile"><a href="#3-3-Show-Profile" class="headerlink" title="3.3 Show Profile"></a>3.3 Show Profile</h3><h4 id="3-3-1-ä»‹ç»"><a href="#3-3-1-ä»‹ç»" class="headerlink" title="3.3.1 ä»‹ç»"></a>3.3.1 ä»‹ç»</h4><blockquote>
<p>æ˜¯ä»€ä¹ˆï¼šæ˜¯mysqlæä¾›å¯ä»¥ç”¨æ¥åˆ†æå½“å‰ä¼šè¯ä¸­è¯­å¥æ‰§è¡Œçš„èµ„æºæ¶ˆè€—æƒ…å†µã€‚å¯ä»¥ç”¨äºSQLçš„è°ƒä¼˜çš„æµ‹é‡</p>
</blockquote>
<h4 id="3-3-2-å®˜ç½‘ä»‹ç»"><a href="#3-3-2-å®˜ç½‘ä»‹ç»" class="headerlink" title="3.3.2 å®˜ç½‘ä»‹ç»"></a>3.3.2 å®˜ç½‘ä»‹ç»</h4><p>å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/refman/5.5/en/show-profile.html">http://dev.mysql.com/doc/refman/5.5/en/show-profile.html</a></p>
<h4 id="3-3-3-é»˜è®¤è®¾ç½®"><a href="#3-3-3-é»˜è®¤è®¾ç½®" class="headerlink" title="3.3.3 é»˜è®¤è®¾ç½®"></a>3.3.3 é»˜è®¤è®¾ç½®</h4><blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‚æ•°å¤„äºå…³é—­çŠ¶æ€ï¼Œå¹¶ä¿å­˜æœ€è¿‘15æ¬¡çš„è¿è¡Œç»“æœ</p>
</blockquote>
<h4 id="3-3-4-åˆ†ææ­¥éª¤"><a href="#3-3-4-åˆ†ææ­¥éª¤" class="headerlink" title="3.3.4 åˆ†ææ­¥éª¤"></a>3.3.4 åˆ†ææ­¥éª¤</h4><ul>
<li><p>çœ‹çœ‹å½“å‰çš„mysqlç‰ˆæœ¬æ˜¯å¦æ”¯æŒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Show variables like &#39;profiling&#39;; #  é»˜è®¤æ˜¯å…³é—­ï¼Œä½¿ç”¨å‰éœ€è¦å¼€å¯    </span><br><span class="line">set profiling&#x3D;1;  #  å¼€å¯</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>è¿è¡ŒSQL</p>
</li>
<li><p>æŸ¥çœ‹ç»“æœï¼Œshow profilesï¼›</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_39_showprofiles.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_39_showprofiles.png" alt="img"></a></p>
</li>
<li><p>è¯Šæ–­SQLï¼Œshow profile cpu,block io for query n (nä¸ºä¸Šä¸€æ­¥å‰é¢çš„é—®é¢˜SQLæ•°å­—å·ç );</p>
<ul>
<li><p>æŸ¥è¯¢å‘½ä»¤çš„å‚æ•°</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_39_showprofiles%E8%AF%8A%E6%96%AD2.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_39_showprofiles%E8%AF%8A%E6%96%AD2.png" alt="img"></a></p>
</li>
<li><p>æŸ¥è¯¢ç»“æœ</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_39_showprofiles%E8%AF%8A%E6%96%AD.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_39_showprofiles%E8%AF%8A%E6%96%AD.png" alt="img"></a></p>
</li>
</ul>
</li>
<li><p>æ—¥å¸¸å¼€å‘éœ€è¦æ³¨æ„çš„ç»“è®º</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_40_showprofiles%E8%AF%8A%E6%96%AD%E6%B3%A8%E6%84%8F%E7%9A%84%E7%BB%93%E8%AE%BA.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_40_showprofiles%E8%AF%8A%E6%96%AD%E6%B3%A8%E6%84%8F%E7%9A%84%E7%BB%93%E8%AE%BA.png" alt="img"></a></p>
<ul>
<li><p>åˆ›å»ºä¸´æ—¶è¡¨çš„æ€§èƒ½è€—è´¹ç¤ºä¾‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_40_showprofiles%E8%AF%8A%E6%96%AD%E6%B3%A8%E6%84%8F%E7%9A%84%E7%BB%93%E8%AE%BA2.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_40_showprofiles%E8%AF%8A%E6%96%AD%E6%B3%A8%E6%84%8F%E7%9A%84%E7%BB%93%E8%AE%BA2.png" alt="img"></a></p>
</li>
</ul>
</li>
</ul>
<h3 id="3-4-å…¨å±€æŸ¥è¯¢æ—¥å¿—"><a href="#3-4-å…¨å±€æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="3.4 å…¨å±€æŸ¥è¯¢æ—¥å¿—"></a>3.4 å…¨å±€æŸ¥è¯¢æ—¥å¿—</h3><h4 id="3-4-1-é…ç½®å¯ç”¨"><a href="#3-4-1-é…ç½®å¯ç”¨" class="headerlink" title="3.4.1 é…ç½®å¯ç”¨"></a>3.4.1 é…ç½®å¯ç”¨</h4><p>åœ¨mysqlçš„my.cnfä¸­ï¼Œè®¾ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯</span><br><span class="line">general_log&#x3D;1  </span><br><span class="line"># è®°å½•æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„</span><br><span class="line">general_log_file&#x3D;&#x2F;path&#x2F;logfile</span><br><span class="line"># è¾“å‡ºæ ¼å¼</span><br><span class="line">log_output&#x3D;FILE</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<h4 id="3-4-2-ç¼–ç å¯ç”¨"><a href="#3-4-2-ç¼–ç å¯ç”¨" class="headerlink" title="3.4.2 ç¼–ç å¯ç”¨"></a>3.4.2 ç¼–ç å¯ç”¨</h4><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_41_%E5%85%A8%E5%B1%80%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E7%BC%96%E7%A0%81%E5%90%AF%E7%94%A8.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_41_%E5%85%A8%E5%B1%80%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E7%BC%96%E7%A0%81%E5%90%AF%E7%94%A8.png" alt="img"></a></p>
<blockquote>
<p><strong>ç‰¹åˆ«çš„ï¼šå°½é‡ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒå¼€å¯è¿™ä¸ªåŠŸèƒ½</strong></p>
</blockquote>
<h2 id="4-MySQLé”æœºåˆ¶"><a href="#4-MySQLé”æœºåˆ¶" class="headerlink" title="4. MySQLé”æœºåˆ¶"></a>4. MySQLé”æœºåˆ¶</h2><h3 id="4-1-æ¦‚è¿°"><a href="#4-1-æ¦‚è¿°" class="headerlink" title="4.1 æ¦‚è¿°"></a>4.1 æ¦‚è¿°</h3><blockquote>
<p>é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ã€‚ åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚CPUã€RAMã€I/Oç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚å¦‚ä½•ä¿è¯æ•°æ®å¹¶å‘è®¿é—®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§æ˜¯æ‰€æœ‰æ•°æ®åº“å¿…é¡»è§£å†³çš„ä¸€ä¸ªé—®é¢˜ï¼Œé”å†²çªä¹Ÿæ˜¯å½±å“æ•°æ®åº“å¹¶å‘è®¿é—®æ€§èƒ½çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œé”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p>
</blockquote>
<h3 id="4-2-é”çš„åˆ†ç±»"><a href="#4-2-é”çš„åˆ†ç±»" class="headerlink" title="4.2 é”çš„åˆ†ç±»"></a>4.2 é”çš„åˆ†ç±»</h3><h4 id="4-2-1-ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹ï¼ˆè¯»-å†™ï¼‰åˆ†"><a href="#4-2-1-ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹ï¼ˆè¯»-å†™ï¼‰åˆ†" class="headerlink" title="4.2.1 ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹ï¼ˆè¯»\å†™ï¼‰åˆ†"></a>4.2.1 ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹ï¼ˆè¯»\å†™ï¼‰åˆ†</h4><ul>
<li>è¯»é”(å…±äº«é”)ï¼šé’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ã€‚</li>
<li>å†™é”(æ’å®ƒé”)ï¼šå½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚</li>
</ul>
<h4 id="4-2-2-ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†"><a href="#4-2-2-ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†" class="headerlink" title="4.2.2 ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†"></a>4.2.2 ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†</h4><ul>
<li>è¡¨é”</li>
<li>è¡Œé”</li>
</ul>
<h3 id="4-3-ä¸‰é”"><a href="#4-3-ä¸‰é”" class="headerlink" title="4.3 ä¸‰é”"></a>4.3 ä¸‰é”</h3><h4 id="4-3-1-è¡¨é”ï¼ˆåè¯»ï¼‰"><a href="#4-3-1-è¡¨é”ï¼ˆåè¯»ï¼‰" class="headerlink" title="4.3.1 è¡¨é”ï¼ˆåè¯»ï¼‰"></a>4.3.1 è¡¨é”ï¼ˆåè¯»ï¼‰</h4><blockquote>
<p>ç‰¹ç‚¹ï¼šåå‘MyISAMå­˜å‚¨å¼•æ“ï¼Œå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›æ— æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜,å¹¶å‘åº¦æœ€ä½ã€‚</p>
</blockquote>
<ul>
<li><p>æ‰‹åŠ¨åŠ è¯»å†™é”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lock tabel è¡¨å read(write), è¡¨å2 read(write), ...;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æŸ¥çœ‹è¡¨ä¸ŠåŠ è¿‡çš„é”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show open tables;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>é‡Šæ”¾è¡¨é”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unlock tables;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æ€»ç»“</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_42_%E8%A1%A8%E9%94%81.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_42_%E8%A1%A8%E9%94%81.png" alt="img"></a></p>
<p>è¡¥å……ï¼šåŠ è¯»é”çš„sessionä¹Ÿä¸èƒ½ä¿®æ”¹åŠ è¯»é”çš„è¡¨ã€‚</p>
<p><strong>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¯»é”ä¼šé˜»å¡å†™ï¼Œä½†æ˜¯ä¸ä¼šå µå¡è¯»ã€‚è€Œå†™é”åˆ™ä¼šæŠŠè¯»å’Œå†™éƒ½å µå¡</strong></p>
</li>
<li><p>å¦‚ä½•åˆ†æè¡¨é”å®š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_43_%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E8%A1%A8%E9%94%81%E5%AE%9A.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_43_%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E8%A1%A8%E9%94%81%E5%AE%9A.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_43_%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E8%A1%A8%E9%94%81%E5%AE%9A2.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_43_%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E8%A1%A8%E9%94%81%E5%AE%9A2.png" alt="img"></a></p>
</li>
</ul>
<h4 id="4-3-2-è¡Œé”ï¼ˆåå†™ï¼‰"><a href="#4-3-2-è¡Œé”ï¼ˆåå†™ï¼‰" class="headerlink" title="4.3.2 è¡Œé”ï¼ˆåå†™ï¼‰"></a>4.3.2 è¡Œé”ï¼ˆåå†™ï¼‰</h4><blockquote>
<p>ç‰¹ç‚¹ï¼š</p>
<ol>
<li>åå‘InnoDBå­˜å‚¨å¼•æ“ï¼Œå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½,å¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚</li>
<li>InnoDBä¸MyISAMçš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼ˆTRANSACTIONï¼‰ï¼›äºŒæ˜¯é‡‡ç”¨äº†è¡Œçº§é”</li>
</ol>
</blockquote>
<ul>
<li><p>è¡Œé”æ”¯æŒäº‹åŠ¡ï¼Œ<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/08/MySQL%E5%9F%BA%E7%A1%80/#5-TCL%E8%AF%AD%E8%A8%80">å¤ä¹ åˆçº§éƒ¨åˆ†çŸ¥è¯†â­</a></p>
<ul>
<li><p>é‡ç‚¹:äº‹åŠ¡ç‰¹æ€§ã€å¹¶å‘äº‹åŠ¡å¯¼è‡´çš„é—®é¢˜ã€äº‹åŠ¡éš”ç¦»çº§åˆ«ç­‰</p>
</li>
<li><p>è¡¥å……ï¼šå¹¶å‘äº‹åŠ¡å¯¼è‡´çš„é—®é¢˜ï¼ˆæ›´æ–°ä¸¢å¤±ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_44_%E6%9B%B4%E6%96%B0%E4%B8%A2%E5%A4%B1.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_44_%E6%9B%B4%E6%96%B0%E4%B8%A2%E5%A4%B1.png" alt="img"></a></p>
</li>
</ul>
</li>
<li><p><strong>æ— ç´¢å¼•(æˆ–è€…ç´¢å¼•å¤±æ•ˆ)è¡Œé”å‡çº§ä¸ºè¡¨é”</strong></p>
</li>
<li><p>é—´éš™é”çš„å±å®³</p>
<ul>
<li><p><strong>é—´éš™é”</strong>:</p>
<p>å½“æˆ‘ä»¬ç”¨èŒƒå›´æ¡ä»¶è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è®°å½•çš„ç´¢å¼•é¡¹åŠ é”ï¼›å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åšâ€œé—´éš™ï¼ˆGAP)â€ï¼ŒInnoDBä¹Ÿä¼šå¯¹è¿™ä¸ªâ€œé—´éš™â€åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„é—´éš™é”ï¼ˆGAP Lockï¼‰ã€‚</p>
</li>
<li><p><strong>å±å®³</strong>:</p>
<p>å› ä¸ºQueryæ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡è¿‡èŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œä»–ä¼šé”å®šæ•´ä¸ªèŒƒå›´å†…æ‰€æœ‰çš„ç´¢å¼•é”®å€¼ï¼Œå³ä½¿è¿™ä¸ªé”®å€¼å¹¶ä¸å­˜åœ¨ã€‚é—´éš™é”æœ‰ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„å¼±ç‚¹ï¼Œå°±æ˜¯å½“é”å®šä¸€ä¸ªèŒƒå›´é”®å€¼ä¹‹åï¼Œå³ä½¿æŸäº›ä¸å­˜åœ¨çš„é”®å€¼ä¹Ÿä¼šè¢«æ— è¾œçš„é”å®šï¼Œè€Œé€ æˆåœ¨é”å®šçš„æ—¶å€™æ— æ³•æ’å…¥é”å®šé”®å€¼èŒƒå›´å†…çš„ä»»ä½•æ•°æ®ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹è¿™å¯èƒ½ä¼šå¯¹æ€§èƒ½é€ æˆå¾ˆå¤§çš„å±å®³</p>
</li>
</ul>
</li>
<li><p><strong>[é¢è¯•é¢˜] å¸¸è€ƒå¦‚ä½•é”å®šä¸€è¡Œ</strong></p>
<p>äº‹åŠ¡æ˜¾ç¤ºåŠ é”[<a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fn:9">9]</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">##åœ¨ MySQL 5.7 ä¸­</span><br><span class="line">å…±äº«é”ï¼ˆSï¼‰ï¼šSELECT * FROM table_name WHERE ... LOCK IN SHARE MODE</span><br><span class="line">æ’ä»–é”ï¼ˆXï¼‰ï¼šSELECT * FROM table_name WHERE ... FOR UPDATE</span><br><span class="line"></span><br><span class="line">##åœ¨ MySQL 8.0 ä¸­</span><br><span class="line">å…±äº«é”ï¼ˆSï¼‰ï¼šSELECT * FROM table_name WHERE ... FOR SHARE</span><br><span class="line">æ’ä»–é”ï¼ˆXï¼‰ï¼šSELECT * FROM table_name WHERE ... FOR UPDATE[NOWAIT|SKIP LOCKED]</span><br><span class="line">--NOWAIT:å‘ç°æœ‰é”ç­‰å¾…åä¼šç«‹å³è¿”å›é”™è¯¯ï¼Œä¸ç”¨ç­‰å¾…é”è¶…æ—¶åæŠ¥é”™ã€‚</span><br><span class="line">--SKIP LOCKED:è·³è¿‡è¢«é”å®šçš„è¡Œï¼Œç›´æ¥æ›´æ–°å…¶ä»–è¡Œï¼Œä½†æ˜¯è¿™æ ·è¦æ³¨æ„æ˜¯å¦ä¼šé€ æˆæ›´æ–°ç»“æœä¸ç¬¦åˆé¢„æœŸã€‚</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_45_%E9%9D%A2%E8%AF%95%E9%A2%98.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_45_%E9%9D%A2%E8%AF%95%E9%A2%98.png" alt="img"></a></p>
</li>
<li><p>Innodbå­˜å‚¨å¼•æ“ç”±äºå®ç°äº†è¡Œçº§é”å®šï¼Œè™½ç„¶åœ¨é”å®šæœºåˆ¶çš„å®ç°æ–¹é¢æ‰€å¸¦æ¥çš„æ€§èƒ½æŸè€—å¯èƒ½æ¯”è¡¨çº§é”å®šä¼šè¦æ›´é«˜ä¸€äº›ï¼Œä½†æ˜¯åœ¨æ•´ä½“å¹¶å‘å¤„ç†èƒ½åŠ›æ–¹é¢è¦è¿œè¿œä¼˜äºMyISAMçš„è¡¨çº§é”å®šçš„ã€‚å½“ç³»ç»Ÿå¹¶å‘é‡è¾ƒé«˜çš„æ—¶å€™ï¼ŒInnodbçš„æ•´ä½“æ€§èƒ½å’ŒMyISAMç›¸æ¯”å°±ä¼šæœ‰æ¯”è¾ƒæ˜æ˜¾çš„ä¼˜åŠ¿äº†ã€‚</p>
</li>
<li><p>ä½†æ˜¯ï¼ŒInnodbçš„è¡Œçº§é”å®šåŒæ ·ä¹Ÿæœ‰å…¶è„†å¼±çš„ä¸€é¢ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸å½“çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè®©Innodbçš„æ•´ä½“æ€§èƒ½è¡¨ç°ä¸ä»…ä¸èƒ½æ¯”MyISAMé«˜ï¼Œç”šè‡³å¯èƒ½ä¼šæ›´å·®ã€‚</p>
</li>
<li><p>å¦‚ä½•åˆ†æè¡Œé”å®š</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_47_%E8%A1%8C%E9%94%81%E5%AE%9A%E5%88%86%E6%9E%903.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_47_%E8%A1%8C%E9%94%81%E5%AE%9A%E5%88%86%E6%9E%903.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_47_%E8%A1%8C%E9%94%81%E5%AE%9A%E5%88%86%E6%9E%902.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_47_%E8%A1%8C%E9%94%81%E5%AE%9A%E5%88%86%E6%9E%902.png" alt="img"></a></p>
</li>
<li><p>ä¼˜åŒ–å»ºè®®ï¼š</p>
<ul>
<li>å°½å¯èƒ½è®©æ‰€æœ‰æ•°æ®æ£€ç´¢éƒ½é€šè¿‡ç´¢å¼•æ¥å®Œæˆï¼Œé¿å…æ— ç´¢å¼•è¡Œé”å‡çº§ä¸ºè¡¨é”</li>
<li>å°½å¯èƒ½è¾ƒå°‘æ£€ç´¢æ¡ä»¶ï¼Œé¿å…é—´éš™é”</li>
<li>å°½é‡æ§åˆ¶äº‹åŠ¡å¤§å°ï¼Œå‡å°‘é”å®šèµ„æºé‡å’Œæ—¶é—´é•¿åº¦</li>
<li>é”ä½æŸè¡Œåï¼Œå°½é‡ä¸è¦å»è°ƒåˆ«çš„è¡Œæˆ–è¡¨ï¼Œèµ¶ç´§å¤„ç†è¢«é”ä½çš„è¡Œç„¶åé‡Šæ”¾æ‰é”</li>
<li>æ¶‰åŠç›¸åŒè¡¨çš„äº‹åŠ¡ï¼Œå¯¹äºè°ƒç”¨è¡¨çš„é¡ºåºå°½é‡ä¿æŒä¸€è‡´</li>
<li>åœ¨ä¸šåŠ¡ç¯å¢ƒå…è®¸çš„æƒ…å†µä¸‹,å°½å¯èƒ½ä½çº§åˆ«äº‹åŠ¡éš”ç¦»</li>
</ul>
</li>
</ul>
<h4 id="4-3-2-é¡µé”ï¼ˆäº†è§£ï¼‰"><a href="#4-3-2-é¡µé”ï¼ˆäº†è§£ï¼‰" class="headerlink" title="4.3.2 é¡µé”ï¼ˆäº†è§£ï¼‰"></a>4.3.2 é¡µé”ï¼ˆäº†è§£ï¼‰</h4><blockquote>
<p>å¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›</p>
<p>ä¼šå‡ºç°æ­»é”ï¼›</p>
<p>é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚</p>
</blockquote>
<h2 id="5-ä¸»ä»å¤åˆ¶â­"><a href="#5-ä¸»ä»å¤åˆ¶â­" class="headerlink" title="5. ä¸»ä»å¤åˆ¶â­"></a>5. ä¸»ä»å¤åˆ¶â­</h2><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_48_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_48_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.png" alt="img"></a></p>
<h3 id="5-1-å¤åˆ¶çš„åŸºæœ¬åŸç†"><a href="#5-1-å¤åˆ¶çš„åŸºæœ¬åŸç†" class="headerlink" title="5.1 å¤åˆ¶çš„åŸºæœ¬åŸç†"></a>5.1 å¤åˆ¶çš„åŸºæœ¬åŸç†</h3><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_49_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86.png"><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_49_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86.png" alt="img"></a></p>
<h3 id="5-2-å¤åˆ¶çš„åŸºæœ¬åŸåˆ™"><a href="#5-2-å¤åˆ¶çš„åŸºæœ¬åŸåˆ™" class="headerlink" title="5.2 å¤åˆ¶çš„åŸºæœ¬åŸåˆ™"></a>5.2 å¤åˆ¶çš„åŸºæœ¬åŸåˆ™</h3><ul>
<li>æ¯ä¸ªslaveåªæœ‰ä¸€ä¸ªmaster</li>
<li>æ¯ä¸ªslaveåªèƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å™¨ID</li>
<li>æ¯ä¸ªmasterå¯ä»¥æœ‰å¤šä¸ªsalve</li>
</ul>
<h3 id="5-3-å¤åˆ¶çš„æœ€å¤§é—®é¢˜"><a href="#5-3-å¤åˆ¶çš„æœ€å¤§é—®é¢˜" class="headerlink" title="5.3 å¤åˆ¶çš„æœ€å¤§é—®é¢˜"></a>5.3 å¤åˆ¶çš„æœ€å¤§é—®é¢˜</h3><blockquote>
<p>å»¶æ—¶</p>
</blockquote>
<h3 id="5-4-ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®"><a href="#5-4-ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®" class="headerlink" title="5.4 ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®"></a>5.4 ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®</h3><ul>
<li><p>mysqlç‰ˆæœ¬ä¸€è‡´ä¸”åå°ä»¥æœåŠ¡è¿è¡Œ</p>
</li>
<li><p>ä¸»ä»éƒ½é…ç½®åœ¨[mysqld]ç»“ç‚¹ä¸‹ï¼Œéƒ½æ˜¯å°å†™</p>
</li>
<li><p>ä¸»æœºä¿®æ”¹my.inié…ç½®æ–‡ä»¶</p>
<ul>
<li>[å¿…é¡»]ä¸»æœåŠ¡å™¨å”¯ä¸€ID<ul>
<li>server-id=1</li>
</ul>
</li>
</ul>
</li>
<li><p>[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</p>
<ul>
<li>log-bin=è‡ªå·±æœ¬åœ°çš„è·¯å¾„/data/mysqlbin<ul>
<li>log-bin=D:/devSoft/MySQLServer5.5/data/mysqlbin</li>
</ul>
</li>
<li>[å¯é€‰]å¯ç”¨é”™è¯¯æ—¥å¿—<ul>
<li>log-err=è‡ªå·±æœ¬åœ°çš„è·¯å¾„/data/mysqlerr</li>
</ul>
</li>
<li>log-err=D:/devSoft/MySQLServer5.5/data/mys</li>
<li>[å¯é€‰]æ ¹ç›®å½•</li>
<li>basedir=â€è‡ªå·±æœ¬åœ°è·¯å¾„â€<ul>
<li>basedir=â€D:/devSoft/MySQLServer5.5/â€œ</li>
</ul>
</li>
</ul>
</li>
<li><p>[å¯é€‰]ä¸´æ—¶ç›®å½•</p>
<ul>
<li>tmpdir=â€è‡ªå·±æœ¬åœ°è·¯å¾„â€</li>
<li>tmpdir=â€D:/devSoft/MySQLServer5.5/â€œ</li>
<li>[å¯é€‰]æ•°æ®ç›®å½•<ul>
<li>datadir=â€è‡ªå·±æœ¬åœ°è·¯å¾„/Data/â€œ</li>
<li>datadir=â€D:/devSoft/MySQLServer5.5/Data/â€œ</li>
</ul>
</li>
</ul>
</li>
<li><p>read-only=0</p>
<ul>
<li>ä¸»æœºï¼Œè¯»å†™éƒ½å¯ä»¥</li>
<li>[å¯é€‰]è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“</li>
<li>binlog-ignore-db=mysql</li>
<li>[å¯é€‰]è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“<ul>
<li>binlog-do-db=éœ€è¦å¤åˆ¶çš„ä¸»æ•°æ®åº“åå­—</li>
</ul>
</li>
</ul>
</li>
<li><p>ä»æœºä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶</p>
<ul>
<li>[å¿…é¡»]ä»æœåŠ¡å™¨å”¯ä¸€ID</li>
<li>[å¯é€‰]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</li>
</ul>
</li>
<li><p>å› ä¿®æ”¹è¿‡é…ç½®æ–‡ä»¶ï¼Œè¯·ä¸»æœº+ä»æœºéƒ½é‡å¯åå°mysqlæœåŠ¡</p>
</li>
<li><p>ä¸»æœºä»æœºéƒ½å…³é—­é˜²ç«å¢™</p>
<ul>
<li>windowsæ‰‹åŠ¨å…³é—­</li>
<li>å…³é—­è™šæ‹Ÿæœºlinuxé˜²ç«å¢™ service iptables stop</li>
</ul>
</li>
<li><p>åœ¨Windowsä¸»æœºä¸Šå»ºç«‹å¸æˆ·å¹¶æˆæƒslave</p>
<ul>
<li><p>åœ¨ä¸»æœºmysqlä¸­æ‰§è¡Œæˆæƒå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 1.æˆæƒ</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO &#39;zhangsan&#39;@&#39;ä»æœºå™¨æ•°æ®åº“IP&#39; IDENTIFIED BY &#39;123456&#39;;</span><br><span class="line"># 2.æ‰§è¡Œç»“æŸååˆ·æ–°</span><br><span class="line">flush privileges;</span><br><span class="line"># 3.æŸ¥è¯¢ä¸»æœºçŠ¶æ€</span><br><span class="line">show master status;</span><br><span class="line"># 4.è®°å½•ä¸‹Fileå’ŒPositionçš„å€¼</span><br><span class="line"># 5.æ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MYSQLï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>åœ¨Linuxä»æœºä¸Šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº</p>
<ul>
<li><p>åœ¨ä»æœºmysqlä¸­æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;ä¸»æœºIP&#39;,</span><br><span class="line">MASTER_USER&#x3D;&#39;zhangsan&#39;,</span><br><span class="line">MASTER_PASSWORD&#x3D;&#39;123456&#39;,</span><br><span class="line">MASTER_LOG_FILE&#x3D;&#39;Fileåå­—&#39;,MASTER_LOG_POS&#x3D;Positionæ•°å­—;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>å¯åŠ¨ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure></li>
<li><p>æŸ¥çœ‹ä»æœºçŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show slave status\G</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Yesï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸ!</p>
<p>Slave_IO_Running: Yes</p>
<p>Slave_SQL_Running: Yes</p>
</li>
</ul>
</li>
<li><p>ä¸»æœºæ–°å»ºåº“ã€æ–°å»ºè¡¨ã€insertè®°å½•ï¼Œä»æœºå¤åˆ¶</p>
</li>
<li><p>å¦‚ä½•åœæ­¢ä»æœåŠ¡å¤åˆ¶åŠŸèƒ½</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åœæ­¢åï¼Œé‡æ–°æˆæƒéœ€è¦é‡æ–°æŸ¥çœ‹ä¸»æœºçŠ¶æ€ï¼Œè®°å½•ä¸‹Fileå’ŒPositionçš„å€¼</p>
</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™ï¼š"><a href="#å‚è€ƒèµ„æ–™ï¼š" class="headerlink" title="å‚è€ƒèµ„æ–™ï¼š"></a>å‚è€ƒèµ„æ–™ï¼š</h2><ol>
<li><a target="_blank" rel="noopener" href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">http://blog.codinglabs.org/articles/theory-of-mysql-index.html</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:1">â†©</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12b411K7Zu?p=179">https://www.bilibili.com/video/BV12b411K7Zu?p=179</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:2">â†©</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/feichitianxia/article/details/107997795">https://blog.csdn.net/feichitianxia/article/details/107997795</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:3">â†©</a></li>
<li>Baron Scbwartzç­‰ è‘—ï¼Œç‹å°ä¸œç­‰ è¯‘ï¼›é«˜æ€§èƒ½MySQLï¼ˆHigh Performance MySQLï¼‰ï¼›ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾ï¼Œ2010 <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:4">â†©</a></li>
<li>Michael Kofler è‘—ï¼Œæ¨æ™“äº‘ç­‰ è¯‘ï¼›MySQL5æƒå¨æŒ‡å—ï¼ˆThe Definitive Guide to MySQL5ï¼‰ï¼›äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾ï¼Œ2006 <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:5">â†©</a></li>
<li>D Comer, Ubiquitous B-tree; ACM Computing Surveys (CSUR), 1979 <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:6">â†©</a></li>
<li>Codd, E. F. (1970). â€œA relational model of data for large shared data banksâ€. Communications of the ACM, , Vol. 13, No. 6, pp. 377-387 <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:7">â†©</a></li>
<li>MySQL5.1å‚è€ƒæ‰‹å†Œ - <a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/refman/5.1/zh/index.html">http://dev.mysql.com/doc/refman/5.1/zh/index.html</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:8">â†©</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33033819/article/details/106445880">https://blog.csdn.net/qq_33033819/article/details/106445880</a> <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:9">â†©</a></li>
<li>ã€Šæ•°æ®åº“åŸç†ã€‹ <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/#fnref:10">â†©</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/06/MySQL%E9%AB%98%E7%BA%A7/" data-id="cknyemfcq00096oube4jx0833" data-title="MySQLé«˜çº§" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/26/%E5%AD%97%E8%8A%82%E5%AE%9E%E4%B9%A0/">å­—èŠ‚å®ä¹ </a>
          </li>
        
          <li>
            <a href="/2021/04/18/jvm%E5%AD%A6%E4%B9%A0/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/04/18/juc%E5%AD%A6%E4%B9%A0/">jucå­¦ä¹ </a>
          </li>
        
          <li>
            <a href="/2021/04/07/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2021/04/06/redis%E9%9B%86%E7%BE%A4%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>